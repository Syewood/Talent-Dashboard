<!DOCTYPE html>
<!--
PortSwigger Talent Dashboard - Standalone Version
Generated: 2026-01-15 13:38:51

This is a self-contained HTML file with all data and dependencies embedded.
No external files or internet connection required (except for Chart.js and XLSX CDN).

To use:
1. Open this file in any modern web browser
2. All data is embedded within the file
3. Edit mode, charts, and all features work exactly as before

To update data:
- Replace the EMBEDDED_DATA object in the <script> section
- Or regenerate this file using build_standalone.py

File size: ~609.0 KB
-->

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PortSwigger Talent Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        h1 {
            color: #ff6b35;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .filters {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-weight: 600;
            color: #ff6b35;
            font-size: 0.9em;
        }

        select, input {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #ff6b35;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        /* Row 1: 4 cards √ó 3 columns each */
        .metric-card:nth-child(1),
        .metric-card:nth-child(2),
        .metric-card:nth-child(3),
        .metric-card:nth-child(4) {
            grid-column: span 3;
        }

        /* Row 2: 3 cards √ó 4 columns each */
        .metric-card:nth-child(5),
        .metric-card:nth-child(6),
        .metric-card:nth-child(7) {
            grid-column: span 4;
        }

        /* Row 3: 3 cards √ó 4 columns each */
        .metric-card:nth-child(8),
        .metric-card:nth-child(9),
        .metric-card:nth-child(10) {
            grid-column: span 4;
        }

        @media (max-width: 1200px) {
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .metrics-grid {
                grid-template-columns: 1fr;
            }
        }

        .metric-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s, box-shadow 0.3s, border 0.3s;
            cursor: pointer;
            border: 3px solid transparent;
            position: relative;
            min-height: 200px;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            border: 3px solid #ff6b35;
        }

        .metric-card:active {
            transform: translateY(-3px);
        }

        .metric-card::after {
            content: 'üëÜ Click to view data';
            position: absolute;
            top: 10px;
            right: 50px;
            font-size: 0.7em;
            color: #ff6b35;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .metric-card:hover::after {
            opacity: 1;
        }

        .info-button {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%);
            color: white;
            border: none;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s, box-shadow 0.3s;
            z-index: 10;
        }

        .info-button:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.4);
        }

        .info-button:active {
            transform: scale(1.05);
        }

        .metric-title {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .metric-value {
            font-size: 3em;
            font-weight: bold;
            color: #ff6b35;
            margin-bottom: 10px;
        }

        .metric-subtitle {
            font-size: 0.85em;
            color: #999;
        }

        .metric-trend {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
            margin-top: 10px;
        }

        .trend-up {
            background: #d4edda;
            color: #155724;
        }

        .trend-down {
            background: #f8d7da;
            color: #721c24;
        }

        .trend-neutral {
            background: #fff3cd;
            color: #856404;
        }

        .charts-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            position: relative;
        }

        .chart-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.25);
        }

        .chart-card::after {
            content: 'üîç Click chart elements to filter';
            position: absolute;
            top: 10px;
            right: 25px;
            font-size: 0.7em;
            color: #ff6b35;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .chart-card:hover::after {
            opacity: 1;
        }

        /* Fullscreen chart mode */
        .chart-fullscreen {
            position: fixed !important;
            top: 0;
            left: 0;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 10000;
            margin: 0 !important;
            border-radius: 0 !important;
            max-width: 100vw !important;
            padding: 30px !important;
            transform: none !important;
            overflow-y: auto !important;
            display: flex;
            flex-direction: column;
        }

        .chart-fullscreen canvas {
            max-height: calc(100vh - 200px) !important;
            flex-shrink: 0;
        }

        .chart-fullscreen #lineControlsPanel {
            flex-shrink: 0;
            max-height: 50vh;
            overflow-y: auto;
        }

        .chart-card-full {
            grid-column: 1 / -1;
            min-height: 700px;
        }

        .chart-card-full canvas {
            min-height: 600px;
        }

        .chart-card-geo {
            min-height: 450px;
        }

        .chart-card-geo canvas {
            min-height: 350px;
        }

        .chart-title {
            font-size: 1.3em;
            color: #ff6b35;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .pipeline-table {
            width: 100%;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%);
            color: white;
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            cursor: pointer;
            user-select: none;
        }

        th:hover {
            background: rgba(255,255,255,0.1);
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        tbody tr:hover {
            background: #f8f9ff;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-open {
            background: #fff3cd;
            color: #856404;
        }

        .status-accepted {
            background: #d4edda;
            color: #155724;
        }

        .status-future {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-pipeline {
            background: #cce5ff;
            color: #004085;
        }

        .status-onhold {
            background: #fff3cd;
            color: #856404;
            opacity: 0.8;
        }

        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }

        .health-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .health-healthy {
            background: #d4edda;
            color: #155724;
        }

        .health-at-risk {
            background: #fff3cd;
            color: #856404;
        }

        .health-critical {
            background: #f8d7da;
            color: #721c24;
        }

        .refresh-btn {
            background: linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.4);
        }

        /* Edit Mode Styles */
        .editable-cell {
            cursor: pointer;
            position: relative;
            padding: 8px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .editable-cell:hover {
            background: #fff5f0;
            outline: 2px solid #ff6b35;
        }

        .editable-cell.editing {
            background: white;
            padding: 0;
        }

        .editable-cell input,
        .editable-cell select {
            width: 100%;
            padding: 8px;
            border: 2px solid #ff6b35;
            border-radius: 4px;
            font-size: 14px;
        }

        .row-actions {
            display: flex;
            gap: 5px;
        }

        .row-actions button {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: transform 0.2s;
        }

        .row-actions button:hover {
            transform: scale(1.1);
        }

        .btn-edit {
            background: #43e97b;
            color: white;
        }

        .btn-delete {
            background: #f5576c;
            color: white;
        }

        .btn-save {
            background: #667eea;
            color: white;
        }

        .btn-cancel {
            background: #999;
            color: white;
        }

        .row-modified {
            background: #e3f2fd !important;
        }

        .row-new {
            background: #e8f5e9 !important;
        }

        .row-deleted {
            background: #ffebee !important;
            opacity: 0.6;
            text-decoration: line-through;
        }

        .edit-mode-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #43e97b;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1001;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b35 0%, #ff8c42 100%);
            transition: width 0.5s ease;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 10001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            margin: 50px auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #ff6b35;
            padding-bottom: 15px;
        }

        .modal-title {
            font-size: 1.8em;
            color: #ff6b35;
            font-weight: 600;
        }

        .close-btn {
            font-size: 2em;
            color: #999;
            cursor: pointer;
            transition: color 0.3s, transform 0.3s;
            border: none;
            background: none;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: #ff6b35;
            transform: rotate(90deg);
        }

        .modal-body {
            color: #333;
        }

        .detail-section {
            margin-bottom: 20px;
        }

        .detail-label {
            font-weight: 600;
            color: #ff6b35;
            margin-bottom: 5px;
        }

        .detail-value {
            color: #666;
            margin-bottom: 15px;
        }

        .detail-list {
            list-style: none;
            padding: 0;
        }

        .detail-list li {
            padding: 10px;
            margin: 5px 0;
            background: #fff5f0;
            border-radius: 8px;
            border-left: 4px solid #ff6b35;
        }

        tbody tr {
            cursor: pointer;
            transition: background 0.2s;
        }

        tbody tr:hover {
            background: #fff5f0;
        }

        .active-filter {
            background: #fff5f0 !important;
            border: 2px solid #ff6b35 !important;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @media (max-width: 768px) {
            .charts-section {
                grid-template-columns: 1fr;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                margin: 20px auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
                <div>
                    <h1>üéØ PortSwigger Talent Dashboard</h1>
                    <p class="subtitle">Pipeline Health, Capacity Planning & Growth Tracking | 2025-2026</p>
                </div>
                <button onclick="generateBoardPack()" style="
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    border: none;
                    padding: 15px 30px;
                    border-radius: 12px;
                    font-size: 16px;
                    font-weight: 600;
                    cursor: pointer;
                    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
                    transition: all 0.3s ease;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.6)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.4)'">
                    üìä Generate Board Pack
                </button>
            </div>
        </header>

        <!-- Backfill Transition Notifications -->
        <div id="backfillNotifications" style="display: none; margin: 20px 0; padding: 15px 20px; background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%); color: white; border-radius: 12px; box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);">
            <div style="display: flex; align-items: center; gap: 12px;">
                <span style="font-size: 24px;">‚è∞</span>
                <div style="flex: 1;">
                    <strong id="backfillNotificationTitle" style="font-size: 16px; display: block; margin-bottom: 5px;"></strong>
                    <span id="backfillNotificationText" style="font-size: 14px; opacity: 0.95;"></span>
                </div>
            </div>
        </div>

        <div class="filters">
            <div class="filter-group">
                <label>Talent Champion</label>
                <select id="championFilter">
                    <option value="all">All Champions</option>
                    <option value="Anthony">Anthony</option>
                    <option value="Simon">Simon</option>
                    <option value="Mia">Mia</option>
                    <option value="Adam">Adam</option>
                    <option value="Tom">Tom</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Function</label>
                <select id="functionFilter">
                    <option value="all">All Functions</option>
                    <option value="P&E">Product & Engineering</option>
                    <option value="Support">Support</option>
                    <option value="GTM">Go-to-Market</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Role Status</label>
                <select id="statusFilter">
                    <option value="all">All Status</option>
                    <option value="Pipeline Open">Pipeline Open</option>
                    <option value="Offer Accepted">Offer Accepted</option>
                    <option value="Future">Future</option>
                    <option value="On Hold">On Hold</option>
                    <option value="Cancelled">Cancelled</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Start Month Filter</label>
                <input type="month" id="dateFilter" placeholder="All months" min="2025-01" max="2026-12">
            </div>

            <!-- Action Buttons - Ultra Compact Layout -->
            <div style="display: flex; gap: 6px; flex-wrap: wrap; align-items: center; padding: 8px 0; border-top: 2px solid #e9ecef; margin-top: 15px;">
                <button class="refresh-btn" onclick="loadData()" style="padding: 6px 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); font-size: 0.85em;">üîÑ Refresh</button>
                <button class="refresh-btn" onclick="toggleAutoRefresh()" id="autoRefreshToggle" style="padding: 6px 12px; background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%); font-size: 0.85em;">‚è∏Ô∏è Auto-Refresh</button>
                <span id="lastRefreshTime" style="color: #6c757d; font-size: 0.8em; padding: 0 6px; white-space: nowrap;">Last: --:--:--</span>
                <div style="width: 1px; height: 26px; background: #dee2e6; margin: 0 4px;"></div>
                <button class="refresh-btn" onclick="openTimelineView()" style="padding: 6px 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); font-size: 0.85em;">üìÖ Timeline</button>
                <button class="refresh-btn" onclick="toggleEditMode()" id="editModeBtn" style="padding: 6px 12px; background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); font-size: 0.85em;">‚úèÔ∏è Edit</button>
                <div id="editModeActions" style="display: none; align-items: center; gap: 6px;">
                    <div style="width: 1px; height: 26px; background: #43e97b; margin: 0 4px;"></div>
                    <button class="refresh-btn" onclick="addNewRole()" id="addRoleBtn" style="padding: 6px 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); font-size: 0.85em;">‚ûï Add Role</button>
                    <button class="refresh-btn" onclick="saveChangesToServer()" id="saveBtn" style="padding: 6px 12px; background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); font-size: 0.85em;">üíæ Save</button>
                    <button class="refresh-btn" onclick="exportToExcel()" id="exportBtn" style="padding: 6px 12px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); font-size: 0.85em;">üì• Export</button>
                </div>
            </div>
        </div>

        <!-- Status Warning Banner -->
        <div id="statusBanner" style="margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); border-radius: 12px; box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3); display: none; position: relative;">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div style="font-size: 3em;">‚ö†Ô∏è</div>
                    <div>
                        <div style="font-size: 1.5em; font-weight: 700; color: white; margin-bottom: 5px;" id="statusTitle">14 HIRES SHORT OF NET GROWTH TARGET</div>
                        <div style="font-size: 1.1em; color: rgba(255,255,255,0.9);" id="statusMessage">Projected 83 hires - 44 attrition = 39 net growth (need 53)</div>
                    </div>
                </div>
                <div style="text-align: right; position: relative;">
                    <div style="font-size: 2.5em; font-weight: 700; color: white;" id="statusGap">-14</div>
                    <div style="font-size: 0.9em; color: rgba(255,255,255,0.8); margin-bottom: 8px;">hires short</div>
                    <button onclick="showStatusBannerInfo(event)" style="background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 4px 10px; border-radius: 12px; cursor: pointer; font-size: 0.75em; font-weight: 600; transition: all 0.3s ease; letter-spacing: 0.5px; text-transform: uppercase;" onmouseover="this.style.background='rgba(255,255,255,0.25)'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.15)';" onmouseout="this.style.background='rgba(255,255,255,0.15)'; this.style.transform='translateY(0)'; this.style.boxShadow='none';" title="Learn how banner colors work">‚ÑπÔ∏è How it works</button>
                </div>
            </div>
        </div>

        <div class="metrics-grid">
            <div class="metric-card" data-filter-type="total" onclick="showMetricData(event, 'total')">
                <button class="info-button" onclick="showMetricInfo(event, 'totalRoles'); return false;" title="Show detailed information">‚Ñπ</button>
                <div class="metric-title">üìã Total Hires in Plan</div>
                <div class="metric-value" id="totalHires">0</div>
                <div class="metric-subtitle">All statuses (excl. cancelled)</div>
                <div class="metric-subtitle" id="totalHiresBreakdown" style="color: #ff6b35; font-size: 0.85em; margin-top: 3px; font-weight: 600;">0 growth ‚Ä¢ 0 backfills</div>
                <div class="metric-subtitle" id="totalHiresNonGrad" style="color: #999; font-size: 0.8em; margin-top: 5px;">Non-grad: 0</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="hiresProgress" style="width: 0%"></div>
                </div>
                <span class="metric-trend trend-up" id="hiresTrend">Accepted + Pipeline + Future</span>
            </div>

            <div class="metric-card" data-filter-type="status" data-filter-value="Offer Accepted" onclick="showMetricData(event, 'acceptedHired')">
                <button class="info-button" onclick="showMetricInfo(event, 'acceptedHired'); return false;" title="Show detailed information">‚Ñπ</button>
                <div class="metric-title">‚úÖ Accepted + Hired</div>
                <div class="metric-value" id="offersAccepted">0</div>
                <div class="metric-subtitle">2025 hires + 2026 accepted</div>
                <div class="metric-subtitle" id="offersAcceptedNonGrad" style="color: #999; font-size: 0.8em; margin-top: 5px;">Non-grad: 0</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="offersProgress" style="width: 0%"></div>
                </div>
            </div>

            <div class="metric-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;" onclick="showMetricData(event, 'accepted2026Only')">
                <button class="info-button" style="background: rgba(255,255,255,0.2); color: white;" onclick="showMetricInfo(event, 'accepted2026Only'); return false;" title="Show detailed information">‚Ñπ</button>
                <div class="metric-title" style="color: white;">üéØ 2026 Starts Only</div>
                <div class="metric-value" id="accepted2026Only">0</div>
                <div class="metric-subtitle" style="color: rgba(255,255,255,0.9);">Accepted + Started in 2026</div>
                <div class="metric-subtitle" id="accepted2026OnlyBreakdown" style="color: rgba(255,255,255,0.85); font-size: 0.85em; margin-top: 3px;">0 started ‚Ä¢ 0 pending</div>
                <div class="metric-subtitle" id="accepted2026OnlyNonGrad" style="color: rgba(255,255,255,0.7); font-size: 0.8em; margin-top: 5px;">Non-grad: 0</div>
                <div class="progress-bar" style="background: rgba(255,255,255,0.2);">
                    <div class="progress-fill" id="accepted2026OnlyProgress" style="width: 0%; background: #fff;"></div>
                </div>
            </div>

            <div class="metric-card" data-filter-type="status" data-filter-value="Pipeline Open" onclick="showMetricData(event, 'pipelineOpen')">
                <button class="info-button" onclick="showMetricInfo(event, 'pipelineOpen'); return false;" title="Show detailed information">‚Ñπ</button>
                <div class="metric-title">Pipeline Open</div>
                <div class="metric-value" id="pipelineOpen">0</div>
                <div class="metric-subtitle">Unique roles in recruitment</div>
                <div class="metric-subtitle" id="pipelineOpenTotal" style="color: #ff6b35; font-size: 0.85em; margin-top: 3px; font-weight: 600;">0 total live roles</div>
                <div class="metric-subtitle" id="pipelineOpenNonGrad" style="color: #999; font-size: 0.8em; margin-top: 5px;">Non-grad: 0</div>
                <span class="metric-trend trend-neutral" id="pipelineTrend">In Progress</span>
            </div>

            <div class="metric-card" data-filter-type="status" data-filter-value="Future" onclick="showMetricData(event, 'futureRoles')">
                <button class="info-button" onclick="showMetricInfo(event, 'futureRoles'); return false;" title="Show detailed information">‚Ñπ</button>
                <div class="metric-title">Future Roles</div>
                <div class="metric-value" id="futureRoles">0</div>
                <div class="metric-subtitle">Planned openings</div>
                <div class="metric-subtitle" id="futureRolesBreakdown" style="color: #ff6b35; font-size: 0.85em; margin-top: 3px; font-weight: 600;">0 growth ‚Ä¢ 0 backfills</div>
                <div class="metric-subtitle" id="futureRolesNonGrad" style="color: #999; font-size: 0.8em; margin-top: 5px;">Non-grad: 0</div>
            </div>

            <div class="metric-card" onclick="showMetricData(event, 'growthTarget')">
                <button class="info-button" onclick="showMetricInfo(event, 'growthTarget'); return false;" title="Show detailed information">‚Ñπ</button>
                <div class="metric-title">30% Growth Target</div>
                <div class="metric-value" id="growthTarget">0</div>
                <div class="metric-subtitle">Target NET headcount increase</div>
                <div class="metric-subtitle" style="color: #6c757d; font-size: 0.8em; margin-top: 3px; font-style: italic;">(Excludes 44 backfill roles)</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="growthProgress" style="width: 0%"></div>
                </div>
                <span class="metric-trend" id="growthStatus">Tracking</span>
            </div>

            <div class="metric-card" onclick="showMetricData(event, 'targetProbability')">
                <button class="info-button" onclick="showMetricInfo(event, 'targetProbability'); return false;" title="Show detailed information">‚Ñπ</button>
                <div class="metric-title">üéØ Target Probability</div>
                <div class="metric-value" id="targetProbability">0%</div>
                <div class="metric-subtitle">Likelihood of hitting 30% growth</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="predictionProgress" style="width: 0%; background: linear-gradient(90deg, #43e97b 0%, #38f9d7 100%);"></div>
                </div>
                <span class="metric-trend" id="predictionTrend">Projected: <span id="projectedHires">0</span> hires</span>
            </div>

            <div class="metric-card" onclick="showMetricData(event, 'expectedAttrition')">
                <button class="info-button" onclick="showMetricInfo(event, 'expectedAttrition'); return false;" title="Show detailed information">‚Ñπ</button>
                <div class="metric-title">üìâ Expected Attrition</div>
                <div class="metric-value" id="expectedAttrition">0</div>
                <div class="metric-subtitle">2026 attrition forecast</div>
                <span class="metric-trend trend-down" id="attritionTrend">Replacement roles needed</span>
            </div>

            <div class="metric-card" onclick="showMetricData(event, 'netGrowth')" style="border: 3px solid #ff6b6b;">
                <button class="info-button" onclick="showMetricData(event, 'netGrowth'); return false;" title="Show detailed information">‚Ñπ</button>
                <div class="metric-title">üìä Net Growth Projection</div>
                <div class="metric-value" style="display: flex; align-items: baseline; justify-content: center; gap: 10px;">
                    <span id="netGrowth" style="color: #ff6b6b;">39</span>
                    <span style="font-size: 0.5em; color: #666;">/</span>
                    <span style="font-size: 0.6em; color: #999;">53</span>
                </div>
                <div class="metric-subtitle">Hires (83) - Attrition (44)</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="netGrowthProgress" style="width: 74%; background: linear-gradient(90deg, #ff6b6b 0%, #ee5a6f 100%);"></div>
                </div>
                <span class="metric-trend trend-down" id="netGrowthTrend" style="color: #ff6b6b;">-14 short of target</span>
            </div>

            <div class="metric-card" onclick="showMetricData(event, 'totalNeed')" style="border: 3px solid #ffa500;">
                <button class="info-button" onclick="showMetricData(event, 'totalNeed'); return false;" title="Show detailed information">‚Ñπ</button>
                <div class="metric-title">üéØ Total Hiring Need</div>
                <div class="metric-value" style="color: #ffa500;" id="totalNeed">97</div>
                <div class="metric-subtitle">Growth (53) + Attrition (44)</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="totalNeedProgress" style="width: 85%; background: linear-gradient(90deg, #ffa500 0%, #ff8c42 100%);"></div>
                </div>
                <span class="metric-trend trend-neutral" id="totalNeedTrend">Currently: 83 projected (14 short)</span>
            </div>
        </div>

        <div class="charts-section">
            <div class="chart-card chart-card-full" style="cursor: pointer;" id="growthChartCard">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h3 class="chart-title">üìà Growth Trajectory</h3>
                    <div style="display: flex; gap: 10px;">
                        <button id="viewToggleBtn" onclick="toggleGrowthChartView(event)" style="padding: 8px 16px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9em;">üìä Monthly View</button>
                        <button id="lineToggleBtn" onclick="toggleLineControls(event)" style="padding: 8px 16px; background: linear-gradient(135deg, #6c757d 0%, #495057 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9em;">üëÅÔ∏è Show/Hide Lines</button>
                        <button onclick="showGrowthChartInfo(event)" style="padding: 8px 16px; background: linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9em;">‚ÑπÔ∏è Chart Guide</button>
                        <button onclick="toggleGrowthChartFullscreen(event)" style="padding: 8px 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9em;">‚õ∂ Fullscreen</button>
                    </div>
                </div>

                <!-- Line visibility controls -->
                <div id="lineControlsPanel" style="display: none; margin: 15px 0; padding: 15px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 8px; border: 2px solid #dee2e6;">

                    <!-- Preset Views Section -->
                    <div style="margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #dee2e6;">
                        <strong style="color: #495057; font-size: 1.05em; display: block; margin-bottom: 12px;">üí° Preset Views - Meaningful Insights</strong>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 10px;">
                            <button onclick="applyPresetView('executive')" title="Shows: Accepted + Started, Projected, and 30% Target lines. Best for: Quick executive overview to see what's confirmed vs where we're heading vs our goal. Use this view for high-level progress tracking." style="padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; text-align: left; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                                <div style="font-size: 1.1em; margin-bottom: 4px;">üéØ Executive Summary</div>
                                <div style="font-size: 0.85em; opacity: 0.9;">Accepted, Projected, Target</div>
                                <div style="font-size: 0.75em; opacity: 0.8; margin-top: 4px;">What's confirmed vs where we're going vs goal</div>
                            </button>

                            <button onclick="applyPresetView('pipeline')" title="Shows: Pipeline Open, Future Roles, and 30% Target lines. Best for: Understanding recruitment pipeline status and what needs to convert to hit targets. Use this to monitor roles in progress." style="padding: 12px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; text-align: left; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                                <div style="font-size: 1.1em; margin-bottom: 4px;">üîÑ Pipeline Health</div>
                                <div style="font-size: 0.85em; opacity: 0.9;">Pipeline, Future, Target</div>
                                <div style="font-size: 0.75em; opacity: 0.8; margin-top: 4px;">What's in progress and needs to convert</div>
                            </button>

                            <button onclick="applyPresetView('capacity')" title="Shows: Total (All Starters), Expected Attrition, and 30% Target lines. Best for: Understanding absolute hiring capacity and maximum potential if everything converts. Use this to see total capacity vs losses." style="padding: 12px; background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; text-align: left; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                                <div style="font-size: 1.1em; margin-bottom: 4px;">üìä Total Capacity</div>
                                <div style="font-size: 0.85em; opacity: 0.9;">Total, Attrition, Target</div>
                                <div style="font-size: 0.75em; opacity: 0.8; margin-top: 4px;">Maximum potential vs losses vs goal</div>
                            </button>

                            <button onclick="applyPresetView('attrition')" title="Shows: Accepted + Started, Expected Attrition, and 30% Target lines. Best for: Planning for replacement hires and understanding net growth after departures. Use this to calculate backfill needs." style="padding: 12px; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; text-align: left; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                                <div style="font-size: 1.1em; margin-bottom: 4px;">‚ö†Ô∏è Attrition Impact</div>
                                <div style="font-size: 0.85em; opacity: 0.9;">Accepted, Attrition, Target</div>
                                <div style="font-size: 0.75em; opacity: 0.8; margin-top: 4px;">Net growth after expected departures</div>
                            </button>

                            <button onclick="applyPresetView('velocity')" title="Shows: Accepted + Started, Projected, and 30% Target lines. Best for: Tracking if hiring speed is on track. Use this to see if current pace will hit the year-end goal or if acceleration is needed." style="padding: 12px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; text-align: left; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                                <div style="font-size: 1.1em; margin-bottom: 4px;">üöÄ Hiring Velocity</div>
                                <div style="font-size: 0.85em; opacity: 0.9;">Accepted, Projected, Target</div>
                                <div style="font-size: 0.75em; opacity: 0.8; margin-top: 4px;">Current pace vs forecast vs goal</div>
                            </button>

                            <button onclick="applyPresetView('funnel')" title="Shows: Accepted + Started, Pipeline Open, and Future Roles lines. Best for: Understanding the complete hiring funnel progression. Use this to see how roles move from future to pipeline to accepted." style="padding: 12px; background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; text-align: left; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                                <div style="font-size: 1.1em; margin-bottom: 4px;">üìà Full Funnel</div>
                                <div style="font-size: 0.85em; opacity: 0.9;">Accepted, Pipeline, Future</div>
                                <div style="font-size: 0.75em; opacity: 0.8; margin-top: 4px;">Complete hiring progression stages</div>
                            </button>

                            <button onclick="applyPresetView('risk')" title="Shows: Projected, Expected Attrition, and 30% Target lines. Best for: Risk planning and mitigation. Use this to assess if we'll hit target after accounting for losses and current velocity." style="padding: 12px; background: linear-gradient(135deg, #ffa500 0%, #ff6348 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; text-align: left; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                                <div style="font-size: 1.1em; margin-bottom: 4px;">‚ö° Risk Assessment</div>
                                <div style="font-size: 0.85em; opacity: 0.9;">Projected, Attrition, Target</div>
                                <div style="font-size: 0.75em; opacity: 0.8; margin-top: 4px;">Will we hit target after losses?</div>
                            </button>

                            <button onclick="applyPresetView('realistic')" title="Shows: Accepted + Started, Pipeline Open, and 30% Target lines. Best for: Conservative forecasting excluding optimistic future roles. Use this for realistic planning based on confirmed and active recruiting only." style="padding: 12px; background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; text-align: left; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                                <div style="font-size: 1.1em; margin-bottom: 4px;">üé≤ Realistic View</div>
                                <div style="font-size: 0.85em; opacity: 0.9;">Accepted, Pipeline, Target</div>
                                <div style="font-size: 0.75em; opacity: 0.8; margin-top: 4px;">What's likely vs optimistic future roles</div>
                            </button>
                        </div>
                    </div>

                    <!-- Individual Line Controls -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <strong style="color: #495057; font-size: 1em;">üé® Custom - Individual Lines</strong>
                        <div style="display: flex; gap: 8px;">
                            <button onclick="toggleAllLines(true)" style="padding: 6px 12px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85em; font-weight: 600;">‚úì Show All</button>
                            <button onclick="toggleAllLines(false)" style="padding: 6px 12px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85em; font-weight: 600;">‚úó Hide All</button>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 10px;">
                        <button id="lineToggle0" onclick="toggleChartLine(0)" style="padding: 10px; background: white; border: 2px solid #ff6b35; border-radius: 6px; cursor: pointer; font-weight: 600; color: #ff6b35; text-align: left; transition: all 0.2s;">
                            <span style="font-size: 1.2em;">üü†</span> Accepted + Started
                        </button>
                        <button id="lineToggle1" onclick="toggleChartLine(1)" style="padding: 10px; background: white; border: 2px solid #f39c12; border-radius: 6px; cursor: pointer; font-weight: 600; color: #f39c12; text-align: left; transition: all 0.2s;">
                            <span style="font-size: 1.2em;">üü°</span> Pipeline Open
                        </button>
                        <button id="lineToggle2" onclick="toggleChartLine(2)" style="padding: 10px; background: white; border: 2px solid #9b59b6; border-radius: 6px; cursor: pointer; font-weight: 600; color: #9b59b6; text-align: left; transition: all 0.2s;">
                            <span style="font-size: 1.2em;">üü£</span> Future Roles
                        </button>
                        <button id="lineToggle3" onclick="toggleChartLine(3)" style="padding: 10px; background: white; border: 2px solid #3498db; border-radius: 6px; cursor: pointer; font-weight: 600; color: #3498db; text-align: left; transition: all 0.2s;">
                            <span style="font-size: 1.2em;">üîµ</span> Total (All Starters)
                        </button>
                        <button id="lineToggle4" onclick="toggleChartLine(4)" style="padding: 10px; background: white; border: 2px solid #28a745; border-radius: 6px; cursor: pointer; font-weight: 600; color: #28a745; text-align: left; transition: all 0.2s;">
                            <span style="font-size: 1.2em;">üü¢</span> Net Growth
                        </button>
                        <button id="lineToggle5" onclick="toggleChartLine(5)" style="padding: 10px; background: white; border: 2px solid #ffa500; border-radius: 6px; cursor: pointer; font-weight: 600; color: #ffa500; text-align: left; transition: all 0.2s;">
                            <span style="font-size: 1.2em;">üü†</span> Projected
                        </button>
                        <button id="lineToggle6" onclick="toggleChartLine(6)" style="padding: 10px; background: white; border: 2px solid #43e97b; border-radius: 6px; cursor: pointer; font-weight: 600; color: #43e97b; text-align: left; transition: all 0.2s;">
                            <span style="font-size: 1.2em;">üü¢</span> 30% Target
                        </button>
                        <button id="lineToggle7" onclick="toggleChartLine(7)" style="padding: 10px; background: white; border: 2px solid #e74c3c; border-radius: 6px; cursor: pointer; font-weight: 600; color: #e74c3c; text-align: left; transition: all 0.2s;">
                            <span style="font-size: 1.2em;">üî¥</span> Attrition
                        </button>
                    </div>
                </div>

                <canvas id="growthChart"></canvas>
            </div>

            <div class="chart-card chart-card-full" style="cursor: pointer;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 class="chart-title" style="margin: 0;">üìä Hiring Timeline 2025-2026</h3>
                    <button onclick="showHiringTimelineInfo(event)" style="padding: 8px 16px; background: linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9em;">‚ÑπÔ∏è Chart Guide</button>
                </div>
                <canvas id="timelineChart"></canvas>
            </div>
        </div>

        <!-- Strategic Bets Section -->
        <div class="chart-card chart-card-full" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; margin-top: 30px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <div>
                    <h2 style="margin: 0; font-size: 1.8em; color: white;">üéØ Strategic Bets - 2026 Recruitment Alignment</h2>
                    <p style="margin: 8px 0 0 0; color: rgba(255,255,255,0.9); font-size: 0.95em;">Track hiring progress across our 4 strategic priorities</p>
                </div>
                <button onclick="showStrategicBetsInfo(event)" style="padding: 10px 20px; background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.95em; transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                    ‚ÑπÔ∏è Bet Details
                </button>
            </div>

            <div id="strategicBetsGrid" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px;">
                <!-- Bet cards will be inserted here by JavaScript (4 bets + Unassigned = 5 columns) -->
            </div>
        </div>

        <div class="pipeline-table">
            <!-- Filters Section -->
            <div class="table-filters" style="
                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                padding: 20px;
                border-radius: 12px;
                margin-bottom: 20px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            ">
                <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                    <!-- Search Box -->
                    <div style="flex: 1; min-width: 250px;">
                        <input
                            type="text"
                            id="tableSearchBox"
                            placeholder="üîç Search roles, teams, functions..."
                            oninput="applyTableFilters()"
                            style="
                                width: 100%;
                                padding: 12px 16px;
                                border: 2px solid #dee2e6;
                                border-radius: 8px;
                                font-size: 14px;
                                transition: all 0.2s ease;
                                box-shadow: 0 2px 4px rgba(0,0,0,0.05);
                            "
                            onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 4px 12px rgba(102, 126, 234, 0.2)'"
                            onblur="this.style.borderColor='#dee2e6'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.05)'"
                        />
                    </div>

                    <!-- Status Filter -->
                    <div>
                        <select
                            id="tableStatusFilter"
                            onchange="applyTableFilters()"
                            style="
                                padding: 12px 16px;
                                border: 2px solid #dee2e6;
                                border-radius: 8px;
                                font-size: 14px;
                                background: white;
                                cursor: pointer;
                                min-width: 150px;
                                transition: all 0.2s ease;
                            "
                            onfocus="this.style.borderColor='#667eea'"
                            onblur="this.style.borderColor='#dee2e6'"
                        >
                            <option value="">All Statuses</option>
                            <option value="Offer Accepted">Offer Accepted</option>
                            <option value="Pipeline Open">Pipeline Open</option>
                            <option value="Future">Future</option>
                            <option value="Backfill - Not Opened">Backfill - Not Opened</option>
                            <option value="On Hold">On Hold</option>
                            <option value="Cancelled">Cancelled</option>
                        </select>
                    </div>

                    <!-- Champion Filter -->
                    <div>
                        <select
                            id="tableChampionFilter"
                            onchange="applyTableFilters()"
                            style="
                                padding: 12px 16px;
                                border: 2px solid #dee2e6;
                                border-radius: 8px;
                                font-size: 14px;
                                background: white;
                                cursor: pointer;
                                min-width: 150px;
                                transition: all 0.2s ease;
                            "
                            onfocus="this.style.borderColor='#667eea'"
                            onblur="this.style.borderColor='#dee2e6'"
                        >
                            <option value="">All Champions</option>
                            <option value="Tom">Tom</option>
                            <option value="Adam">Adam</option>
                            <option value="Simon">Simon</option>
                            <option value="Anthony">Anthony</option>
                            <option value="Mia">Mia</option>
                            <option value="Misc Talent Champion">Misc Talent Champion (Backfills)</option>
                        </select>
                    </div>

                    <!-- Function Filter -->
                    <div>
                        <select
                            id="tableFunctionFilter"
                            onchange="applyTableFilters()"
                            style="
                                padding: 12px 16px;
                                border: 2px solid #dee2e6;
                                border-radius: 8px;
                                font-size: 14px;
                                background: white;
                                cursor: pointer;
                                min-width: 150px;
                                transition: all 0.2s ease;
                            "
                            onfocus="this.style.borderColor='#667eea'"
                            onblur="this.style.borderColor='#dee2e6'"
                        >
                            <option value="">All Functions</option>
                        </select>
                    </div>

                    <!-- Clear Filters Button -->
                    <button
                        onclick="clearTableFilters()"
                        style="
                            padding: 12px 20px;
                            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
                            color: white;
                            border: none;
                            border-radius: 8px;
                            cursor: pointer;
                            font-weight: 600;
                            font-size: 14px;
                            transition: all 0.2s ease;
                            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                        "
                        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.15)'"
                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.1)'"
                    >
                        üîÑ Clear Filters
                    </button>
                </div>

                <!-- Filter Results Summary -->
                <div id="filterSummary" style="
                    margin-top: 15px;
                    padding: 10px 15px;
                    background: white;
                    border-radius: 6px;
                    font-size: 13px;
                    color: #6c757d;
                    display: none;
                ">
                    <strong>Filters Active:</strong> <span id="filterSummaryText"></span>
                </div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th onclick="sortTable('id')">ID ‚ñº</th>
                        <th onclick="sortTable('role')">Role Title ‚ñº</th>
                        <th onclick="sortTable('status')">Status ‚ñº</th>
                        <th onclick="sortTable('health')">Health ‚ñº</th>
                        <th onclick="sortTable('champion')">Talent Champion ‚ñº</th>
                        <th onclick="sortTable('function')">Function ‚ñº</th>
                        <th onclick="sortTable('team')">Team ‚ñº</th>
                        <th onclick="sortTable('open')">Date Open ‚ñº</th>
                        <th onclick="sortTable('accept')">Date Accept ‚ñº</th>
                        <th onclick="sortTable('start')">Date Start ‚ñº</th>
                        <th onclick="sortTable('geo')">Location ‚ñº</th>
                    </tr>
                </thead>
                <tbody id="pipelineTableBody">
                    <!-- Table rows will be dynamically inserted -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal for detailed views -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Details</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Dynamic content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- AI Assistant Chat Interface -->
    <div id="aiAssistantContainer" style="position: fixed; bottom: 20px; right: 20px; z-index: 10000;">
        <!-- Chat Toggle Button -->
        <button id="aiAssistantToggle" style="
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s, box-shadow 0.2s;
        " onclick="toggleAIChat()" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
            ü§ñ
        </button>

        <!-- Chat Window -->
        <div id="aiChatWindow" style="
            display: none;
            position: absolute;
            bottom: 80px;
            right: 0;
            width: 400px;
            height: 600px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            flex-direction: column;
            overflow: hidden;
        ">
            <!-- Chat Header -->
            <div style="
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 16px 20px;
                display: flex;
                justify-content: space-between;
                align-items: center;
            ">
                <div>
                    <div style="font-weight: 600; font-size: 16px;">ü§ñ AI Dashboard Assistant</div>
                    <div style="font-size: 11px; opacity: 0.9; margin-top: 2px;" id="aiStatus">Ready to help</div>
                </div>
                <button onclick="toggleAIChat()" style="
                    background: rgba(255,255,255,0.2);
                    border: none;
                    color: white;
                    width: 28px;
                    height: 28px;
                    border-radius: 50%;
                    cursor: pointer;
                    font-size: 18px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                ">√ó</button>
            </div>

            <!-- Chat Messages -->
            <div id="aiChatMessages" style="
                flex: 1;
                overflow-y: auto;
                padding: 20px;
                background: #f8f9fa;
            ">
                <div style="
                    background: white;
                    padding: 12px 16px;
                    border-radius: 8px;
                    margin-bottom: 12px;
                    border-left: 4px solid #667eea;
                    font-size: 14px;
                    line-height: 1.6;
                ">
                    <strong>üëã Hi! I'm your AI assistant.</strong><br><br>
                    I can help you understand:
                    <ul style="margin: 8px 0 0 20px; line-height: 1.8;">
                        <li>Why probability is 25% despite 29 hires</li>
                        <li>How attrition impacts your growth target</li>
                        <li>Any metric, calculation, or data point</li>
                        <li>Strategic bets, pipeline health, and more</li>
                    </ul>
                    <div style="margin-top: 12px; padding: 8px; background: #fff3cd; border-radius: 4px; font-size: 12px;">
                        ‚ö†Ô∏è <strong>Setup Required:</strong> Click the gear icon below to add your Anthropic API key.
                    </div>
                </div>
            </div>

            <!-- Chat Input -->
            <div style="
                padding: 16px;
                border-top: 1px solid #e0e0e0;
                background: white;
            ">
                <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                    <input
                        id="aiChatInput"
                        type="text"
                        placeholder="Ask me anything about the dashboard..."
                        style="
                            flex: 1;
                            padding: 10px 14px;
                            border: 1px solid #ddd;
                            border-radius: 6px;
                            font-size: 14px;
                            outline: none;
                        "
                        onkeypress="if(event.key==='Enter') sendAIMessage()"
                    />
                    <button onclick="sendAIMessage()" style="
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 6px;
                        cursor: pointer;
                        font-weight: 600;
                        font-size: 14px;
                    ">Send</button>
                </div>
                <div style="display: flex; gap: 8px; font-size: 12px;">
                    <button onclick="showAISettings()" style="
                        flex: 1;
                        background: #f8f9fa;
                        border: 1px solid #ddd;
                        padding: 6px 12px;
                        border-radius: 4px;
                        cursor: pointer;
                        font-size: 11px;
                    ">‚öôÔ∏è Settings</button>
                    <button onclick="clearAIChat()" style="
                        flex: 1;
                        background: #f8f9fa;
                        border: 1px solid #ddd;
                        padding: 6px 12px;
                        border-radius: 4px;
                        cursor: pointer;
                        font-size: 11px;
                    ">üóëÔ∏è Clear</button>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Settings Modal -->
    <div id="aiSettingsModal" style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 10001;
        align-items: center;
        justify-content: center;
    ">
        <div style="
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
        ">
            <h3 style="margin: 0 0 20px 0; color: #667eea;">AI Assistant Settings</h3>
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px;">
                    Anthropic API Key
                </label>
                <input
                    id="anthropicApiKey"
                    type="password"
                    placeholder="sk-ant-..."
                    style="
                        width: 100%;
                        padding: 10px 14px;
                        border: 1px solid #ddd;
                        border-radius: 6px;
                        font-size: 14px;
                    "
                />
                <div style="margin-top: 8px; font-size: 12px; color: #666; line-height: 1.6;">
                    Get your API key from <a href="https://console.anthropic.com/" target="_blank" style="color: #667eea;">console.anthropic.com</a>.<br>
                    Your key is stored locally in your browser and never sent anywhere except Anthropic's API.
                </div>
            </div>
            <div style="display: flex; gap: 12px;">
                <button onclick="saveAISettings()" style="
                    flex: 1;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    border: none;
                    padding: 12px 20px;
                    border-radius: 6px;
                    cursor: pointer;
                    font-weight: 600;
                ">Save</button>
                <button onclick="closeAISettings()" style="
                    flex: 1;
                    background: #f8f9fa;
                    border: 1px solid #ddd;
                    padding: 12px 20px;
                    border-radius: 6px;
                    cursor: pointer;
                    font-weight: 600;
                ">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // AI Assistant UI Functions
        function toggleAIChat() {
            const chatWindow = document.getElementById('aiChatWindow');
            const toggleButton = document.getElementById('aiAssistantToggle');

            if (chatWindow.style.display === 'none') {
                chatWindow.style.display = 'flex';
                toggleButton.textContent = '‚úï';
            } else {
                chatWindow.style.display = 'none';
                toggleButton.textContent = 'ü§ñ';
            }
        }

        function showAISettings() {
            const modal = document.getElementById('aiSettingsModal');
            modal.style.display = 'flex';

            // Load saved API key
            const savedKey = localStorage.getItem('anthropic_api_key');
            if (savedKey) {
                document.getElementById('anthropicApiKey').value = savedKey;
            }
        }

        function closeAISettings() {
            document.getElementById('aiSettingsModal').style.display = 'none';
        }

        function saveAISettings() {
            const apiKey = document.getElementById('anthropicApiKey').value.trim();

            if (!apiKey) {
                alert('Please enter your Anthropic API key');
                return;
            }

            if (!apiKey.startsWith('sk-ant-')) {
                alert('Invalid API key format. Anthropic keys start with "sk-ant-"');
                return;
            }

            // Save to localStorage
            localStorage.setItem('anthropic_api_key', apiKey);

            // Initialize AI assistant
            window.dashboardAI.initialize(apiKey);

            // Update status
            document.getElementById('aiStatus').textContent = 'Connected ‚úì';

            closeAISettings();

            // Show success message
            addAIMessage('assistant', '‚úÖ API key saved! I\'m now ready to answer your questions about the dashboard.');
        }

        async function sendAIMessage() {
            const input = document.getElementById('aiChatInput');
            const message = input.value.trim();

            if (!message) return;

            // Check if API key is set
            const apiKey = localStorage.getItem('anthropic_api_key');
            if (!apiKey) {
                addAIMessage('assistant', '‚ö†Ô∏è Please configure your Anthropic API key in Settings first.');
                showAISettings();
                return;
            }

            // Add user message to chat
            addAIMessage('user', message);
            input.value = '';

            // Show typing indicator
            const typingId = addAIMessage('assistant', '‚è≥ Thinking...');

            try {
                // Send to AI
                const response = await window.dashboardAI.sendMessage(message);

                // Remove typing indicator
                document.getElementById(typingId).remove();

                if (response.error) {
                    addAIMessage('assistant', `‚ùå Error: ${response.message}`);
                } else {
                    addAIMessage('assistant', response.message);
                }
            } catch (error) {
                document.getElementById(typingId).remove();
                addAIMessage('assistant', `‚ùå Error: ${error.message}`);
            }
        }

        function addAIMessage(role, content) {
            const messagesContainer = document.getElementById('aiChatMessages');
            const messageDiv = document.createElement('div');
            const messageId = 'msg-' + Date.now();
            messageDiv.id = messageId;

            const isUser = role === 'user';

            messageDiv.style.cssText = `
                background: ${isUser ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' : 'white'};
                color: ${isUser ? 'white' : '#333'};
                padding: 12px 16px;
                border-radius: 8px;
                margin-bottom: 12px;
                ${!isUser ? 'border-left: 4px solid #667eea;' : ''}
                font-size: 14px;
                line-height: 1.6;
                white-space: pre-wrap;
                word-wrap: break-word;
            `;

            messageDiv.textContent = content;
            messagesContainer.appendChild(messageDiv);

            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            return messageId;
        }

        function clearAIChat() {
            if (confirm('Clear all chat messages?')) {
                window.dashboardAI.clearHistory();
                const messagesContainer = document.getElementById('aiChatMessages');
                messagesContainer.innerHTML = `
                    <div style="
                        background: white;
                        padding: 12px 16px;
                        border-radius: 8px;
                        margin-bottom: 12px;
                        border-left: 4px solid #667eea;
                        font-size: 14px;
                        line-height: 1.6;
                    ">
                        <strong>üëã Chat cleared!</strong><br><br>
                        Ask me anything about the dashboard.
                    </div>
                `;
            }
        }

        // Auto-initialize AI on page load if API key exists
        window.addEventListener('DOMContentLoaded', () => {
            const savedKey = localStorage.getItem('anthropic_api_key');
            if (savedKey) {
                window.dashboardAI.initialize(savedKey);
                document.getElementById('aiStatus').textContent = 'Connected ‚úì';
            }
        });
    </script>

    <!-- Google Sheets integration disabled due to CORS restrictions -->
    <!-- <script src="src/google-sheets-loader.js"></script> -->
    
    
    
    

    <!-- ============================================ -->
    <!-- EMBEDDED JAVASCRIPT -->
    <!-- All dashboard functionality in one file -->
    <!-- Generated: 2026-01-15 13:38:51 -->
    <!-- ============================================ -->
    <script>
    
// ============================================
// EMBEDDED DATA - Converted from Excel files
// Generated: 2026-01-15 13:38:51
// ============================================
window.EMBEDDED_DATA = {
  "hiringData": [
    {
      "Id": "J25-001",
      "Role Title": "Front of House Swigger",
      "Notes": "Rebecca Nicholson",
      "Workable link": "https://portswigger.workable.com/backend/jobs#:~:text=Front%20of%20House%20team%20member",
      "Role Status": "Started",
      "Date_Open": "2025-10-08",
      "Date_Accept": "2025-11-01",
      "Date_Start": "2025-11-18",
      "Role Type": "Backfill",
      "Team": "Workplace",
      "Tribe": "Culture",
      "Function": "Support",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 1.0,
      "Swigger Type": "FTE",
      "Lead TC": "Renata",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2025.0
    },
    {
      "Id": "J25-002",
      "Role Title": "Front of House Swigger",
      "Notes": "ICP is being reviewed, potentially changing shape",
      "Workable link": "https://portswigger.workable.com/backend/jobs#:~:text=Front%20of%20House%20team%20member",
      "Role Status": "Future",
      "Date_Open": "2026-04-01",
      "Date_Accept": "2026-05-01",
      "Date_Start": "2026-06-01",
      "Role Type": "Backfill",
      "Team": "Workplace",
      "Tribe": "Culture",
      "Function": "Support",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 1.0,
      "Swigger Type": "FTE",
      "Lead TC": "Renata",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-003",
      "Role Title": "Junior Workplace Chef",
      "Notes": "Nico & Renata running pipeline",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5175141/browser/applied",
      "Role Status": "Started",
      "Date_Open": "2025-10-01",
      "Date_Accept": "2025-11-17",
      "Date_Start": "2025-12-01",
      "Role Type": "New",
      "Team": "Workplace",
      "Tribe": "Culture",
      "Function": "Support",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 1.0,
      "Swigger Type": "FTE",
      "Lead TC": "Simon",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2025.0
    },
    {
      "Id": "J25-004",
      "Role Title": "Director of Intelligent Support",
      "Notes": "Anthony Fisher",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5016937/browser/applied",
      "Role Status": "Started",
      "Date_Open": "2025-07-20",
      "Date_Accept": "2025-10-15",
      "Date_Start": "2025-11-10",
      "Role Type": "New",
      "Team": "Tech Support",
      "Tribe": "CX",
      "Function": "GTM",
      "Leader?": 1.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Tom",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2025.0
    },
    {
      "Id": "J25-005",
      "Role Title": "Solutions Architect",
      "Notes": "Artur Cabral",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5083101/browser/offer_accepted/candidate/517710612",
      "Role Status": "Started",
      "Date_Open": "2025-08-18",
      "Date_Accept": "2025-10-17",
      "Date_Start": "2025-11-10",
      "Role Type": "New",
      "Team": "Customer Success",
      "Tribe": "CX",
      "Function": "GTM",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "ATL",
      "Geo Fixed?": 1.0,
      "Swigger Type": "FTE",
      "Lead TC": "Tom",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2025.0
    },
    {
      "Id": "J25-006",
      "Role Title": "VP Marketing",
      "Notes": "Adrian Lambert",
      "Workable link": "https://portswigger.workable.com/backend/candidates/db/profile/522214078?navigation=false",
      "Role Status": "Started",
      "Date_Open": "2025-09-01",
      "Date_Accept": "2025-10-13",
      "Date_Start": "2025-11-19",
      "Role Type": "New",
      "Team": "Elders",
      "Tribe": "Other",
      "Function": "Support",
      "Leader?": 1.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Becky",
      "Sourcing Notes": null,
      "Strategic Initiative": "Right-size Marketing function",
      "Date_Year_Start": 2025.0
    },
    {
      "Id": "J25-007",
      "Role Title": "Technical Product Specialist",
      "Notes": "Edwina Lawrence ",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5016783/browser/applied",
      "Role Status": "Offer Accepted",
      "Date_Open": "2025-11-07",
      "Date_Accept": "2026-01-06",
      "Date_Start": "2026-02-01",
      "Role Type": "New",
      "Team": "Tech Support",
      "Tribe": "CX",
      "Function": "GTM",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "ATL",
      "Geo Fixed?": 1.0,
      "Swigger Type": "FTE",
      "Lead TC": "Tom",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-008",
      "Role Title": "Technical Product Specialist",
      "Notes": null,
      "Workable link": "https://portswigger.workable.com/backend/jobs/5016783/browser/applied",
      "Role Status": "Pipeline Open",
      "Date_Open": "2025-11-07",
      "Date_Accept": "2026-01-09",
      "Date_Start": "2026-02-01",
      "Role Type": "New",
      "Team": "Tech Support",
      "Tribe": "CX",
      "Function": "GTM",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "ATL",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Tom",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-009",
      "Role Title": "Technical Product Specialist",
      "Notes": null,
      "Workable link": "https://portswigger.workable.com/backend/jobs/5016783/browser/applied",
      "Role Status": "Pipeline Open",
      "Date_Open": "2025-11-07",
      "Date_Accept": "2026-01-09",
      "Date_Start": "2026-02-01",
      "Role Type": "New",
      "Team": "Tech Support",
      "Tribe": "CX",
      "Function": "GTM",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "ATL",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Tom",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-010",
      "Role Title": "Product Data Analyst",
      "Notes": null,
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2026-05-01",
      "Date_Accept": "2026-07-01",
      "Date_Start": "2026-10-01",
      "Role Type": "New",
      "Team": "Team TBC - Product",
      "Tribe": "Product",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Adam",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-011",
      "Role Title": "Data Engineer",
      "Notes": "Zach Damcevski",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5128742/browser/applied",
      "Role Status": "Offer Accepted",
      "Date_Open": "2025-09-01",
      "Date_Accept": "2026-01-01",
      "Date_Start": "2026-04-01",
      "Role Type": "New",
      "Team": "Financial Planning & Analysis",
      "Tribe": "Finance",
      "Function": "Support",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Adam",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-012",
      "Role Title": "Tax & Treasury Manager",
      "Notes": "Currently a contractor in place / Phil Robinson accepted offer ",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5128719/browser/applied",
      "Role Status": "Offer Accepted",
      "Date_Open": "2025-09-09",
      "Date_Accept": "2025-12-15",
      "Date_Start": "2026-03-16",
      "Role Type": "New",
      "Team": "Finance Control",
      "Tribe": "Finance",
      "Function": "Support",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Adam",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-013",
      "Role Title": "Growth Finance Partner",
      "Notes": null,
      "Workable link": "https://portswigger.workable.com/backend/jobs/5092687/browser/applied",
      "Role Status": "Pipeline Open",
      "Date_Open": "2025-08-22",
      "Date_Accept": "2026-01-01",
      "Date_Start": "2026-04-01",
      "Role Type": "New",
      "Team": "Financial Planning & Analysis",
      "Tribe": "Finance",
      "Function": "Support",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Adam",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-014",
      "Role Title": "FP&A Analyst",
      "Notes": null,
      "Workable link": "https://portswigger.workable.com/backend/jobs/5092736/browser/applied",
      "Role Status": "Future",
      "Date_Open": "2026-02-01",
      "Date_Accept": "2026-04-01",
      "Date_Start": "2026-07-01",
      "Role Type": "New",
      "Team": "Financial Planning & Analysis",
      "Tribe": "Finance",
      "Function": "Support",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Adam",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-015",
      "Role Title": "Product Manager - Teams",
      "Notes": null,
      "Workable link": "https://portswigger.workable.com/backend/jobs/4924643/browser/applied",
      "Role Status": "Future",
      "Date_Open": "2026-02-01",
      "Date_Accept": "2026-04-01",
      "Date_Start": "2026-07-01",
      "Role Type": "New",
      "Team": "Team TBC - Product",
      "Tribe": "Product",
      "Function": "P&E",
      "Leader?": 1.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Adam",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-016",
      "Role Title": "Product Designer / UX",
      "Notes": "Chuck Rice ",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5130405/browser/applied",
      "Role Status": "Started",
      "Date_Open": "2025-06-01",
      "Date_Accept": "2025-07-01",
      "Date_Start": "2026-01-06",
      "Role Type": "New",
      "Team": "Critical Systems",
      "Tribe": "Product",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Adam",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-017",
      "Role Title": "VP Product",
      "Notes": "Sarah accepted the offer. Joining Feb",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5035941/browser/applied",
      "Role Status": "Offer Accepted",
      "Date_Open": "2025-10-01",
      "Date_Accept": "2025-11-01",
      "Date_Start": "2026-02-02",
      "Role Type": "New",
      "Team": "Elders",
      "Tribe": "Other",
      "Function": "Support",
      "Leader?": 1.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Becky",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-018",
      "Role Title": "Junior Account Executive: KNU",
      "Notes": "Abdul Sahal",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5109069/browser/applied",
      "Role Status": "Started",
      "Date_Open": "2025-10-30",
      "Date_Accept": "2025-11-01",
      "Date_Start": "2025-12-15",
      "Role Type": "New",
      "Team": "Sales",
      "Tribe": "Sales",
      "Function": "GTM",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 1.0,
      "Swigger Type": "FTE",
      "Lead TC": "Tom",
      "Sourcing Notes": null,
      "Strategic Initiative": "Inside Sales",
      "Date_Year_Start": 2025.0
    },
    {
      "Id": "J25-019",
      "Role Title": "Junior Account Executive: KNU",
      "Notes": "Ran Mo",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5109069/browser/applied",
      "Role Status": "Offer Accepted",
      "Date_Open": "2025-10-31",
      "Date_Accept": "2025-11-15",
      "Date_Start": "2026-01-13",
      "Role Type": "New",
      "Team": "Sales",
      "Tribe": "Sales",
      "Function": "GTM",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 1.0,
      "Swigger Type": "FTE",
      "Lead TC": "Tom",
      "Sourcing Notes": null,
      "Strategic Initiative": "Inside Sales",
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-020",
      "Role Title": "Junior Account Executive: ATL",
      "Notes": "Reviewing ICP / resetting role. ",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5092589/browser/applied",
      "Role Status": "Future",
      "Date_Open": "2026-01-01",
      "Date_Accept": "2026-03-01",
      "Date_Start": "2026-04-01",
      "Role Type": "New",
      "Team": "Sales",
      "Tribe": "Sales",
      "Function": "GTM",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "ATL",
      "Geo Fixed?": 1.0,
      "Swigger Type": "FTE",
      "Lead TC": "Tom",
      "Sourcing Notes": null,
      "Strategic Initiative": "Inside Sales",
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-021",
      "Role Title": "Junior Account Executive: ATL",
      "Notes": "Reviewing ICP / resetting role. ",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5092589/browser/applied",
      "Role Status": "Future",
      "Date_Open": "2026-01-01",
      "Date_Accept": "2026-03-01",
      "Date_Start": "2026-04-01",
      "Role Type": "New",
      "Team": "Sales",
      "Tribe": "Sales",
      "Function": "GTM",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "ATL",
      "Geo Fixed?": 1.0,
      "Swigger Type": "FTE",
      "Lead TC": "Tom",
      "Sourcing Notes": null,
      "Strategic Initiative": "Inside Sales",
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-022",
      "Role Title": "Security Engineer",
      "Notes": "Simon backfill - Matt Long",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5025847/browser/applied",
      "Role Status": "Offer Accepted",
      "Date_Open": "2025-08-22",
      "Date_Accept": "2025-11-28",
      "Date_Start": "2026-03-02",
      "Role Type": "Backfill",
      "Team": "Technology",
      "Tribe": "Technology",
      "Function": "Support",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Anthony",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-023",
      "Role Title": "Technology ICT Level 3 Apprentice",
      "Notes": "Finn Parsonage",
      "Workable link": "N/A - Pareto",
      "Role Status": "Started",
      "Date_Open": "2025-08-22",
      "Date_Accept": "2025-12-24",
      "Date_Start": "2026-01-05",
      "Role Type": "New",
      "Team": "Technology",
      "Tribe": "Technology",
      "Function": "Support",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Anthony",
      "Sourcing Notes": "Via Pareto",
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-024",
      "Role Title": "Technology ICT Level 3 Apprentice",
      "Notes": "N/A - Pareto",
      "Workable link": "N/A - Pareto",
      "Role Status": "Pipeline Open",
      "Date_Open": "2025-08-22",
      "Date_Accept": "2026-01-01",
      "Date_Start": "2026-04-01",
      "Role Type": "New",
      "Team": "Technology",
      "Tribe": "Technology",
      "Function": "Support",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Anthony",
      "Sourcing Notes": "Via Pareto",
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-026",
      "Role Title": "Graduate Developer - Returning WiT",
      "Notes": "Team TBC - Claire Cooper",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5082535/browser/applied",
      "Role Status": "Started",
      "Date_Open": "2024-08-01",
      "Date_Accept": "2024-08-01",
      "Date_Start": "2026-01-12",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-027",
      "Role Title": "Graduate Developer",
      "Notes": "Team TBC - Anish Thapa",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5082535/browser/applied",
      "Role Status": "Started",
      "Date_Open": "2025-09-01",
      "Date_Accept": "2025-10-10",
      "Date_Start": "2026-01-12",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-028",
      "Role Title": "Graduate Developer",
      "Notes": "Team TBC - Ricky Hull",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5082535/browser/applied",
      "Role Status": "Started",
      "Date_Open": "2025-09-01",
      "Date_Accept": "2025-10-10",
      "Date_Start": "2026-01-12",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-029",
      "Role Title": "Graduate Developer",
      "Notes": "Team TBC - Miguel Alfonso ",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5082535/browser/applied",
      "Role Status": "Started",
      "Date_Open": "2025-09-01",
      "Date_Accept": "2025-10-23",
      "Date_Start": "2026-01-12",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-030",
      "Role Title": "Graduate Developer",
      "Notes": "Team TBC - Ben Zefferrt",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5082535/browser/applied",
      "Role Status": "Started",
      "Date_Open": "2025-09-01",
      "Date_Accept": "2025-10-23",
      "Date_Start": "2026-01-12",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-031",
      "Role Title": "Product Marketing Manager",
      "Notes": "Potentially haring pipeline with Product Marketing Director / Lead",
      "Workable link": "https://portswigger.workable.com/backend/jobs/4492146/browser/applied",
      "Role Status": "Pipeline Open",
      "Date_Open": "2025-11-01",
      "Date_Accept": "2026-05-01",
      "Date_Start": "2026-08-01",
      "Role Type": "New",
      "Team": "Marketing",
      "Tribe": "Marketing",
      "Function": "GTM",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Simon",
      "Sourcing Notes": null,
      "Strategic Initiative": "Right-size Marketing function",
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-032",
      "Role Title": "Product Engineer",
      "Notes": "(Developer). Team TBC",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5109845/browser/offer",
      "Role Status": "Pipeline Open",
      "Date_Open": "2025-01-01",
      "Date_Accept": "2025-11-01",
      "Date_Start": "2026-02-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "LDN",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Anthony",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-033",
      "Role Title": "CSM (Scale): KNU",
      "Notes": "Pushing back to later in year due to hire of Sagar",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5047681/browser/applied",
      "Role Status": "Future",
      "Date_Open": "2026-04-01",
      "Date_Accept": "2026-06-01",
      "Date_Start": "2026-09-01",
      "Role Type": "New",
      "Team": "Customer Success",
      "Tribe": "CX",
      "Function": "GTM",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 1.0,
      "Swigger Type": "FTE",
      "Lead TC": "Tom",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-034",
      "Role Title": "Product Marketing Director / Lead",
      "Notes": "Potentially sharing pipeline with Product Marketing Manager",
      "Workable link": "https://portswigger.workable.com/backend/jobs/4492146/browser/applied",
      "Role Status": "Future",
      "Date_Open": "2026-01-19",
      "Date_Accept": "2026-03-30",
      "Date_Start": "2026-04-27",
      "Role Type": "New",
      "Team": "Marketing",
      "Tribe": "Marketing",
      "Function": "GTM",
      "Leader?": 1.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Simon",
      "Sourcing Notes": null,
      "Strategic Initiative": "Right-size Marketing function",
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-035",
      "Role Title": "Enterprise Sales Director",
      "Notes": "David Harrison",
      "Workable link": "https://portswigger.workable.com/backend/jobs#:~:text=More%20actions-,Sales%20Leader,-Growth%20Tribe%20%C2%B7",
      "Role Status": "Offer Accepted",
      "Date_Open": "2025-10-15",
      "Date_Accept": "2025-12-19",
      "Date_Start": "2026-03-02",
      "Role Type": "New",
      "Team": "Sales",
      "Tribe": "Sales",
      "Function": "GTM",
      "Leader?": 1.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 1.0,
      "Swigger Type": "FTE",
      "Lead TC": "Tom",
      "Sourcing Notes": "Prioritise getting a healthy pipeline, probably with direct sourcing, aim for final round interviews when Jim is in Knutsford in December",
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-037",
      "Role Title": "Engineering Manager",
      "Notes": "Pause pipeline",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5130637/browser/applied",
      "Role Status": "Future",
      "Date_Open": "2026-02-01",
      "Date_Accept": "2026-08-01",
      "Date_Start": "2026-11-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 1.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "TBC",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-038",
      "Role Title": "Product Engineer",
      "Notes": "(Developer). Team TBC",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5109845/browser/offer",
      "Role Status": "Pipeline Open",
      "Date_Open": "2025-01-01",
      "Date_Accept": "2025-12-01",
      "Date_Start": "2026-03-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "LDN",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Anthony",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-039",
      "Role Title": "RevOps - Experienced",
      "Notes": null,
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2025-11-01",
      "Date_Accept": "2026-01-01",
      "Date_Start": "2026-04-01",
      "Role Type": "New",
      "Team": "RevOps",
      "Tribe": "Other",
      "Function": "GTM",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Adam",
      "Sourcing Notes": null,
      "Strategic Initiative": "Build a mature Revenue Operations function",
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-040",
      "Role Title": "Security Researcher",
      "Notes": "AI Prompt Researcher",
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2026-02-01",
      "Date_Accept": "2026-07-01",
      "Date_Start": "2026-10-01",
      "Role Type": "New",
      "Team": "Research",
      "Tribe": "Other",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Adam",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-041",
      "Role Title": "Platform Engineer",
      "Notes": "Backfill Tao. Potential Grad Dev rotation?",
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2026-02-01",
      "Date_Accept": "2026-04-01",
      "Date_Start": "2026-06-01",
      "Role Type": "Backfill",
      "Team": "Technology",
      "Tribe": "Technology",
      "Function": "Support",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "TBC",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-042",
      "Role Title": "Product Engineer",
      "Notes": "(Developer). Team TBC",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5109845/browser/offer",
      "Role Status": "Pipeline Open",
      "Date_Open": "2025-01-01",
      "Date_Accept": "2026-01-01",
      "Date_Start": "2026-04-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "LDN",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Anthony",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-043",
      "Role Title": "Data Role TBC",
      "Notes": "Role TBC - Data Excellence",
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2026-05-01",
      "Date_Accept": "2026-07-01",
      "Date_Start": "2026-10-01",
      "Role Type": "New",
      "Team": "Financial Planning & Analysis",
      "Tribe": "Finance",
      "Function": "Support",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Adam",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-044",
      "Role Title": "Social and Community Manager",
      "Notes": null,
      "Workable link": "https://portswigger.workable.com/backend/jobs/4824736/browser/applied",
      "Role Status": "Future",
      "Date_Open": "2026-02-01",
      "Date_Accept": "2026-05-01",
      "Date_Start": "2026-08-01",
      "Role Type": "New",
      "Team": "Marketing",
      "Tribe": "Marketing",
      "Function": "GTM",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "Temp/FTC",
      "Lead TC": "Simon",
      "Sourcing Notes": null,
      "Strategic Initiative": "Right-size Marketing function",
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-045",
      "Role Title": "Product Engineer",
      "Notes": "(Developer). Team TBC",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5109845/browser/offer",
      "Role Status": "Pipeline Open",
      "Date_Open": "2025-01-01",
      "Date_Accept": "2026-02-01",
      "Date_Start": "2026-05-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "LDN",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Anthony",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-046",
      "Role Title": "Sales Channel: MSSP/Partnerships",
      "Notes": "Partnerships programmes (sell-through, MSSP, and tech partnerships)",
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2026-04-01",
      "Date_Accept": "2026-06-01",
      "Date_Start": "2026-09-01",
      "Role Type": "New",
      "Team": "Sales",
      "Tribe": "Sales",
      "Function": "GTM",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Tom",
      "Sourcing Notes": null,
      "Strategic Initiative": "Structured partner programme",
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-047",
      "Role Title": "Governance, Risk & Control (GRC)",
      "Notes": null,
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2026-02-01",
      "Date_Accept": "2026-04-01",
      "Date_Start": "2026-07-01",
      "Role Type": "New",
      "Team": "Technology",
      "Tribe": "Technology",
      "Function": "Support",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "TBC",
      "Sourcing Notes": null,
      "Strategic Initiative": "Build a risk and governance function",
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-048",
      "Role Title": "Culture - Talent Champion",
      "Notes": "Placeholder for Scaling Support",
      "Workable link": null,
      "Role Status": "Pipeline Open",
      "Date_Open": "2025-11-01",
      "Date_Accept": "2026-01-01",
      "Date_Start": "2026-04-01",
      "Role Type": "Backfill",
      "Team": "Culture",
      "Tribe": "Culture",
      "Function": "Support",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Simon",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-050",
      "Role Title": "Product Engineer",
      "Notes": "(Developer). Team TBC",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5109845/browser/offer",
      "Role Status": "Pipeline Open",
      "Date_Open": "2025-01-01",
      "Date_Accept": "2026-03-01",
      "Date_Start": "2026-06-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "LDN",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Anthony",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-051",
      "Role Title": "Technology Support (ATL)",
      "Notes": "Backfill Elliot. TBC - might roll into 2027",
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2026-09-01",
      "Date_Accept": "2026-11-01",
      "Date_Start": "2026-12-01",
      "Role Type": "Backfill",
      "Team": "Technology",
      "Tribe": "Technology",
      "Function": "Support",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "ATL",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "TBC",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-052",
      "Role Title": "Product Engineer",
      "Notes": "(Developer). Team TBC",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5109845/browser/offer",
      "Role Status": "Pipeline Open",
      "Date_Open": "2025-01-01",
      "Date_Accept": "2026-04-01",
      "Date_Start": "2026-07-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "LDN",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Anthony",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-053",
      "Role Title": "Social and Community Manager",
      "Notes": null,
      "Workable link": "https://portswigger.workable.com/backend/jobs/4824736/browser/applied",
      "Role Status": "Future",
      "Date_Open": "2026-09-01",
      "Date_Accept": "2026-11-01",
      "Date_Start": "2027-02-01",
      "Role Type": "New",
      "Team": "Marketing",
      "Tribe": "Marketing",
      "Function": "GTM",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Simon",
      "Sourcing Notes": null,
      "Strategic Initiative": "Right-size Marketing function",
      "Date_Year_Start": 2027.0
    },
    {
      "Id": "J25-054",
      "Role Title": "Master of the Swigverse",
      "Notes": "Will Sprunt",
      "Workable link": "https://portswigger.workable.com/backend/jobs/4855796/browser/applied",
      "Role Status": "Offer Accepted",
      "Date_Open": "2025-11-01",
      "Date_Accept": "2025-12-15",
      "Date_Start": "2026-03-01",
      "Role Type": "New",
      "Team": "Minions",
      "Tribe": "Minions",
      "Function": "Support",
      "Leader?": 1.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Simon",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-055",
      "Role Title": "Grad Biz Generalist",
      "Notes": null,
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2025-12-01",
      "Date_Accept": "2026-04-01",
      "Date_Start": "2026-09-01",
      "Role Type": "New",
      "Team": "Minions",
      "Tribe": "Minions",
      "Function": "Support",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-056",
      "Role Title": "CSM (Scale): ATL",
      "Notes": null,
      "Workable link": "https://portswigger.workable.com/backend/jobs/4492098/browser/applied",
      "Role Status": "Future",
      "Date_Open": "2026-01-01",
      "Date_Accept": "2026-03-01",
      "Date_Start": "2026-04-01",
      "Role Type": "New",
      "Team": "Customer Success",
      "Tribe": "CX",
      "Function": "GTM",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "ATL",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Tom",
      "Sourcing Notes": null,
      "Strategic Initiative": "Right-size Customer Support",
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-057",
      "Role Title": "Engineering Manager",
      "Notes": "Team TBC - EM",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5130637/browser/applied",
      "Role Status": "Future",
      "Date_Open": "2026-02-01",
      "Date_Accept": "2026-08-01",
      "Date_Start": "2026-11-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 1.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "TBC",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-058",
      "Role Title": "Product Engineer",
      "Notes": "(Developer). Team TBC",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5109845/browser/offer",
      "Role Status": "Pipeline Open",
      "Date_Open": "2025-01-01",
      "Date_Accept": "2026-05-01",
      "Date_Start": "2026-08-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "LDN",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Anthony",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-059",
      "Role Title": "Solutions Architect",
      "Notes": null,
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2026-04-01",
      "Date_Accept": "2026-06-01",
      "Date_Start": "2026-07-01",
      "Role Type": "New",
      "Team": "Customer Success",
      "Tribe": "CX",
      "Function": "GTM",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "ATL",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Tom",
      "Sourcing Notes": null,
      "Strategic Initiative": "Enterprise onboarding",
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-060",
      "Role Title": "Engineering Manager",
      "Notes": "Team TBC - EM",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5130637/browser/applied",
      "Role Status": "Future",
      "Date_Open": "2026-02-01",
      "Date_Accept": "2026-08-01",
      "Date_Start": "2026-11-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 1.0,
      "Grad?": 0.0,
      "Geo": "LDN",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "TBC",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-061",
      "Role Title": "Product Engineer",
      "Notes": "(Developer). Team TBC",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5109845/browser/offer",
      "Role Status": "Pipeline Open",
      "Date_Open": "2025-01-01",
      "Date_Accept": "2026-06-01",
      "Date_Start": "2026-09-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "LDN",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Anthony",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-062",
      "Role Title": "Graduate Developer",
      "Notes": "Team TBC - James Kinley",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5082535/browser/applied",
      "Role Status": "Offer Accepted",
      "Date_Open": "2025-09-01",
      "Date_Accept": "2025-10-24",
      "Date_Start": "2026-09-07",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-063",
      "Role Title": "Security Operations",
      "Notes": null,
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2026-05-01",
      "Date_Accept": "2026-07-01",
      "Date_Start": "2026-10-01",
      "Role Type": "New",
      "Team": "Technology",
      "Tribe": "Technology",
      "Function": "Support",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "TBC",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-064",
      "Role Title": "CSM (Scale): ATL",
      "Notes": null,
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2026-01-01",
      "Date_Accept": "2026-03-01",
      "Date_Start": "2026-04-01",
      "Role Type": "New",
      "Team": "Customer Success",
      "Tribe": "CX",
      "Function": "GTM",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "ATL",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Tom",
      "Sourcing Notes": null,
      "Strategic Initiative": "Premium success",
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-065",
      "Role Title": "CSM (Scale): KNU",
      "Notes": null,
      "Workable link": "https://portswigger.workable.com/backend/jobs/4492098/browser/applied",
      "Role Status": "Future",
      "Date_Open": "2026-04-01",
      "Date_Accept": "2026-06-01",
      "Date_Start": "2026-09-01",
      "Role Type": "New",
      "Team": "Customer Success",
      "Tribe": "CX",
      "Function": "GTM",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Tom",
      "Sourcing Notes": null,
      "Strategic Initiative": "Right-size Customer Support",
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-066",
      "Role Title": "Product Engineer",
      "Notes": "(Developer). Team TBC",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5109845/browser/offer",
      "Role Status": "Pipeline Open",
      "Date_Open": "2025-01-01",
      "Date_Accept": "2026-07-01",
      "Date_Start": "2026-10-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "LDN",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Anthony",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-067",
      "Role Title": "Product Engineer",
      "Notes": "(Developer). Team TBC",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5109845/browser/offer",
      "Role Status": "Pipeline Open",
      "Date_Open": "2025-01-01",
      "Date_Accept": "2026-08-01",
      "Date_Start": "2026-11-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "LDN",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Anthony",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-068",
      "Role Title": "Data Role TBC",
      "Notes": "Role TBC - Data Excellence",
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2026-05-01",
      "Date_Accept": "2026-07-01",
      "Date_Start": "2026-10-01",
      "Role Type": "New",
      "Team": "Financial Planning & Analysis",
      "Tribe": "Finance",
      "Function": "Support",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Adam",
      "Sourcing Notes": null,
      "Strategic Initiative": "Build data excellence",
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-069",
      "Role Title": "Content Marketing Manager",
      "Notes": null,
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2026-06-01",
      "Date_Accept": "2026-08-01",
      "Date_Start": "2026-11-01",
      "Role Type": "New",
      "Team": "Marketing",
      "Tribe": "Marketing",
      "Function": "GTM",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Simon",
      "Sourcing Notes": null,
      "Strategic Initiative": "Right-size Marketing function",
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-070",
      "Role Title": "RevOps",
      "Notes": null,
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2026-02-01",
      "Date_Accept": "2026-04-01",
      "Date_Start": "2026-07-01",
      "Role Type": "New",
      "Team": "RevOps",
      "Tribe": "Other",
      "Function": "GTM",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Adam",
      "Sourcing Notes": null,
      "Strategic Initiative": "Build a mature Revenue Operations function",
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-071",
      "Role Title": "Role TBC - Culture",
      "Notes": "Placeholder for Scaling Support",
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2026-03-01",
      "Date_Accept": "2026-05-01",
      "Date_Start": "2026-08-01",
      "Role Type": "New",
      "Team": "Culture",
      "Tribe": "Culture",
      "Function": "Support",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Simon",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-072",
      "Role Title": "Role TBC - Culture",
      "Notes": "Placeholder for Scaling Support",
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2026-06-01",
      "Date_Accept": "2026-08-01",
      "Date_Start": "2026-09-01",
      "Role Type": "New",
      "Team": "Culture",
      "Tribe": "Culture",
      "Function": "Support",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "ATL",
      "Geo Fixed?": 1.0,
      "Swigger Type": "FTE",
      "Lead TC": "Simon",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-075",
      "Role Title": "Role TBC - Culture",
      "Notes": "Placeholder for Scaling Support",
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2026-09-01",
      "Date_Accept": "2026-11-01",
      "Date_Start": "2027-02-01",
      "Role Type": "New",
      "Team": "Culture",
      "Tribe": "Culture",
      "Function": "Support",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Simon",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2027.0
    },
    {
      "Id": "J25-076",
      "Role Title": "Customer Success (Digital)",
      "Notes": "Digital Success Program Manager",
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2026-01-01",
      "Date_Accept": "2026-03-01",
      "Date_Start": "2026-06-01",
      "Role Type": "New",
      "Team": "Customer Success",
      "Tribe": "CX",
      "Function": "GTM",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Tom",
      "Sourcing Notes": null,
      "Strategic Initiative": "Digital CS",
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-077",
      "Role Title": "Product Engineer",
      "Notes": "(Developer). Team TBC",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5109845/browser/offer",
      "Role Status": "Pipeline Open",
      "Date_Open": "2025-01-01",
      "Date_Accept": "2026-09-01",
      "Date_Start": "2026-12-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "LDN",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Anthony",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-078",
      "Role Title": "Graduate Developer - Returning WiT",
      "Notes": "Team TBC - Charlotte MacDonald",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5082535/browser/applied",
      "Role Status": "Offer Accepted",
      "Date_Open": "2025-01-01",
      "Date_Accept": "2025-06-04",
      "Date_Start": "2026-09-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-079",
      "Role Title": "Graduate Developer - Returning WiT",
      "Notes": "Team TBC - Lucy Waters",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5082535/browser/applied",
      "Role Status": "Offer Accepted",
      "Date_Open": "2025-01-01",
      "Date_Accept": "2025-05-28",
      "Date_Start": "2026-09-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-080",
      "Role Title": "Graduate Developer - Returning WiT",
      "Notes": "Team TBC - Grace Webb",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5082535/browser/applied",
      "Role Status": "Offer Accepted",
      "Date_Open": "2025-01-01",
      "Date_Accept": "2025-09-01",
      "Date_Start": "2026-09-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-081",
      "Role Title": "Graduate Developer",
      "Notes": "Team TBC - James Duxbury",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5082535/browser/applied",
      "Role Status": "Offer Accepted",
      "Date_Open": "2025-09-01",
      "Date_Accept": "2025-10-01",
      "Date_Start": "2026-09-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-082",
      "Role Title": "Master of the Swigverse",
      "Notes": null,
      "Workable link": "https://portswigger.workable.com/backend/jobs/4855796/browser/applied",
      "Role Status": "Future",
      "Date_Open": "2026-02-01",
      "Date_Accept": "2026-12-01",
      "Date_Start": "2027-03-01",
      "Role Type": "New",
      "Team": "Minions",
      "Tribe": "Minions",
      "Function": "Support",
      "Leader?": 1.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Simon",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2027.0
    },
    {
      "Id": "J25-083",
      "Role Title": "Grad Biz Generalist",
      "Notes": null,
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2025-12-01",
      "Date_Accept": "2026-04-01",
      "Date_Start": "2026-09-01",
      "Role Type": "New",
      "Team": "Minions",
      "Tribe": "Minions",
      "Function": "Support",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-084",
      "Role Title": "Product Tech Writer",
      "Notes": "Team TBC",
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2026-10-01",
      "Date_Accept": "2026-12-01",
      "Date_Start": "2027-03-01",
      "Role Type": "New",
      "Team": "Team TBC - Product",
      "Tribe": "Product",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Adam",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2027.0
    },
    {
      "Id": "J25-085",
      "Role Title": "Sales Channel: MSSP/Partnerships",
      "Notes": "Partnerships programmes (sell-through, MSSP, and tech partnerships)",
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2026-04-01",
      "Date_Accept": "2026-06-01",
      "Date_Start": "2026-09-01",
      "Role Type": "New",
      "Team": "Sales",
      "Tribe": "Sales",
      "Function": "GTM",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Tom",
      "Sourcing Notes": null,
      "Strategic Initiative": "MSSP strategic partnerships",
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-088",
      "Role Title": "Platform Engineer",
      "Notes": null,
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2026-02-01",
      "Date_Accept": "2026-04-01",
      "Date_Start": "2026-06-01",
      "Role Type": "New",
      "Team": "Technology",
      "Tribe": "Technology",
      "Function": "Support",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "TBC",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-089",
      "Role Title": "Technology Team Leader",
      "Notes": "TBC - might roll into 2027",
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2026-09-01",
      "Date_Accept": "2026-11-01",
      "Date_Start": "2027-02-01",
      "Role Type": "New",
      "Team": "Technology",
      "Tribe": "Technology",
      "Function": "Support",
      "Leader?": 1.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "TBC",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2027.0
    },
    {
      "Id": "J25-090",
      "Role Title": "Finance Manager",
      "Notes": "Sanj Harrichand",
      "Workable link": "https://portswigger.workable.com/backend/jobs/4958640/browser/offer_accepted/candidate/497583152",
      "Role Status": "Started",
      "Date_Open": "2025-08-18",
      "Date_Accept": "2025-08-18",
      "Date_Start": "2025-11-17",
      "Role Type": "New",
      "Team": "Finance Control",
      "Tribe": "Finance",
      "Function": "Support",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Adam",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2025.0
    },
    {
      "Id": "J25-091",
      "Role Title": "Product Manager - CriSys",
      "Notes": "Matt Prescrott - Backfill for Raji",
      "Workable link": "https://portswigger.workable.com/backend/jobs/4924643/browser/applied",
      "Role Status": "Started",
      "Date_Open": "2025-06-09",
      "Date_Accept": "2025-11-01",
      "Date_Start": "2025-12-01",
      "Role Type": "Backfill",
      "Team": "Critical Systems",
      "Tribe": "Product",
      "Function": "P&E",
      "Leader?": 1.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Anthony",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2025.0
    },
    {
      "Id": "J25-092",
      "Role Title": "Customer Success Manager",
      "Notes": "Michael Kongnyu",
      "Workable link": "https://portswigger.workable.com/backend/jobs/4492098/browser/applied",
      "Role Status": "Started",
      "Date_Open": "2025-03-14",
      "Date_Accept": "2025-10-01",
      "Date_Start": "2026-01-03",
      "Role Type": "New",
      "Team": "Customer Success",
      "Tribe": "CX",
      "Function": "GTM",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Tom",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-093",
      "Role Title": "Product UX Researcher",
      "Notes": "Hope Bristow",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5130405/browser/offer_accepted/candidate/524956768",
      "Role Status": "Offer Accepted",
      "Date_Open": "2025-09-01",
      "Date_Accept": "2025-11-01",
      "Date_Start": "2026-03-01",
      "Role Type": "New",
      "Team": "Product",
      "Tribe": "Product",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Adam",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-094",
      "Role Title": "Product UX",
      "Notes": "Designer / Researcher for Teams",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5130405/browser/applied",
      "Role Status": "Future",
      "Date_Open": "2026-08-01",
      "Date_Accept": "2026-10-01",
      "Date_Start": "2027-01-01",
      "Role Type": "New",
      "Team": "Team TBC - Product",
      "Tribe": "Product",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Adam",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2027.0
    },
    {
      "Id": "J25-095",
      "Role Title": "Product Engineer",
      "Notes": "George Belokapov",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5109845/browser/offer",
      "Role Status": "Offer Accepted",
      "Date_Open": "2025-09-01",
      "Date_Accept": "2025-10-31",
      "Date_Start": "2026-02-02",
      "Role Type": "New",
      "Team": "BurpAI",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "LDN",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Anthony",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-096",
      "Role Title": "Graduate Developer",
      "Notes": "Team TBC ",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5082535/browser/applied",
      "Role Status": "Future",
      "Date_Open": "2025-09-01",
      "Date_Accept": "2025-10-24",
      "Date_Start": "2026-09-07",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-097",
      "Role Title": "Graduate Developer",
      "Notes": "Team TBC - Sam Berry ",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5082535/browser/applied",
      "Role Status": "Offer Accepted",
      "Date_Open": "2025-09-01",
      "Date_Accept": "2025-11-01",
      "Date_Start": "2026-09-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-098",
      "Role Title": "Graduate Developer",
      "Notes": "Team TBC - Oliver Hamilton",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5082535/browser/applied",
      "Role Status": "Offer Accepted",
      "Date_Open": "2025-09-01",
      "Date_Accept": "2025-11-01",
      "Date_Start": "2026-09-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-099",
      "Role Title": "Graduate Developer",
      "Notes": "Team TBC - Rayan Rizwan",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5082535/browser/applied",
      "Role Status": "Offer Accepted",
      "Date_Open": "2025-09-01",
      "Date_Accept": "2025-11-01",
      "Date_Start": "2026-09-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-100",
      "Role Title": "Graduate Developer",
      "Notes": "Team TBC - Albert Kwok ",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5082535/browser/applied",
      "Role Status": "Offer Accepted",
      "Date_Open": "2025-09-01",
      "Date_Accept": "2025-11-01",
      "Date_Start": "2026-09-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-101",
      "Role Title": "Graduate Developer",
      "Notes": "Team TBC - Ibraheem Ali ",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5082535/browser/applied",
      "Role Status": "Offer Made",
      "Date_Open": "2025-09-01",
      "Date_Accept": "2025-11-01",
      "Date_Start": "2026-09-07",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-102",
      "Role Title": "Graduate Developer",
      "Notes": "Team TBC - Ibraheem Ali ",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5082535/browser/applied",
      "Role Status": "Offer Accepted",
      "Date_Open": "2025-09-01",
      "Date_Accept": "2025-11-01",
      "Date_Start": "2026-09-07",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-103",
      "Role Title": "Graduate Developer",
      "Notes": "Team TBC - Jan 27 GradDev",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5082535/browser/applied",
      "Role Status": "Future",
      "Date_Open": "2025-09-01",
      "Date_Accept": "2025-11-01",
      "Date_Start": "2027-01-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2027.0
    },
    {
      "Id": "J25-104",
      "Role Title": "Graduate Developer",
      "Notes": "Team TBC - Jan 27 GradDev",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5082535/browser/applied",
      "Role Status": "Future",
      "Date_Open": "2025-09-01",
      "Date_Accept": "2025-11-01",
      "Date_Start": "2027-01-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2027.0
    },
    {
      "Id": "J25-105",
      "Role Title": "Graduate Developer",
      "Notes": "Team TBC - Jan 27 GradDev",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5082535/browser/applied",
      "Role Status": "Future",
      "Date_Open": "2025-09-01",
      "Date_Accept": "2025-11-01",
      "Date_Start": "2027-01-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2027.0
    },
    {
      "Id": "J25-106",
      "Role Title": "Graduate Developer",
      "Notes": "Team TBC - Jan 27 GradDev",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5082535/browser/applied",
      "Role Status": "Future",
      "Date_Open": "2025-09-01",
      "Date_Accept": "2025-11-01",
      "Date_Start": "2027-01-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2027.0
    },
    {
      "Id": "J25-107",
      "Role Title": "Sales Engineer",
      "Notes": "Elba Lugo",
      "Workable link": "https://portswigger.workable.com/backend/jobs/4710354/browser/offer_accepted",
      "Role Status": "Started",
      "Date_Open": "2025-09-01",
      "Date_Accept": "2025-12-01",
      "Date_Start": "2025-12-08",
      "Role Type": "New",
      "Team": "Sales",
      "Tribe": "Sales",
      "Function": "GTM",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "ATL",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Tom",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2025.0
    },
    {
      "Id": "J25-108",
      "Role Title": "Product Engineer",
      "Notes": "(Developer). Team TBC",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5109845/browser/offer",
      "Role Status": "Pipeline Open",
      "Date_Open": "2025-01-01",
      "Date_Accept": "2026-11-01",
      "Date_Start": "2027-02-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "LDN",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Anthony",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2027.0
    },
    {
      "Id": "J25-109",
      "Role Title": "Product Engineer",
      "Notes": "(Developer). Team TBC",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5109845/browser/offer",
      "Role Status": "Pipeline Open",
      "Date_Open": "2025-01-01",
      "Date_Accept": "2026-10-01",
      "Date_Start": "2027-01-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "LDN",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Anthony",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2027.0
    },
    {
      "Id": "J25-110",
      "Role Title": "Product Engineer",
      "Notes": "(Developer). Team TBC",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5109845/browser/offer",
      "Role Status": "Pipeline Open",
      "Date_Open": "2025-01-01",
      "Date_Accept": "2026-12-01",
      "Date_Start": "2027-03-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": "LDN",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Anthony",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2027.0
    },
    {
      "Id": "J25-111",
      "Role Title": "Women In Tech",
      "Notes": "2027 summer placement",
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2026-03-01",
      "Date_Accept": "2026-07-01",
      "Date_Start": "2027-08-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2027.0
    },
    {
      "Id": "J25-112",
      "Role Title": "Women In Tech",
      "Notes": "2027 summer placement",
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2026-03-01",
      "Date_Accept": "2026-07-01",
      "Date_Start": "2027-08-01",
      "Role Type": "New",
      "Team": "Team TBC - Engineering",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2027.0
    },
    {
      "Id": "J25-113",
      "Role Title": "Culture Graduate",
      "Notes": null,
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2025-12-01",
      "Date_Accept": "2026-02-01",
      "Date_Start": "2026-09-01",
      "Role Type": "New",
      "Team": "Culture",
      "Tribe": "Culture",
      "Function": "Support",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-114",
      "Role Title": "Culture Graduate",
      "Notes": null,
      "Workable link": null,
      "Role Status": "Future",
      "Date_Open": "2025-12-01",
      "Date_Accept": "2026-02-01",
      "Date_Start": "2026-09-01",
      "Role Type": "New",
      "Team": "Culture",
      "Tribe": "Culture",
      "Function": "Support",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-115",
      "Role Title": "Marketing Graduate Executive ",
      "Notes": "Open internally through referal ",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5305777/browser/applied",
      "Role Status": "Offer Accepted",
      "Date_Open": "2025-11-01",
      "Date_Accept": "2026-02-01",
      "Date_Start": "2026-01-12",
      "Role Type": "New",
      "Team": "Marketing",
      "Tribe": "Marketing",
      "Function": "GTM",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-116",
      "Role Title": "Marketing Graduate Executive ",
      "Notes": null,
      "Workable link": "https://portswigger.workable.com/backend/jobs/5305777/browser/applied",
      "Role Status": "Future",
      "Date_Open": "2025-11-01",
      "Date_Accept": "2026-02-01",
      "Date_Start": "2026-09-01",
      "Role Type": "New",
      "Team": "Marketing",
      "Tribe": "Marketing",
      "Function": "GTM",
      "Leader?": 0.0,
      "Grad?": 1.0,
      "Geo": "KNU",
      "Geo Fixed?": 0.0,
      "Swigger Type": "FTE",
      "Lead TC": "Mia",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 2026.0
    },
    {
      "Id": "J25-117",
      "Role Title": "Customer Relationship Manager",
      "Notes": "Sagar Krishnamurthy ",
      "Workable link": "https://portswigger.workable.com/backend/candidates/db/profile/527569893?q=sagar&sort=-score,-created_at&offset=0",
      "Role Status": "Started",
      "Date_Open": "2025-07-01",
      "Date_Accept": "2025-12-10",
      "Date_Start": "2025-12-01",
      "Role Type": "New",
      "Team": "Customer Success",
      "Tribe": "CX",
      "Function": "GTM",
      "Leader?": null,
      "Grad?": null,
      "Geo": "KNU",
      "Geo Fixed?": null,
      "Swigger Type": "FTE",
      "Lead TC": "Adam",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": null
    },
    {
      "Id": "J25-118",
      "Role Title": "Security Engineer",
      "Notes": "Joshua Lainton-Ruddell",
      "Workable link": "https://portswigger.workable.com/backend/jobs/5025847/browser/offer_accepted",
      "Role Status": "Offer Accepted",
      "Date_Open": "2025-07-01",
      "Date_Accept": "2025-12-10",
      "Date_Start": "2025-12-01",
      "Role Type": "New",
      "Team": "Research",
      "Tribe": "Engineering",
      "Function": "P&E",
      "Leader?": null,
      "Grad?": null,
      "Geo": "KNU",
      "Geo Fixed?": null,
      "Swigger Type": "FTE",
      "Lead TC": "Anthony",
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": null
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    },
    {
      "Id": null,
      "Role Title": null,
      "Notes": null,
      "Workable link": null,
      "Role Status": null,
      "Date_Open": null,
      "Date_Accept": null,
      "Date_Start": null,
      "Role Type": null,
      "Team": null,
      "Tribe": null,
      "Function": null,
      "Leader?": 0.0,
      "Grad?": 0.0,
      "Geo": null,
      "Geo Fixed?": 0.0,
      "Swigger Type": null,
      "Lead TC": null,
      "Sourcing Notes": null,
      "Strategic Initiative": null,
      "Date_Year_Start": 1899.0
    }
  ],
  "attritionData": [
    {
      "Unnamed: 0": null,
      "Unnamed: 1": null,
      "Unnamed: 2": null,
      "Unnamed: 3": null,
      "Unnamed: 4": null,
      "Unnamed: 5": null,
      "Unnamed: 6": null,
      "Unnamed: 7": null,
      "Unnamed: 8": null,
      "Unnamed: 9": null,
      "Unnamed: 10": null,
      "Unnamed: 11": null,
      "Unnamed: 12": null
    },
    {
      "Unnamed: 0": null,
      "Unnamed: 1": null,
      "Unnamed: 2": null,
      "Unnamed: 3": null,
      "Unnamed: 4": null,
      "Unnamed: 5": null,
      "Unnamed: 6": null,
      "Unnamed: 7": null,
      "Unnamed: 8": null,
      "Unnamed: 9": null,
      "Unnamed: 10": null,
      "Unnamed: 11": null,
      "Unnamed: 12": null
    },
    {
      "Unnamed: 0": null,
      "Unnamed: 1": "2026-01-26",
      "Unnamed: 2": "2026-02-26",
      "Unnamed: 3": "2026-03-26",
      "Unnamed: 4": "2026-04-26",
      "Unnamed: 5": "2026-05-26",
      "Unnamed: 6": "2026-06-26",
      "Unnamed: 7": "2026-07-26",
      "Unnamed: 8": "2026-08-26",
      "Unnamed: 9": "2026-09-26",
      "Unnamed: 10": "2026-10-26",
      "Unnamed: 11": "2026-11-26",
      "Unnamed: 12": "2026-12-26"
    },
    {
      "Unnamed: 0": null,
      "Unnamed: 1": -3,
      "Unnamed: 2": -3,
      "Unnamed: 3": -3,
      "Unnamed: 4": -4,
      "Unnamed: 5": -4,
      "Unnamed: 6": -4,
      "Unnamed: 7": -4,
      "Unnamed: 8": -4,
      "Unnamed: 9": -4,
      "Unnamed: 10": -4,
      "Unnamed: 11": -5,
      "Unnamed: 12": -5
    }
  ],
  "visualizationData": [
    {
      "Unnamed: 0": "Tom (16)",
      "November": "Sales Engineer - Atlanta",
      "December": null,
      "January": "Digital Customer Success",
      "February": null,
      "March": null,
      "April": "CSM (Scale): KNU",
      "May": null,
      "June": null,
      "July": null,
      "August": null,
      "September": "Graduate Software Developers",
      "October": null,
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": null,
      "November": "Sales Leader",
      "December": null,
      "January": "TPS Atlanta x2",
      "February": null,
      "March": null,
      "April": "CSM (Scale): KNU",
      "May": null,
      "June": null,
      "July": null,
      "August": null,
      "September": null,
      "October": null,
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": null,
      "November": "Junior A&E - Knutsford",
      "December": null,
      "January": "Junior A&E - Atlanta x2 (role change to SDR)",
      "February": null,
      "March": null,
      "April": "Solution Architect KNU",
      "May": null,
      "June": null,
      "July": null,
      "August": null,
      "September": null,
      "October": null,
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": null,
      "November": "TPS Atlanta x1",
      "December": null,
      "January": "CSM (Scale): ATL x2",
      "February": null,
      "March": null,
      "April": "Partnerships x2",
      "May": null,
      "June": null,
      "July": null,
      "August": null,
      "September": null,
      "October": null,
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": null,
      "November": null,
      "December": null,
      "January": null,
      "February": null,
      "March": null,
      "April": null,
      "May": null,
      "June": null,
      "July": null,
      "August": null,
      "September": null,
      "October": null,
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": "Adam (13)",
      "November": "Data Engineer",
      "December": null,
      "January": "FP&A Analyst",
      "February": null,
      "March": null,
      "April": null,
      "May": "Data TBC x2",
      "June": null,
      "July": null,
      "August": null,
      "September": null,
      "October": null,
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": null,
      "November": "Growth Finance Partner",
      "December": null,
      "January": null,
      "February": "Rev Ops ",
      "March": null,
      "April": null,
      "May": null,
      "June": null,
      "July": null,
      "August": null,
      "September": null,
      "October": null,
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": null,
      "November": null,
      "December": null,
      "January": "Rev Ops - Experienced",
      "February": null,
      "March": null,
      "April": null,
      "May": null,
      "June": null,
      "July": null,
      "August": null,
      "September": null,
      "October": "Technical Writer",
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": null,
      "November": "Tax & Treasury",
      "December": null,
      "January": "Product Manager - Teams",
      "February": null,
      "March": null,
      "April": null,
      "May": "Product Data",
      "June": null,
      "July": null,
      "August": "Product UX",
      "September": null,
      "October": null,
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": null,
      "November": null,
      "December": null,
      "January": "Security Researcher",
      "February": null,
      "March": null,
      "April": null,
      "May": null,
      "June": null,
      "July": null,
      "August": null,
      "September": null,
      "October": null,
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": null,
      "November": null,
      "December": null,
      "January": null,
      "February": null,
      "March": null,
      "April": null,
      "May": null,
      "June": null,
      "July": null,
      "August": null,
      "September": null,
      "October": null,
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": "Simon (15)",
      "November": "Culture - Talent Champion",
      "December": null,
      "January": null,
      "February": "MotS x2",
      "March": null,
      "April": null,
      "May": null,
      "June": null,
      "July": null,
      "August": null,
      "September": null,
      "October": null,
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": null,
      "November": "PMM",
      "December": null,
      "January": null,
      "February": null,
      "March": null,
      "April": null,
      "May": null,
      "June": "Culture",
      "July": null,
      "August": null,
      "September": "Culture ",
      "October": null,
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": null,
      "November": "PML",
      "December": null,
      "January": null,
      "February": null,
      "March": "Culture ",
      "April": null,
      "May": null,
      "June": "Culture Talent Lead",
      "July": null,
      "August": null,
      "September": null,
      "October": null,
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": null,
      "November": "FoH + Kitchen (Led by Renata & co)",
      "December": null,
      "January": null,
      "February": null,
      "March": null,
      "April": "Community Manager",
      "May": null,
      "June": null,
      "July": null,
      "August": null,
      "September": "Social Community Manager",
      "October": null,
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": null,
      "November": null,
      "December": null,
      "January": "Content Manager",
      "February": null,
      "March": null,
      "April": null,
      "May": null,
      "June": null,
      "July": null,
      "August": null,
      "September": null,
      "October": null,
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": null,
      "November": null,
      "December": null,
      "January": null,
      "February": null,
      "March": null,
      "April": null,
      "May": null,
      "June": null,
      "July": null,
      "August": null,
      "September": null,
      "October": "Social Media Manager",
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": null,
      "November": null,
      "December": null,
      "January": null,
      "February": null,
      "March": null,
      "April": null,
      "May": null,
      "June": null,
      "July": null,
      "August": null,
      "September": null,
      "October": null,
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": "Anthony (15)",
      "November": "Product Engineer x12",
      "December": null,
      "January": null,
      "February": null,
      "March": null,
      "April": null,
      "May": null,
      "June": null,
      "July": null,
      "August": null,
      "September": null,
      "October": null,
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": null,
      "November": "Security Engineer x1",
      "December": null,
      "January": null,
      "February": null,
      "March": null,
      "April": null,
      "May": null,
      "June": null,
      "July": null,
      "August": null,
      "September": null,
      "October": null,
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": null,
      "November": "ICT Apprentice x2 (Led by Ben & co)",
      "December": null,
      "January": null,
      "February": null,
      "March": null,
      "April": null,
      "May": null,
      "June": null,
      "July": null,
      "August": null,
      "September": null,
      "October": null,
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": null,
      "November": null,
      "December": null,
      "January": null,
      "February": null,
      "March": null,
      "April": null,
      "May": null,
      "June": null,
      "July": null,
      "August": null,
      "September": null,
      "October": null,
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": "New TC (9)",
      "November": null,
      "December": null,
      "January": null,
      "February": "GRC x1",
      "March": null,
      "April": null,
      "May": "Security Ops x1",
      "June": null,
      "July": null,
      "August": null,
      "September": "Technology Support - Atlanta x1",
      "October": null,
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": null,
      "November": null,
      "December": null,
      "January": null,
      "February": "EMs x3",
      "March": null,
      "April": null,
      "May": null,
      "June": null,
      "July": null,
      "August": null,
      "September": "Technology Team Lead",
      "October": null,
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": null,
      "November": null,
      "December": null,
      "January": null,
      "February": "Platform Engineer x2",
      "March": null,
      "April": null,
      "May": null,
      "June": null,
      "July": null,
      "August": null,
      "September": null,
      "October": null,
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": null,
      "November": null,
      "December": null,
      "January": null,
      "February": null,
      "March": null,
      "April": null,
      "May": null,
      "June": null,
      "July": null,
      "August": null,
      "September": null,
      "October": null,
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": "Mia",
      "November": "Grad Dev",
      "December": null,
      "January": "Grad business generalist x2",
      "February": "WiT scholarship",
      "March": null,
      "April": null,
      "May": null,
      "June": null,
      "July": null,
      "August": null,
      "September": null,
      "October": null,
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": null,
      "November": null,
      "December": "Grad culture x2",
      "January": null,
      "February": null,
      "March": null,
      "April": null,
      "May": null,
      "June": null,
      "July": null,
      "August": null,
      "September": null,
      "October": null,
      "November.1": null,
      "December.1": null
    },
    {
      "Unnamed: 0": null,
      "November": "Grad marketing x2",
      "December": null,
      "January": null,
      "February": null,
      "March": null,
      "April": null,
      "May": null,
      "June": null,
      "July": null,
      "August": null,
      "September": null,
      "October": null,
      "November.1": null,
      "December.1": null
    }
  ],
  "championCapacityData": [
    {
      "Purpose": "To ensure fairness, transparency, and efficiency in Talent Champion workload across tribes and functions, supporting PortSwigger\u2019s ability to scale smart while maintaining Swigger culture."
    },
    {
      "Purpose": null
    },
    {
      "Purpose": "Triggers for review"
    },
    {
      "Purpose": "Active Role Threshold: If a Talent Champion has >4 active roles in a single tribe/function, this triggers a discussion to either redistribute roles to other Champions or lean on temporary SSC support."
    },
    {
      "Purpose": null
    },
    {
      "Purpose": "High-Complexity Pipelines: If a Talent Champion manages \u22652 high-complexity pipelines, this flags the need for review and possible redistribution."
    },
    {
      "Purpose": "High-complexity definition: High-complexity roles could require significantly more time, expertise, or stakeholder coordination than standard roles."
    },
    {
      "Purpose": "Criteria for High-Complexity Pipelines:"
    },
    {
      "Purpose": "Roles we have not hired for before such as VP, Junior AE, Director etc."
    },
    {
      "Purpose": "Cross-functional involvement of different hiring teams ie., roles requiring alignment across multiple functions or tribes."
    },
    {
      "Purpose": "Low availability talent pool ie., roles with very competitive markets or niche skill sets (e.g., senior security engineers, highly specialised technologists)."
    },
    {
      "Purpose": "High impact on business outcomes ie., roles where a wrong hire has significant business risk (Engineering, Product leadership, Tech/Platform specialists)."
    },
    {
      "Purpose": "Extended cycle time ie., roles that historically take longer than average to fill (>8\u201310 weeks)."
    },
    {
      "Purpose": null
    },
    {
      "Purpose": "Ad-Hoc workload spikes: Any unforeseen peak in pipeline complexity or urgency triggers immediate review with SSC support options."
    },
    {
      "Purpose": null
    },
    {
      "Purpose": "Redistribution Process"
    },
    {
      "Purpose": "Talent Champions record active roles and high-complexity pipelines on the shared spreadsheet (here)."
    },
    {
      "Purpose": "Redistributing roles is initiated by either the overloaded Talent Champion or the Team Leader."
    },
    {
      "Purpose": "SSCs can step in to support (based on their own workload) immediately if redistribution is not feasible or requires additional capacity."
    },
    {
      "Purpose": "Review every month initially. Once we attain a certain momentum, we can move to a different review cadence ie., quarterly."
    },
    {
      "Purpose": "Purpose of review: small reshuffles based on upcoming hiring plans, business priorities, and pipeline projections."
    },
    {
      "Purpose": "Outcomes of the review: ensures equitable spread of workload, prevents chronic overloading, and aligns Talent Champions effort with strategic hiring."
    },
    {
      "Purpose": "Keeping track on the load by adding these metrics to the shared spreadsheet:"
    },
    {
      "Purpose": "Number of active roles per Champion"
    },
    {
      "Purpose": "Number of high-complexity pipelines per Champion"
    },
    {
      "Purpose": "Screening calls per Talent Champion per week"
    },
    {
      "Purpose": null
    },
    {
      "Purpose": "Principles"
    },
    {
      "Purpose": null
    },
    {
      "Purpose": "Fairness: workload spread proportionally based on active roles and complexity."
    },
    {
      "Purpose": null
    },
    {
      "Purpose": "Transparency: all workload, triggers, and redistributions visible to the team."
    },
    {
      "Purpose": null
    },
    {
      "Purpose": "Flexibility: ad-hoc SSC support or redistribution allows for rapid response to spikes."
    },
    {
      "Purpose": null
    },
    {
      "Purpose": "Proactivity: weekly or every 2 weeks monitoring prevents backlog and ensures early intervention."
    },
    {
      "Purpose": null
    },
    {
      "Purpose": null
    },
    {
      "Purpose": "Dashboard Metrics"
    },
    {
      "Purpose": null
    },
    {
      "Purpose": "1. Active Roles per Talent Champion"
    },
    {
      "Purpose": "Measures: Count of active roles per Champion, grouped by tribe/function."
    },
    {
      "Purpose": "Why: Threshold trigger: >4 active roles prompts redistribution review."
    },
    {
      "Purpose": "Display: A Tab per Talent Champion with this information"
    },
    {
      "Purpose": null
    },
    {
      "Purpose": "2. High-Complexity Roles"
    },
    {
      "Purpose": "Measures: Number of roles meeting complexity criteria (first-time hiring, cross-functional, niche market, high impact, long cycle time >8\u201310 weeks)."
    },
    {
      "Purpose": "Why: Threshold trigger: \u22652 high-complexity roles require review."
    },
    {
      "Purpose": "Display: Complexity score per role + count per Champion."
    },
    {
      "Purpose": null
    },
    {
      "Purpose": "3. Time Allocation (BAU vs Pipeline/Engagement)"
    },
    {
      "Purpose": "Measures: Weekly time split across:"
    },
    {
      "Purpose": "Roles are live and we are actively doing recruitment ie., moving live roles forward, direct sourcing, catch ups with hiring teams etc."
    },
    {
      "Purpose": "Roles will go live and we are preparing for it ie., doing ICPs, market insights, getting hiring teams ready etc."
    },
    {
      "Purpose": "Why: Provides visibility of non-role workload and supports capacity decisions."
    },
    {
      "Purpose": "Display: Trend line or percentage split."
    },
    {
      "Purpose": null
    },
    {
      "Purpose": "4. Screening Calls per Champion"
    },
    {
      "Purpose": "Measures: Weekly planned and completed screening calls."
    },
    {
      "Purpose": "Why: Identified as key workload driver; included in workload tracking metrics."
    },
    {
      "Purpose": "Display: Per-Champion bar chart."
    }
  ]
};

// Override loadData function to use embedded data
async function loadData() {
    try {
        console.log('üì¶ Loading embedded data...');

        const data = window.EMBEDDED_DATA;

        // Process hiring data
        hiringData = data.hiringData.map(row => ({
            id: row['Id'],
            roleTitle: row['Role Title'],
            notes: row['Notes'],
            workableLink: row['Workable link'],
            roleStatus: row['Role Status'],
            dateOpen: row['Date_Open'] ? new Date(row['Date_Open']) : null,
            dateAccept: row['Date_Accept'] ? new Date(row['Date_Accept']) : null,
            dateStart: row['Date_Start'] ? new Date(row['Date_Start']) : null,
            roleType: row['Role Type'],
            team: row['Team'],
            tribe: row['Tribe'],
            function: row['Function'],
            isLeader: row['Leader?'],
            isGrad: row['Grad?'],
            geo: row['Geo'],
            geoFixed: row['Geo Fixed?'],
            swiggerType: row['Swigger Type'],
            leadTC: row['Lead TC'],
            sourcingNotes: row['Sourcing Notes'],
            strategicInitiative: row['Strategic Initiative'],
            dateYearStart: row['Date_Year_Start']
        })));

        console.log(`‚úì Loaded ${hiringData.length} hiring roles`);

        // Process attrition data
        attritionData = data.attritionData.map(row => {
            const keys = Object.keys(row);
            const dateKey = keys.find(k => k.includes('2026') || k.toLowerCase().includes('month'));
            const valueKey = keys.find(k => k !== dateKey);

            return {
                date: new Date(row[dateKey]),
                count: Math.abs(row[valueKey] || 0)
            };
        });

        console.log(`‚úì Loaded ${attritionData.length} attrition months`);

        // Generate backfill roles
        const backfillRoles = [];
        attritionData.forEach(attrition => {
            const departureDate = new Date(attrition.date);
            const departureCount = Math.abs(attrition.count || 0);

            for (let i = 0; i < departureCount; i++) {
                const backfillDepartureDate = new Date(departureDate);
                const backfillOpenDate = new Date(departureDate);
                backfillOpenDate.setMonth(backfillOpenDate.getMonth() + 1);
                backfillOpenDate.setDate(1);

                backfillRoles.push({
                    departureMonth: `${backfillDepartureDate.getFullYear()}-${String(backfillDepartureDate.getMonth() + 1).padStart(2, '0')}`,
                    backfillOpenMonth: `${backfillOpenDate.getFullYear()}-${String(backfillOpenDate.getMonth() + 1).padStart(2, '0')}`,
                    backfillOpenDate: new Date(backfillOpenDate),
                    departureDate: new Date(backfillDepartureDate),
                    roleTitle: 'Backfill Role (TBD)',
                    function: 'TBD',
                    champion: 'Misc Talent Champion',
                    status: 'Backfill - Not Opened'
                });
            }
        });

        window.backfillRoles = backfillRoles;
        console.log(`‚úì Generated ${backfillRoles.length} backfill roles`);

        // Update backfill statuses based on current date
        updateBackfillStatuses();

        // Calculate monthly backfills
        const monthlyBackfills = {};
        backfillRoles.forEach(backfill => {
            const monthKey = backfill.backfillOpenMonth;
            if (!monthlyBackfills[monthKey]) {
                monthlyBackfills[monthKey] = 0;
            }
            monthlyBackfills[monthKey]++;
        });
        window.monthlyBackfills = monthlyBackfills;

        // Process visualization data
        if (data.visualizationData && data.visualizationData.length > 0) {
            window.visualizationData = {};

            // Group roles by month
            const rolesByMonth = {};
            data.visualizationData.forEach(row => {
                const month = row['Month'] || row['month'];
                if (!month) return;

                if (!rolesByMonth[month]) {
                    rolesByMonth[month] = [];
                }

                // Extract role info
                const role = {
                    month: month,
                    title: row['Role Title'] || row['title'] || 'TBD',
                    function: row['Function'] || row['function'] || 'TBD',
                    champion: row['Champion'] || row['champion'] || 'Unassigned',
                    count: row['Count'] || row['count'] || 1
                };

                rolesByMonth[month].push(role);
            });

            window.visualizationData.rolesByMonth = rolesByMonth;
            console.log(`‚úì Loaded visualization data for ${Object.keys(rolesByMonth).length} months`);
        }

        // Process champion capacity data
        if (data.championCapacityData && data.championCapacityData.length > 0) {
            championCapacityData = {};
            data.championCapacityData.forEach(row => {
                const championName = row['Champion'] || row['Name'];
                if (championName) {
                    championCapacityData[championName] = {
                        activeRoles: row['Active Roles'] || 0,
                        highComplexityRoles: row['High Complexity'] || 0,
                        liveRoles: row['Live Roles'] || 0,
                        upcomingRoles: row['Upcoming Roles'] || 0,
                        screeningCallsPerWeek: row['Screening Calls'] || 0,
                        projectWorkTime: row['Project Work'] || 0,
                        otherWork: row['Other Work'] || 0
                    };
                }
            });
            console.log(`‚úì Loaded capacity data for ${Object.keys(championCapacityData).length} champions`);
        }

        // Set historical data to empty (not needed for standalone)
        historical2025Data = { hiresYTD: { total: 0 }, cumulativeAccepts: 0 };

        updateDashboard();
        updateLastRefreshTime();

        console.log('‚úÖ All embedded data loaded successfully');
    } catch (error) {
        console.error('‚ùå Error loading embedded data:', error);
        alert('Error loading dashboard data: ' + error.message);
    }
}


    // ============================================
    // DASHBOARD CORE LOGIC
    // ============================================
    // Dashboard v121 - DEBUG: Enhanced logging to show strategic initiative values for each pipeline role
// Global variables
let hiringData = [];
let attritionData = [];
let historical2025Data = {}; // Historical data from 2025 - Hiring Planning.xlsx
let championCapacityData = {}; // Capacity data from Talent Champion - Dashboards.xlsx
let charts = {};
let currentFilters = {
    champion: 'all',
    function: 'all',
    status: 'all',
    date: '' // Empty by default to show all months
};
let editMode = false;
let changedRoles = new Set(); // Track which roles have been modified
let deletedRoles = new Set(); // Track deleted roles
let newRoles = new Set(); // Track new roles
let autoRefreshInterval = null;
let autoRefreshEnabled = true;
let growthChartViewMode = 'cumulative'; // 'cumulative' or 'monthly'
let growthChartMonthlyData = {}; // Store monthly data for toggling

// FIX: Initialize backfillRoles array to prevent race condition when boardpack.js calls getAllRoles
window.backfillRoles = [];

// Configuration constants
const CONFIG = {
    BASELINE_HEADCOUNT: 177,
    GROWTH_TARGET: 53,
    GROWTH_PERCENTAGE: 0.30,
    PIPELINE_CONVERSION_RATE: 0.80,
    FUTURE_CONVERSION_RATE: 0.60,
    AUTO_REFRESH_SECONDS: 60,
    HIRING_CYCLE_DAYS: 60
};

// ============================================
// SECURITY: HTML Escaping Function
// Prevents XSS attacks by escaping user-controlled data
// ============================================
function escapeHtml(text) {
    if (text === null || text === undefined) return '';
    const div = document.createElement('div');
    div.textContent = String(text);
    return div.innerHTML;
}

// ============================================
// UNIFIED DATA MERGER - Phase 1 Fix
// Combines growth roles, backfills, and visualization roles
// ============================================
function getAllRoles(options = {}) {
    const {
        includeGrowth = true,
        includeBackfills = true,
        includeVisualization = false
    } = options;

    let roles = [];

    // Add growth roles from Hiring Master
    if (includeGrowth) {
        roles.push(...hiringData.map(r => ({
            ...r,
            __type: 'growth',
            __source: 'Hiring Master'
        })));
    }

    // Add backfill roles (generated from attrition)
    if (includeBackfills && window.backfillRoles) {
        roles.push(...window.backfillRoles.map(b => ({
            id: `BACKFILL-${b.backfillOpenMonth}`,
            roleTitle: b.roleTitle || 'Backfill Role (TBD)',
            notes: `Backfill for departure in ${b.departureMonth}. Opens ${b.backfillOpenMonth}.`,
            workableLink: '',
            roleStatus: b.status,
            dateOpen: b.backfillOpenDate,
            dateAccept: null,
            dateStart: b.backfillOpenDate,
            dateYearStart: b.backfillOpenDate,
            roleType: 'Backfill',
            team: 'TBD',
            tribe: 'TBD',
            function: b.function || 'TBD',
            isLeader: false,
            isGrad: false,
            geo: 'TBD',
            geoFixed: false,
            swiggerType: 'Permanent',
            leadTC: b.champion,
            sourcingNotes: '',
            strategicInitiative: '',
            __type: 'backfill',
            __isBackfill: true,
            __source: 'Attrition Backfill',
            __backfillData: b
        })));
    }

    // Add visualization future roles (if requested)
    if (includeVisualization && window.visualizationData?.rolesByMonth) {
        Object.entries(window.visualizationData.rolesByMonth).forEach(([, rolesList]) => {
            rolesList.forEach(role => {
                roles.push({
                    id: `VIZ-${role.month}-${role.title}`,
                    roleTitle: role.title,
                    function: role.function || 'TBD',
                    leadTC: role.champion || 'Unassigned',
                    roleStatus: 'Future',
                    dateStart: role.month ? new Date(role.month + '-01') : null,
                    team: '',
                    notes: `Planned opening in ${role.month}. Count: ${role.count || 1}`,
                    __type: 'visualization',
                    __source: 'Hiring Plan 2026 Visualisation'
                });
            });
        });
    }

    // LEGACY: Keep for backwards compatibility (old approach)
    if (includeVisualization && window.visualizationData?.monthlyRoleNames && !window.visualizationData?.rolesByMonth) {
        // Note: This is the old approach, kept for backwards compatibility
    }

    return roles;
}

// Automated Backfill Status Transitions
// Automatically updates backfill statuses based on current date
function updateBackfillStatuses() {
    if (!window.backfillRoles || window.backfillRoles.length === 0) {
        return;
    }

    const today = new Date();
    today.setHours(0, 0, 0, 0); // Normalize to start of day
    let transitionCount = 0;

    window.backfillRoles.forEach(backfill => {
        const openDate = new Date(backfill.backfillOpenDate);
        openDate.setHours(0, 0, 0, 0);

        // Transition logic based on current date vs backfill open date
        if (backfill.status === 'Backfill - Not Opened' && openDate <= today) {
            // Backfill should now be opened for recruitment
            backfill.status = 'Pipeline Open';
            backfill.dateOpen = backfill.backfillOpenDate;
            transitionCount++;
            console.log(`‚úì Auto-transitioned backfill for ${backfill.backfillOpenMonth} to Pipeline Open`);
        }
    });

    if (transitionCount > 0) {
        console.log(`‚úì Transitioned ${transitionCount} backfills from "Not Opened" to "Pipeline Open"`);

        // Show user notification if transitions occurred
        if (typeof showNotification === 'function') {
            showNotification(`${transitionCount} backfill role(s) automatically opened for recruitment`, 'info');
        }
    }

    // Show upcoming backfill transitions notification
    showUpcomingBackfillNotification();
}

// Show notification banner for upcoming backfill transitions
function showUpcomingBackfillNotification() {
    if (!window.backfillRoles || window.backfillRoles.length === 0) {
        return;
    }

    const today = new Date();
    today.setHours(0, 0, 0, 0);

    const thirtyDaysFromNow = new Date(today);
    thirtyDaysFromNow.setDate(thirtyDaysFromNow.getDate() + 30);

    // Find backfills opening in next 30 days
    const upcomingBackfills = window.backfillRoles.filter(b => {
        if (b.status !== 'Backfill - Not Opened') return false;
        const openDate = new Date(b.backfillOpenDate);
        openDate.setHours(0, 0, 0, 0);
        return openDate > today && openDate <= thirtyDaysFromNow;
    });

    if (upcomingBackfills.length > 0) {
        // Group by month
        const byMonth = upcomingBackfills.reduce((acc, b) => {
            const month = b.backfillOpenMonth;
            acc[month] = (acc[month] || 0) + 1;
            return acc;
        }, {});

        const monthsList = Object.keys(byMonth).sort();
        const notificationEl = document.getElementById('backfillNotifications');
        const titleEl = document.getElementById('backfillNotificationTitle');
        const textEl = document.getElementById('backfillNotificationText');

        if (notificationEl && titleEl && textEl) {
            titleEl.textContent = `${upcomingBackfills.length} Backfill Role(s) Opening Soon`;
            const monthSummary = monthsList.map(m => `${byMonth[m]} in ${m}`).join(', ');
            textEl.textContent = `These replacement roles will automatically transition to "Pipeline Open" when their open date arrives: ${monthSummary}`;
            notificationEl.style.display = 'block';
        }
    }
}

// Initialize dashboard
document.addEventListener('DOMContentLoaded', function() {
    loadData();
    setupFilters();
    loadFromLocalStorage(); // Load any saved changes
    startAutoRefresh();
});

// Load data from Google Sheets or local xlsx files
async function loadData() {
    try {
        // Check if Google Sheets loader is available
        if (typeof loadDataFromGoogleSheets === 'function') {
            await loadDataFromGoogleSheets();
            updateDashboard();
            updateLastRefreshTime();
            return;
        }

        // Fallback to local Excel files
        // Load PortSwigger Hiring Master data
        const hiringResponse = await fetch(encodeURI('data/PortSwigger Hiring Master - 2026 (1).xlsx'));
        if (!hiringResponse.ok) {
            throw new Error(`Failed to load hiring file: ${hiringResponse.status} ${hiringResponse.statusText}`);
        }
        const hiringBuffer = await hiringResponse.arrayBuffer();
        const hiringWorkbook = XLSX.read(hiringBuffer, { type: 'array' });

        // Parse Hiring sheet
        const hiringSheet = hiringWorkbook.Sheets['Hiring'];
        const rawHiringData = XLSX.utils.sheet_to_json(hiringSheet, { header: 1 });

        // Helper function to parse Excel dates
        const parseExcelDate = (excelDate) => {
            if (!excelDate) return null;
            if (excelDate instanceof Date) return excelDate;
            if (typeof excelDate === 'number') {
                // Excel date serial number (days since 1900-01-01)
                const date = new Date((excelDate - 25569) * 86400 * 1000);
                return date;
            }
            return new Date(excelDate);
        };

        // Process hiring data (skip header)
        hiringData = rawHiringData.slice(1).filter(row => row[0]).map(row => ({
            id: row[0],
            roleTitle: row[1],
            notes: row[2],
            workableLink: row[3],
            roleStatus: row[4],
            dateOpen: parseExcelDate(row[5]),
            dateAccept: parseExcelDate(row[6]),
            dateStart: parseExcelDate(row[7]),
            roleType: row[8],
            team: row[9],
            tribe: row[10],
            function: row[11],
            isLeader: row[12],
            isGrad: row[13],
            geo: row[14],
            geoFixed: row[15],
            swiggerType: row[16],
            leadTC: row[17],
            sourcingNotes: row[18],
            strategicInitiative: row[19],
            dateYearStart: parseExcelDate(row[20])
        }));

        // Load Attrition data
        const attritionResponse = await fetch(encodeURI('data/attrition expected.xlsx'));
        if (!attritionResponse.ok) {
            throw new Error(`Failed to load attrition file: ${attritionResponse.status} ${attritionResponse.statusText}`);
        }
        const attritionBuffer = await attritionResponse.arrayBuffer();
        const attritionWorkbook = XLSX.read(attritionBuffer, { type: 'array' });

        // Parse attrition sheet
        const attritionSheet = attritionWorkbook.Sheets['Sheet1'];
        const rawAttritionData = XLSX.utils.sheet_to_json(attritionSheet, { header: 1 });

        // Process attrition data (row 4 has dates, row 5 has values)
        // Note: sheet_to_json may skip empty rows, so we need to find the right rows
        attritionData = [];

        // Find the row with dates (should contain Date objects or numbers)
        let dateRowIndex = -1;
        let valueRowIndex = -1;

        for (let i = 0; i < rawAttritionData.length; i++) {
            const row = rawAttritionData[i];
            if (row && row.length > 1 && row[1]) {
                // Check if this row has date-like values (number = Excel serial, Date object, or date string)
                const cell = row[1];
                const isDate = (typeof cell === 'number' && cell > 40000) ||
                              (cell instanceof Date) ||
                              (typeof cell === 'string' && cell.includes('2026'));

                if (isDate) {
                    dateRowIndex = i;
                    valueRowIndex = i + 1;
                    break;
                }
            }
        }

        if (dateRowIndex >= 0 && valueRowIndex < rawAttritionData.length) {
            const dateRow = rawAttritionData[dateRowIndex];
            const valueRow = rawAttritionData[valueRowIndex];

            for (let i = 1; i < dateRow.length; i++) {
                if (dateRow[i] && valueRow[i] !== undefined && valueRow[i] !== null) {
                    const date = parseExcelDate(dateRow[i]);
                    if (date) {
                        attritionData.push({
                            date: date,
                            count: valueRow[i]
                        });
                    }
                }
            }
        }

        // Generate backfill roles: Each departure creates a backfill role opening the NEXT month
        // These are treated as Future roles in the pipeline with status "Backfill - Not Opened"
        const backfillRoles = [];
        attritionData.forEach(attrition => {
            const departureDate = new Date(attrition.date);
            // FIX: Use Math.abs to handle negative attrition counts
            const departureCount = Math.abs(attrition.count || 0);

            // Create backfill role entries (one per departure)
            for (let i = 0; i < departureCount; i++) {
                // FIX: Create new Date objects for each backfill to avoid mutation issues
                const backfillDepartureDate = new Date(departureDate);
                const backfillOpenDate = new Date(departureDate);

                // Backfill opens the month AFTER departure
                backfillOpenDate.setMonth(backfillOpenDate.getMonth() + 1);
                backfillOpenDate.setDate(1); // Normalize to 1st of month to avoid date overflow issues

                backfillRoles.push({
                    departureMonth: `${backfillDepartureDate.getFullYear()}-${String(backfillDepartureDate.getMonth() + 1).padStart(2, '0')}`,
                    backfillOpenMonth: `${backfillOpenDate.getFullYear()}-${String(backfillOpenDate.getMonth() + 1).padStart(2, '0')}`,
                    backfillOpenDate: new Date(backfillOpenDate), // New instance to prevent sharing
                    departureDate: new Date(backfillDepartureDate), // New instance to prevent sharing
                    roleTitle: 'Backfill Role (TBD)',
                    function: 'TBD',
                    champion: 'Misc Talent Champion',
                    status: 'Backfill - Not Opened'
                });
            }
        });

        // Store backfill roles globally
        window.backfillRoles = backfillRoles;
        console.log(`‚úì Generated ${backfillRoles.length} backfill roles from ${attritionData.length} attrition months`);

        // Automatically transition backfills based on current date
        updateBackfillStatuses();

        // Calculate monthly backfill counts for timeline visualization
        const monthlyBackfills = {};
        backfillRoles.forEach(backfill => {
            const monthKey = backfill.backfillOpenMonth;
            if (!monthlyBackfills[monthKey]) {
                monthlyBackfills[monthKey] = 0;
            }
            monthlyBackfills[monthKey]++;
        });
        window.monthlyBackfills = monthlyBackfills;

        // Load 2025 - Hiring Planning data for historical counts
        try {
            // Encode the filename to handle spaces properly
            const planning2025Response = await fetch(encodeURI('data/2025 - Hiring Planning.xlsx'));

            if (!planning2025Response.ok) {
                throw new Error(`HTTP ${planning2025Response.status}: ${planning2025Response.statusText}`);
            }

            const planning2025Buffer = await planning2025Response.arrayBuffer();
            const planning2025Workbook = XLSX.read(planning2025Buffer, { type: 'array' });

            // Load Progress YTD sheet for actual hires count
            const progressSheet = planning2025Workbook.Sheets['Progress YTD'];
            if (!progressSheet) {
                throw new Error('Progress YTD sheet not found');
            }

            const progressData = XLSX.utils.sheet_to_json(progressSheet, { header: 1 });

            // Search for "hires ytd" row dynamically (XLSX.js may skip empty rows)
            let hiresYTDRow = null;

            for (let i = 0; i < progressData.length; i++) {
                const row = progressData[i];
                if (row && row[3] && String(row[3]).toLowerCase() === 'hires ytd') {
                    hiresYTDRow = row;
                    break;
                }
            }

            if (hiresYTDRow) {
                historical2025Data.hiresYTD = {
                    product: hiresYTDRow[4] || 0,
                    gtm: hiresYTDRow[5] || 0,
                    support: hiresYTDRow[6] || 0,
                    total: hiresYTDRow[7] || 0
                };
            }

            // Row 12 has September cumulative offer accepts
            const septRow = progressData[11]; // Row 12, 0-indexed
            if (septRow && septRow[3] === 'Sep') {
                historical2025Data.cumulativeAccepts = septRow[5] || 0; // Column F
            }
        } catch (error) {
            console.error('‚úó Could not load 2025 - Hiring Planning.xlsx:', error);
            historical2025Data = { hiresYTD: { total: 0 }, cumulativeAccepts: 0 };
        }

        // Load Talent Champion capacity data
        try {
            const championResponse = await fetch(encodeURI('data/Talent Champion - Dashboards.xlsx'));
            if (!championResponse.ok) {
                throw new Error(`HTTP ${championResponse.status}: ${championResponse.statusText}`);
            }
            const championBuffer = await championResponse.arrayBuffer();
            const championWorkbook = XLSX.read(championBuffer, { type: 'array' });

            // Load each champion's capacity data (skip first sheet which is principles)
            const championNames = championWorkbook.SheetNames.filter(name =>
                name !== 'Talent Champion workload princi'
            );

            championNames.forEach(championName => {
                const sheet = championWorkbook.Sheets[championName];
                const data = XLSX.utils.sheet_to_json(sheet, { header: 1 });

                // Row 3 (index 2) has the data
                if (data.length >= 3) {
                    const row = data[2];

                    // Parse values, handling different formats
                    const parseValue = (val) => {
                        if (val === null || val === undefined) return 0;

                        // Skip Date objects (Excel date formatting issues) - return 0
                        if (val instanceof Date) {
                            return 0;
                        }

                        if (typeof val === 'number') return val;

                        if (typeof val === 'string') {
                            // Extract all numbers from strings like "5-10 hours" or "6-12" or "20 hours"
                            const matches = val.match(/(\d+)/g);
                            if (matches && matches.length > 0) {
                                // If multiple numbers found (like "5-10"), take the highest
                                const numbers = matches.map(n => parseFloat(n));
                                return Math.max(...numbers);
                            }
                            return 0;
                        }

                        return 0;
                    };

                    championCapacityData[championName] = {
                        activeRoles: parseValue(row[0]),
                        highComplexityRoles: parseValue(row[1]),
                        liveRoles: parseValue(row[2]),
                        upcomingRoles: parseValue(row[3]),
                        screeningCallsPerWeek: parseValue(row[4]), // 30-min blocks
                        projectWorkTime: parseValue(row[5]), // hours
                        otherWork: parseValue(row[6]) // hours
                    };
                }
            });
        } catch (error) {
            console.error('‚úó Could not load Talent Champion - Dashboards.xlsx:', error);
            championCapacityData = {};
        }

        // Load visualization data from "Hiring Resources - Central Document" for board pack
        try {
            console.log('üìä Loading visualization data from Hiring Resources...');
            const visualResponse = await fetch(encodeURI('data/Hiring Resources - Central Document (2).xlsx'));
            if (!visualResponse.ok) {
                throw new Error(`HTTP ${visualResponse.status}: ${visualResponse.statusText}`);
            }
            const visualBuffer = await visualResponse.arrayBuffer();
            const visualWorkbook = XLSX.read(visualBuffer, { type: 'array' });

            // Parse "Hiring Plan 2026 visualisation" sheet
            if (visualWorkbook.SheetNames.includes('Hiring Plan 2026 visualisation')) {
                const sheet = visualWorkbook.Sheets['Hiring Plan 2026 visualisation'];
                const data = XLSX.utils.sheet_to_json(sheet, { header: 1 });

                // Map month names to indices (0-11 for Jan-Dec)
                const monthMap = {
                    'January': 0, 'February': 1, 'March': 2, 'April': 3, 'May': 4, 'June': 5,
                    'July': 6, 'August': 7, 'September': 8, 'October': 9, 'November': 10, 'December': 11
                };

                // Initialize monthly counts and role names
                const monthlyFuture = Array(12).fill(0);
                const monthlyRoleNames = Array(12).fill(null).map(() => []); // Array of arrays

                // First row contains month headers
                const headers = data[0] || [];

                // Count roles per month AND store role names
                // IMPORTANT: Parse multipliers like "xN" or "x N" at end of role names
                // Example: "Product Engineer x12" = 12 roles, "TPS Atlanta x2" = 2 roles
                const multiplierPattern = /\s+x\s*(\d+)\s*$/i;

                // IMPORTANT: Champion names use a grouped/merged cell structure
                // Champion appears once in Column A (e.g., "Simon (15)" at row 13)
                // Subsequent roles belong to that champion until next champion appears
                // We need to track "currentChampion" and forward-fill it
                let currentChampion = 'Unassigned';

                headers.forEach((header, colIdx) => {
                    if (header && monthMap.hasOwnProperty(header)) {
                        const monthNum = monthMap[header];
                        let roleCount = 0;

                        // Reset champion tracking for each column
                        currentChampion = 'Unassigned';

                        // Count non-empty cells in this column (skip first row)
                        for (let rowIdx = 1; rowIdx < Math.min(data.length, 50); rowIdx++) {
                            const cell = data[rowIdx][colIdx];
                            const championCell = data[rowIdx][0]; // Column A contains champion name

                            // Check if this row has a new champion name in Column A
                            // Champion format can be either:
                            // 1. "Name (number)" like "Simon (15)" - standard format
                            // 2. "Name" like "Mia" - some champions don't have counts
                            if (championCell && typeof championCell === 'string' && championCell.trim()) {
                                const championWithCount = /^(.+?)\s*\(\d+\)\s*$/;
                                const championMatch = championCell.match(championWithCount);
                                if (championMatch) {
                                    // Found champion with count format: "Name (15)"
                                    currentChampion = championMatch[1].trim();
                                } else {
                                    // Check if it's a simple champion name (no count)
                                    // Only update if it looks like a name (not empty, not a role)
                                    const trimmedChampion = championCell.trim();
                                    // Simple heuristic: if it's a short string without special role indicators
                                    // and doesn't contain common role keywords, treat it as a champion name
                                    if (trimmedChampion.length > 0 &&
                                        trimmedChampion.length < 50 &&
                                        !trimmedChampion.includes('x') &&
                                        !trimmedChampion.toLowerCase().includes('row')) {
                                        currentChampion = trimmedChampion;
                                    }
                                }
                            }

                            // Count if cell has a value, excluding champion names (format: "Name (number)")
                            // Champion names have parentheses at the END like "Tom (16)"
                            // Role names can have parentheses anywhere else like "CSM (Scale): KNU"
                            if (cell && typeof cell === 'string' && cell.trim() && !cell.startsWith('Row')) {
                                const trimmed = cell.trim();
                                // Exclude if it matches champion name pattern: ends with "(number)"
                                const roleChampionPattern = /\(\d+\)$/;
                                if (!roleChampionPattern.test(trimmed)) {
                                    // Check for multiplier notation like "Role Name x12" or "Role x2"
                                    const multiplierMatch = trimmed.match(multiplierPattern);

                                    // Use the current champion (forward-filled from above rows)
                                    const champion = currentChampion;

                                    if (multiplierMatch) {
                                        // Extract multiplier count
                                        const count = parseInt(multiplierMatch[1], 10);
                                        const roleName = trimmed.replace(multiplierPattern, '').trim();
                                        roleCount += count;
                                        // Store role with multiplier info
                                        monthlyRoleNames[monthNum].push({
                                            name: roleName,
                                            count: count,
                                            champion: champion,
                                            displayName: `${roleName} (√ó${count})`
                                        });
                                    } else {
                                        // No multiplier, count as 1 role
                                        roleCount++;
                                        monthlyRoleNames[monthNum].push({
                                            name: trimmed,
                                            count: 1,
                                            champion: champion,
                                            displayName: trimmed
                                        });
                                    }
                                }
                            }
                        }

                        monthlyFuture[monthNum] = roleCount;
                    }
                });

                // Convert monthlyRoleNames array to rolesByMonth object with month keys
                // This format is required by the chart code (lines 1536-1542)
                const rolesByMonth = {};
                monthlyRoleNames.forEach((roles, monthIndex) => {
                    const monthKey = `2026-${String(monthIndex + 1).padStart(2, '0')}`;
                    rolesByMonth[monthKey] = roles.map(role => ({
                        title: role.name,
                        count: role.count,
                        champion: role.champion,
                        function: 'TBD', // Will be determined by role matching later
                        month: monthKey
                    }));
                });

                // Store in global window object for board pack and modals to use
                window.visualizationData = {
                    monthlyFuture: monthlyFuture,
                    monthlyRoleNames: monthlyRoleNames, // Array format for legacy compatibility
                    rolesByMonth: rolesByMonth // NEW: Object format for chart code
                };

                console.log('‚úì Visualization data loaded:', monthlyFuture);
            } else {
                console.warn('‚ö† "Hiring Plan 2026 visualisation" sheet not found');
                window.visualizationData = {
                    monthlyFuture: Array(12).fill(0),
                    monthlyRoleNames: Array(12).fill(null).map(() => []),
                    rolesByMonth: {} // Empty object for missing data
                };
            }
        } catch (error) {
            console.error('‚úó Could not load visualization data:', error);
            window.visualizationData = {
                monthlyFuture: Array(12).fill(0),
                monthlyRoleNames: Array(12).fill(null).map(() => []),
                rolesByMonth: {} // Empty object for error case
            };
        }

        updateDashboard();
        updateLastRefreshTime();
    } catch (error) {
        console.error('Error loading data:', error);
        alert('Error loading Excel files. Please ensure:\n1. You are accessing via http://localhost:8000\n2. Both Excel files are in the same directory\n3. Files: "PortSwigger Hiring Master - 2026 (1).xlsx" and "Hiring Resources - Central Document (2).xlsx"');
        throw error; // Don't fall back to mock data
    }
}

// Auto-refresh functionality
function startAutoRefresh() {
    if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
    }

    if (autoRefreshEnabled) {
        autoRefreshInterval = setInterval(() => {
            loadData();
        }, CONFIG.AUTO_REFRESH_SECONDS * 1000);
    }
}

function toggleAutoRefresh() {
    autoRefreshEnabled = !autoRefreshEnabled;

    if (autoRefreshEnabled) {
        startAutoRefresh();
        document.getElementById('autoRefreshToggle').textContent = '‚è∏Ô∏è Pause Auto-Refresh';
        document.getElementById('autoRefreshToggle').style.background = 'linear-gradient(135deg, #ffc107 0%, #ff9800 100%)';
    } else {
        if (autoRefreshInterval) {
            clearInterval(autoRefreshInterval);
            autoRefreshInterval = null;
        }
        document.getElementById('autoRefreshToggle').textContent = '‚ñ∂Ô∏è Resume Auto-Refresh';
        document.getElementById('autoRefreshToggle').style.background = 'linear-gradient(135deg, #4caf50 0%, #45a049 100%)';
    }
}

function updateLastRefreshTime() {
    const now = new Date();
    const timeString = now.toLocaleTimeString('en-US', {
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
    });
    const element = document.getElementById('lastRefreshTime');
    if (element) {
        element.textContent = `Last updated: ${timeString}`;
    }
}

// Calculate role health score
function calculateRoleHealth(role) {
    let score = 100;
    let factors = [];

    const now = new Date();
    const dateOpen = role.dateOpen ? new Date(role.dateOpen) : now;
    const daysOpen = Math.floor((now - dateOpen) / (1000 * 60 * 60 * 24));

    // Status-based scoring
    if (role.roleStatus === 'Offer Accepted' || role.roleStatus === 'Started') {
        return { score: 100, status: 'healthy', label: 'Healthy', factors: ['Offer accepted/started'] };
    }

    if (role.roleStatus === 'Future') {
        return { score: 90, status: 'healthy', label: 'Healthy', factors: ['Not yet opened'] };
    }

    if (role.roleStatus === 'On Hold') {
        return { score: 70, status: 'at-risk', label: 'At Risk', factors: ['Role on hold'] };
    }

    if (role.roleStatus === 'Cancelled') {
        return { score: 0, status: 'critical', label: 'Critical', factors: ['Role cancelled'] };
    }

    // Smart time-based scoring for Pipeline Open roles
    if (role.roleStatus === 'Pipeline Open') {
        if (!role.dateStart) {
            // No start date: use simple days-open approach
            if (daysOpen > 120) {
                score -= 50;
                factors.push(`Open ${daysOpen} days, no start date`);
            } else if (daysOpen > 90) {
                score -= 30;
                factors.push(`Open ${daysOpen} days, no start date`);
            } else if (daysOpen > 60) {
                score -= 15;
                factors.push(`Open ${daysOpen} days`);
            }
        } else {
            // Has start date: calculate time remaining and assess urgency
            const startDate = new Date(role.dateStart);
            const daysUntilStart = Math.floor((startDate - now) / (1000 * 60 * 60 * 24));

            // Assume typical hiring process needs ~60 days (offer, acceptance, notice period)
            const daysNeeded = 60;
            const buffer = daysUntilStart - daysNeeded;

            // Calculate percentage of time consumed
            const timeConsumed = daysOpen / (daysOpen + daysUntilStart);

            if (daysUntilStart < 0) {
                // Start date has passed!
                score -= 80;
                factors.push(`Start date passed ${Math.abs(daysUntilStart)} days ago!`);
            } else if (daysUntilStart < 30) {
                // Less than 30 days to start - CRITICAL
                score -= 60;
                factors.push(`Only ${daysUntilStart} days until start, still open`);
            } else if (buffer < 0) {
                // Less than 60 days to start - HIGH RISK
                score -= 40;
                factors.push(`Only ${daysUntilStart} days to start (need ~60 days to hire)`);
            } else if (buffer < 30) {
                // 60-90 days to start - MODERATE RISK
                score -= 25;
                factors.push(`${daysUntilStart} days to start, buffer tight`);
            } else if (timeConsumed > 0.7) {
                // Consumed >70% of available time - MONITOR
                score -= 15;
                factors.push(`Open ${daysOpen} days, ${Math.round(timeConsumed * 100)}% of timeline used`);
            } else {
                // Plenty of time
                factors.push(`Open ${daysOpen} days, ${daysUntilStart} days until start`);
            }
        }
    }

    // Determine status
    let status, label;
    if (score >= 75) {
        status = 'healthy';
        label = 'Healthy';
    } else if (score >= 50) {
        status = 'at-risk';
        label = 'At Risk';
    } else {
        status = 'critical';
        label = 'Critical';
    }

    return { score, status, label, factors, daysOpen };
}

// Calculate predictive target tracking
function calculatePredictiveTargeting(data) {
    // From Team Planning Dashboard in Excel:
    // - Starting headcount (beginning of 2026): 177 employees
    // - 30% growth target: 53 hires
    // - Actual planned roles: 80 hires (45.2% growth)
    const baselineHeadcount = CONFIG.BASELINE_HEADCOUNT;
    const targetGrowth = CONFIG.GROWTH_TARGET;

    // Calculate total expected attrition for 2026
    const totalAttrition = attritionData.reduce((sum, item) => sum + Math.abs(item.count), 0);

    // Adjust target to account for attrition
    // Net growth target remains 53, but total hiring need increases by attrition
    const totalHiringNeed = targetGrowth + totalAttrition;

    const now = new Date();
    const yearStart = new Date('2026-01-01'); // Focus on 2026 only
    const yearEnd = new Date('2026-12-31');

    const totalDays = Math.floor((yearEnd - yearStart) / (1000 * 60 * 60 * 24));
    const daysElapsed = Math.floor((now - yearStart) / (1000 * 60 * 60 * 24));
    const daysRemaining = totalDays - daysElapsed;

    // Count 2026 hires only (starting in 2026)
    const roles2026 = data.filter(r => {
        if (r.roleStatus === 'Cancelled') return false;
        if (!r.dateStart) return true; // Include future roles without dates
        const startYear = new Date(r.dateStart).getFullYear();
        return startYear === 2026; // Only count roles starting in 2026
    });

    const accepted = roles2026.filter(r => r.roleStatus === 'Offer Accepted' || r.roleStatus === 'Started').length;

    // Count unique role titles for Pipeline Open (to match orange card on dashboard)
    const pipelineOpenRoles = roles2026.filter(r => r.roleStatus === 'Pipeline Open');
    const pipeline = new Set(pipelineOpenRoles.map(r => r.roleTitle || 'Untitled Role')).size;

    // Count Future roles from visualization data (NOT from Hiring Master)
    // CRITICAL: Future roles are tracked in visualization timeline sheet with multipliers
    const future = window.visualizationData && window.visualizationData.monthlyFuture
        ? window.visualizationData.monthlyFuture.reduce((sum, count) => sum + count, 0)
        : 0;

    // Count backfill roles (generated from attrition, opening month after departure)
    const backfillRoles = window.backfillRoles || [];
    const backfillsTotal = backfillRoles.length;

    // Calculate velocity based on actual start dates, not just total accepted / days elapsed
    // This prevents crazy projections at the start of the year
    const startedRoles = roles2026.filter(r => {
        if (r.roleStatus !== 'Offer Accepted' && r.roleStatus !== 'Started') return false;
        if (!r.dateStart) return false;
        const startDate = new Date(r.dateStart);
        return startDate <= now; // Only count people who have already started
    });

    const actuallyStarted = startedRoles.length;
    // Use a minimum of 30 days to avoid crazy velocities at year start
    const effectiveDaysElapsed = Math.max(daysElapsed, 30);
    const velocity = actuallyStarted / effectiveDaysElapsed;

    // Project forward
    // Include: Accepted + Pipeline conversions + Future conversions + Backfill conversions
    // Backfills use Future conversion rate since they're not yet opened
    const projectedGrowthRoles = accepted + (pipeline * CONFIG.PIPELINE_CONVERSION_RATE) + (future * CONFIG.FUTURE_CONVERSION_RATE);
    const projectedBackfillRoles = backfillsTotal * CONFIG.FUTURE_CONVERSION_RATE;
    const projectedTotal = projectedGrowthRoles + projectedBackfillRoles;

    // Calculate NET GROWTH probability (projected hires minus attrition)
    // The 30% growth target is about net headcount growth, so we must subtract attrition
    const projectedNetGrowth = projectedTotal - totalAttrition;
    const progressRatio = projectedNetGrowth / targetGrowth;
    let probability;

    if (progressRatio >= 1.1) probability = 95;
    else if (progressRatio >= 1.0) probability = 85;
    else if (progressRatio >= 0.9) probability = 70;
    else if (progressRatio >= 0.8) probability = 55;
    else if (progressRatio >= 0.7) probability = 40;
    else probability = 25;

    // Calculate gross hiring demand coverage
    const totalGrossHiringNeed = targetGrowth + totalAttrition; // 53 growth + 44 backfills = 97
    const grossHiringCoverage = (projectedTotal / totalGrossHiringNeed) * 100;

    return {
        targetGrowth,
        totalAttrition,
        totalHiringNeed,
        currentAccepted: accepted,
        currentPipeline: pipeline,
        currentFuture: future,
        currentBackfills: backfillsTotal,
        projectedGrowthRoles: Math.round(projectedGrowthRoles),
        projectedBackfillRoles: Math.round(projectedBackfillRoles),
        projectedTotal: Math.round(projectedTotal),
        projectedNetGrowth: Math.round(projectedNetGrowth),
        probability,
        velocity: velocity.toFixed(3),
        daysRemaining,
        progressRatio,
        needsToHire: Math.max(0, targetGrowth - accepted), // Based on growth target, not total need
        totalGrossHiringNeed,
        grossHiringCoverage: Math.round(grossHiringCoverage)
    };
}

// Mock data function removed - dashboard now only uses Excel files:
// 1. "PortSwigger Hiring Master - 2026 (1).xlsx"
// 2. "Hiring Resources - Central Document (2).xlsx"

// Setup filter event listeners
function setupFilters() {
    document.getElementById('championFilter').addEventListener('change', function(e) {
        currentFilters.champion = e.target.value;
        updateDashboard();
    });

    document.getElementById('functionFilter').addEventListener('change', function(e) {
        currentFilters.function = e.target.value;
        updateDashboard();
    });

    document.getElementById('statusFilter').addEventListener('change', function(e) {
        currentFilters.status = e.target.value;
        updateDashboard();
    });

    document.getElementById('dateFilter').addEventListener('change', function(e) {
        currentFilters.date = e.target.value;
        updateDashboard();
    });
}

// Filter data based on current filters
function getFilteredData() {
    // Use getAllRoles() to include growth roles, backfills, AND visualization future roles
    return getAllRoles({ includeVisualization: true }).filter(row => {
        if (currentFilters.champion !== 'all' && row.leadTC !== currentFilters.champion) return false;
        if (currentFilters.function !== 'all' && row.function !== currentFilters.function) return false;
        if (currentFilters.status !== 'all' && row.roleStatus !== currentFilters.status) return false;

        // Date filter: filter by start date month (YYYY-MM format)
        // For backfills, use backfillOpenDate instead of dateStart
        if (currentFilters.date) {
            const dateToCheck = row.__isBackfill ? row.dateOpen : row.dateStart;
            if (!dateToCheck) return false; // Exclude roles without date
            const startDate = new Date(dateToCheck);
            const filterYearMonth = currentFilters.date; // e.g., "2026-03"
            const rowYearMonth = `${startDate.getFullYear()}-${String(startDate.getMonth() + 1).padStart(2, '0')}`;
            if (rowYearMonth !== filterYearMonth) return false;
        }

        return true;
    });
}

// Update entire dashboard
function updateDashboard() {
    const filteredData = getFilteredData();

    // Populate function filter dropdown on first load
    populateFunctionFilter(filteredData);

    updateMetrics(filteredData);
    updateCharts(filteredData);
    updateTable(filteredData);
}

// Update metrics cards
function updateMetrics(data) {
    // Helper function to check if a role is a grad
    const isGradRole = (role) => {
        if (!role.isGrad) return false;
        const gradValue = String(role.isGrad).toLowerCase().trim();
        return gradValue === 'yes' || gradValue === 'y' || gradValue === 'true' || gradValue === '1' || gradValue.includes('grad');
    };

    // Exclude cancelled roles from total count
    const totalHires = data.filter(r => r.roleStatus !== 'Cancelled').length;
    const totalHiresNonGrad = data.filter(r => r.roleStatus !== 'Cancelled' && !isGradRole(r)).length;

    // Count offers accepted + started (hired) in 2025-2026 plan
    // Use historical data from 2025 - Hiring Planning.xlsx if available
    let offersAccepted;
    let offersAcceptedNonGrad;

    if (historical2025Data && historical2025Data.hiresYTD && historical2025Data.hiresYTD.total > 0) {
        // Use historical 2025 hires + current master file data for 2026
        // Count roles starting in 2026 (to avoid double-counting 2025 hires)
        const currentMasterAccepted = data.filter(r => {
            if (r.roleStatus !== 'Offer Accepted' && r.roleStatus !== 'Started') return false;

            // Only count roles STARTING in 2026 (regardless of when accepted)
            // This avoids double-counting 2025 hires that are in the historical data
            if (r.dateStart) {
                const startYear = new Date(r.dateStart).getFullYear();
                return startYear === 2026;
            }

            // If no start date, fallback to accept date = 2026
            if (r.dateAccept) {
                const acceptYear = new Date(r.dateAccept).getFullYear();
                return acceptYear === 2026;
            }

            return false; // Exclude if no date or unclear year
        }).length;

        const currentMasterAcceptedNonGrad = data.filter(r => {
            if (r.roleStatus !== 'Offer Accepted' && r.roleStatus !== 'Started') return false;
            if (isGradRole(r)) return false;

            if (r.dateStart) {
                const startYear = new Date(r.dateStart).getFullYear();
                return startYear === 2026;
            }

            if (r.dateAccept) {
                const acceptYear = new Date(r.dateAccept).getFullYear();
                return acceptYear === 2026;
            }

            return false;
        }).length;

        // Historical 2025 hires + current 2026 starters
        offersAccepted = Math.round(historical2025Data.hiresYTD.total) + currentMasterAccepted;
        // Note: We don't have grad breakdown for historical data, so using 2026 only for non-grad
        offersAcceptedNonGrad = Math.round(historical2025Data.hiresYTD.total) + currentMasterAcceptedNonGrad;
    } else {
        // Fallback: count from master file only
        offersAccepted = data.filter(r => {
            // Include both "Offer Accepted" and "Started" statuses
            if (r.roleStatus !== 'Offer Accepted' && r.roleStatus !== 'Started') return false;

            // If there's a dateAccept, check if it's in 2025-2026
            if (r.dateAccept) {
                const acceptDate = new Date(r.dateAccept);
                const acceptYear = acceptDate.getFullYear();
                return acceptYear === 2025 || acceptYear === 2026;
            }

            // If no dateAccept but has dateStart, check if starting in 2025 or 2026
            if (r.dateStart) {
                const startDate = new Date(r.dateStart);
                const startYear = startDate.getFullYear();
                return startYear >= 2025 && startYear <= 2026;
            }

            // If neither date exists, include it (likely a 2025-2026 role)
            return true;
        }).length;

        offersAcceptedNonGrad = data.filter(r => {
            if (r.roleStatus !== 'Offer Accepted' && r.roleStatus !== 'Started') return false;
            if (isGradRole(r)) return false;

            if (r.dateAccept) {
                const acceptDate = new Date(r.dateAccept);
                const acceptYear = acceptDate.getFullYear();
                return acceptYear === 2025 || acceptYear === 2026;
            }

            if (r.dateStart) {
                const startDate = new Date(r.dateStart);
                const startYear = startDate.getFullYear();
                return startYear >= 2025 && startYear <= 2026;
            }

            return true;
        }).length;
    }

    // Count unique role titles for Pipeline Open (not total openings)
    const pipelineOpenRoles = data.filter(r => r.roleStatus === 'Pipeline Open');
    const pipelineOpen = new Set(pipelineOpenRoles.map(r => r.roleTitle || 'Untitled Role')).size;
    const pipelineOpenTotal = pipelineOpenRoles.length; // Total live roles across all pipelines

    const pipelineOpenNonGradRoles = data.filter(r => r.roleStatus === 'Pipeline Open' && !isGradRole(r));
    const pipelineOpenNonGrad = new Set(pipelineOpenNonGradRoles.map(r => r.roleTitle || 'Untitled Role')).size;

    // Count Future roles from visualization data (not Hiring Master)
    // IMPORTANT: Future roles include BOTH growth roles AND backfill roles
    // 1. Growth roles: From visualization timeline sheet with multipliers
    // 2. Backfill roles: Generated from attrition, opening month-after-departure
    const futureGrowthRoles = window.visualizationData && window.visualizationData.monthlyFuture
        ? window.visualizationData.monthlyFuture.reduce((sum, count) => sum + count, 0)
        : 0;

    const futureBackfillRoles = (window.backfillRoles || [])
        .filter(b => b.status === 'Backfill - Not Opened').length;

    const futureRoles = futureGrowthRoles + futureBackfillRoles;

    // Note: Cannot calculate non-grad Future roles as visualization sheet doesn't have isGrad flag
    // Show total Future roles for both cards
    const futureRolesNonGrad = 0; // Visualization sheet doesn't distinguish grad vs non-grad

    const onHold = data.filter(r => r.roleStatus === 'On Hold').length;
    const cancelled = data.filter(r => r.roleStatus === 'Cancelled').length;

    // From Team Planning Dashboard: 177 employees at start of 2026, 30% = 53 hires
    const growthTarget = CONFIG.GROWTH_TARGET;

    // Calculate 2026 accepted offers + started (for growth progress and new metric)
    const accepted2026Only = hiringData.filter(r => {
        if (r.roleStatus !== 'Offer Accepted' && r.roleStatus !== 'Started') return false;
        if (!r.dateStart) return false;
        const startYear = new Date(r.dateStart).getFullYear();
        return startYear === 2026; // Only 2026 starts
    }).length;

    // Calculate breakdown: already started vs pending
    const accepted2026Started = hiringData.filter(r => {
        if (r.roleStatus !== 'Started') return false;
        if (!r.dateStart) return false;
        const startYear = new Date(r.dateStart).getFullYear();
        return startYear === 2026;
    }).length;

    const accepted2026Pending = accepted2026Only - accepted2026Started;

    const accepted2026OnlyNonGrad = hiringData.filter(r => {
        if (r.roleStatus !== 'Offer Accepted' && r.roleStatus !== 'Started') return false;
        if (isGradRole(r)) return false;
        if (!r.dateStart) return false;
        const startYear = new Date(r.dateStart).getFullYear();
        return startYear === 2026;
    }).length;

    const growthProgress = Math.min((accepted2026Only / growthTarget) * 100, 100);

    // Calculate predictive targeting
    const prediction = calculatePredictiveTargeting(hiringData);

    // Calculate total expected attrition for 2026 with error handling
    const totalAttrition = (attritionData && attritionData.length > 0)
        ? attritionData.reduce((sum, item) => sum + Math.abs(item.count || 0), 0)
        : 0;

    if (totalAttrition === 0 && (!attritionData || attritionData.length === 0)) {
        console.warn('‚ö†Ô∏è No attrition data loaded - Net Growth calculations may be incorrect');
    }

    // Calculate growth vs backfill breakdown for Total Hires
    const totalGrowthRoles = data.filter(r => r.roleStatus !== 'Cancelled' && !r.__isBackfill).length;
    const totalBackfillRoles = data.filter(r => r.roleStatus !== 'Cancelled' && r.__isBackfill).length;

    // Update DOM
    document.getElementById('totalHires').textContent = totalHires;
    document.getElementById('totalHiresBreakdown').textContent = `${totalGrowthRoles} growth ‚Ä¢ ${totalBackfillRoles} backfills`;
    document.getElementById('totalHiresNonGrad').textContent = `Non-grad: ${totalHiresNonGrad}`;

    document.getElementById('offersAccepted').textContent = offersAccepted;
    document.getElementById('offersAcceptedNonGrad').textContent = `Non-grad: ${offersAcceptedNonGrad}`;

    document.getElementById('accepted2026Only').textContent = accepted2026Only;
    document.getElementById('accepted2026OnlyBreakdown').textContent = `${accepted2026Started} started ‚Ä¢ ${accepted2026Pending} pending`;
    document.getElementById('accepted2026OnlyNonGrad').textContent = `Non-grad: ${accepted2026OnlyNonGrad}`;
    document.getElementById('accepted2026OnlyProgress').style.width = `${(accepted2026Only / growthTarget) * 100}%`;

    document.getElementById('pipelineOpen').textContent = pipelineOpen;
    document.getElementById('pipelineOpenTotal').textContent = `${pipelineOpenTotal} total live roles`;
    document.getElementById('pipelineOpenNonGrad').textContent = `Non-grad: ${pipelineOpenNonGrad}`;

    document.getElementById('futureRoles').textContent = futureRoles;
    document.getElementById('futureRolesBreakdown').textContent = `${futureGrowthRoles} growth ‚Ä¢ ${futureBackfillRoles} backfills`;
    document.getElementById('futureRolesNonGrad').textContent = `Non-grad: ${futureRolesNonGrad}`;

    document.getElementById('growthTarget').textContent = growthTarget;

    // Update attrition metric
    const attritionEl = document.getElementById('expectedAttrition');
    if (attritionEl) {
        attritionEl.textContent = totalAttrition;
    }

    // Calculate and update NET GROWTH metric
    const projectedHires = prediction.projectedTotal || 0;
    const netGrowth = projectedHires - totalAttrition;
    const netGrowthGap = growthTarget - netGrowth;

    const netGrowthEl = document.getElementById('netGrowth');
    const netGrowthProgressEl = document.getElementById('netGrowthProgress');
    const netGrowthTrendEl = document.getElementById('netGrowthTrend');

    if (netGrowthEl) {
        netGrowthEl.textContent = netGrowth;
        netGrowthEl.style.color = netGrowth >= growthTarget ? '#28a745' : '#ff6b6b';
    }
    if (netGrowthProgressEl) {
        const progressPercent = Math.min(100, (netGrowth / growthTarget) * 100);
        netGrowthProgressEl.style.width = progressPercent + '%';
        netGrowthProgressEl.style.background = netGrowth >= growthTarget
            ? 'linear-gradient(90deg, #28a745 0%, #20c997 100%)'
            : 'linear-gradient(90deg, #ff6b6b 0%, #ee5a6f 100%)';
    }
    if (netGrowthTrendEl) {
        if (netGrowth >= growthTarget) {
            netGrowthTrendEl.textContent = `+${netGrowth - growthTarget} above target`;
            netGrowthTrendEl.style.color = '#28a745';
        } else {
            netGrowthTrendEl.textContent = `-${netGrowthGap} short of target`;
            netGrowthTrendEl.style.color = '#ff6b6b';
        }
    }

    // Calculate and update TOTAL HIRING NEED metric
    const totalNeed = growthTarget + totalAttrition;
    const totalNeedGap = totalNeed - projectedHires;

    const totalNeedEl = document.getElementById('totalNeed');
    const totalNeedProgressEl = document.getElementById('totalNeedProgress');
    const totalNeedTrendEl = document.getElementById('totalNeedTrend');

    if (totalNeedEl) {
        totalNeedEl.textContent = totalNeed;
    }
    if (totalNeedProgressEl) {
        const progressPercent = Math.min(100, (projectedHires / totalNeed) * 100);
        totalNeedProgressEl.style.width = progressPercent + '%';
        totalNeedProgressEl.style.background = projectedHires >= totalNeed
            ? 'linear-gradient(90deg, #28a745 0%, #20c997 100%)'
            : 'linear-gradient(90deg, #ffa500 0%, #ff8c42 100%)';
    }
    if (totalNeedTrendEl) {
        if (projectedHires >= totalNeed) {
            totalNeedTrendEl.textContent = `Currently: ${projectedHires} projected (+${projectedHires - totalNeed} buffer)`;
        } else {
            totalNeedTrendEl.textContent = `Currently: ${projectedHires} projected (${totalNeedGap} short)`;
        }
    }

    // Update STATUS BANNER
    const statusBannerEl = document.getElementById('statusBanner');
    const statusTitleEl = document.getElementById('statusTitle');
    const statusMessageEl = document.getElementById('statusMessage');
    const statusGapEl = document.getElementById('statusGap');

    if (statusBannerEl) {
        if (netGrowthGap > 0) {
            // We're short - show warning banner
            statusBannerEl.style.display = 'block';
            statusBannerEl.style.background = 'linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%)';
            if (statusTitleEl) statusTitleEl.textContent = `${netGrowthGap} HIRES SHORT OF NET GROWTH TARGET`;
            if (statusMessageEl) statusMessageEl.textContent = `Projected ${projectedHires} hires - ${totalAttrition} attrition = ${netGrowth} net growth (need ${growthTarget})`;
            if (statusGapEl) statusGapEl.textContent = `-${netGrowthGap}`;
        } else if (netGrowthGap < 0) {
            // We're ahead - show success banner
            statusBannerEl.style.display = 'block';
            statusBannerEl.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
            if (statusTitleEl) statusTitleEl.textContent = `${Math.abs(netGrowthGap)} HIRES AHEAD OF TARGET`;
            if (statusMessageEl) statusMessageEl.textContent = `Projected ${projectedHires} hires - ${totalAttrition} attrition = ${netGrowth} net growth (target ${growthTarget})`;
            if (statusGapEl) statusGapEl.textContent = `+${Math.abs(netGrowthGap)}`;
        } else {
            // Exactly on target
            statusBannerEl.style.display = 'block';
            statusBannerEl.style.background = 'linear-gradient(135deg, #ffc107 0%, #ff9800 100%)';
            if (statusTitleEl) statusTitleEl.textContent = `ON TARGET FOR NET GROWTH`;
            if (statusMessageEl) statusMessageEl.textContent = `Projected ${projectedHires} hires - ${totalAttrition} attrition = ${netGrowth} net growth (target ${growthTarget})`;
            if (statusGapEl) statusGapEl.textContent = `¬±0`;
        }
    }

    // Update predictive metric
    const predictionEl = document.getElementById('targetProbability');
    if (predictionEl) {
        predictionEl.textContent = prediction.probability + '%';
    }
    const projectedEl = document.getElementById('projectedHires');
    if (projectedEl) {
        projectedEl.textContent = prediction.projectedTotal;
    }

    // Update progress bars
    document.getElementById('hiresProgress').style.width = ((totalHires / growthTarget) * 100) + '%';
    document.getElementById('offersProgress').style.width = ((offersAccepted / totalHires) * 100) + '%';
    document.getElementById('growthProgress').style.width = growthProgress + '%';

    // Update prediction progress bar
    const predictionProgressEl = document.getElementById('predictionProgress');
    if (predictionProgressEl) {
        predictionProgressEl.style.width = prediction.probability + '%';
    }

    // Update prediction trend
    const predictionTrendEl = document.getElementById('predictionTrend');
    if (predictionTrendEl) {
        if (prediction.probability >= 85) {
            predictionTrendEl.className = 'metric-trend trend-up';
        } else if (prediction.probability >= 70) {
            predictionTrendEl.className = 'metric-trend trend-neutral';
        } else {
            predictionTrendEl.className = 'metric-trend trend-down';
        }
    }

    // Update growth status
    const growthStatusEl = document.getElementById('growthStatus');
    if (growthProgress >= 100) {
        growthStatusEl.textContent = '‚úì Target Met';
        growthStatusEl.className = 'metric-trend trend-up';
    } else if (growthProgress >= 70) {
        growthStatusEl.textContent = 'On Track';
        growthStatusEl.className = 'metric-trend trend-neutral';
    } else {
        growthStatusEl.textContent = 'Below Target';
        growthStatusEl.className = 'metric-trend trend-down';
    }
}

// Update all charts
function updateCharts(data) {
    updateTimelineChart(data);
    updateGrowthChart(data);
    updateStrategicBets(data);
}

// Update timeline chart
function updateTimelineChart(data) {
    const ctx = document.getElementById('timelineChart').getContext('2d');

    // Group by month and status (2026 only)
    const monthlyData = {};
    data.forEach(row => {
        if (row.dateStart) {
            const date = new Date(row.dateStart);
            const year = date.getFullYear();

            // Filter to only include 2026 data
            if (year !== 2026) {
                return;
            }

            const monthKey = `${year}-${String(date.getMonth() + 1).padStart(2, '0')}`;

            if (!monthlyData[monthKey]) {
                monthlyData[monthKey] = {
                    accepted: 0,
                    pipeline: 0,
                    future: 0,
                    backfills: 0
                };
            }

            const status = row.roleStatus || row.status || '';

            // Track backfills separately
            if (row.__isBackfill) {
                monthlyData[monthKey].backfills++;
            } else if (status === 'Offer Accepted' || status === 'Started') {
                monthlyData[monthKey].accepted++;
            } else if (status === 'Pipeline Open') {
                monthlyData[monthKey].pipeline++;
            }
            // Note: Removed Future counting from Hiring Master data as it should come from visualization
        }
    });

    // Add Future roles from visualization data (monthlyFuture array is 0-indexed for Jan-Dec)
    if (window.visualizationData && window.visualizationData.monthlyFuture) {
        for (let monthIdx = 0; monthIdx < 12; monthIdx++) {
            const monthKey = `2026-${String(monthIdx + 1).padStart(2, '0')}`;
            if (!monthlyData[monthKey]) {
                monthlyData[monthKey] = { accepted: 0, pipeline: 0, future: 0, backfills: 0 };
            }
            monthlyData[monthKey].future = window.visualizationData.monthlyFuture[monthIdx] || 0;
        }
    }

    // Add backfill counts by month (backfills open the month AFTER departure)
    if (window.backfillRoles) {
        window.backfillRoles.forEach(backfill => {
            const openDate = new Date(backfill.backfillOpenDate);
            if (openDate.getFullYear() === 2026) {
                const monthKey = `2026-${String(openDate.getMonth() + 1).padStart(2, '0')}`;
                if (!monthlyData[monthKey]) {
                    monthlyData[monthKey] = { accepted: 0, pipeline: 0, future: 0, backfills: 0 };
                }
                monthlyData[monthKey].backfills++;
            }
        });
    }

    const months = Object.keys(monthlyData).sort();
    const acceptedCounts = months.map(m => monthlyData[m].accepted);
    const pipelineCounts = months.map(m => monthlyData[m].pipeline);
    const futureCounts = months.map(m => monthlyData[m].future);
    const backfillCounts = months.map(m => monthlyData[m].backfills);

    if (charts.timeline) {
        charts.timeline.destroy();
    }

    charts.timeline = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: months,
            datasets: [
                {
                    label: 'Accepted + Started',
                    data: acceptedCounts,
                    backgroundColor: 'rgba(255, 107, 53, 0.8)',
                    borderColor: '#ff6b35',
                    borderWidth: 1
                },
                {
                    label: 'Pipeline Open',
                    data: pipelineCounts,
                    backgroundColor: 'rgba(243, 156, 18, 0.8)',
                    borderColor: '#f39c12',
                    borderWidth: 1
                },
                {
                    label: 'Future Roles',
                    data: futureCounts,
                    backgroundColor: 'rgba(155, 89, 182, 0.8)',
                    borderColor: '#9b59b6',
                    borderWidth: 1
                },
                {
                    label: 'Backfill Roles',
                    data: backfillCounts,
                    backgroundColor: 'rgba(220, 53, 69, 0.8)',
                    borderColor: '#dc3545',
                    borderWidth: 1
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            onClick: (event, elements) => {
                if (elements.length > 0) {
                    const index = elements[0].index;
                    const month = months[index];
                    handleTimelineClick(month, data);
                }
            },
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: {
                        font: {
                            size: 12,
                            weight: '600'
                        },
                        usePointStyle: true,
                        padding: 15
                    }
                },
                tooltip: {
                    callbacks: {
                        footer: function(tooltipItems) {
                            let total = 0;
                            tooltipItems.forEach(item => {
                                total += item.parsed.y;
                            });
                            return 'Total: ' + total + ' hires';
                        }
                    }
                }
            },
            scales: {
                x: {
                    stacked: true,
                    grid: {
                        display: false
                    }
                },
                y: {
                    stacked: true,
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1
                    },
                    title: {
                        display: true,
                        text: 'Number of Hires',
                        font: {
                            size: 12,
                            weight: '600'
                        }
                    }
                }
            }
        }
    });
}

// Update growth trajectory chart
function updateGrowthChart(data) {
    const ctx = document.getElementById('growthChart').getContext('2d');

    // Filter to 2026 roles by status (include both Accepted and Started)
    const acceptedFor2026 = data.filter(r => {
        if (r.roleStatus !== 'Offer Accepted' && r.roleStatus !== 'Started') return false;
        if (!r.dateStart) return false;
        const startYear = new Date(r.dateStart).getFullYear();
        return startYear === 2026; // Only count roles starting in 2026
    });

    const pipelineFor2026 = data.filter(r => {
        if (r.roleStatus !== 'Pipeline Open') return false;
        if (!r.dateStart) return false;
        const startYear = new Date(r.dateStart).getFullYear();
        return startYear === 2026; // Only count roles starting in 2026
    });

    // NOTE: Future roles monthly data now sourced directly from window.visualizationData.rolesByMonth
    // No need to filter from data array - visualization timeline is the authoritative source

    // Create full 2026 timeline (Jan-Dec)
    const months = [
        '2026-01', '2026-02', '2026-03', '2026-04', '2026-05', '2026-06',
        '2026-07', '2026-08', '2026-09', '2026-10', '2026-11', '2026-12'
    ];

    // Calculate accepted offers by month (using dateStart - when they actually start)
    const acceptedMonthlyData = {};
    months.forEach(m => acceptedMonthlyData[m] = 0);

    acceptedFor2026.forEach(row => {
        const date = new Date(row.dateStart); // Use actual start date
        const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;

        if (monthKey >= '2026-01' && monthKey <= '2026-12') {
            acceptedMonthlyData[monthKey] = (acceptedMonthlyData[monthKey] || 0) + 1;
        }
    });

    // Calculate pipeline roles by month (using dateStart - when they will start)
    const pipelineMonthlyData = {};
    months.forEach(m => pipelineMonthlyData[m] = 0);

    pipelineFor2026.forEach(row => {
        const date = new Date(row.dateStart); // Use expected start date
        const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;

        if (monthKey >= '2026-01' && monthKey <= '2026-12') {
            pipelineMonthlyData[monthKey] = (pipelineMonthlyData[monthKey] || 0) + 1;
        }
    });

    // Calculate future roles by month
    // Use visualization timeline as authoritative source (growth future positions)
    const futureMonthlyData = {};
    months.forEach(m => futureMonthlyData[m] = 0);

    if (window.visualizationData?.rolesByMonth) {
        Object.entries(window.visualizationData.rolesByMonth).forEach(([month, roles]) => {
            if (month >= '2026-01' && month <= '2026-12') {
                futureMonthlyData[month] = roles.length;
            }
        });
    }

    // Calculate backfill openings by month (using backfillOpenDate)
    const backfillMonthlyData = {};
    months.forEach(m => backfillMonthlyData[m] = 0);

    if (window.backfillRoles) {
        window.backfillRoles.forEach(backfill => {
            const openDate = new Date(backfill.backfillOpenDate);
            if (openDate.getFullYear() === 2026) {
                const monthKey = `${openDate.getFullYear()}-${String(openDate.getMonth() + 1).padStart(2, '0')}`;
                if (monthKey >= '2026-01' && monthKey <= '2026-12') {
                    backfillMonthlyData[monthKey] = (backfillMonthlyData[monthKey] || 0) + 1;
                }
            }
        });
    }

    // Calculate cumulative counts for accepted offers (2026 starters only)
    let cumulativeAccepted = 0;
    const cumulativeAcceptedCounts = months.map(m => {
        cumulativeAccepted += acceptedMonthlyData[m];
        return cumulativeAccepted;
    });

    // Calculate cumulative counts for pipeline roles
    let cumulativePipeline = 0;
    const cumulativePipelineCounts = months.map(m => {
        cumulativePipeline += pipelineMonthlyData[m];
        return cumulativePipeline;
    });

    // Calculate cumulative counts for future roles
    let cumulativeFuture = 0;
    const cumulativeFutureCounts = months.map(m => {
        cumulativeFuture += futureMonthlyData[m];
        return cumulativeFuture;
    });

    // Calculate cumulative counts for backfill roles
    let cumulativeBackfills = 0;
    const cumulativeBackfillCounts = months.map(m => {
        cumulativeBackfills += backfillMonthlyData[m];
        return cumulativeBackfills;
    });

    // Calculate combined total (accepted + pipeline + future + backfills)
    const cumulativeTotalCounts = months.map((m, index) => {
        return cumulativeAcceptedCounts[index] + cumulativePipelineCounts[index] + cumulativeFutureCounts[index] + cumulativeBackfillCounts[index];
    });

    // Calculate cumulative attrition for 2026
    const attritionMonthlyData = {};
    months.forEach(m => attritionMonthlyData[m] = 0);

    attritionData.forEach(item => {
        const date = new Date(item.date);
        const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
        if (monthKey >= '2026-01' && monthKey <= '2026-12') {
            attritionMonthlyData[monthKey] = Math.abs(item.count);
        }
    });

    // Calculate cumulative attrition (negative impact on headcount)
    let cumulativeAttrition = 0;
    const cumulativeAttritionCounts = months.map(m => {
        cumulativeAttrition += attritionMonthlyData[m];
        return cumulativeAttrition;
    });

    // Keep reference for backward compatibility
    const cumulativeCounts = cumulativeAcceptedCounts;

    // 30% growth target from Team Planning Dashboard
    // Baseline: 177 employees at start of 2026
    // Target: 53 NEW hires in 2026 (30% growth)
    const targetGrowth = CONFIG.GROWTH_TARGET;

    // Create cumulative target line that reaches 53 by end of 2026
    // Shows 2026 growth target only (excludes 2025 historical)
    const targetLine = months.map((month, index) => {
        const monthNum = index + 1; // Jan=1, Feb=2, ..., Dec=12
        return Math.round((monthNum / 12) * targetGrowth);
    });

    // Calculate forecast based on unified projection from calculatePredictiveTargeting
    // This ensures consistency between metric cards and chart
    const prediction = calculatePredictiveTargeting(data);
    const projectedYearEnd = prediction.projectedTotal;

    // Find the current month to determine actual vs projected data
    // We're on Jan 2, 2026, so only January is actual, Feb-Dec are projections
    const now = new Date();
    const currentMonth = now.getMonth(); // 0 = January, 1 = February, etc.
    const currentYear = now.getFullYear();

    // If we're in 2026, use current month. Otherwise use -1 (before year) or 11 (after year)
    let lastActualIndex;
    if (currentYear < 2026) {
        lastActualIndex = -1; // Haven't started 2026 yet
    } else if (currentYear > 2026) {
        lastActualIndex = 11; // 2026 is over, all months are actual
    } else {
        lastActualIndex = currentMonth; // Current month of 2026
    }

    const lastActualValue = lastActualIndex >= 0 ? cumulativeAcceptedCounts[lastActualIndex] : 0;

    // Build forecast line that starts from accepted and projects to year-end
    const forecastLine = months.map((_, index) => {
        // Show accepted data up to the last actual month
        if (index <= lastActualIndex) {
            return cumulativeAcceptedCounts[index];
        }

        // Project from last accepted value to projected year-end
        const monthsRemaining = months.length - lastActualIndex;
        const growthPerMonth = (projectedYearEnd - lastActualValue) / monthsRemaining;
        const monthsFromLastActual = index - lastActualIndex;
        return Math.round(lastActualValue + (growthPerMonth * monthsFromLastActual));
    });

    // Calculate NET GROWTH (ACTUAL headcount change = Accepted - Attrition)
    // IMPORTANT: Only count ACTUAL hires (accepted/started), not pipeline or future (they're just plans)
    // Backfills excluded (they're replacements, not growth)
    const cumulativeNetGrowth = months.map((month, index) => {
        // Net growth = Only actual accepted hires minus actual attrition
        return Math.max(0, cumulativeAcceptedCounts[index] - cumulativeAttritionCounts[index]);
    });

    const monthlyNetGrowth = months.map((month, index) => {
        // Net growth = Only actual accepted hires minus attrition (not pipeline/future plans)
        return acceptedMonthlyData[month] - attritionMonthlyData[month];
    });

    // Store monthly data globally for toggling between views
    growthChartMonthlyData = {
        months: months,
        acceptedMonthly: months.map(m => acceptedMonthlyData[m]),
        pipelineMonthly: months.map(m => pipelineMonthlyData[m]),
        futureMonthly: months.map(m => futureMonthlyData[m]),
        backfillMonthly: months.map(m => backfillMonthlyData[m]),
        totalMonthly: months.map(m => acceptedMonthlyData[m] + pipelineMonthlyData[m] + futureMonthlyData[m] + backfillMonthlyData[m]),
        attritionMonthly: months.map(m => attritionMonthlyData[m]),
        netGrowthMonthly: monthlyNetGrowth,
        cumulativeAccepted: cumulativeAcceptedCounts,
        cumulativePipeline: cumulativePipelineCounts,
        cumulativeFuture: cumulativeFutureCounts,
        cumulativeBackfills: cumulativeBackfillCounts,
        cumulativeTotal: cumulativeTotalCounts,
        cumulativeAttrition: cumulativeAttritionCounts,
        cumulativeNetGrowth: cumulativeNetGrowth,
        targetLine: targetLine,
        forecastLine: forecastLine,
        data: data
    };

    // DEBUG: Comprehensive chart data audit (after all calculations complete)
    console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
    console.log('üìä GROWTH CHART DATA AUDIT (v111)');
    console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
    console.log('Input Data Counts:');
    console.log('  Total data array length:', data.length);
    console.log('  Accepted 2026 roles:', acceptedFor2026.length);
    console.log('  Pipeline 2026 roles:', pipelineFor2026.length);
    console.log('  Visualization future (from window):', window.visualizationData?.rolesByMonth ? Object.values(window.visualizationData.rolesByMonth).reduce((sum, roles) => sum + roles.length, 0) : 0);
    console.log('  Backfills (from window):', window.backfillRoles?.length || 0);
    console.log('');
    console.log('December Cumulative Counts:');
    console.log('  Accepted:', cumulativeAcceptedCounts[11]);
    console.log('  Pipeline:', cumulativePipelineCounts[11]);
    console.log('  Future:', cumulativeFutureCounts[11], '(should be ~44 growth future only)');
    console.log('  Backfills:', cumulativeBackfillCounts[11], '(should be 44)');
    console.log('  Total:', cumulativeTotalCounts[11], '(should be ~87)');
    console.log('  Attrition:', cumulativeAttritionCounts[11], '(should be 44)');
    console.log('  Net Growth:', cumulativeNetGrowth[11], '(accepted - attrition only)');
    console.log('');
    console.log('Projection Details:');
    console.log('  Projected Total:', projectedYearEnd, '(should be 87)');
    console.log('  Projected Growth Roles:', prediction.projectedGrowthRoles);
    console.log('  Projected Backfill Roles:', prediction.projectedBackfillRoles);
    console.log('  Target Growth:', targetGrowth, '(53)');
    console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');

    if (charts.growth) {
        charts.growth.destroy();
    }

    // Determine which data to use based on view mode
    const acceptedData = growthChartViewMode === 'cumulative' ? cumulativeAcceptedCounts : growthChartMonthlyData.acceptedMonthly;
    const pipelineData = growthChartViewMode === 'cumulative' ? cumulativePipelineCounts : growthChartMonthlyData.pipelineMonthly;
    const futureData = growthChartViewMode === 'cumulative' ? cumulativeFutureCounts : growthChartMonthlyData.futureMonthly;
    const backfillData = growthChartViewMode === 'cumulative' ? cumulativeBackfillCounts : growthChartMonthlyData.backfillMonthly;
    const totalData = growthChartViewMode === 'cumulative' ? cumulativeTotalCounts : growthChartMonthlyData.totalMonthly;
    const attritionChartData = growthChartViewMode === 'cumulative' ? cumulativeAttritionCounts : growthChartMonthlyData.attritionMonthly;
    const netGrowthData = growthChartViewMode === 'cumulative' ? cumulativeNetGrowth : growthChartMonthlyData.netGrowthMonthly;

    charts.growth = new Chart(ctx, {
        type: 'line',
        data: {
            labels: months,
            datasets: [
                {
                    label: 'Accepted + Started (2026)',
                    data: acceptedData,
                    borderColor: '#ff6b35',
                    backgroundColor: 'rgba(255, 107, 53, 0.1)',
                    tension: 0.4,
                    fill: false,
                    borderWidth: 3
                },
                {
                    label: 'Pipeline Open (Starting)',
                    data: pipelineData,
                    borderColor: '#f39c12',
                    backgroundColor: 'rgba(243, 156, 18, 0.1)',
                    tension: 0.4,
                    fill: false,
                    borderWidth: 2
                },
                {
                    label: 'Future Roles (Starting)',
                    data: futureData,
                    borderColor: '#9b59b6',
                    backgroundColor: 'rgba(155, 89, 182, 0.1)',
                    tension: 0.4,
                    fill: false,
                    borderWidth: 2
                },
                {
                    label: 'Backfill Roles',
                    data: backfillData,
                    borderColor: '#dc3545',
                    backgroundColor: 'rgba(220, 53, 69, 0.1)',
                    tension: 0.4,
                    fill: false,
                    borderWidth: 2
                },
                {
                    label: 'Total (All Starters)',
                    data: totalData,
                    borderColor: '#3498db',
                    backgroundColor: 'rgba(52, 152, 219, 0.1)',
                    tension: 0.4,
                    fill: true,
                    borderWidth: 3
                },
                {
                    label: 'Net Growth (after attrition)',
                    data: netGrowthData,
                    borderColor: '#28a745',
                    backgroundColor: 'rgba(40, 167, 69, 0.15)',
                    tension: 0.4,
                    fill: false,
                    borderWidth: 4,
                    pointRadius: 3,
                    pointBackgroundColor: '#28a745',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2
                },
                {
                    label: 'Projected (at current velocity)',
                    data: growthChartViewMode === 'cumulative' ? forecastLine : null,
                    borderColor: '#ffa500',
                    borderDash: [10, 5],
                    tension: 0.4,
                    fill: false,
                    pointRadius: 3,
                    pointBackgroundColor: '#ffa500',
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    borderWidth: 3,
                    hidden: growthChartViewMode === 'monthly'
                },
                {
                    label: '30% Target (53 hires)',
                    data: growthChartViewMode === 'cumulative' ? targetLine : null,
                    borderColor: '#43e97b',
                    borderDash: [5, 5],
                    tension: 0,
                    fill: false,
                    borderWidth: 2,
                    hidden: growthChartViewMode === 'monthly'
                },
                {
                    label: 'Expected Attrition',
                    data: attritionChartData,
                    borderColor: '#e74c3c',
                    backgroundColor: 'rgba(231, 76, 60, 0.1)',
                    tension: 0.4,
                    fill: false,
                    borderWidth: 2,
                    borderDash: [3, 3]
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            // Removed onClick handler - tooltips provide sufficient detail without disrupting interaction
            plugins: {
                legend: {
                    display: true,
                    position: 'bottom',
                    onClick: (e, legendItem, legend) => {
                        // Toggle dataset visibility
                        const index = legendItem.datasetIndex;
                        const chart = legend.chart;
                        const meta = chart.getDatasetMeta(index);

                        meta.hidden = meta.hidden === null ? !chart.data.datasets[index].hidden : null;
                        chart.update();
                    },
                    labels: {
                        padding: 15,
                        font: {
                            size: 12,
                            weight: 'bold'
                        },
                        usePointStyle: true,
                        generateLabels: (chart) => {
                            const datasets = chart.data.datasets;
                            return datasets.map((dataset, i) => {
                                const meta = chart.getDatasetMeta(i);
                                const hidden = meta.hidden === null ? dataset.hidden : meta.hidden;

                                return {
                                    text: dataset.label,
                                    fillStyle: dataset.borderColor,
                                    strokeStyle: dataset.borderColor,
                                    lineWidth: dataset.borderWidth,
                                    hidden: hidden,
                                    datasetIndex: i,
                                    fontColor: hidden ? '#999' : '#333'
                                };
                            });
                        }
                    }
                },
                tooltip: {
                    enabled: true,
                    mode: 'index',
                    intersect: false,
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    titleColor: '#fff',
                    bodyColor: '#fff',
                    borderColor: '#ff6b35',
                    borderWidth: 1,
                    padding: 12,
                    displayColors: true,
                    callbacks: {
                        title: (context) => {
                            const monthKey = context[0].label;
                            const date = new Date(monthKey + '-01');
                            return date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                        },
                        label: (context) => {
                            const label = context.dataset.label || '';
                            const value = context.parsed.y;

                            // Add context to each line based on view mode
                            let explanation = '';
                            if (growthChartViewMode === 'cumulative') {
                                if (label.includes('Accepted')) {
                                    explanation = ' (Confirmed hires starting this month or earlier)';
                                } else if (label.includes('Pipeline')) {
                                    explanation = ' (Active recruiting, expected to start by this month)';
                                } else if (label.includes('Future')) {
                                    explanation = ' (Planned roles, expected by this month)';
                                } else if (label.includes('Net Growth')) {
                                    explanation = ' (Total hires - Attrition = actual net headcount gain)';
                                } else if (label.includes('Total')) {
                                    explanation = ' (Sum of Accepted + Pipeline + Future - gross hires)';
                                } else if (label.includes('Projected')) {
                                    explanation = ' (Forecast based on current hiring velocity)';
                                } else if (label.includes('Target')) {
                                    explanation = ' (30% net growth goal = 53 new hires in 2026)';
                                } else if (label.includes('Attrition')) {
                                    explanation = ' (Expected departures by this month)';
                                }
                            } else {
                                // Monthly view explanations
                                if (label.includes('Accepted')) {
                                    explanation = ' (Confirmed hires starting in this month)';
                                } else if (label.includes('Pipeline')) {
                                    explanation = ' (Active roles expected to start this month)';
                                } else if (label.includes('Future')) {
                                    explanation = ' (Planned roles expected this month)';
                                } else if (label.includes('Net Growth')) {
                                    explanation = ' (Hires - attrition in this month)';
                                } else if (label.includes('Total')) {
                                    explanation = ' (Sum of all hires starting this month)';
                                } else if (label.includes('Attrition')) {
                                    explanation = ' (Expected departures in this month)';
                                }
                            }

                            return `${label}: ${value}${explanation}`;
                        },
                        afterBody: (context) => {
                            if (context.length > 0 && growthChartViewMode === 'cumulative') {
                                const monthIndex = context[0].dataIndex;
                                const netGrowth = growthChartMonthlyData.cumulativeNetGrowth[monthIndex];
                                const target = growthChartMonthlyData.targetLine[monthIndex];
                                const netGrowthGap = target - netGrowth;

                                const lines = [
                                    '',
                                    `Net Growth vs Target: ${netGrowth} vs ${target}`,
                                    netGrowthGap <= 0 ? `‚úÖ ${Math.abs(netGrowthGap)} ahead of target` : `‚ùå ${netGrowthGap} SHORT of target`
                                ];

                                return lines;
                            }
                            return [];
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: growthChartViewMode === 'cumulative' ? 'Cumulative Hires' : 'Monthly Hires',
                        font: {
                            size: 14,
                            weight: 'bold'
                        }
                    },
                    ticks: {
                        callback: (value) => {
                            return value.toFixed(0);
                        }
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: '2026 Timeline',
                        font: {
                            size: 14,
                            weight: 'bold'
                        }
                    },
                    ticks: {
                        callback: (value, index) => {
                            const date = new Date(months[index] + '-01');
                            return date.toLocaleDateString('en-US', { month: 'short' });
                        }
                    }
                }
            },
            interaction: {
                mode: 'nearest',
                axis: 'x',
                intersect: false
            }
        }
    });
}

// Update Strategic Bets Section
async function updateStrategicBets(hiringData) {
    try {
        // Define bet descriptions and colors
        const betInfo = {
            'Scale Execution': {
                icon: 'üìä',
                color: '#667eea',
                description: 'Build operational excellence and scalable infrastructure'
            },
            'Launch the Invasion': {
                icon: 'üöÄ',
                color: '#ff6b35',
                description: 'Aggressive market expansion and customer acquisition'
            },
            'Defend our Ground': {
                icon: 'üõ°Ô∏è',
                color: '#28a745',
                description: 'Retain and deepen existing customer relationships'
            },
            'Build the Bridge': {
                icon: 'üåâ',
                color: '#ffa500',
                description: 'Connect products, teams, and capabilities'
            },
            'Unassigned': {
                icon: '‚ùì',
                color: '#999',
                description: 'Roles not yet aligned to a strategic bet'
            }
        };

        // Use strategicInitiative field from hiring data
        // Map common variations to standard bet names
        const betMappings = {
            // Direct bet names (lowercase for case-insensitive matching)
            'scale execution': 'Scale Execution',
            'launch the invasion': 'Launch the Invasion',
            'defend our ground': 'Defend our Ground',
            'build the bridge': 'Build the Bridge',

            // Strategic initiatives mapped to bets (all 11 found in spreadsheet)
            'right-size marketing function': 'Scale Execution',
            'right-size customer support': 'Scale Execution',
            'build a mature revenue operations function': 'Scale Execution',
            'build a risk and governance function': 'Scale Execution',
            'build data excellence': 'Scale Execution',

            'inside sales': 'Launch the Invasion',
            'mssp strategic partnerships': 'Launch the Invasion',
            'structured partner programme': 'Launch the Invasion',

            'digital cs': 'Defend our Ground',
            'premium success': 'Defend our Ground',

            'enterprise onboarding': 'Build the Bridge',

            // Fallbacks
            '': 'Unassigned',
            null: 'Unassigned',
            undefined: 'Unassigned'
        };

        // Enrich hiring data with normalized bet alignment
        const enrichedData = hiringData.map(role => {
            const rawBet = (role.strategicInitiative || '').toLowerCase().trim();
            const betAlignment = betMappings[rawBet] ||
                                (role.strategicInitiative ? role.strategicInitiative : 'Unassigned');
            return {
                ...role,
                betAlignment: betAlignment
            };
        });

        // Calculate metrics per bet
        const betMetrics = {};

        Object.keys(betInfo).forEach(betName => {
            const rolesInBet = enrichedData.filter(r => r.betAlignment === betName);

            const total2026 = rolesInBet.filter(r => {
                // Only count 2026 relevant roles
                if (r.roleStatus === 'Cancelled') return false;

                // Accepted/Started: Must have 2026 start date
                if (r.roleStatus === 'Offer Accepted' || r.roleStatus === 'Started') {
                    if (!r.dateStart) return false;
                    const year = new Date(r.dateStart).getFullYear();
                    return year === 2026;
                }

                // Pipeline: Assume 2026 unless date explicitly shows otherwise
                if (r.roleStatus === 'Pipeline Open') {
                    if (!r.dateStart) return true; // No date = assume 2026
                    const year = new Date(r.dateStart).getFullYear();
                    return year === 2026;
                }

                // Future/Backfill roles: Assume 2026 (they don't have explicit dates)
                if (r.roleStatus === 'Future' ||
                    r.roleStatus === 'Backfill - Not Opened' ||
                    r.__type === 'visualization' ||
                    r.__isBackfill) {
                    return true;
                }

                // Everything else: exclude
                return false;
            }).length;

            const accepted2026 = rolesInBet.filter(r => {
                if (r.roleStatus !== 'Offer Accepted' && r.roleStatus !== 'Started') return false;
                if (!r.dateStart) return false;
                const year = new Date(r.dateStart).getFullYear();
                return year === 2026;
            }).length;

            // Count pipeline roles (assume 2026 unless date shows otherwise)
            const pipelineRoles = rolesInBet.filter(r => {
                if (r.roleStatus !== 'Pipeline Open') return false;
                if (!r.dateStart) return true; // No date = assume 2026
                const year = new Date(r.dateStart).getFullYear();
                return year === 2026;
            });
            const pipelineUnique = new Set(pipelineRoles.map(r => r.roleTitle || 'Untitled Role')).size;
            const pipelineCount = pipelineRoles.length; // Actual count

            // Count future roles (visualization + backfills, assume 2026)
            const futureRoles = rolesInBet.filter(r =>
                r.roleStatus === 'Future' || // Visualization roles
                r.roleStatus === 'Backfill - Not Opened' || // Backfills not yet opened
                r.__type === 'visualization' || // Explicitly marked visualization roles
                r.__isBackfill // Explicitly marked backfill roles
            );
            const futureUnique = new Set(futureRoles.map(r => r.roleTitle || 'Untitled Role')).size;
            const futureCount = futureRoles.length; // Actual count

            const atRisk = rolesInBet.filter(r => {
                if (r.roleStatus !== 'Pipeline Open') return false;
                if (!r.dateOpen) return false;
                const daysOpen = Math.floor((new Date() - new Date(r.dateOpen)) / (1000 * 60 * 60 * 24));
                return daysOpen > 90;
            }).length;

            const progressPercent = total2026 > 0 ? Math.round((accepted2026 / total2026) * 100) : 0;

            betMetrics[betName] = {
                total2026,
                accepted2026,
                pipeline: pipelineUnique,      // Unique titles (for compatibility)
                pipelineCount: pipelineCount,  // Actual count (NEW)
                future: futureUnique,          // Unique titles (for compatibility)
                futureCount: futureCount,      // Actual count (NEW)
                atRisk,
                progressPercent,
                roles: rolesInBet
            };
        });

        // Debug: Log pipeline distribution across bets
        console.log('üìä Strategic Bets Pipeline Distribution:');

        // First, show all pipeline roles and their strategic initiative values
        const allPipelineRoles = enrichedData.filter(r => {
            if (r.roleStatus !== 'Pipeline Open') return false;
            if (!r.dateStart) return true; // No date = assume 2026
            const year = new Date(r.dateStart).getFullYear();
            return year === 2026;
        });

        console.log(`\nAll Pipeline Roles (${allPipelineRoles.length} total):`);
        allPipelineRoles.forEach(role => {
            console.log(`  - "${role.roleTitle}" | Strategic Initiative: "${role.strategicInitiative || '(empty)'}" | Mapped to: "${role.betAlignment}"`);
        });

        console.log('\nPipeline Roles per Bet:');
        Object.keys(betInfo).forEach(betName => {
            const metrics = betMetrics[betName];
            if (metrics.pipelineCount > 0) {
                console.log(`  ${betName}: ${metrics.pipelineCount} pipeline roles (${metrics.pipeline} unique)`);
            }
        });
        const totalPipeline = Object.values(betMetrics).reduce((sum, m) => sum + m.pipelineCount, 0);
        console.log(`  TOTAL: ${totalPipeline} pipeline roles across all bets`);

        // Render bet cards
        renderStrategicBetsCards(betMetrics, betInfo);
        // Removed: renderStrategicBetsBreakdown() - redundant with improved cards

    } catch (error) {
        console.error('Error updating strategic bets:', error);
    }
}

// Render strategic bet cards
function renderStrategicBetsCards(betMetrics, betInfo) {
    const grid = document.getElementById('strategicBetsGrid');
    if (!grid) return;

    let html = '';

    Object.keys(betInfo).forEach(betName => {
        const metrics = betMetrics[betName];
        const info = betInfo[betName];

        const statusColor = metrics.progressPercent >= 75 ? '#28a745' :
                           metrics.progressPercent >= 50 ? '#ffa500' : '#ff6b6b';

        // Use total2026 directly (already calculated as the full count)
        const totalDemand = metrics.total2026;

        html += `
            <div style="background: white; border-radius: 10px; padding: 18px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); cursor: pointer; transition: transform 0.2s ease; display: flex; flex-direction: column;"
                 onclick="showBetDetails('${escapeHtml(betName)}')"
                 onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'"
                 onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'">

                <div style="display: flex; align-items: flex-start; gap: 12px; margin-bottom: 16px;">
                    <div style="font-size: 2em; line-height: 1;">${info.icon}</div>
                    <div style="flex: 1; min-width: 0;">
                        <h3 style="margin: 0 0 6px 0; color: ${info.color}; font-size: 1.1em; font-weight: 700;">${escapeHtml(betName)}</h3>
                        <p style="margin: 0; font-size: 0.8em; color: #666; line-height: 1.4;">${escapeHtml(info.description)}</p>
                    </div>
                </div>

                <!-- Total Hiring Demand (Big Number) -->
                <div style="text-align: center; margin: 16px 0; padding: 16px; background: linear-gradient(135deg, ${info.color}15 0%, ${info.color}08 100%); border-radius: 8px; border: 2px solid ${info.color}30;">
                    <div style="font-size: 3em; font-weight: 700; color: ${info.color}; line-height: 1;">${totalDemand}</div>
                    <div style="font-size: 0.9em; color: #666; margin-top: 6px; font-weight: 600;">Total Hiring Demand</div>
                    <div style="font-size: 0.75em; color: #999; margin-top: 2px;">Accepted + Pipeline + Future</div>
                </div>

                <!-- Breakdown Grid -->
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 12px;">
                    <div style="background: #e8f5e9; padding: 10px; border-radius: 6px; text-align: center;">
                        <div style="font-size: 1.6em; font-weight: 700; color: #28a745; line-height: 1;">${metrics.accepted2026}</div>
                        <div style="font-size: 0.7em; color: #666; margin-top: 4px; font-weight: 600;">Accepted</div>
                        <div style="font-size: 0.65em; color: #999;">Hired</div>
                    </div>
                    <div style="background: #fff3e0; padding: 10px; border-radius: 6px; text-align: center;">
                        <div style="font-size: 1.6em; font-weight: 700; color: #ff9800; line-height: 1;">${metrics.pipelineCount}</div>
                        <div style="font-size: 0.7em; color: #666; margin-top: 4px; font-weight: 600;">Pipeline</div>
                        <div style="font-size: 0.65em; color: #999;">${metrics.pipeline} unique title${metrics.pipeline !== 1 ? 's' : ''}</div>
                    </div>
                    <div style="background: #e3f2fd; padding: 10px; border-radius: 6px; text-align: center;">
                        <div style="font-size: 1.6em; font-weight: 700; color: #2196f3; line-height: 1;">${metrics.futureCount}</div>
                        <div style="font-size: 0.7em; color: #666; margin-top: 4px; font-weight: 600;">Future</div>
                        <div style="font-size: 0.65em; color: #999;">${metrics.future} unique title${metrics.future !== 1 ? 's' : ''}</div>
                    </div>
                </div>

                <!-- Progress Bar with Better Context -->
                <div style="margin: 12px 0;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 6px; align-items: baseline;">
                        <span style="font-size: 0.8em; color: #666; font-weight: 600;">Hiring Progress</span>
                        <span style="font-weight: 700; color: ${statusColor}; font-size: 1em;">${metrics.progressPercent}% complete</span>
                    </div>
                    <div style="background: #e9ecef; border-radius: 10px; height: 10px; overflow: hidden;">
                        <div style="background: ${statusColor}; width: ${metrics.progressPercent}%; height: 100%; transition: width 0.3s ease;"></div>
                    </div>
                    <div style="font-size: 0.7em; color: #999; margin-top: 4px; text-align: center;">
                        ${metrics.accepted2026} of ${totalDemand} roles filled
                    </div>
                </div>

                ${metrics.atRisk > 0 ? `
                    <div style="background: #fff3cd; border-left: 4px solid #ff9800; padding: 8px 10px; margin-top: 10px; border-radius: 4px;">
                        <span style="color: #856404; font-size: 0.75em; font-weight: 700;">‚ö†Ô∏è ${metrics.atRisk} role${metrics.atRisk > 1 ? 's' : ''} open 90+ days</span>
                    </div>
                ` : ''}

                <div style="margin-top: 14px; padding-top: 10px; border-top: 1px solid #eee; text-align: center;">
                    <span style="font-size: 0.75em; color: #2196f3; font-weight: 600;">üìä Click for detailed breakdown ‚Üí</span>
                </div>
            </div>
        `;
    });

    grid.innerHTML = html;
}

// Render detailed breakdown (DISABLED - redundant with improved cards)
/*
function renderStrategicBetsBreakdown(betMetrics, betInfo, enrichedData) {
    const container = document.getElementById('strategicBetsBreakdown');
    if (!container) return;

    let html = '';

    Object.keys(betInfo).forEach(betName => {
        const metrics = betMetrics[betName];
        const info = betInfo[betName];

        // Group roles by status
        const rolesByStatus = {
            'Accepted/Started (2026)': [],
            'Pipeline Open': [],
            'Future': [],
            'Other': []
        };

        metrics.roles.forEach(role => {
            const is2026Starter = (role.roleStatus === 'Offer Accepted' || role.roleStatus === 'Started') &&
                                  role.dateStart && new Date(role.dateStart).getFullYear() === 2026;

            if (is2026Starter) {
                rolesByStatus['Accepted/Started (2026)'].push(role);
            } else if (role.roleStatus === 'Pipeline Open') {
                rolesByStatus['Pipeline Open'].push(role);
            } else if (
                role.roleStatus === 'Future' || // Visualization roles
                role.roleStatus === 'Backfill - Not Opened' || // Backfills
                role.__type === 'visualization' || // Explicitly marked
                role.__isBackfill // Explicitly marked backfills
            ) {
                rolesByStatus['Future'].push(role);
            } else if (role.roleStatus !== 'Cancelled') {
                rolesByStatus['Other'].push(role);
            }
        });

        html += `
            <div style="background: rgba(255,255,255,0.95); border-radius: 8px; padding: 12px;">
                <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 10px;">
                    <div style="font-size: 1.3em;">${info.icon}</div>
                    <h4 style="margin: 0; color: ${info.color}; font-size: 0.9em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${escapeHtml(betName)}</h4>
                </div>

                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 6px; margin-bottom: 10px;">
                    <div style="text-align: center; padding: 5px; background: #f8f9fa; border-radius: 4px;">
                        <div style="font-size: 1.1em; font-weight: 700; color: #667eea;">${metrics.total2026}</div>
                        <div style="font-size: 0.6em; color: #666;">Total</div>
                    </div>
                    <div style="text-align: center; padding: 5px; background: #e8f5e9; border-radius: 4px;">
                        <div style="font-size: 1.1em; font-weight: 700; color: #28a745;">${metrics.accepted2026}</div>
                        <div style="font-size: 0.6em; color: #666;">Accepted</div>
                    </div>
                    <div style="text-align: center; padding: 5px; background: #e3f2fd; border-radius: 4px;">
                        <div style="font-size: 1.1em; font-weight: 700; color: #2196f3;">${metrics.pipelineCount}</div>
                        <div style="font-size: 0.6em; color: #666;">Pipeline (${metrics.pipeline} unique)</div>
                    </div>
                    <div style="text-align: center; padding: 5px; background: #fff3e0; border-radius: 4px;">
                        <div style="font-size: 1.1em; font-weight: 700; color: #ff9800;">${metrics.futureCount}</div>
                        <div style="font-size: 0.6em; color: #666;">Future (${metrics.future} unique)</div>
                    </div>
                </div>

                ${Object.entries(rolesByStatus).map(([status, roles]) => {
                    if (roles.length === 0) return '';

                    return `
                        <div style="margin-top: 6px; padding: 6px; background: #f8f9fa; border-radius: 4px;">
                            <div style="font-weight: 600; color: #495057; margin-bottom: 4px; font-size: 0.7em;">
                                ${escapeHtml(status)} (${roles.length})
                            </div>
                            <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                                ${roles.slice(0, 3).map(role => `
                                    <span style="background: white; padding: 2px 6px; border-radius: 3px; font-size: 0.65em; color: #666; border: 1px solid #dee2e6; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%;">
                                        ${escapeHtml(role.roleTitle)}
                                    </span>
                                `).join('')}
                                ${roles.length > 3 ? `<span style="color: #999; font-size: 0.65em; padding: 2px;">+${roles.length - 3} more</span>` : ''}
                            </div>
                        </div>
                    `;
                }).join('')}
            </div>
        `;
    });

    container.innerHTML = html;
}
*/

// Show bet details modal
function showBetDetails(betName) {
    const modal = document.getElementById('detailModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');

    if (!modal || !modalTitle || !modalBody) {
        console.error('Modal elements not found');
        return;
    }

    // Get bet info and data
    const betInfo = {
        'Scale Execution': { icon: 'üìä', color: '#667eea', description: 'Build operational excellence and scalable infrastructure' },
        'Launch the Invasion': { icon: 'üöÄ', color: '#f093fb', description: 'Aggressive market expansion and customer acquisition' },
        'Defend our Ground': { icon: 'üõ°Ô∏è', color: '#4facfe', description: 'Retain and deepen existing customer relationships' },
        'Build the Bridge': { icon: 'üåâ', color: '#43e97b', description: 'Connect products, teams, and capabilities' },
        'Unassigned': { icon: '‚ùì', color: '#95a5a6', description: 'Roles not yet aligned to a strategic bet' }
    };

    const info = betInfo[betName] || { icon: '‚ùì', color: '#95a5a6', description: 'Unknown bet' };

    // Get all roles for this bet
    const betMappings = {
        'scale execution': 'Scale Execution',
        'launch the invasion': 'Launch the Invasion',
        'defend our ground': 'Defend our Ground',
        'build the bridge': 'Build the Bridge',
        'right-size marketing function': 'Scale Execution',
        'right-size customer support': 'Scale Execution',
        'build a mature revenue operations function': 'Scale Execution',
        'build a risk and governance function': 'Scale Execution',
        'build data excellence': 'Scale Execution',
        'inside sales': 'Launch the Invasion',
        'mssp strategic partnerships': 'Launch the Invasion',
        'structured partner programme': 'Launch the Invasion',
        'digital cs': 'Defend our Ground',
        'premium success': 'Defend our Ground',
        'enterprise onboarding': 'Build the Bridge',
        '': 'Unassigned',
        null: 'Unassigned',
        undefined: 'Unassigned'
    };

    const enrichedData = hiringData.map(role => {
        const rawBet = (role.strategicInitiative || '').toLowerCase().trim();
        const betAlignment = betMappings[rawBet] || (role.strategicInitiative ? role.strategicInitiative : 'Unassigned');
        return { ...role, betAlignment: betAlignment };
    });

    const rolesInBet = enrichedData.filter(r => r.betAlignment === betName && r.roleStatus !== 'Cancelled');

    // Group by status
    const rolesByStatus = {
        'Accepted/Started (2026)': [],
        'Pipeline Open': [],
        'Future': [],
        'Other': []
    };

    rolesInBet.forEach(role => {
        const is2026Starter = (role.roleStatus === 'Offer Accepted' || role.roleStatus === 'Started') &&
                              role.dateStart && new Date(role.dateStart).getFullYear() === 2026;

        if (is2026Starter) {
            rolesByStatus['Accepted/Started (2026)'].push(role);
        } else if (role.roleStatus === 'Pipeline Open') {
            rolesByStatus['Pipeline Open'].push(role);
        } else if (
            role.roleStatus === 'Future' || // Visualization roles
            role.roleStatus === 'Backfill - Not Opened' || // Backfills
            role.__type === 'visualization' || // Explicitly marked
            role.__isBackfill // Explicitly marked backfills
        ) {
            rolesByStatus['Future'].push(role);
        } else {
            rolesByStatus['Other'].push(role);
        }
    });

    // Build modal content
    modalTitle.innerHTML = `${info.icon} ${escapeHtml(betName)}`;

    let content = `
        <div style="margin-bottom: 20px;">
            <p style="color: #666; font-size: 1.05em; margin: 0 0 15px 0;">${escapeHtml(info.description)}</p>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px;">
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 2em; font-weight: 700; color: #667eea;">${rolesInBet.length}</div>
                    <div style="font-size: 0.9em; color: #666;">Total Roles</div>
                </div>
                <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 2em; font-weight: 700; color: #28a745;">${rolesByStatus['Accepted/Started (2026)'].length}</div>
                    <div style="font-size: 0.9em; color: #666;">Accepted 2026</div>
                </div>
                <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 2em; font-weight: 700; color: #2196f3;">${rolesByStatus['Pipeline Open'].length}</div>
                    <div style="font-size: 0.9em; color: #666;">Pipeline Open</div>
                </div>
                <div style="background: #fff3e0; padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 2em; font-weight: 700; color: #ff9800;">${rolesByStatus['Future'].length}</div>
                    <div style="font-size: 0.9em; color: #666;">Future</div>
                </div>
            </div>
        </div>
    `;

    // Show roles by status
    Object.entries(rolesByStatus).forEach(([status, roles]) => {
        if (roles.length === 0) return;

        content += `
            <div style="margin-bottom: 25px;">
                <h4 style="color: #495057; margin: 0 0 12px 0; font-size: 1.1em; border-bottom: 2px solid #e9ecef; padding-bottom: 8px;">
                    ${escapeHtml(status)} (${roles.length})
                </h4>
                <div style="display: grid; gap: 10px;">
                    ${roles.map(role => {
                        const openDate = role.dateOpen ? new Date(role.dateOpen).toLocaleDateString() : 'N/A';
                        const startDate = role.dateStart ? new Date(role.dateStart).toLocaleDateString() : 'N/A';
                        const daysOpen = role.dateOpen ? Math.floor((new Date() - new Date(role.dateOpen)) / (1000 * 60 * 60 * 24)) : 0;
                        const isAtRisk = daysOpen > 90 && role.roleStatus === 'Pipeline Open';

                        return `
                            <div style="background: ${isAtRisk ? '#fff3cd' : '#f8f9fa'}; padding: 12px; border-radius: 6px; border-left: 4px solid ${isAtRisk ? '#ffa500' : info.color};">
                                <div style="display: flex; justify-content: space-between; align-items: start; gap: 10px;">
                                    <div style="flex: 1; min-width: 0;">
                                        <div style="font-weight: 600; color: #212529; margin-bottom: 4px;">${escapeHtml(role.roleTitle)}</div>
                                        <div style="font-size: 0.85em; color: #666;">
                                            ${escapeHtml(role.leadTC || 'No champion')} ‚Ä¢ ${escapeHtml(role.function || 'No function')}
                                        </div>
                                        ${role.strategicInitiative ? `
                                            <div style="font-size: 0.8em; color: #667eea; margin-top: 4px;">
                                                Initiative: ${escapeHtml(role.strategicInitiative)}
                                            </div>
                                        ` : ''}
                                    </div>
                                    <div style="text-align: right; min-width: 120px;">
                                        <div style="font-size: 0.8em; color: #666;">
                                            ${role.roleStatus === 'Pipeline Open' ? `Open: ${openDate}` : ''}
                                            ${role.roleStatus === 'Offer Accepted' || role.roleStatus === 'Started' ? `Start: ${startDate}` : ''}
                                        </div>
                                        ${isAtRisk ? `
                                            <div style="font-size: 0.75em; color: #856404; margin-top: 2px; font-weight: 600;">
                                                ‚ö†Ô∏è ${daysOpen} days open
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            </div>
        `;
    });

    if (rolesInBet.length === 0) {
        content = `
            <div style="text-align: center; padding: 40px; color: #999;">
                <div style="font-size: 3em; margin-bottom: 10px;">üì≠</div>
                <div style="font-size: 1.2em;">No roles currently assigned to this strategic bet</div>
            </div>
        `;
    }

    modalBody.innerHTML = content;
    modal.style.display = 'block';
}

// Show strategic bets info
function showStrategicBetsInfo(event) {
    if (event) {
        event.stopPropagation();
        event.preventDefault();
    }

    const modal = document.getElementById('detailModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');

    if (!modal || !modalTitle || !modalBody) return;

    modalTitle.textContent = 'üéØ Strategic Bets Overview';

    modalBody.innerHTML = `
        <div style="line-height: 1.8;">
            <h3 style="color: #667eea; margin-top: 0;">What are Strategic Bets?</h3>
            <p>Strategic Bets represent our 4 key priorities for 2026 growth and development. Every role we hire should align with at least one of these strategic initiatives.</p>

            <div style="margin-top: 25px;">
                <h3 style="color: #667eea;">The 4 Strategic Bets:</h3>

                <div style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-left: 4px solid #667eea; border-radius: 6px;">
                    <h4 style="margin: 0 0 8px 0; color: #667eea;">üìä Scale Execution</h4>
                    <p style="margin: 0; color: #666;">Build operational excellence and scalable infrastructure to support rapid growth. Focus on processes, systems, and team efficiency.</p>
                </div>

                <div style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-left: 4px solid #ff6b35; border-radius: 6px;">
                    <h4 style="margin: 0 0 8px 0; color: #ff6b35;">üöÄ Launch the Invasion</h4>
                    <p style="margin: 0; color: #666;">Aggressive market expansion and customer acquisition. Drive revenue growth through new markets, products, and sales channels.</p>
                </div>

                <div style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-left: 4px solid #28a745; border-radius: 6px;">
                    <h4 style="margin: 0 0 8px 0; color: #28a745;">üõ°Ô∏è Defend our Ground</h4>
                    <p style="margin: 0; color: #666;">Retain and deepen existing customer relationships. Focus on customer success, support excellence, and product quality.</p>
                </div>

                <div style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-left: 4px solid #ffa500; border-radius: 6px;">
                    <h4 style="margin: 0 0 8px 0; color: #ffa500;">üåâ Build the Bridge</h4>
                    <p style="margin: 0; color: #666;">Connect products, teams, and capabilities. Enable cross-functional collaboration and product integration.</p>
                </div>
            </div>

            <div style="margin-top: 25px; padding: 15px; background: #e3f2fd; border-radius: 8px;">
                <h4 style="margin: 0 0 10px 0; color: #2196f3;">üìä How Progress is Measured</h4>
                <ul style="margin: 0; padding-left: 20px; color: #666;">
                    <li>Total 2026 roles aligned to each bet</li>
                    <li>Accepted offers for 2026 start dates</li>
                    <li>Active pipeline roles (currently recruiting)</li>
                    <li>Future planned roles (not yet open)</li>
                    <li>At-risk roles (open >90 days)</li>
                </ul>
            </div>

            <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px;">
                <h4 style="margin: 0 0 10px 0; color: #856404;">‚ö†Ô∏è Risk Indicators</h4>
                <p style="margin: 0; color: #856404;">Roles flagged as "at risk" have been open for more than 90 days without an accepted offer. These may require:</p>
                <ul style="margin: 10px 0 0 0; padding-left: 20px; color: #856404;">
                    <li>Job description refresh</li>
                    <li>Salary/benefits review</li>
                    <li>Sourcing strategy adjustment</li>
                    <li>Market positioning analysis</li>
                </ul>
            </div>
        </div>
    `;

    modal.style.display = 'flex';
}

// Show Growth Chart Info Guide
function showGrowthChartInfo(event) {
    if (event) {
        event.stopPropagation();
        event.preventDefault();
    }

    const modal = document.getElementById('detailModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');

    modalTitle.textContent = 'üìà Growth Trajectory Chart Guide';
    modalBody.innerHTML = `
        <div class="detail-section">
            <div class="detail-label">üìä What This Chart Shows</div>
            <div class="detail-value">
                This chart visualizes your 2026 hiring progress across the year, tracking multiple metrics simultaneously
                to help you understand if you're on track to meet your 30% growth target.
            </div>
        </div>

        <div class="detail-section">
            <div class="detail-label">üìà Understanding the Lines</div>
            <ul class="detail-list">
                <li>
                    <strong style="color: #ff6b35;">üü† Accepted + Started (2026)</strong><br>
                    Confirmed hires with accepted offers who are starting in 2026. This is your most reliable metric
                    as these people have committed to joining.
                </li>
                <li>
                    <strong style="color: #f39c12;">üü° Pipeline Open (Starting)</strong><br>
                    Roles actively being recruited where you're interviewing candidates. These haven't accepted yet
                    but are expected to start in 2026 if recruitment is successful.
                </li>
                <li>
                    <strong style="color: #9b59b6;">üü£ Future Roles (Starting)</strong><br>
                    Approved positions not yet opened for recruitment. These are planned to be filled in 2026
                    but recruitment hasn't started yet.
                </li>
                <li>
                    <strong style="color: #3498db;">üîµ Total (All Starters)</strong><br>
                    <em>Sum of all three above = Accepted + Pipeline + Future</em><br>
                    This shows your maximum potential if everything goes perfectly. It represents all roles
                    that could potentially start in 2026.
                </li>
                <li>
                    <strong style="color: #28a745;">üü¢ Net Growth (after attrition)</strong> <em>(Thick line)</em><br>
                    <em>Accepted hires - Attrition = actual net headcount change</em><br>
                    <strong>This is the most important metric for executives.</strong> Shows your actual team size increase
                    based on people who have ACTUALLY joined (not pipeline/future plans), minus departures.
                    Compare this against the Target line (53) to see if you're on track for 30% growth.
                    Note: This will be low until accepted offers actually start throughout the year.
                </li>
                <li>
                    <strong style="color: #ffa500;">üü† Projected (at current velocity)</strong> <em>(Dashed)</em><br>
                    Forecast based on your current hiring speed. If you continue at the same pace, this is where
                    you'll likely end up by December 2026. Helps identify if you need to accelerate hiring.
                </li>
                <li>
                    <strong style="color: #43e97b;">üü¢ 30% Target (53 hires)</strong> <em>(Dashed)</em><br>
                    Your goal: 53 new hires in 2026 to achieve 30% growth. This line shows the ideal trajectory
                    if you hire evenly throughout the year.
                </li>
                <li>
                    <strong style="color: #e74c3c;">üî¥ Expected Attrition</strong> <em>(Dashed)</em><br>
                    Forecasted departures throughout 2026. These roles need to be backfilled on top of your
                    growth target to maintain headcount.
                </li>
            </ul>
        </div>

        <div class="detail-section">
            <div class="detail-label">üéØ How the Lines Relate to Each Other</div>
            <ul class="detail-list">
                <li>
                    <strong>Accepted ‚Üí Pipeline ‚Üí Future</strong>: Represents the hiring funnel progression.
                    Future roles should eventually move to Pipeline, and Pipeline should convert to Accepted.
                </li>
                <li>
                    <strong>Net Growth vs Target</strong> <em>(Most Important!)</em>: If the thick green "Net Growth" line
                    is below the dashed green "Target" line, you're SHORT of your growth goal. This is the primary metric
                    to watch‚Äîit shows whether you'll actually achieve 30% team growth after accounting for departures.
                </li>
                <li>
                    <strong>Total vs Target</strong>: If the blue "Total" line is above the green "Target" line,
                    you're on track (assuming conversions happen). If below, you need more roles in the pipeline.
                </li>
                <li>
                    <strong>Projected vs Target</strong>: Shows if your current velocity will hit the target.
                    Orange above green = good pace. Orange below green = need to accelerate.
                </li>
                <li>
                    <strong>Net Growth = Total - Attrition</strong>: The thick green line shows this calculation visually.
                    You need to hire enough to cover attrition AND hit your growth target. Example: To grow by 53,
                    you must hire 97 people if 44 are leaving (53 + 44 = 97 total hires needed).
                </li>
            </ul>
        </div>

        <div class="detail-section">
            <div class="detail-label">üí° Interactive Features</div>
            <ul class="detail-list">
                <li>
                    <strong>Click legend items</strong> to show/hide specific lines. This helps focus on what matters most.
                </li>
                <li>
                    <strong>Hover over data points</strong> to see detailed tooltips with context and target gaps.
                </li>
                <li>
                    <strong>Click data points</strong> to see a detailed monthly breakdown of that specific month.
                </li>
            </ul>
        </div>

        <div class="detail-section">
            <div class="detail-label">üìä Cumulative vs Monthly Views</div>
            <div class="detail-value">
                <strong style="color: #28a745;">üìà Cumulative View (Default)</strong><br>
                Each point shows the <strong>running total up to that month</strong>, not just that month's additions.
                This is the standard view for tracking progress toward your year-end goal.<br>
                <em>Example:</em> If January shows "10" and February shows "15", you had 10 total hires by end of January,
                and 15 total hires by end of February (meaning 5 new hires in February).<br><br>

                <strong style="color: #007bff;">üìä Monthly View</strong><br>
                Each point shows <strong>only that month's individual count</strong>, not the running total.
                Use this view to understand month-by-month hiring patterns and identify which specific months
                contributed to being ahead or behind target.<br>
                <em>Example:</em> If January shows "10" and February shows "5", you hired 10 people in January
                and 5 additional people in February (15 total by February).<br><br>

                <strong>üí° When to Use Each View:</strong><br>
                ‚Ä¢ <strong>Cumulative:</strong> "Are we on track to hit our 53-hire target by December?"<br>
                ‚Ä¢ <strong>Monthly:</strong> "Why does January show +6 ahead of target? How many did we actually hire that month?"<br><br>

                <em>Toggle between views using the "üìä Monthly View" / "üìà Cumulative View" button above the chart.</em>
            </div>
        </div>

        <div class="detail-section">
            <div class="detail-label">üé® Pro Tip: Use Preset Views</div>
            <div class="detail-value">
                Too many lines? Use the preset view buttons to see focused views for different audiences:<br><br>

                <strong>üéØ Executive Summary</strong> (Board-Ready)<br>
                Shows: Accepted, Net Growth, Projected, Target, Attrition<br>
                <em>Perfect for: Board presentations, executive reviews</em><br><br>

                <strong>üìä Velocity</strong> (For Quick Status)<br>
                Shows: Accepted, Net Growth, Projected, Target<br>
                <em>Perfect for: Weekly stand-ups, quick check-ins</em><br><br>

                <strong>‚ö†Ô∏è Risk</strong> (All Factors)<br>
                Shows: Accepted, Net Growth, Projected, Attrition, Target<br>
                <em>Perfect for: Risk assessment, contingency planning</em><br><br>

                Or manually hide lines by clicking the "üëÅÔ∏è Show/Hide Lines" button and toggling individual lines.
            </div>
        </div>
    `;

    modal.style.display = 'block';
}

// Toggle between cumulative and monthly view for Growth Chart
function toggleGrowthChartView(event) {
    if (event) {
        event.stopPropagation();
        event.preventDefault();
    }

    // Toggle the view mode
    growthChartViewMode = growthChartViewMode === 'cumulative' ? 'monthly' : 'cumulative';

    // Update button text
    const btn = document.getElementById('viewToggleBtn');
    if (growthChartViewMode === 'cumulative') {
        btn.textContent = 'üìä Monthly View';
        btn.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
    } else {
        btn.textContent = 'üìà Cumulative View';
        btn.style.background = 'linear-gradient(135deg, #007bff 0%, #0056b3 100%)';
    }

    // Rebuild the chart with the current filters
    if (growthChartMonthlyData && growthChartMonthlyData.data) {
        updateGrowthChart(growthChartMonthlyData.data);
    }

    // Update line toggle button states after chart is rebuilt
    // Projected (index 5) and Target (index 6) are only available in cumulative view
    setTimeout(() => {
        updateLineToggleButtonStates();
    }, 100);
}

// Update line toggle button states based on data availability
function updateLineToggleButtonStates() {
    if (!charts.growth) return;

    for (let i = 0; i < charts.growth.data.datasets.length; i++) {
        const dataset = charts.growth.data.datasets[i];
        const meta = charts.growth.getDatasetMeta(i);
        const btn = document.getElementById('lineToggle' + i);

        if (!btn) continue;

        // Check if dataset has no data
        const hasNoData = !dataset || !dataset.data ||
                         (Array.isArray(dataset.data) && dataset.data.every(val => val === null));

        if (hasNoData) {
            // Disable button visually
            btn.style.opacity = '0.3';
            btn.style.background = '#f8f9fa';
            btn.style.textDecoration = 'line-through';
            btn.style.cursor = 'not-allowed';
            btn.title = 'Not available in current view mode';
        } else {
            // Button is available - show current state
            btn.style.cursor = 'pointer';
            btn.title = '';
            if (meta.hidden) {
                btn.style.opacity = '0.3';
                btn.style.background = '#f8f9fa';
                btn.style.textDecoration = 'line-through';
            } else {
                btn.style.opacity = '1';
                btn.style.background = 'white';
                btn.style.textDecoration = 'none';
            }
        }
    }
}

// Toggle line controls panel visibility
function toggleLineControls(event) {
    if (event) {
        event.stopPropagation();
        event.preventDefault();
    }

    const panel = document.getElementById('lineControlsPanel');
    const btn = document.getElementById('lineToggleBtn');

    if (panel.style.display === 'none') {
        panel.style.display = 'block';
        btn.style.background = 'linear-gradient(135deg, #495057 0%, #343a40 100%)';
    } else {
        panel.style.display = 'none';
        btn.style.background = 'linear-gradient(135deg, #6c757d 0%, #495057 100%)';
    }
}

// Toggle individual chart line visibility
function toggleChartLine(datasetIndex) {
    if (!charts.growth) return;

    const dataset = charts.growth.data.datasets[datasetIndex];
    const meta = charts.growth.getDatasetMeta(datasetIndex);

    // Check if dataset has no data (e.g., Projected/Target in monthly view)
    if (!dataset || !dataset.data || (Array.isArray(dataset.data) && dataset.data.every(val => val === null))) {
        // Dataset has no data - button shouldn't do anything
        // Show visual feedback that it's unavailable
        const btn = document.getElementById('lineToggle' + datasetIndex);
        if (btn) {
            btn.style.opacity = '0.3';
            btn.style.background = '#f8f9fa';
            btn.style.textDecoration = 'line-through';
            btn.style.cursor = 'not-allowed';
            btn.title = 'Not available in current view mode';
        }
        return;
    }

    // Toggle using Chart.js standard approach (same as legend onClick)
    // If meta.hidden is null, set it to opposite of dataset.hidden
    // Otherwise, set it back to null (this toggles the visibility)
    meta.hidden = meta.hidden === null ? !dataset.hidden : null;

    // Update button appearance
    const btn = document.getElementById('lineToggle' + datasetIndex);
    if (btn) {
        btn.style.cursor = 'pointer';
        btn.title = '';

        // Determine actual visibility: if meta.hidden is null, use dataset.hidden
        const isHidden = meta.hidden === null ? dataset.hidden : meta.hidden;

        if (isHidden) {
            btn.style.opacity = '0.3';
            btn.style.background = '#f8f9fa';
            btn.style.textDecoration = 'line-through';
        } else {
            btn.style.opacity = '1';
            btn.style.background = 'white';
            btn.style.textDecoration = 'none';
        }
    }

    charts.growth.update();
}

// Toggle all lines on or off
function toggleAllLines(show) {
    if (!charts.growth) return;

    for (let i = 0; i < charts.growth.data.datasets.length; i++) {
        const meta = charts.growth.getDatasetMeta(i);
        meta.hidden = !show;

        // Update button appearance
        const btn = document.getElementById('lineToggle' + i);
        if (btn) {
            if (!show) {
                btn.style.opacity = '0.3';
                btn.style.background = '#f8f9fa';
                btn.style.textDecoration = 'line-through';
            } else {
                btn.style.opacity = '1';
                btn.style.background = 'white';
                btn.style.textDecoration = 'none';
            }
        }
    }

    charts.growth.update();
}

// Apply preset view configurations
function applyPresetView(presetName) {
    if (!charts.growth) return;

    // Define which lines to show for each preset
    // Line indices: 0=Accepted, 1=Pipeline, 2=Future, 3=Total, 4=Net Growth, 5=Projected, 6=Target, 7=Attrition
    const presets = {
        'executive': [0, 4, 5, 6, 7],     // Accepted, Net Growth, Projected, Target, Attrition (complete board story)
        'pipeline': [0, 1, 2, 6],         // Accepted, Pipeline, Future, Target (shows confirmed + pipeline vs target)
        'capacity': [3, 4, 7, 6],         // Total, Net Growth, Attrition, Target (headcount planning)
        'attrition': [0, 4, 7, 6],        // Accepted, Net Growth, Attrition, Target (attrition impact focus)
        'velocity': [0, 4, 5, 6],         // Accepted, Net Growth, Projected, Target (hiring pace + net impact)
        'funnel': [0, 1, 2],              // Accepted, Pipeline, Future (pure pipeline stages)
        'risk': [0, 4, 5, 7, 6],          // Accepted, Net Growth, Projected, Attrition, Target (all risk factors)
        'realistic': [0, 1, 4, 6]         // Accepted, Pipeline, Net Growth, Target (most likely outcome)
    };

    const linesToShow = presets[presetName];
    if (!linesToShow) return;

    // Hide all lines first, then show only the preset lines
    for (let i = 0; i < charts.growth.data.datasets.length; i++) {
        const meta = charts.growth.getDatasetMeta(i);
        const shouldShow = linesToShow.includes(i);
        meta.hidden = !shouldShow;

        // Update button appearance
        const btn = document.getElementById('lineToggle' + i);
        if (btn) {
            if (!shouldShow) {
                btn.style.opacity = '0.3';
                btn.style.background = '#f8f9fa';
                btn.style.textDecoration = 'line-through';
            } else {
                btn.style.opacity = '1';
                btn.style.background = 'white';
                btn.style.textDecoration = 'none';
            }
        }
    }

    charts.growth.update();
}

// Track table expansion state
let tableExpanded = false;
const INITIAL_ROWS_TO_SHOW = 10;

// Track active filters
let activeFilters = {
    search: '',
    status: '',
    champion: '',
    function: ''
};

// Apply table filters
function applyTableFilters() {
    activeFilters.search = document.getElementById('tableSearchBox').value.toLowerCase();
    activeFilters.status = document.getElementById('tableStatusFilter').value;
    activeFilters.champion = document.getElementById('tableChampionFilter').value;
    activeFilters.function = document.getElementById('tableFunctionFilter').value;

    // Update filter summary
    updateFilterSummary();

    // Re-render table with ALL roles (growth + backfills) - updateTable will apply activeFilters internally
    updateTable(getAllRoles());
}

// Clear all filters
function clearTableFilters() {
    document.getElementById('tableSearchBox').value = '';
    document.getElementById('tableStatusFilter').value = '';
    document.getElementById('tableChampionFilter').value = '';
    document.getElementById('tableFunctionFilter').value = '';

    activeFilters = {
        search: '',
        status: '',
        champion: '',
        function: ''
    };

    document.getElementById('filterSummary').style.display = 'none';
    updateTable(getAllRoles());
}

// Update filter summary display
function updateFilterSummary() {
    const summary = [];
    if (activeFilters.search) summary.push(`Search: "${activeFilters.search}"`);
    if (activeFilters.status) summary.push(`Status: ${activeFilters.status}`);
    if (activeFilters.champion) summary.push(`Champion: ${activeFilters.champion}`);
    if (activeFilters.function) summary.push(`Function: ${activeFilters.function}`);

    const summaryDiv = document.getElementById('filterSummary');
    const summaryText = document.getElementById('filterSummaryText');

    if (summary.length > 0) {
        summaryText.textContent = summary.join(' ‚Ä¢ ');
        summaryDiv.style.display = 'block';
    } else {
        summaryDiv.style.display = 'none';
    }
}

// Populate function filter dropdown
function populateFunctionFilter(data) {
    const functionSet = new Set();
    data.forEach(row => {
        if (row.function) functionSet.add(row.function);
    });

    const functionFilter = document.getElementById('tableFunctionFilter');
    functionFilter.innerHTML = '<option value="">All Functions</option>';

    Array.from(functionSet).sort().forEach(func => {
        const option = document.createElement('option');
        option.value = func;
        option.textContent = func;
        functionFilter.appendChild(option);
    });
}

// Update table
function updateTable(data) {
    const tbody = document.getElementById('pipelineTableBody');
    tbody.innerHTML = '';

    console.log('updateTable called with data length:', data ? data.length : 'undefined');
    console.log('activeFilters:', activeFilters);

    // Filter out deleted roles
    let visibleData = data.filter(row => !deletedRoles.has(row.id));
    console.log('After deleted filter:', visibleData.length);

    // Apply active filters
    if (activeFilters.search) {
        console.log('Applying search filter for:', activeFilters.search);
        visibleData = visibleData.filter(row =>
            (row.roleTitle && row.roleTitle.toLowerCase().includes(activeFilters.search)) ||
            (row.team && row.team.toLowerCase().includes(activeFilters.search)) ||
            (row.function && row.function.toLowerCase().includes(activeFilters.search)) ||
            (row.leadTC && row.leadTC.toLowerCase().includes(activeFilters.search)) ||
            (row.id && row.id.toLowerCase().includes(activeFilters.search))
        );
        console.log('After search filter:', visibleData.length);
    }

    if (activeFilters.status && activeFilters.status !== 'all') {
        visibleData = visibleData.filter(row =>
            row.roleStatus && row.roleStatus.includes(activeFilters.status)
        );
    }

    if (activeFilters.champion && activeFilters.champion !== 'all') {
        visibleData = visibleData.filter(row =>
            row.leadTC && row.leadTC === activeFilters.champion
        );
    }

    if (activeFilters.function && activeFilters.function !== 'all') {
        visibleData = visibleData.filter(row =>
            row.function && row.function === activeFilters.function
        );
    }

    // Determine how many rows to show
    const rowsToShow = tableExpanded ? visibleData.length : Math.min(INITIAL_ROWS_TO_SHOW, visibleData.length);
    const dataToDisplay = visibleData.slice(0, rowsToShow);

    dataToDisplay.forEach(row => {
        const tr = document.createElement('tr');

        // Add row state classes
        if (deletedRoles.has(row.id)) tr.classList.add('row-deleted');
        else if (newRoles.has(row.id)) tr.classList.add('row-new');
        else if (changedRoles.has(row.id)) tr.classList.add('row-modified');

        // In edit mode, disable row click and make cells editable
        if (!editMode) {
            tr.onclick = () => handleRowClick(row);
            tr.style.cursor = 'pointer';
        }

        const statusClass = getStatusClass(row.roleStatus);
        const openDate = row.dateOpen ? new Date(row.dateOpen).toLocaleDateString() : 'TBD';
        const acceptDate = row.dateAccept ? new Date(row.dateAccept).toLocaleDateString() : 'TBD';
        const startDate = row.dateStart ? new Date(row.dateStart).toLocaleDateString() : 'TBD';

        // Calculate health indicator
        const health = calculateRoleHealth(row);
        const healthClass = `health-${health.status}`;
        const healthIcon = health.status === 'healthy' ? '‚úì' : health.status === 'at-risk' ? '‚ö†' : '‚ö†';

        if (editMode) {
            // Edit mode: make cells editable
            // SECURITY FIX: Escape all user-controlled data to prevent XSS
            tr.innerHTML = `
                <td>${escapeHtml(row.id) || 'N/A'}</td>
                <td class="editable-cell" onclick="makeEditable(this, '${escapeHtml(row.id)}', 'roleTitle', '${escapeHtml(row.roleTitle)}')"><strong>${escapeHtml(row.roleTitle) || 'N/A'}</strong></td>
                <td class="editable-cell" onclick="makeEditable(this, '${escapeHtml(row.id)}', 'roleStatus', '${escapeHtml(row.roleStatus)}')"><span class="status-badge ${statusClass}">${escapeHtml(row.roleStatus) || 'Unknown'}</span></td>
                <td><span class="health-badge ${healthClass}" title="${escapeHtml(health.factors.join(', '))}">${healthIcon} ${escapeHtml(health.label)}</span></td>
                <td class="editable-cell" onclick="makeEditable(this, '${escapeHtml(row.id)}', 'leadTC', '${escapeHtml(row.leadTC)}')">${escapeHtml(row.leadTC) || 'N/A'}</td>
                <td class="editable-cell" onclick="makeEditable(this, '${escapeHtml(row.id)}', 'function', '${escapeHtml(row.function)}')">${escapeHtml(row.function) || 'N/A'}</td>
                <td class="editable-cell" onclick="makeEditable(this, '${escapeHtml(row.id)}', 'team', '${escapeHtml(row.team)}')">${escapeHtml(row.team) || 'N/A'}</td>
                <td class="editable-cell" onclick="makeEditable(this, '${escapeHtml(row.id)}', 'dateOpen', '${row.dateOpen ? escapeHtml(row.dateOpen.toISOString()) : ''}')">${escapeHtml(openDate)}</td>
                <td class="editable-cell" onclick="makeEditable(this, '${escapeHtml(row.id)}', 'dateAccept', '${row.dateAccept ? escapeHtml(row.dateAccept.toISOString()) : ''}')">${escapeHtml(acceptDate)}</td>
                <td class="editable-cell" onclick="makeEditable(this, '${escapeHtml(row.id)}', 'dateStart', '${row.dateStart ? escapeHtml(row.dateStart.toISOString()) : ''}')">${escapeHtml(startDate)}</td>
                <td class="editable-cell" onclick="makeEditable(this, '${escapeHtml(row.id)}', 'geo', '${escapeHtml(row.geo)}')">${escapeHtml(row.geo) || 'N/A'}</td>
                <td class="row-actions">
                    <button class="btn-delete" onclick="deleteRole('${escapeHtml(row.id)}')">üóëÔ∏è</button>
                </td>
            `;
        } else {
            // View mode: regular display
            // SECURITY FIX: Escape all user-controlled data to prevent XSS
            const backfillBadge = row.__isBackfill
                ? '<span style="background: #ff6b35; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.7em; margin-left: 6px; font-weight: 600;">BACKFILL</span>'
                : '';
            tr.innerHTML = `
                <td>${escapeHtml(row.id) || 'N/A'}</td>
                <td><strong>${escapeHtml(row.roleTitle) || 'N/A'}</strong>${backfillBadge}</td>
                <td><span class="status-badge ${statusClass}">${escapeHtml(row.roleStatus) || 'Unknown'}</span></td>
                <td><span class="health-badge ${healthClass}" title="${escapeHtml(health.factors.join(', '))}">${healthIcon} ${escapeHtml(health.label)}</span></td>
                <td>${escapeHtml(row.leadTC) || 'N/A'}</td>
                <td>${escapeHtml(row.function) || 'N/A'}</td>
                <td>${escapeHtml(row.team) || 'N/A'}</td>
                <td>${escapeHtml(openDate)}</td>
                <td>${escapeHtml(acceptDate)}</td>
                <td>${escapeHtml(startDate)}</td>
                <td>${escapeHtml(row.geo) || 'N/A'}</td>
            `;
        }

        tbody.appendChild(tr);
    });

    // Add "Show More/Less" button if there are more rows
    if (visibleData.length > INITIAL_ROWS_TO_SHOW) {
        const buttonRow = document.createElement('tr');
        buttonRow.classList.add('show-more-row');
        buttonRow.innerHTML = `
            <td colspan="11" style="text-align: center; padding: 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-top: 2px solid #dee2e6;">
                <button onclick="toggleTableExpansion()" style="
                    padding: 12px 24px;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    border: none;
                    border-radius: 8px;
                    cursor: pointer;
                    font-weight: 600;
                    font-size: 14px;
                    transition: all 0.2s ease;
                    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.4)'"
                   onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(102, 126, 234, 0.3)'">
                    ${tableExpanded ? '‚ñ≤ Show Less' : `‚ñº Show ${visibleData.length - INITIAL_ROWS_TO_SHOW} More Roles`}
                </button>
            </td>
        `;
        tbody.appendChild(buttonRow);
    }
}

// Toggle table expansion
function toggleTableExpansion() {
    tableExpanded = !tableExpanded;
    updateTable(currentData); // Re-render the table
}

// Get status badge class
function getStatusClass(status) {
    if (!status) return 'status-open';
    if (status.includes('Accepted')) return 'status-accepted';
    if (status.includes('Future')) return 'status-future';
    if (status.includes('Pipeline')) return 'status-pipeline';
    if (status.includes('On Hold')) return 'status-onhold';
    if (status.includes('Cancelled')) return 'status-cancelled';
    return 'status-open';
}

// Sort table
let sortDirection = {};
function sortTable(column) {
    const direction = sortDirection[column] === 'asc' ? 'desc' : 'asc';
    sortDirection[column] = direction;

    const filteredData = getFilteredData();

    filteredData.sort((a, b) => {
        let aVal, bVal;

        switch(column) {
            case 'id': aVal = a.id; bVal = b.id; break;
            case 'role': aVal = a.roleTitle; bVal = b.roleTitle; break;
            case 'status': aVal = a.roleStatus; bVal = b.roleStatus; break;
            case 'health':
                aVal = calculateRoleHealth(a).score;
                bVal = calculateRoleHealth(b).score;
                break;
            case 'champion': aVal = a.leadTC; bVal = b.leadTC; break;
            case 'function': aVal = a.function; bVal = b.function; break;
            case 'team': aVal = a.team; bVal = b.team; break;
            case 'open': aVal = a.dateOpen; bVal = b.dateOpen; break;
            case 'accept': aVal = a.dateAccept; bVal = b.dateAccept; break;
            case 'start': aVal = a.dateStart; bVal = b.dateStart; break;
            case 'geo': aVal = a.geo; bVal = b.geo; break;
            default: return 0;
        }

        if (aVal < bVal) return direction === 'asc' ? -1 : 1;
        if (aVal > bVal) return direction === 'asc' ? 1 : -1;
        return 0;
    });

    updateTable(filteredData);
}


// ============================================
// INTERACTIVE TILE FUNCTIONALITY
// ============================================

// Handle metric card clicks
function handleMetricClick(type, value) {
    if (type === 'total') {
        // Reset all filters (including date to show all months)
        currentFilters = {
            champion: 'all',
            function: 'all',
            status: 'all',
            date: ''
        };
        document.getElementById('championFilter').value = 'all';
        document.getElementById('functionFilter').value = 'all';
        document.getElementById('statusFilter').value = 'all';
        document.getElementById('dateFilter').value = '';
        updateDashboard();

        // Show modal with breakdown
        showTotalHiresModal();
    } else if (type === 'status') {
        // Apply status filter
        currentFilters.status = value;
        document.getElementById('statusFilter').value = value;
        updateDashboard();

        // Highlight active card
        highlightActiveCard(value);

        // Scroll to table
        document.querySelector('.pipeline-table').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
}

// Highlight active filter card
function highlightActiveCard(status) {
    // Remove all active classes
    document.querySelectorAll('.metric-card').forEach(card => {
        card.classList.remove('active-filter');
    });

    // Add active class to clicked card
    const activeCard = document.querySelector(`[data-filter-value="${status}"]`);
    if (activeCard) {
        activeCard.classList.add('active-filter');
        activeCard.classList.add('pulse');
        setTimeout(() => activeCard.classList.remove('pulse'), 2000);
    }
}

// Handle prediction metric click
function handlePredictionClick() {
    const prediction = calculatePredictiveTargeting(hiringData);

    const modal = document.getElementById('detailModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');

    modalTitle.textContent = 'üéØ Target Achievement Prediction';

    // Calculate health breakdown
    const healthBreakdown = hiringData.reduce((acc, role) => {
        const health = calculateRoleHealth(role);
        acc[health.status] = (acc[health.status] || 0) + 1;
        return acc;
    }, {});

    modalBody.innerHTML = `
        <div style="margin-bottom: 20px;">
            <h3 style="color: #ff6b35; margin-bottom: 10px;">üìä 2026 Prediction Analysis</h3>
            <p style="margin-bottom: 10px; font-size: 1.2em;"><strong>Probability of Hitting 30% Growth Target:</strong> <span style="color: #ff6b35; font-size: 1.3em;">${prediction.probability}%</span></p>

            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <p style="margin-bottom: 5px;"><strong>2026 Growth Target:</strong> ${prediction.targetGrowth} hires (30% increase on 177 baseline)</p>
                <p style="margin-bottom: 5px;"><strong>Current 2026 Progress:</strong> ${prediction.currentAccepted} accepted/started (${Math.round((prediction.currentAccepted / prediction.targetGrowth) * 100)}%)</p>
                <p style="margin-bottom: 5px;"><strong>Projected by End 2026:</strong> ${prediction.projectedTotal} hires</p>
                <p style="margin-bottom: 0px;"><strong>Still Need to Accept:</strong> ${prediction.needsToHire} more offers</p>
            </div>

            <div style="background: #fff3cd; padding: 12px; border-radius: 8px; border-left: 4px solid #ff6b35; margin-bottom: 15px;">
                <p style="margin: 0; font-size: 0.95em;"><strong>üìå Note:</strong> The probability measures likelihood of hitting the <strong>53 growth target</strong> in 2026. This is separate from attrition replacement hiring.</p>
            </div>

            <p style="margin-bottom: 5px;"><strong>Expected 2026 Attrition:</strong> ${prediction.totalAttrition} departures</p>
            <p style="margin-bottom: 5px; color: #666;"><strong>Total Hiring Activity Needed:</strong> ${prediction.totalHiringNeed} hires (${prediction.targetGrowth} growth + ${prediction.totalAttrition} replacement)</p>

            <hr style="margin: 15px 0; border: none; border-top: 1px solid #ddd;">

            <p style="margin-bottom: 5px; font-size: 0.9em;"><strong>Hiring Velocity:</strong> ${prediction.velocity} hires/day</p>
            <p style="margin-bottom: 5px; font-size: 0.9em;"><strong>Days Until End of 2026:</strong> ${prediction.daysRemaining}</p>
        </div>

        <div style="margin-bottom: 20px;">
            <h3 style="color: #ff6b35; margin-bottom: 10px;">üíö Pipeline Health</h3>
            <p style="margin-bottom: 5px;"><strong>Healthy Roles:</strong> ${healthBreakdown.healthy || 0} ‚úì</p>
            <p style="margin-bottom: 5px;"><strong>At Risk Roles:</strong> ${healthBreakdown['at-risk'] || 0} ‚ö†</p>
            <p style="margin-bottom: 5px;"><strong>Critical Roles:</strong> ${healthBreakdown.critical || 0} ‚ö†</p>
        </div>

        <div>
            <h3 style="color: #ff6b35; margin-bottom: 10px;">üìà Breakdown by Status</h3>
            <p style="margin-bottom: 5px;"><strong>Offers Accepted:</strong> ${prediction.currentAccepted}</p>
            <p style="margin-bottom: 5px;"><strong>Pipeline Open:</strong> ${prediction.currentPipeline} (contributing ~${Math.round(prediction.currentPipeline * 0.8)} projected)</p>
            <p style="margin-bottom: 5px;"><strong>Future Roles:</strong> ${prediction.currentFuture} (contributing ~${Math.round(prediction.currentFuture * 0.6)} projected)</p>
        </div>

        <div style="margin-top: 20px; padding: 15px; background: #fff5f0; border-left: 4px solid #ff6b35; border-radius: 5px;">
            <p style="margin: 0;"><strong>Insight:</strong> ${
                prediction.probability >= 85
                    ? 'üéâ Excellent! On track to exceed target.'
                    : prediction.probability >= 70
                    ? '‚úì Good progress. Continue current momentum.'
                    : prediction.probability >= 55
                    ? '‚ö† Moderate risk. Consider accelerating pipeline.'
                    : '‚ö† High risk. Immediate action needed to hit target.'
            }</p>
        </div>
    `;

    modal.style.display = 'flex';
}

// Handle attrition metric click
function handleAttritionClick() {
    const modal = document.getElementById('detailModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');

    modalTitle.textContent = 'üìâ Expected Attrition Analysis';

    // Calculate monthly breakdown
    let monthlyBreakdown = '';
    if (attritionData && attritionData.length > 0) {
        attritionData.forEach(item => {
            const monthName = item.date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            monthlyBreakdown += `<p style="margin-bottom: 5px;"><strong>${monthName}:</strong> ${Math.abs(item.count)} departures</p>`;
        });
    } else {
        monthlyBreakdown = '<p style="color: #999;">No attrition data available</p>';
    }

    const totalAttrition = attritionData.reduce((sum, item) => sum + Math.abs(item.count), 0);
    const growthTarget = 53; // 30% growth target for 2026
    const netHiringTarget = growthTarget + totalAttrition;

    modalBody.innerHTML = `
        <div style="margin-bottom: 20px;">
            <h3 style="color: #ff6b35; margin-bottom: 10px;">üìä 2026 Attrition Forecast</h3>
            <p style="margin-bottom: 5px;"><strong>Total Expected Attrition:</strong> ${totalAttrition} people</p>
            <p style="margin-bottom: 5px;"><strong>Growth Target (Net New):</strong> ${growthTarget} hires</p>
            <p style="margin-bottom: 5px; font-size: 1.1em; color: #ff6b35;"><strong>Total Hires Needed:</strong> ${netHiringTarget} (${totalAttrition} replacement + ${growthTarget} growth)</p>
        </div>

        <div style="margin-bottom: 20px;">
            <h3 style="color: #ff6b35; margin-bottom: 10px;">üìÖ Monthly Breakdown</h3>
            ${monthlyBreakdown}
        </div>

        <div style="margin-top: 20px; padding: 15px; background: #fff5f0; border-left: 4px solid #ff6b35; border-radius: 5px;">
            <p style="margin: 0;"><strong>Note:</strong> Attrition creates replacement hiring needs in addition to growth targets. Total hiring capacity must account for both.</p>
        </div>
    `;

    modal.style.display = 'flex';
}

// Handle growth target click
function handleGrowthTargetClick() {
    const modal = document.getElementById('detailModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');

    const data = hiringData;
    const totalHires = data.filter(r => r.roleStatus !== 'Cancelled').length;
    const offersAccepted = data.filter(r => r.roleStatus === 'Offer Accepted' || r.roleStatus === 'Started').length;

    // Count unique role titles for Pipeline Open (consistent with dashboard cards)
    const pipelineOpenRoles = data.filter(r => r.roleStatus === 'Pipeline Open');
    const pipelineOpen = new Set(pipelineOpenRoles.map(r => r.roleTitle || 'Untitled Role')).size;

    // Count Future roles from visualization data (NOT from Hiring Master)
    const futureRoles = window.visualizationData && window.visualizationData.monthlyFuture
        ? window.visualizationData.monthlyFuture.reduce((sum, count) => sum + count, 0)
        : 0;

    // From Team Planning Dashboard
    const growthTarget = CONFIG.GROWTH_TARGET;

    // Calculate 2026 roles only (starting in 2026)
    const roles2026 = hiringData.filter(r => {
        if (r.roleStatus === 'Cancelled') return false;
        if (!r.dateStart) return true; // Include future roles without start dates
        const startYear = new Date(r.dateStart).getFullYear();
        return startYear >= 2026;
    });
    const totalRolesPlanned = roles2026.length; // Should be ~80 for 2026

    // Filter accepted offers for 2026 (includes both Offer Accepted and Started)
    const acceptedFor2026 = roles2026.filter(r => r.roleStatus === 'Offer Accepted' || r.roleStatus === 'Started').length;
    const growthProgress = Math.min((acceptedFor2026 / growthTarget) * 100, 100);
    const gap = Math.max(0, growthTarget - acceptedFor2026);

    // Calculate monthly breakdown
    const monthlyData = {};
    data.forEach(role => {
        if (role.dateStart) {
            const month = new Date(role.dateStart).toLocaleString('default', { month: 'short', year: 'numeric' });
            monthlyData[month] = (monthlyData[month] || 0) + 1;
        }
    });

    modalTitle.textContent = 'üìà 30% Growth Target Analysis';

    modalBody.innerHTML = `
        <div style="margin-bottom: 20px;">
            <h3 style="color: #ff6b35; margin-bottom: 10px;">üéØ 2026 Growth Target (from Team Planning)</h3>
            <p style="margin-bottom: 5px;"><strong>Baseline Headcount (Start of 2026):</strong> ${baselineHeadcount} employees</p>
            <p style="margin-bottom: 5px;"><strong>30% Growth Target for 2026:</strong> ${growthTarget} hires</p>
            <p style="margin-bottom: 5px;"><strong>Total 2026 Vacancies Planned:</strong> ${totalRolesPlanned} roles (${((totalRolesPlanned/baselineHeadcount)*100).toFixed(1)}% growth)</p>
            <p style="margin-bottom: 5px;"><strong>Offers Accepted for 2026 Starts:</strong> ${acceptedFor2026} / ${growthTarget} (${growthProgress.toFixed(1)}%)</p>
            <p style="margin-bottom: 5px; font-size: 0.9em; color: #666;"><em>Includes offers accepted now for roles starting in 2026</em></p>
            <p style="margin-bottom: 5px;"><strong>Still Need to Accept (to hit 30%):</strong> ${gap} offers</p>
            <p style="margin-bottom: 5px; color: ${totalRolesPlanned > growthTarget ? '#28a745' : '#6c757d'};"><strong>Note:</strong> Planning ${totalRolesPlanned - growthTarget} additional roles beyond 30% target</p>
        </div>

        <div style="margin-bottom: 20px;">
            <h3 style="color: #ff6b35; margin-bottom: 10px;">üìä Pipeline Status</h3>
            <p style="margin-bottom: 5px;"><strong>Offers Accepted:</strong> ${offersAccepted} (${((offersAccepted/totalHires)*100).toFixed(0)}%)</p>
            <p style="margin-bottom: 5px;"><strong>Pipeline Open:</strong> ${pipelineOpen} (${((pipelineOpen/totalHires)*100).toFixed(0)}%)</p>
            <p style="margin-bottom: 5px;"><strong>Future Roles:</strong> ${futureRoles} (${((futureRoles/totalHires)*100).toFixed(0)}%)</p>
        </div>

        <div style="margin-bottom: 20px;">
            <h3 style="color: #ff6b35; margin-bottom: 10px;">üìÖ Monthly Hires Distribution</h3>
            <ul class="detail-list">
                ${Object.entries(monthlyData)
                    .sort((a, b) => new Date(a[0]) - new Date(b[0]))
                    .map(([month, count]) => `<li><strong>${month}:</strong> ${count} ${count === 1 ? 'hire' : 'hires'}</li>`)
                    .join('')}
            </ul>
        </div>

        <div style="margin-top: 20px; padding: 15px; background: #fff5f0; border-left: 4px solid #ff6b35; border-radius: 5px;">
            <p style="margin: 0;"><strong>Status:</strong> ${
                growthProgress >= 100
                    ? 'üéâ Target met! Consider stretch goals.'
                    : growthProgress >= 80
                    ? '‚úì Strong progress. On track to hit target.'
                    : growthProgress >= 60
                    ? '‚ö† Moderate progress. Need to accelerate to hit target.'
                    : '‚ö† Below target. Significant acceleration needed.'
            }</p>
        </div>
    `;

    modal.style.display = 'flex';
}

// Handle time to hire click
function handleTimeToHireClick() {
    const modal = document.getElementById('detailModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');

    const data = hiringData;

    // Calculate time to hire metrics (includes both Offer Accepted and Started)
    const rolesWithDates = data.filter(r => r.dateOpen && (r.roleStatus === 'Offer Accepted' || r.roleStatus === 'Started'));

    const timeToHireData = rolesWithDates.map(role => {
        const open = new Date(role.dateOpen);
        const accept = new Date(); // In real data, this would be dateAccept
        const days = Math.floor((accept - open) / (1000 * 60 * 60 * 24));
        return {
            role: role.roleTitle,
            champion: role.leadTC,
            days: days,
            function: role.function
        };
    });

    const avgTime = timeToHireData.length > 0
        ? Math.round(timeToHireData.reduce((sum, r) => sum + r.days, 0) / timeToHireData.length)
        : 0;

    // By champion
    const byChampion = {};
    timeToHireData.forEach(r => {
        if (!byChampion[r.champion]) byChampion[r.champion] = [];
        byChampion[r.champion].push(r.days);
    });

    const championAvgs = Object.entries(byChampion).map(([champ, days]) => ({
        champion: champ,
        avg: Math.round(days.reduce((a, b) => a + b, 0) / days.length),
        count: days.length
    })).sort((a, b) => a.avg - b.avg);

    // By function
    const byFunction = {};
    timeToHireData.forEach(r => {
        if (!byFunction[r.function]) byFunction[r.function] = [];
        byFunction[r.function].push(r.days);
    });

    const functionAvgs = Object.entries(byFunction).map(([func, days]) => ({
        function: func,
        avg: Math.round(days.reduce((a, b) => a + b, 0) / days.length),
        count: days.length
    })).sort((a, b) => a.avg - b.avg);

    modalTitle.textContent = '‚è± Time to Hire Analysis';

    modalBody.innerHTML = `
        <div style="margin-bottom: 20px;">
            <h3 style="color: #ff6b35; margin-bottom: 10px;">üìä Overall Metrics</h3>
            <p style="margin-bottom: 5px;"><strong>Average Time to Hire:</strong> ${avgTime} days</p>
            <p style="margin-bottom: 5px;"><strong>Roles Analyzed:</strong> ${timeToHireData.length} (accepted offers)</p>
            <p style="margin-bottom: 5px;"><strong>Fastest Fill:</strong> ${Math.min(...timeToHireData.map(r => r.days))} days</p>
            <p style="margin-bottom: 5px;"><strong>Slowest Fill:</strong> ${Math.max(...timeToHireData.map(r => r.days))} days</p>
        </div>

        <div style="margin-bottom: 20px;">
            <h3 style="color: #ff6b35; margin-bottom: 10px;">üë§ By Talent Champion</h3>
            <ul class="detail-list">
                ${championAvgs.map(c => `
                    <li>
                        <strong>${c.champion}:</strong> ${c.avg} days avg (${c.count} ${c.count === 1 ? 'role' : 'roles'})
                        ${c.avg < avgTime ? '<span style="color: #43e97b;">‚úì Faster</span>' : c.avg > avgTime ? '<span style="color: #ff6b35;">‚ö† Slower</span>' : ''}
                    </li>
                `).join('')}
            </ul>
        </div>

        <div style="margin-bottom: 20px;">
            <h3 style="color: #ff6b35; margin-bottom: 10px;">üéØ By Function</h3>
            <ul class="detail-list">
                ${functionAvgs.map(f => `
                    <li>
                        <strong>${f.function}:</strong> ${f.avg} days avg (${f.count} ${f.count === 1 ? 'role' : 'roles'})
                    </li>
                `).join('')}
            </ul>
        </div>

        <div style="margin-top: 20px; padding: 15px; background: #fff5f0; border-left: 4px solid #ff6b35; border-radius: 5px;">
            <p style="margin: 0;"><strong>Benchmark:</strong> ${
                avgTime < 60
                    ? 'üéâ Excellent! Well below industry average (60-90 days).'
                    : avgTime < 90
                    ? '‚úì Good pace. Within industry average range.'
                    : '‚ö† Consider process improvements to reduce time to hire.'
            }</p>
        </div>
    `;

    modal.style.display = 'flex';
}

// Handle timeline chart click
function handleTimelineClick(monthKey, data) {
    const modal = document.getElementById('detailModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');

    // Filter roles for this month
    const monthRoles = data.filter(role => {
        if (role.dateStart) {
            const date = new Date(role.dateStart);
            const roleMonthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
            return roleMonthKey === monthKey;
        }
        return false;
    });

    // Format month for display
    const [year, month] = monthKey.split('-');
    const monthName = new Date(year, parseInt(month) - 1).toLocaleString('default', { month: 'long', year: 'numeric' });
    const monthIndex = parseInt(month) - 1; // 0-indexed for visualization data

    // Get Future roles from visualization sheet for this month
    const visualFutureRoles = window.visualizationData && window.visualizationData.monthlyRoleNames && window.visualizationData.monthlyRoleNames[monthIndex]
        ? window.visualizationData.monthlyRoleNames[monthIndex]
        : [];
    const visualFutureCount = visualFutureRoles.reduce((sum, role) => sum + role.count, 0);

    // Group by status
    const byStatus = {};
    monthRoles.forEach(role => {
        const status = role.roleStatus || 'Unknown';
        if (!byStatus[status]) byStatus[status] = [];
        byStatus[status].push(role);
    });

    // Group by function
    const byFunction = {};
    monthRoles.forEach(role => {
        const func = role.function || 'Unknown';
        if (!byFunction[func]) byFunction[func] = [];
        byFunction[func].push(role);
    });

    // Group by champion
    const byChampion = {};
    monthRoles.forEach(role => {
        const champ = role.leadTC || 'Unknown';
        if (!byChampion[champ]) byChampion[champ] = [];
        byChampion[champ].push(role);
    });

    modalTitle.textContent = `üìÖ ${monthName} - Monthly Details`;

    modalBody.innerHTML = `
        <div style="margin-bottom: 20px;">
            <h3 style="color: #ff6b35; margin-bottom: 10px;">üìä Overview</h3>
            <p style="margin-bottom: 5px;"><strong>Total Hires This Month (Hiring Master):</strong> ${monthRoles.length}</p>
            ${visualFutureCount > 0 ? `<p style="margin-bottom: 5px; color: #9b59b6;"><strong>Future Roles Planned (Timeline):</strong> ${visualFutureCount}</p>` : ''}
        </div>

        <div style="margin-bottom: 20px;">
            <h3 style="color: #ff6b35; margin-bottom: 10px;">üìã By Status</h3>
            <ul class="detail-list">
                ${Object.entries(byStatus).map(([status, roles]) => `
                    <li>
                        <strong>${status}:</strong> ${roles.length}
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            ${roles.map(r => `<li onclick="showRoleDetailById('${r.id}')" style="cursor: pointer; font-size: 0.9em; padding: 5px; border-radius: 3px; transition: background 0.2s;" onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='transparent'">${r.roleTitle} (${r.leadTC}) <span style="color: #ff6b35;">‚Üí</span></li>`).join('')}
                        </ul>
                    </li>
                `).join('')}
            </ul>
        </div>

        <div style="margin-bottom: 20px;">
            <h3 style="color: #ff6b35; margin-bottom: 10px;">üéØ By Function</h3>
            <ul class="detail-list">
                ${Object.entries(byFunction).map(([func, roles]) => `
                    <li><strong>${func}:</strong> ${roles.length}</li>
                `).join('')}
            </ul>
        </div>

        <div style="margin-bottom: 20px;">
            <h3 style="color: #ff6b35; margin-bottom: 10px;">üë§ By Talent Champion</h3>
            <ul class="detail-list">
                ${Object.entries(byChampion).map(([champ, roles]) => `
                    <li><strong>${champ}:</strong> ${roles.length}</li>
                `).join('')}
            </ul>
        </div>

        ${visualFutureCount > 0 ? `
        <div style="margin-bottom: 20px; border-top: 2px solid #9b59b6; padding-top: 20px;">
            <h3 style="color: #9b59b6; margin-bottom: 10px;">üìÖ Future Roles Planned for ${monthName} (${visualFutureCount} total)</h3>
            <p style="font-size: 0.9em; color: #666; margin-bottom: 15px; font-style: italic;">
                These roles are from the Hiring Plan timeline and haven't been added to Hiring Master yet.
            </p>
            <div style="background: white; border: 1px solid #9b59b6; border-radius: 8px; overflow: hidden;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead style="background: linear-gradient(135deg, #9b59b6 0%, #7b1fa2 100%); color: white;">
                        <tr>
                            <th style="padding: 10px; text-align: left;">Role</th>
                            <th style="padding: 10px; text-align: center; width: 80px;">Count</th>
                            <th style="padding: 10px; text-align: left;">Champion</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${visualFutureRoles.map((role, idx) => `
                            <tr style="background: ${idx % 2 === 0 ? '#fafafa' : 'white'};">
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">${role.name}</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: center;">
                                    ${role.count > 1
                                        ? `<span style="display: inline-block; padding: 4px 10px; border-radius: 4px; background: #9b59b6; color: white; font-size: 12px; font-weight: bold;">√ó${role.count}</span>`
                                        : '<span style="color: #999;">1</span>'}
                                </td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee; color: #666;">${role.champion}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        </div>
        ` : ''}
    `;

    modal.style.display = 'flex';
}

// Handle growth chart click
function handleGrowthChartClick(cumulativeCounts, targetGrowth, months) {
    const modal = document.getElementById('detailModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');

    const currentTotal = cumulativeCounts.length > 0 ? cumulativeCounts[cumulativeCounts.length - 1] : 0;
    const progress = ((currentTotal / targetGrowth) * 100).toFixed(1);
    const gap = Math.max(0, targetGrowth - currentTotal);

    // Calculate velocity
    const monthsElapsed = months.length;
    const velocity = monthsElapsed > 0 ? (currentTotal / monthsElapsed).toFixed(2) : 0;
    const projectedFinal = monthsElapsed > 0 ? Math.round(currentTotal + (velocity * (12 - monthsElapsed))) : 0;

    // Monthly breakdown with cumulative
    const monthlyBreakdown = months.map((month, index) => {
        const [year, monthNum] = month.split('-');
        const monthName = new Date(year, parseInt(monthNum) - 1).toLocaleString('default', { month: 'short' });
        const monthlyCount = index === 0 ? cumulativeCounts[0] : cumulativeCounts[index] - cumulativeCounts[index - 1];
        return { month: monthName, cumulative: cumulativeCounts[index], monthly: monthlyCount };
    });

    modalTitle.textContent = 'üìà Growth Trajectory Analysis';

    const remainingMonths = 12 - monthsElapsed;
    const monthsNeeded = remainingMonths > 0 ? remainingMonths : 0;
    const remainingTarget = gap > 0 ? gap : 0;
    const neededVelocity = monthsNeeded > 0 ? (remainingTarget / monthsNeeded).toFixed(2) : 0;

    modalBody.innerHTML = `
        <div style="margin-bottom: 25px; padding: 15px; background: #f0f8ff; border-left: 4px solid #4a90e2; border-radius: 5px;">
            <p style="margin: 0 0 10px 0; font-size: 0.95em; color: #333;">
                <strong>What This Shows:</strong> Track your progress toward the 30% growth target (${targetGrowth} hires for 2026).
                See if you're on track based on current hiring velocity and get projections for year-end.
            </p>
        </div>

        <div style="margin-bottom: 20px;">
            <h3 style="color: #ff6b35; margin-bottom: 10px;">üéØ Progress to Target</h3>
            <p style="margin-bottom: 5px;"><strong>2026 Growth Target:</strong> ${targetGrowth} hires (30% growth from 177 baseline)</p>
            <p style="margin-bottom: 5px;"><strong>Offers Accepted for 2026 Starts:</strong> ${currentTotal} hires</p>
            <p style="margin-bottom: 5px;"><strong>Progress:</strong> ${progress}% of target achieved</p>
            <p style="margin-bottom: 5px;"><strong>Still Needed:</strong> ${gap} more offers to hit target</p>
        </div>

        <div style="margin-bottom: 20px;">
            <h3 style="color: #ff6b35; margin-bottom: 10px;">üìä Velocity & Projections</h3>
            <p style="margin-bottom: 5px;"><strong>Current Monthly Velocity:</strong> ${velocity} accepted offers/month</p>
            <p style="margin-bottom: 3px; padding-left: 20px; font-size: 0.9em; color: #666;">
                <em>How this is calculated: ${currentTotal} total accepted √∑ ${monthsElapsed} months = ${velocity} per month</em>
            </p>

            <p style="margin-bottom: 5px; margin-top: 12px;"><strong>Months of Data:</strong> ${monthsElapsed} months tracked</p>

            <p style="margin-bottom: 5px; margin-top: 12px;"><strong>Projected Year-End Total:</strong> ${projectedFinal} hires</p>
            <p style="margin-bottom: 3px; padding-left: 20px; font-size: 0.9em; color: #666;">
                <em>Projection: ${currentTotal} current + (${velocity} per month √ó ${12 - monthsElapsed} remaining months) = ${projectedFinal}</em>
            </p>

            <p style="margin-bottom: 5px; margin-top: 12px;"><strong>Status:</strong> ${projectedFinal >= targetGrowth ? '‚úì On track to hit target' : '‚ö† Below target pace'}</p>

            ${gap > 0 ? `
                <p style="margin-bottom: 5px; margin-top: 12px;"><strong>Velocity Needed:</strong> ${neededVelocity} accepted offers/month</p>
                <p style="margin-bottom: 3px; padding-left: 20px; font-size: 0.9em; color: #666;">
                    <em>To hit target: Need ${remainingTarget} more acceptances in ${monthsNeeded} remaining months</em>
                </p>
            ` : ''}
        </div>

        <div style="margin-bottom: 20px;">
            <h3 style="color: #ff6b35; margin-bottom: 10px;">üìÖ Monthly Breakdown</h3>
            <p style="margin-bottom: 10px; font-size: 0.9em; color: #666;">
                <strong>New:</strong> Offers accepted that month | <strong>Cumulative:</strong> Total accepted so far
            </p>
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #fff5f0;">
                        <th style="padding: 8px; text-align: left; border-bottom: 2px solid #ff6b35;">Month</th>
                        <th style="padding: 8px; text-align: right; border-bottom: 2px solid #ff6b35;">New</th>
                        <th style="padding: 8px; text-align: right; border-bottom: 2px solid #ff6b35;">Cumulative</th>
                    </tr>
                </thead>
                <tbody>
                    ${monthlyBreakdown.map(item => `
                        <tr>
                            <td style="padding: 8px; border-bottom: 1px solid #eee;">${item.month}</td>
                            <td style="padding: 8px; text-align: right; border-bottom: 1px solid #eee;">${item.monthly}</td>
                            <td style="padding: 8px; text-align: right; border-bottom: 1px solid #eee;"><strong>${item.cumulative}</strong></td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </div>

        <div style="margin-top: 20px; padding: 15px; background: #fff5f0; border-left: 4px solid #ff6b35; border-radius: 5px;">
            <p style="margin: 0 0 8px 0;"><strong>üí° What This Means:</strong></p>
            <p style="margin: 0;">${
                projectedFinal >= targetGrowth * 1.1
                    ? `üéâ <strong>Exceeding Target Pace!</strong> At your current velocity of ${velocity} accepted offers/month, you're projected to reach ${projectedFinal} hires - that's ${(projectedFinal - targetGrowth)} above the ${targetGrowth} target! Consider whether to maintain this pace or adjust your hiring goals.`
                    : projectedFinal >= targetGrowth
                    ? `‚úì <strong>On Track!</strong> Your current velocity of ${velocity} accepted offers/month is sufficient to hit the ${targetGrowth} target. You're projected to reach ${projectedFinal} hires by year-end. Keep up the current pace.`
                    : projectedFinal >= targetGrowth * 0.9
                    ? `‚ö† <strong>Slightly Below Target.</strong> At ${velocity} accepted offers/month, you're projected to reach ${projectedFinal} hires, which is ${gap} short of the ${targetGrowth} target. You need to increase velocity to ${neededVelocity} acceptances/month to close the gap.`
                    : `‚ö† <strong>Significant Gap.</strong> Current velocity of ${velocity} accepted offers/month projects ${projectedFinal} hires, falling ${gap} short of the ${targetGrowth} target. To hit target, you need ${neededVelocity} acceptances/month - nearly ${(neededVelocity - velocity).toFixed(2)} more per month. Consider accelerating pipeline activities.`
            }</p>
        </div>
    `;

    modal.style.display = 'flex';
}

// Show total hires breakdown modal
function showTotalHiresModal() {
    const modal = document.getElementById('detailModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');

    // Calculate breakdowns
    const data = hiringData;
    const byStatus = {};
    const byFunction = {};
    const byChampion = {};

    data.forEach(row => {
        // By status
        const status = row.roleStatus || 'Unknown';
        byStatus[status] = (byStatus[status] || 0) + 1;

        // By function
        const func = row.function || 'Unknown';
        byFunction[func] = (byFunction[func] || 0) + 1;

        // By champion
        const champ = row.leadTC || 'Unknown';
        byChampion[champ] = (byChampion[champ] || 0) + 1;
    });

    modalTitle.textContent = 'üìä Total Hires 2025-2026 - Complete Breakdown';
    modalBody.innerHTML = `
        <div class="detail-section">
            <div class="detail-label">Total Roles: ${data.length}</div>
        </div>

        <div class="detail-section">
            <div class="detail-label">By Status</div>
            <ul class="detail-list">
                ${Object.entries(byStatus).map(([status, count]) =>
                    `<li onclick="filterByStatus('${status}')" style="cursor: pointer;">
                        <strong>${status}:</strong> ${count} roles
                        <span style="float: right; color: #ff6b35;">‚Üí Click to filter</span>
                    </li>`
                ).join('')}
            </ul>
        </div>

        <div class="detail-section">
            <div class="detail-label">By Function</div>
            <ul class="detail-list">
                ${Object.entries(byFunction).map(([func, count]) =>
                    `<li onclick="filterByFunction('${func}')" style="cursor: pointer;">
                        <strong>${func}:</strong> ${count} roles
                        <span style="float: right; color: #ff6b35;">‚Üí Click to filter</span>
                    </li>`
                ).join('')}
            </ul>
        </div>

        <div class="detail-section">
            <div class="detail-label">By Talent Champion</div>
            <ul class="detail-list">
                ${Object.entries(byChampion).map(([champ, count]) =>
                    `<li onclick="filterByChampion('${champ}')" style="cursor: pointer;">
                        <strong>${champ}:</strong> ${count} roles
                        <span style="float: right; color: #ff6b35;">‚Üí Click to filter</span>
                    </li>`
                ).join('')}
            </ul>
        </div>
    `;

    modal.style.display = 'block';
}

// Show accepted + hired roles modal
function showAcceptedHiredModal() {
    const modal = document.getElementById('detailModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');

    // Get all accepted + hired roles
    const acceptedHired2026 = hiringData.filter(r => {
        if (r.roleStatus !== 'Offer Accepted' && r.roleStatus !== 'Started') return false;

        // Only count roles STARTING in 2026
        if (r.dateStart) {
            const startYear = new Date(r.dateStart).getFullYear();
            return startYear === 2026;
        }

        if (r.dateAccept) {
            const acceptYear = new Date(r.dateAccept).getFullYear();
            return acceptYear === 2026;
        }

        return false;
    });

    // Calculate breakdowns for 2026 roles
    const byFunction = {};
    const byStatus = {};

    acceptedHired2026.forEach(row => {
        const func = row.function || 'Unknown';
        byFunction[func] = (byFunction[func] || 0) + 1;

        const status = row.roleStatus || 'Unknown';
        byStatus[status] = (byStatus[status] || 0) + 1;
    });

    const total2025 = historical2025Data.hiresYTD?.total || 0;
    const total2026 = acceptedHired2026.length;
    const grandTotal = total2025 + total2026;

    modalTitle.textContent = '‚úÖ Accepted + Hired - Detailed Breakdown';
    modalBody.innerHTML = `
        <div class="detail-section">
            <h3 style="color: #ff6b35; margin-bottom: 15px;">üìä Summary</h3>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <strong>2025 Historical Hires:</strong>
                    <span style="font-size: 20px; color: #2ecc71;">${total2025}</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <strong>2026 Accepted/Started:</strong>
                    <span style="font-size: 20px; color: #3498db;">${total2026}</span>
                </div>
                <div style="border-top: 2px solid #ddd; padding-top: 10px; display: flex; justify-content: space-between;">
                    <strong style="font-size: 18px;">TOTAL:</strong>
                    <span style="font-size: 24px; color: #ff6b35; font-weight: bold;">${grandTotal}</span>
                </div>
            </div>
        </div>

        ${total2025 > 0 ? `
        <div class="detail-section">
            <h3 style="color: #2ecc71; margin-bottom: 10px;">üìÖ 2025 Historical Hires (${total2025})</h3>
            <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <p style="margin-bottom: 10px;"><strong>Source:</strong> 2025 - Hiring Planning.xlsx</p>
                <ul class="detail-list">
                    <li><strong>Product:</strong> ${historical2025Data.hiresYTD.product || 0} hires</li>
                    <li><strong>GTM:</strong> ${historical2025Data.hiresYTD.gtm || 0} hires</li>
                    <li><strong>Support:</strong> ${historical2025Data.hiresYTD.support || 0} hires</li>
                </ul>
                <p style="margin-top: 10px; color: #666; font-size: 14px;">
                    <em>Note: These are actual hires from 2025 that have already joined the company.</em>
                </p>
            </div>
        </div>
        ` : ''}

        <div class="detail-section">
            <h3 style="color: #3498db; margin-bottom: 10px;">üÜï 2026 Accepted/Started (${total2026})</h3>
            <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <p style="margin-bottom: 10px;"><strong>Source:</strong> PortSwigger Hiring Master - 2026 (1).xlsx</p>

                <div style="margin-bottom: 15px;">
                    <strong>By Status:</strong>
                    <ul class="detail-list">
                        ${Object.entries(byStatus).map(([status, count]) =>
                            `<li><strong>${status}:</strong> ${count} roles</li>`
                        ).join('')}
                    </ul>
                </div>

                <div>
                    <strong>By Function:</strong>
                    <ul class="detail-list">
                        ${Object.entries(byFunction).map(([func, count]) =>
                            `<li><strong>${func}:</strong> ${count} roles</li>`
                        ).join('')}
                    </ul>
                </div>
            </div>
        </div>

        <div class="detail-section">
            <h3 style="color: #ff6b35; margin-bottom: 10px;">üìã 2026 Role Details</h3>
            <div style="max-height: 400px; overflow-y: auto; background: white; border: 1px solid #ddd; border-radius: 8px;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead style="position: sticky; top: 0; background: #ff6b35; color: white;">
                        <tr>
                            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">Role</th>
                            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">Function</th>
                            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">Status</th>
                            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">Start Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${acceptedHired2026.map((role, idx) => `
                            <tr onclick="showRoleDetailById('${role.id}')" style="background: ${idx % 2 === 0 ? '#f8f9fa' : 'white'}; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='#e3f2fd'" onmouseout="this.style.background='${idx % 2 === 0 ? '#f8f9fa' : 'white'}'">
                                <td style="padding: 8px; border-bottom: 1px solid #eee;">${role.roleTitle || 'N/A'}</td>
                                <td style="padding: 8px; border-bottom: 1px solid #eee;">${role.function || 'N/A'}</td>
                                <td style="padding: 8px; border-bottom: 1px solid #eee;">
                                    <span style="padding: 3px 8px; border-radius: 4px; background: ${role.roleStatus === 'Started' ? '#2ecc71' : '#3498db'}; color: white; font-size: 12px;">
                                        ${role.roleStatus}
                                    </span>
                                </td>
                                <td style="padding: 8px; border-bottom: 1px solid #eee;">
                                    ${role.dateStart ? new Date(role.dateStart).toLocaleDateString('en-GB') : 'TBD'}
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        </div>

        <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ff6b35;">
            <strong>üí° How this is calculated:</strong>
            <ul style="margin-top: 10px; margin-left: 20px;">
                <li>2025 hires are pulled from the historical planning file (actual hires YTD)</li>
                <li>2026 roles include "Offer Accepted" and "Started" statuses from the master file</li>
                <li>This avoids double-counting by separating 2025 historical from 2026 pipeline</li>
            </ul>
        </div>
    `;

    modal.style.display = 'flex';
}

// Show monthly growth detail modal
function showMonthlyGrowthDetail(
    monthKey,
    monthIndex,
    datasetIndex,
    acceptedMonthlyData,
    pipelineMonthlyData,
    futureMonthlyData,
    attritionMonthlyData,
    cumulativeAcceptedCounts,
    cumulativePipelineCounts,
    cumulativeFutureCounts,
    cumulativeTotalCounts,
    cumulativeAttritionCounts,
    targetLine,
    forecastLine,
    allData
) {
    const modal = document.getElementById('detailModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');

    const datasetNames = [
        'Accepted + Started (2026)',
        'Pipeline Open (Starting)',
        'Future Roles (Starting)',
        'Total (All Starters)',
        'Projected (at current velocity)',
        '30% Target (53 hires)',
        'Expected Attrition'
    ];

    const monthName = new Date(monthKey + '-01').toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
    const clickedDataset = datasetNames[datasetIndex];

    // Get monthly and cumulative values
    const monthlyAccepted = acceptedMonthlyData[monthKey] || 0;
    const monthlyPipeline = pipelineMonthlyData[monthKey] || 0;
    const monthlyFuture = futureMonthlyData[monthKey] || 0;
    const monthlyAttrition = attritionMonthlyData[monthKey] || 0;

    const cumulativeAccepted = cumulativeAcceptedCounts[monthIndex];
    const cumulativePipeline = cumulativePipelineCounts[monthIndex];
    const cumulativeFuture = cumulativeFutureCounts[monthIndex];
    const cumulativeTotal = cumulativeTotalCounts[monthIndex];
    const cumulativeAttrition = cumulativeAttritionCounts[monthIndex];
    const targetValue = targetLine[monthIndex];
    const forecastValue = forecastLine[monthIndex];

    // Get actual roles for this month
    const rolesStartingThisMonth = allData.filter(r => {
        if (!r.dateStart) return false;
        const startDate = new Date(r.dateStart);
        const roleMonthKey = `${startDate.getFullYear()}-${String(startDate.getMonth() + 1).padStart(2, '0')}`;
        return roleMonthKey === monthKey;
    });

    const acceptedThisMonth = rolesStartingThisMonth.filter(r =>
        (r.roleStatus === 'Offer Accepted' || r.roleStatus === 'Started') &&
        new Date(r.dateStart).getFullYear() === 2026
    );
    const pipelineThisMonth = rolesStartingThisMonth.filter(r => r.roleStatus === 'Pipeline Open');

    // FIX: Get Future roles from BOTH visualization AND backfills
    const futureThisMonth = rolesStartingThisMonth.filter(r =>
        r.roleStatus === 'Future' || // Visualization roles
        r.roleStatus === 'Backfill - Not Opened' || // Backfills
        r.__type === 'visualization' || // Explicitly marked
        r.__isBackfill // Explicitly marked backfills
    );

    // Enhance with roles from visualization data (if available for this month)
    // Note: monthIndex is already available as a function parameter
    const visualFutureCount = window.visualizationData && window.visualizationData.monthlyFuture
        ? window.visualizationData.monthlyFuture[monthIndex] || 0
        : 0;

    // Calculate total unique Future roles for this month
    // Note: Hiring Master and Visualization sheet may have different roles (no overlap in most cases)
    // So total is likely the sum, but we show them separately to clarify data sources
    const totalFutureThisMonth = futureThisMonth.length + visualFutureCount;

    modalTitle.textContent = `üìä ${monthName} - Growth Detail`;
    modalBody.innerHTML = `
        <div style="margin-bottom: 20px;">
            <h3 style="color: #ff6b35; margin-bottom: 10px;">üìå You clicked: ${clickedDataset}</h3>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <p style="margin-bottom: 8px;"><strong>Month:</strong> ${monthName}</p>
                <p style="margin-bottom: 8px;"><strong>Value:</strong>
                    ${datasetIndex === 0 ? cumulativeAccepted :
                      datasetIndex === 1 ? cumulativePipeline :
                      datasetIndex === 2 ? cumulativeFuture :
                      datasetIndex === 3 ? cumulativeTotal :
                      datasetIndex === 4 ? forecastValue :
                      datasetIndex === 5 ? targetValue :
                      cumulativeAttrition}
                    ${datasetIndex === 6 ? 'departures' : 'hires'}
                </p>
            </div>
        </div>

        <div style="margin-bottom: 20px;">
            <h3 style="color: #ff6b35; margin-bottom: 10px;">üìà Monthly Activity (${monthName})</h3>
            <div style="background: #e3f2fd; padding: 15px; border-radius: 8px;">
                <p style="margin-bottom: 5px;"><strong>New Accepted/Started:</strong> ${monthlyAccepted} people</p>
                <p style="margin-bottom: 5px;"><strong>New Pipeline Open:</strong> ${monthlyPipeline} roles</p>
                <p style="margin-bottom: 5px;"><strong>New Future:</strong> ${monthlyFuture} roles</p>
                <p style="margin-bottom: 5px;"><strong>Attrition:</strong> ${monthlyAttrition} departures</p>
            </div>
        </div>

        <div style="margin-bottom: 20px;">
            <h3 style="color: #ff6b35; margin-bottom: 10px;">üìä Cumulative (Through ${monthName})</h3>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                <p style="margin-bottom: 5px;"><strong>Accepted + Started:</strong> ${cumulativeAccepted} total</p>
                <p style="margin-bottom: 5px;"><strong>Pipeline Open:</strong> ${cumulativePipeline} total</p>
                <p style="margin-bottom: 5px;"><strong>Future Roles:</strong> ${cumulativeFuture} total</p>
                <p style="margin-bottom: 5px;"><strong>Combined Total:</strong> ${cumulativeTotal} total</p>
                <p style="margin-bottom: 5px;"><strong>Target (by this month):</strong> ${targetValue} hires</p>
                <p style="margin-bottom: 5px;"><strong>Projected (at current velocity):</strong> ${forecastValue} hires</p>
                <p style="margin-bottom: 5px;"><strong>Cumulative Attrition:</strong> ${cumulativeAttrition} departures</p>
            </div>
        </div>

        <div style="margin-bottom: 20px;">
            <h3 style="color: #ff6b35; margin-bottom: 10px;">üéØ Progress vs Target</h3>
            <div style="background: ${cumulativeAccepted >= targetValue ? '#e8f5e9' : '#fff3cd'}; padding: 15px; border-radius: 8px;">
                <p style="margin-bottom: 5px;"><strong>Gap to Target:</strong> ${targetValue - cumulativeAccepted} hires ${cumulativeAccepted >= targetValue ? '(ahead!)' : '(behind)'}</p>
                <p style="margin-bottom: 5px;"><strong>% of Target:</strong> ${Math.round((cumulativeAccepted / targetValue) * 100)}%</p>
                <p style="margin-bottom: 5px;"><strong>On Track:</strong> ${cumulativeAccepted >= targetValue ? '‚úÖ Yes' : '‚ö†Ô∏è Needs acceleration'}</p>
            </div>
        </div>

        ${acceptedThisMonth.length > 0 ? `
        <div style="margin-bottom: 20px;">
            <h3 style="color: #ff6b35; margin-bottom: 10px;">üìã Accepted/Started Roles Starting in ${monthName} (${acceptedThisMonth.length})</h3>
            <div style="max-height: 300px; overflow-y: auto; background: white; border: 1px solid #ddd; border-radius: 8px;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead style="position: sticky; top: 0; background: #ff6b35; color: white;">
                        <tr>
                            <th style="padding: 8px; text-align: left;">Role</th>
                            <th style="padding: 8px; text-align: left;">Function</th>
                            <th style="padding: 8px; text-align: left;">Status</th>
                            <th style="padding: 8px; text-align: left;">Champion</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${acceptedThisMonth.map((role, idx) => `
                            <tr onclick="showRoleDetailById('${role.id}')" style="background: ${idx % 2 === 0 ? '#f8f9fa' : 'white'}; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='#e3f2fd'" onmouseout="this.style.background='${idx % 2 === 0 ? '#f8f9fa' : 'white'}'">
                                <td style="padding: 6px; border-bottom: 1px solid #eee;">${role.roleTitle || 'N/A'}</td>
                                <td style="padding: 6px; border-bottom: 1px solid #eee;">${role.function || 'N/A'}</td>
                                <td style="padding: 6px; border-bottom: 1px solid #eee;">
                                    <span style="padding: 2px 6px; border-radius: 3px; background: ${role.roleStatus === 'Started' ? '#2ecc71' : '#3498db'}; color: white; font-size: 11px;">
                                        ${role.roleStatus}
                                    </span>
                                </td>
                                <td style="padding: 6px; border-bottom: 1px solid #eee;">${role.leadTC || 'N/A'}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        </div>
        ` : ''}

        ${pipelineThisMonth.length > 0 ? `
        <div style="margin-bottom: 20px;">
            <h3 style="color: #f39c12; margin-bottom: 10px;">üìã Pipeline Open Roles Starting in ${monthName} (${pipelineThisMonth.length})</h3>
            <div style="max-height: 200px; overflow-y: auto; background: white; border: 1px solid #ddd; border-radius: 8px;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead style="position: sticky; top: 0; background: #f39c12; color: white;">
                        <tr>
                            <th style="padding: 8px; text-align: left;">Role</th>
                            <th style="padding: 8px; text-align: left;">Function</th>
                            <th style="padding: 8px; text-align: left;">Champion</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${pipelineThisMonth.map((role, idx) => `
                            <tr onclick="showRoleDetailById('${role.id}')" style="background: ${idx % 2 === 0 ? '#f8f9fa' : 'white'}; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='#fff3cd'" onmouseout="this.style.background='${idx % 2 === 0 ? '#f8f9fa' : 'white'}'">
                                <td style="padding: 6px; border-bottom: 1px solid #eee;">${role.roleTitle || 'N/A'}</td>
                                <td style="padding: 6px; border-bottom: 1px solid #eee;">${role.function || 'N/A'}</td>
                                <td style="padding: 6px; border-bottom: 1px solid #eee;">${role.leadTC || 'N/A'}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        </div>
        ` : ''}

        ${futureThisMonth.length > 0 || visualFutureCount > 0 ? `
        <div style="margin-bottom: 20px;">
            <h3 style="color: #9b59b6; margin-bottom: 10px;">üìã Future Roles Starting in ${monthName} (${totalFutureThisMonth})</h3>

            ${futureThisMonth.length > 0 ? `
            <div style="max-height: 200px; overflow-y: auto; background: white; border: 1px solid #ddd; border-radius: 8px; margin-bottom: ${visualFutureCount > 0 ? '15px' : '0'};">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead style="position: sticky; top: 0; background: #9b59b6; color: white;">
                        <tr>
                            <th style="padding: 8px; text-align: left;">Role</th>
                            <th style="padding: 8px; text-align: left;">Function</th>
                            <th style="padding: 8px; text-align: left;">Champion</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${futureThisMonth.map((role, idx) => `
                            <tr onclick="showRoleDetailById('${role.id}')" style="background: ${idx % 2 === 0 ? '#f8f9fa' : 'white'}; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='#f3e5f5'" onmouseout="this.style.background='${idx % 2 === 0 ? '#f8f9fa' : 'white'}'">
                                <td style="padding: 6px; border-bottom: 1px solid #eee;">${role.roleTitle || 'N/A'}</td>
                                <td style="padding: 6px; border-bottom: 1px solid #eee;">${role.function || 'N/A'}</td>
                                <td style="padding: 6px; border-bottom: 1px solid #eee;">${role.leadTC || 'N/A'}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
            ` : ''}

            ${visualFutureCount > 0 ? `
            <div style="background: white; border: 1px solid #9b59b6; border-radius: 8px; overflow: hidden;">
                <div style="padding: 12px 15px; background: linear-gradient(135deg, #9b59b6 0%, #7b1fa2 100%); color: white; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 20px;">üìÖ</span>
                    <strong style="font-size: 1em;">Timeline Planned Roles (${visualFutureCount} roles)</strong>
                </div>
                <div style="max-height: 200px; overflow-y: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead style="position: sticky; top: 0; background: #f3e5f5;">
                            <tr>
                                <th style="padding: 8px; text-align: left; border-bottom: 2px solid #9b59b6; color: #6a1b9a;">Role</th>
                                <th style="padding: 8px; text-align: left; border-bottom: 2px solid #9b59b6; color: #6a1b9a;">Count</th>
                                <th style="padding: 8px; text-align: left; border-bottom: 2px solid #9b59b6; color: #6a1b9a;">Champion</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${window.visualizationData && window.visualizationData.monthlyRoleNames && window.visualizationData.monthlyRoleNames[monthIndex]
                                ? window.visualizationData.monthlyRoleNames[monthIndex].map((role, idx) => `
                                <tr style="background: ${idx % 2 === 0 ? '#fafafa' : 'white'};">
                                    <td style="padding: 6px; border-bottom: 1px solid #eee;">${role.name}</td>
                                    <td style="padding: 6px; border-bottom: 1px solid #eee;">
                                        ${role.count > 1 ? `<span style="padding: 2px 6px; border-radius: 3px; background: #9b59b6; color: white; font-size: 11px; font-weight: bold;">√ó${role.count}</span>` : '1'}
                                    </td>
                                    <td style="padding: 6px; border-bottom: 1px solid #eee; color: #666;">${role.champion}</td>
                                </tr>
                            `).join('')
                                : '<tr><td colspan="3" style="padding: 10px; text-align: center; color: #999;">No role details available</td></tr>'}
                        </tbody>
                    </table>
                </div>
                <div style="padding: 10px 15px; background: #f9f9f9; border-top: 1px solid #eee; font-size: 0.85em; color: #666;">
                    <em>üí° These roles are from the Hiring Plan timeline and haven't been added to Hiring Master yet.</em>
                </div>
            </div>
            ` : ''}
        </div>
        ` : ''}

        <div style="margin-top: 20px; padding: 15px; background: #e3f2fd; border-radius: 8px; border-left: 4px solid #2196f3;">
            <strong>üí° Calculation Method:</strong>
            <ul style="margin-top: 10px; margin-left: 20px; font-size: 0.95em;">
                <li><strong>Monthly values</strong> = New roles with start dates in ${monthName}</li>
                <li><strong>Cumulative values</strong> = Total from Jan through ${monthName}</li>
                <li><strong>Target line</strong> = Linear progression to 53 hires by Dec 2026</li>
                <li><strong>Projected line</strong> = Current velocity extended to year end</li>
            </ul>
        </div>
    `;

    modal.style.display = 'flex';
}

// Filter functions from modal
function filterByStatus(status) {
    currentFilters.status = status;
    document.getElementById('statusFilter').value = status;
    updateDashboard();
    closeModal();
    document.querySelector('.pipeline-table').scrollIntoView({ behavior: 'smooth' });
}

function filterByFunction(func) {
    currentFilters.function = func;
    document.getElementById('functionFilter').value = func;
    updateDashboard();
    closeModal();
    document.querySelector('.pipeline-table').scrollIntoView({ behavior: 'smooth' });
}

function filterByChampion(champ) {
    currentFilters.champion = champ;
    document.getElementById('championFilter').value = champ;
    updateDashboard();
    closeModal();
    document.querySelector('.pipeline-table').scrollIntoView({ behavior: 'smooth' });
}

// Close modal
function closeModal() {
    document.getElementById('detailModal').style.display = 'none';
}

// Show metric information modal
function showMetricInfo(event, metricType) {
    // Prevent card click event from firing - stop both propagation and default behavior
    if (event) {
        event.stopPropagation();
        event.preventDefault();
        event.stopImmediatePropagation(); // Ensure no other handlers fire
    }

    const modal = document.getElementById('detailModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');

    const metricInfo = {
        totalRoles: {
            title: 'üìã Total Hires in Plan',
            description: 'This metric shows the GROSS total hiring demand for 2026, including both NET growth roles and backfill replacement roles.',
            dataSource: `
                <strong>Growth Roles:</strong><br>
                ‚Ä¢ File: PortSwigger Hiring Master - 2026 (1).xlsx<br>
                ‚Ä¢ Sheet: Hiring<br>
                ‚Ä¢ All rows with Role Status data<br><br>
                <strong>Backfill Roles:</strong><br>
                ‚Ä¢ Generated from: attrition expected.xlsx<br>
                ‚Ä¢ Each departure creates 1 backfill opening the month AFTER departure<br>
                ‚Ä¢ Total backfills: 44 roles (2026 attrition)
            `,
            calculation: `
                <strong>Calculation Logic:</strong>
                <ul class="detail-list">
                    <li><strong>Growth Roles:</strong> COUNT(roles WHERE status ‚â† "Cancelled") from Hiring Master</li>
                    <li><strong>Backfill Roles:</strong> COUNT(attrition departures) - opens month after departure</li>
                    <li><strong>TOTAL = Growth + Backfills</strong></li>
                    <li>Example: 53 growth roles + 44 backfills = 97 total hiring demand</li>
                    <li>Note: Backfills maintain headcount, growth roles increase it</li>
                </ul>
            `
        },
        acceptedHired: {
            title: '‚úÖ Accepted + Hired',
            description: 'This metric combines historical 2025 hires that have already started with 2026 roles that have accepted offers.',
            dataSource: `
                <strong>2025 Historical Hires:</strong><br>
                ‚Ä¢ File: 2025 - Hiring Planning.xlsx<br>
                ‚Ä¢ Sheet: Progress YTD<br>
                ‚Ä¢ Cell: Row 25 (Total YTD Hires)<br>
                ‚Ä¢ Value extracted: ${historical2025Data.hiresYTD?.total || 0} hires<br><br>
                <strong>2026 Accepted Offers:</strong><br>
                ‚Ä¢ File: PortSwigger Hiring Master - 2026 (1).xlsx<br>
                ‚Ä¢ Sheet: Hiring<br>
                ‚Ä¢ Column: Role Status = "Offer Accepted" OR "Started"
            `,
            calculation: `
                <strong>Calculation Logic:</strong>
                <ul class="detail-list">
                    <li>2025 YTD Hires (from historical data): ${historical2025Data.hiresYTD?.total || 0}</li>
                    <li>2026 Accepted Offers: COUNT(roles WHERE status = "Offer Accepted" OR "Started")</li>
                    <li><strong>Total = 2025 Hires + 2026 Accepted/Started</strong></li>
                    <li>This gives a running total of confirmed hires for growth tracking</li>
                </ul>
            `
        },
        accepted2026Only: {
            title: 'üéØ 2026 Starts Only',
            description: 'This metric shows ONLY roles with 2026 start dates (Accepted + Started status). Unlike "Accepted + Hired" which includes 2025 historical hires, this focuses exclusively on people joining in 2026.',
            dataSource: `
                <strong>File:</strong> PortSwigger Hiring Master - 2026 (1).xlsx<br>
                <strong>Sheet:</strong> Hiring<br>
                <strong>Columns:</strong> Role Status, Date_Start
            `,
            calculation: `
                <strong>Calculation Logic:</strong>
                <ul class="detail-list">
                    <li>Filter roles WHERE Role Status = "Offer Accepted" OR "Started"</li>
                    <li>AND Date_Start year = 2026</li>
                    <li>COUNT the filtered results</li>
                    <li><strong>Result:</strong> Pure 2026 starters (${accepted2026Only} roles)</li>
                </ul>
                <br>
                <strong>Why this metric matters:</strong>
                <ul class="detail-list">
                    <li>Shows actual 2026 headcount impact</li>
                    <li>Excludes 2025 hires who already joined</li>
                    <li>Tracks progress toward 30% growth target (${CONFIG.GROWTH_TARGET} hires)</li>
                    <li>Currently at ${Math.round((accepted2026Only / CONFIG.GROWTH_TARGET) * 100)}% of target</li>
                </ul>
            `
        },
        pipelineOpen: {
            title: 'üîÑ Pipeline Open',
            description: 'Number of unique role titles currently in active recruitment. This includes both growth roles and backfill roles that have opened for recruitment.',
            dataSource: '<strong>File:</strong> PortSwigger Hiring Master - 2026 (1).xlsx<br><strong>Sheet:</strong> Hiring<br><strong>Column:</strong> Role Status & Role Title<br><strong>Plus:</strong> Backfill roles with status transitioned to "Pipeline Open"',
            calculation: `
                <strong>Calculation Logic:</strong>
                <ul class="detail-list">
                    <li>Filter all roles where <code>Role Status</code> = "Pipeline Open"</li>
                    <li>Count unique <code>Role Title</code> values (not total openings)</li>
                    <li>Formula: COUNT(DISTINCT role titles WHERE status = "Pipeline Open")</li>
                    <li>Example: 3 "Product Engineer" openings = 1 unique pipeline</li>
                    <li><strong>Backfill Workflow:</strong> Backfills start as "Backfill - Not Opened", then transition to "Pipeline Open" when recruitment begins</li>
                    <li>This shows how many distinct roles are actively being recruited</li>
                </ul>
            `
        },
        futureRoles: {
            title: 'üìÖ Future Roles',
            description: 'Planned roles that have not yet been opened for recruitment. This includes BOTH growth roles (NEW positions) and backfill roles (REPLACEMENT positions for expected attrition).',
            dataSource: `
                <strong>Growth Future Roles:</strong><br>
                ‚Ä¢ File: Hiring Resources - Central Document (2).xlsx<br>
                ‚Ä¢ Sheet: Hiring Plan 2026 visualisation<br>
                ‚Ä¢ Parsed from multiplier notation (e.g., "Product Engineer x12" = 12 roles)<br>
                ‚Ä¢ These are NEW positions that increase headcount<br><br>
                <strong>Backfill Future Roles:</strong><br>
                ‚Ä¢ Generated from: attrition expected.xlsx<br>
                ‚Ä¢ Status: "Backfill - Not Opened"<br>
                ‚Ä¢ Each departure creates 1 backfill opening the month AFTER<br>
                ‚Ä¢ These REPLACE departing employees (maintain headcount)
            `,
            calculation: `
                <strong>Calculation Logic:</strong>
                <ul class="detail-list">
                    <li><strong>Growth Future Roles:</strong> SUM(visualization timeline monthly counts)</li>
                    <li><strong>Backfill Roles:</strong> COUNT(attrition departures with status "Backfill - Not Opened")</li>
                    <li><strong>TOTAL Future = Growth Future + Backfill</strong></li>
                    <li>Example: 46 growth future + 44 backfills = 90 total future roles</li>
                    <li><strong>Key Distinction:</strong> Growth increases headcount, backfills maintain it</li>
                    <li>All future roles will convert to "Pipeline Open" when recruitment starts</li>
                </ul>
            `
        },
        growthTarget: {
            title: 'üìà 30% Growth Target',
            description: 'The target number of NET new hires needed to achieve 30% headcount growth for 2026. This is GROWTH ONLY - backfills are NOT included in this target since they only maintain existing headcount.',
            dataSource: '<strong>Calculation:</strong> Based on organizational growth targets<br><strong>Baseline:</strong> 177 employees at start of 2026<br><strong>Target:</strong> 53 NET new hires (30% growth)',
            calculation: `
                <strong>Calculation Logic:</strong>
                <ul class="detail-list">
                    <li>Base calculation: 177 starting employees √ó 30% = 53 NET growth target</li>
                    <li><strong>This is NET growth, NOT total hiring demand</strong></li>
                    <li>Total hiring demand = 53 growth + 44 backfills = 97 GROSS hires</li>
                    <li>Backfills (44) maintain existing headcount, not counted toward growth</li>
                    <li>Growth roles (53) increase headcount from 177 ‚Üí 230</li>
                    <li>Progress bar shows: (Accepted Growth Hires) / 53 √ó 100%</li>
                </ul>
            `
        },
        targetProbability: {
            title: 'üéØ Target Probability',
            description: 'Statistical prediction of the likelihood that we will achieve the 30% growth target based on current pipeline health and historical conversion rates.',
            dataSource: '<strong>Analysis:</strong> Predictive calculation using current pipeline data<br><strong>Factors:</strong> Conversion rates, time remaining, pipeline velocity',
            calculation: `
                <strong>Calculation Logic:</strong>
                <ul class="detail-list">
                    <li><strong>Step 1:</strong> Calculate expected conversions from "Pipeline Open" roles</li>
                    <li>Apply estimated conversion rate (~80% offer acceptance)</li>
                    <li><strong>Step 2:</strong> Add current accepted offers</li>
                    <li><strong>Step 3:</strong> Factor in planned "Future" roles and expected timelines</li>
                    <li><strong>Step 4:</strong> Compare projected total vs growth target</li>
                    <li><strong>Result:</strong> Probability percentage = (Projected Hires / Target) √ó 100%</li>
                    <li>Color coding: Green (>80%), Yellow (60-80%), Red (<60%)</li>
                </ul>
            `
        },
        expectedAttrition: {
            title: 'üìâ Expected Attrition',
            description: 'Forecasted number of employees expected to leave the organization in 2026. Each departure AUTOMATICALLY generates a backfill role opening the month AFTER the departure to maintain headcount.',
            dataSource: '<strong>File:</strong> attrition expected.xlsx<br><strong>Data:</strong> Historical attrition trends and predictive modeling<br><strong>Impact:</strong> Generates replacement hiring needs (backfills)',
            calculation: `
                <strong>Calculation Logic:</strong>
                <ul class="detail-list">
                    <li>Based on historical attrition rates from previous years</li>
                    <li>Applies statistical modeling to predict 2026 departures</li>
                    <li>Loaded directly from attrition forecast file</li>
                    <li><strong>Backfill Generation:</strong> Each departure creates 1 backfill role</li>
                    <li>Backfill opens the month AFTER departure (e.g., March departure ‚Üí April opening)</li>
                    <li>Backfills assigned to "Misc Talent Champion" with status "Backfill - Not Opened"</li>
                    <li><strong>Impact on Hiring:</strong> 44 attrition = 44 backfill roles needed</li>
                    <li>Net Growth = Total Hires (Growth + Backfills) - Attrition</li>
                </ul>
            `
        }
    };

    const info = metricInfo[metricType];

    if (info) {
        modalTitle.textContent = info.title;
        modalBody.innerHTML = `
            <div class="detail-section">
                <div class="detail-label">üìä What This Metric Shows</div>
                <div class="detail-value">${info.description}</div>
            </div>
            <div class="detail-section">
                <div class="detail-label">üìÅ Data Source</div>
                <div class="detail-value">${info.dataSource}</div>
            </div>
            <div class="detail-section">
                <div class="detail-label">üßÆ Calculation Method</div>
                <div class="detail-value">${info.calculation}</div>
            </div>
        `;
        modal.style.display = 'block';
    }
}

// Show metric data (actual roles/records)
function showMetricData(event, metricType) {
    // Prevent info button click from also triggering this EXCEPT for metrics that don't have separate info content
    // (netGrowth and totalNeed show the same comprehensive modal for both card and info button clicks)
    if (event && event.target && event.target.classList.contains('info-button')) {
        if (metricType !== 'netGrowth' && metricType !== 'totalNeed' && metricType !== 'expectedAttrition') {
            return;
        }
    }

    const modal = document.getElementById('detailModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');

    let filteredData = [];
    let title = '';

    switch(metricType) {
        case 'total':
            title = 'üìã All Roles in Plan';
            filteredData = hiringData.filter(r => r.roleStatus && r.roleStatus !== 'Cancelled');
            break;
        case 'acceptedHired':
            title = '‚úÖ Accepted + Hired Roles';
            filteredData = hiringData.filter(r => r.roleStatus === 'Offer Accepted' || r.roleStatus === 'Started');
            modalBody.innerHTML = `
                <div class="detail-section">
                    <div class="detail-label">2025 Historical Hires</div>
                    <div class="detail-value">${historical2025Data.hiresYTD?.total || 0} hires completed in 2025 (from historical data)</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">2026 Accepted Offers (${filteredData.length} roles)</div>
                    ${generateRolesList(filteredData)}
                </div>
            `;
            modalTitle.textContent = title;
            modal.style.display = 'block';
            return;
        case 'accepted2026Only':
            title = 'üéØ 2026 Starts Only (Accepted + Started)';
            filteredData = hiringData.filter(r => {
                if (r.roleStatus !== 'Offer Accepted' && r.roleStatus !== 'Started') return false;
                if (!r.dateStart) return false;
                const startYear = new Date(r.dateStart).getFullYear();
                return startYear === 2026;
            });

            // Group by actual status with clear labels
            const acceptedNotYetStarted = filteredData.filter(r => r.roleStatus === 'Offer Accepted');
            const alreadyStarted = filteredData.filter(r => r.roleStatus === 'Started');

            // Group by function
            const byFunction2026 = {};
            filteredData.forEach(role => {
                const func = role.function || 'Unknown';
                if (!byFunction2026[func]) byFunction2026[func] = [];
                byFunction2026[func].push(role);
            });

            modalBody.innerHTML = `
                <div class="detail-section">
                    <div class="detail-label">Total Starting in 2026</div>
                    <div class="detail-value" style="font-size: 2em; color: #667eea;">${filteredData.length} roles</div>
                    <div style="margin-top: 10px; font-size: 0.9em; color: #666;">
                        ${alreadyStarted.length} already started ‚Ä¢ ${acceptedNotYetStarted.length} yet to start
                    </div>
                </div>

                <div class="detail-section">
                    <div class="detail-label">Breakdown by Current Status</div>

                    ${alreadyStarted.length > 0 ? `
                        <div style="margin-bottom: 20px; padding: 15px; background: #e8f5e9; border-radius: 8px; border-left: 4px solid #28a745;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <strong style="color: #28a745; font-size: 1.1em;">‚úÖ Already Started in 2026</strong>
                                <span style="background: #28a745; color: white; padding: 4px 12px; border-radius: 12px; font-weight: bold;">${alreadyStarted.length}</span>
                            </div>
                            <div style="color: #666; margin-bottom: 10px; font-size: 0.9em;">
                                These people have already joined the company in 2026
                            </div>
                            ${generateRolesList(alreadyStarted)}
                        </div>
                    ` : `
                        <div style="margin-bottom: 20px; padding: 15px; background: #f5f5f5; border-radius: 8px; border-left: 4px solid #999;">
                            <strong style="color: #666;">‚úÖ Already Started in 2026</strong>
                            <div style="color: #999; margin-top: 5px; font-size: 0.9em;">No one has started yet in 2026</div>
                        </div>
                    `}

                    ${acceptedNotYetStarted.length > 0 ? `
                        <div style="margin-bottom: 20px; padding: 15px; background: #e3f2fd; border-radius: 8px; border-left: 4px solid #667eea;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <strong style="color: #667eea; font-size: 1.1em;">üìÖ Accepted, Starting Later in 2026</strong>
                                <span style="background: #667eea; color: white; padding: 4px 12px; border-radius: 12px; font-weight: bold;">${acceptedNotYetStarted.length}</span>
                            </div>
                            <div style="color: #666; margin-bottom: 10px; font-size: 0.9em;">
                                These people have accepted offers and will start in 2026
                            </div>
                            ${generateRolesList(acceptedNotYetStarted)}
                        </div>
                    ` : `
                        <div style="margin-bottom: 20px; padding: 15px; background: #f5f5f5; border-radius: 8px; border-left: 4px solid #999;">
                            <strong style="color: #666;">üìÖ Accepted, Starting Later in 2026</strong>
                            <div style="color: #999; margin-top: 5px; font-size: 0.9em;">No pending starts for 2026</div>
                        </div>
                    `}
                </div>

                <div class="detail-section">
                    <div class="detail-label">By Function</div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        ${Object.entries(byFunction2026)
                            .sort((a, b) => b[1].length - a[1].length)
                            .map(([func, roles]) => `
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e0e0e0;">
                                <strong>${func}</strong>
                                <span style="color: #667eea; font-weight: bold;">${roles.length} ${roles.length === 1 ? 'role' : 'roles'}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div class="detail-section" style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ff6b35;">
                    <strong>üí° What this metric shows:</strong>
                    <p style="margin-top: 10px; color: #856404;">
                        This shows <strong>only people joining in 2026</strong> - it excludes anyone who started in 2025.
                    </p>
                    <ul style="margin-top: 10px; color: #856404; margin-left: 20px;">
                        <li><strong>Already Started:</strong> People who have already joined in 2026 (status = "Started")</li>
                        <li><strong>Yet to Start:</strong> People who accepted offers but haven't started yet (status = "Offer Accepted")</li>
                        <li><strong>All have 2026 start dates:</strong> Both groups are scheduled to start in 2026</li>
                    </ul>
                </div>
            `;
            modalTitle.textContent = title;
            modal.style.display = 'block';
            return;
        case 'pipelineOpen':
            title = 'üîÑ Pipeline Open Roles';
            filteredData = hiringData.filter(r => r.roleStatus === 'Pipeline Open');

            // Group by job title for clearer pipeline view
            const pipelineByTitle = {};
            filteredData.forEach(role => {
                const roleTitle = role.roleTitle || 'Untitled Role';
                if (!pipelineByTitle[roleTitle]) {
                    pipelineByTitle[roleTitle] = [];
                }
                pipelineByTitle[roleTitle].push(role);
            });

            // Generate grouped display
            modalBody.innerHTML = `
                <div class="detail-section">
                    <div class="detail-label">Active Pipelines (${Object.keys(pipelineByTitle).length} unique roles, ${filteredData.length} total openings)</div>
                    <div class="detail-value">
                        ${Object.entries(pipelineByTitle).map(([jobTitle, roles]) => `
                            <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #f39c12;">
                                <div style="margin-bottom: 10px;">
                                    <strong style="color: #f39c12; font-size: 1.1em;">${jobTitle}</strong>
                                    <span style="background: #f39c12; color: white; padding: 3px 8px; border-radius: 12px; font-size: 0.85em; margin-left: 10px;">${roles.length} opening${roles.length > 1 ? 's' : ''}</span>
                                </div>
                                ${roles.map(role => `
                                    <div style="margin-left: 15px; padding: 8px; border-left: 2px solid #e0e0e0; margin-top: 8px; font-size: 0.9em;">
                                        ${role.function || 'N/A'} ‚Ä¢ ${role.team || 'N/A'} ‚Ä¢ TC: ${role.leadTC || 'N/A'}
                                        ${role.dateStart ? `<br><span style="color: #666;">Expected Start: ${formatDate(role.dateStart)}</span>` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            modalTitle.textContent = title;
            modal.style.display = 'block';
            return;
        case 'futureRoles':
            title = 'üìÖ Future Roles';

            // Future roles come from TWO sources:
            // 1. Visualization data (growth future roles from timeline)
            // 2. Backfills (generated from attrition, status = "Backfill - Not Opened")

            // Get visualization future roles
            const visualizationFutureRoles = [];
            if (window.visualizationData && window.visualizationData.rolesByMonth) {
                Object.entries(window.visualizationData.rolesByMonth).forEach(([, roles]) => {
                    roles.forEach(role => {
                        visualizationFutureRoles.push({
                            roleTitle: role.title,
                            function: role.function || 'TBD',
                            leadTC: role.champion || 'Unassigned',
                            roleStatus: 'Future',
                            dateStart: role.month ? new Date(role.month + '-01') : null,
                            team: '',
                            notes: `Planned opening in ${role.month}. Count: ${role.count || 1}`,
                            __type: 'visualization',
                            __source: 'Hiring Plan 2026 Visualisation'
                        });
                    });
                });
            }

            // Get backfill roles with status "Backfill - Not Opened"
            const backfillFutureRoles = (window.backfillRoles || [])
                .filter(b => b.status === 'Backfill - Not Opened')
                .map(b => ({
                    roleTitle: b.roleTitle || 'Backfill Role (TBD)',
                    function: b.function || 'TBD',
                    leadTC: b.champion || 'Misc Talent Champion',
                    roleStatus: 'Backfill - Not Opened',
                    dateStart: b.backfillOpenDate,
                    team: '',
                    notes: `Backfill for departure in ${b.departureMonth}. Opens ${b.backfillOpenMonth}.`,
                    __type: 'backfill',
                    __source: 'Attrition Expected'
                }));

            // Combine both sources
            filteredData = [...visualizationFutureRoles, ...backfillFutureRoles];
            break;
        case 'growthTarget':
            title = 'üìà Growth Target Breakdown';
            const growthTarget = document.getElementById('growthTarget').textContent;
            // Growth target is for 2026 only - count Accepted + Started with 2026 start dates
            const accepted2026 = hiringData.filter(r => {
                if (r.roleStatus !== 'Offer Accepted' && r.roleStatus !== 'Started') return false;
                if (!r.dateStart) return false;
                const startYear = new Date(r.dateStart).getFullYear();
                return startYear === 2026; // Only 2026 starts
            }).length;
            const historical2025Hires = historical2025Data.hiresYTD?.total || 0;
            modalBody.innerHTML = `
                <div class="detail-section">
                    <div class="detail-label">Target Hires for 30% Growth in 2026</div>
                    <div class="detail-value">${growthTarget} new hires needed</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">2026 Progress (Starting in 2026)</div>
                    <div class="detail-value">${accepted2026} accepted offers for 2026 start dates</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">Note on Historical Hires</div>
                    <div class="detail-value">${historical2025Hires} hires started in 2025 (not counted toward 2026 target)</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">Remaining to Target</div>
                    <div class="detail-value">${parseInt(growthTarget) - parseInt(accepted2026)} more 2026 hires needed</div>
                </div>
            `;
            modalTitle.textContent = title;
            modal.style.display = 'block';
            return;
        case 'targetProbability':
            title = 'üéØ Target Probability Analysis';

            // Recalculate prediction to get attrition data
            const prediction = calculatePredictiveTargeting(hiringData);

            const probability = prediction.probability;
            const projected = prediction.projectedTotal;
            const growthTargetValue = prediction.targetGrowth;
            const totalAttrition = prediction.totalAttrition;
            const projectedNetGrowth = projected - totalAttrition;

            const pipelineCount = prediction.currentPipeline;
            const futureCount = prediction.currentFuture;
            const accepted2026Count = prediction.currentAccepted;

            const remaining = growthTargetValue - accepted2026Count;
            const progressPct = ((accepted2026Count / growthTargetValue) * 100).toFixed(1);
            const netProgressPct = ((projectedNetGrowth / growthTargetValue) * 100).toFixed(1);

            // Calculate total expected attrition for 2026
            const totalExpectedAttrition = (attritionData && attritionData.length > 0)
                ? attritionData.reduce((sum, item) => sum + Math.abs(item.count || 0), 0)
                : totalAttrition;

            modalBody.innerHTML = `
                <div class="detail-section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <div class="detail-label" style="color: rgba(255,255,255,0.9); font-size: 1.1em;">Current Probability</div>
                    <div class="detail-value" style="color: white; font-size: 2em; margin: 10px 0;">${probability}%</div>
                    <div style="color: rgba(255,255,255,0.85); margin-top: 10px;">likelihood of hitting 30% NET growth target</div>
                </div>

                <div class="detail-section">
                    <div class="detail-label">üìä Progress Toward Target</div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div style="text-align: center; flex: 1;">
                                <div style="font-size: 2em; font-weight: 700; color: #28a745;">${accepted2026Count}</div>
                                <div style="font-size: 0.9em; color: #666;">Accepted for 2026</div>
                            </div>
                            <div style="font-size: 2em; color: #ccc;">/</div>
                            <div style="text-align: center; flex: 1;">
                                <div style="font-size: 2em; font-weight: 700; color: #667eea;">${growthTargetValue}</div>
                                <div style="font-size: 0.9em; color: #666;">Target (30% Growth)</div>
                            </div>
                        </div>
                        <div style="background: #e9ecef; border-radius: 10px; height: 10px; overflow: hidden; margin-bottom: 10px;">
                            <div style="background: linear-gradient(90deg, #28a745 0%, #20c997 100%); width: ${progressPct}%; height: 100%; transition: width 0.3s ease;"></div>
                        </div>
                        <div style="text-align: center; color: ${remaining > 0 ? '#ff6b6b' : '#28a745'}; font-weight: 600;">
                            ${remaining > 0 ? `${remaining} more hires needed (gross)` : 'Gross target achieved! üéâ'}
                        </div>
                    </div>
                </div>

                <div class="detail-section" style="background: #fff3cd; padding: 20px; border-radius: 10px; border-left: 4px solid #ffa500; margin-bottom: 20px;">
                    <div class="detail-label" style="color: #856404; font-size: 1.1em; margin-bottom: 15px;">üîë The Attrition Factor</div>
                    <div style="color: #856404; font-size: 0.95em; line-height: 1.6;">
                        <p style="margin: 0 0 12px 0;">The <strong>30% growth target (${growthTargetValue} hires)</strong> is a <strong>NET</strong> goal - meaning we need to grow our total headcount by ${growthTargetValue} people.</p>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin: 15px 0; background: white; padding: 15px; border-radius: 8px;">
                            <div style="text-align: center;">
                                <div style="font-size: 1.8em; font-weight: 700; color: #28a745;">${projected}</div>
                                <div style="font-size: 0.85em; color: #666;">Projected Hires</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.8em; font-weight: 700; color: #ff6b6b;">-${totalExpectedAttrition}</div>
                                <div style="font-size: 0.85em; color: #666;">Expected Attrition</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.8em; font-weight: 700; color: ${projectedNetGrowth >= growthTargetValue ? '#28a745' : '#ff6b6b'};">${projectedNetGrowth}</div>
                                <div style="font-size: 0.85em; color: #666;">Net Growth</div>
                            </div>
                        </div>
                        <p style="margin: 12px 0 0 0;"><strong>Net growth:</strong> ${projectedNetGrowth} hires represents <strong>${netProgressPct}%</strong> of the ${growthTargetValue} target.</p>
                    </div>
                </div>

                <div class="detail-section">
                    <div class="detail-label">üîÆ Projected Outcome</div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span style="color: #666;">Gross Hires (Projected):</span>
                            <span style="font-size: 1.5em; font-weight: 700; color: ${projected >= growthTargetValue ? '#28a745' : '#2196f3'};">${projected}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span style="color: #666;">Less: Expected Attrition:</span>
                            <span style="font-size: 1.5em; font-weight: 700; color: #ff6b6b;">-${totalExpectedAttrition}</span>
                        </div>
                        <div style="border-top: 2px solid #dee2e6; margin: 10px 0; padding-top: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="color: #333; font-weight: 600;">Net Headcount Growth:</span>
                                <span style="font-size: 1.8em; font-weight: 700; color: ${projectedNetGrowth >= growthTargetValue ? '#28a745' : '#ff6b6b'};">${projectedNetGrowth}</span>
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 15px; padding-top: 15px; border-top: 1px solid #dee2e6;">
                            ${projectedNetGrowth >= growthTargetValue
                                ? `<span style="color: #28a745; font-weight: 600;">‚úÖ On track to exceed NET growth target by ${projectedNetGrowth - growthTargetValue}</span>`
                                : `<span style="color: #ff6b6b; font-weight: 600;">‚ö†Ô∏è Projected to miss NET growth target by ${growthTargetValue - projectedNetGrowth}</span>`}
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <div class="detail-label">üìà Pipeline Breakdown</div>
                    <ul class="detail-list">
                        <li><strong>Already Accepted:</strong> ${accepted2026Count} offers accepted for 2026 starts</li>
                        <li><strong>Pipeline Open:</strong> ${pipelineCount} roles currently in recruitment</li>
                        <li><strong>Future Roles:</strong> ${futureCount} roles planned to open</li>
                        <li><strong>Backfill Roles:</strong> ${prediction.currentBackfills} roles (to replace attrition, opening month after departure)</li>
                        <li><strong>Gross Potential:</strong> ${projected} projected hires (with conversion rates applied)</li>
                    </ul>
                </div>

                <div class="detail-section" style="background: #fff5f5; padding: 20px; border-radius: 10px; border-left: 4px solid #e74c3c; margin-bottom: 20px;">
                    <div class="detail-label" style="color: #c53030; font-size: 1.1em; margin-bottom: 15px;">üîÑ Total Gross Hiring Demand (2026)</div>
                    <div style="color: #744210; font-size: 0.95em; line-height: 1.6;">
                        <p style="margin: 0 0 12px 0;">To achieve our <strong>53 NET growth</strong> goal while replacing attrition, we need to hire:</p>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0; background: white; padding: 15px; border-radius: 8px;">
                            <div style="text-align: center;">
                                <div style="font-size: 1.8em; font-weight: 700; color: #2196f3;">${growthTargetValue}</div>
                                <div style="font-size: 0.85em; color: #666;">Growth Roles</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.8em; font-weight: 700; color: #e74c3c;">${prediction.currentBackfills}</div>
                                <div style="font-size: 0.85em; color: #666;">Backfill Roles</div>
                            </div>
                        </div>
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 0.9em; opacity: 0.9;">Total Gross Hires Needed</div>
                            <div style="font-size: 2.5em; font-weight: 700; margin: 5px 0;">${prediction.totalGrossHiringNeed}</div>
                            <div style="font-size: 0.85em; opacity: 0.85; margin-top: 5px;">Projected: ${projected} (${prediction.grossHiringCoverage}% coverage)</div>
                        </div>
                        <p style="margin: 12px 0 0 0; font-size: 0.9em;"><strong>Note:</strong> Backfill roles automatically open the month after each expected departure and are assigned to "Misc Talent Champion" until reassigned.</p>
                    </div>
                </div>

                <div class="detail-section" style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #667eea;">
                    <div class="detail-label" style="color: #667eea;">üí° Why ${probability}%?</div>
                    <div style="color: #666; font-size: 0.95em; line-height: 1.6;">
                        The probability is based on <strong>NET growth</strong> (gross hires minus attrition).
                        We're projecting <strong>${projected} total hires</strong>, but after accounting for <strong>${totalExpectedAttrition} expected departures</strong>,
                        our net headcount growth is projected at <strong>${projectedNetGrowth}</strong>.
                        ${projectedNetGrowth < growthTargetValue
                            ? `<br/><br/>This represents <strong>${netProgressPct}%</strong> of the ${growthTargetValue} net growth target, which translates to a <strong>${probability}% probability</strong> of hitting our goal.
                               <br/><br/><strong>Gap:</strong> We need ${growthTargetValue - projectedNetGrowth} more net hires to hit the target. This means either reducing attrition or accelerating hiring.`
                            : `<br/><br/>This exceeds our ${growthTargetValue} net growth target, giving us a <strong>${probability}% probability</strong> of success!`}
                    </div>
                </div>
            `;
            modalTitle.textContent = title;
            modal.style.display = 'block';
            return;
        case 'expectedAttrition':
            title = 'üìâ Expected Attrition';
            const attrition = document.getElementById('expectedAttrition').textContent;

            // Group attrition by month
            const monthlyAttrition = {};
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];

            if (attritionData && attritionData.length > 0) {
                attritionData.forEach(item => {
                    const date = new Date(item.date);
                    const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                    const monthName = `${monthNames[date.getMonth()]} ${date.getFullYear()}`;

                    if (!monthlyAttrition[monthKey]) {
                        monthlyAttrition[monthKey] = {
                            name: monthName,
                            count: 0,
                            sortKey: monthKey
                        };
                    }
                    monthlyAttrition[monthKey].count += Math.abs(item.count || 0);
                });
            }

            // Sort by date
            const sortedMonths = Object.values(monthlyAttrition).sort((a, b) =>
                a.sortKey.localeCompare(b.sortKey)
            );

            // Calculate total
            const totalAttritionCalc = sortedMonths.reduce((sum, month) => sum + month.count, 0);

            // Generate monthly breakdown HTML
            const monthlyBreakdownHTML = sortedMonths.length > 0
                ? sortedMonths.map(month => `
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee;">
                        <span style="color: #555;">${month.name}</span>
                        <strong style="color: #e74c3c;">${month.count} ${month.count === 1 ? 'person' : 'people'}</strong>
                    </div>
                `).join('')
                : '<div style="color: #999; padding: 10px; text-align: center;">No monthly breakdown available</div>';

            modalBody.innerHTML = `
                <div class="detail-section">
                    <div class="detail-label">2026 Attrition Forecast</div>
                    <div class="detail-value">${attrition} employees expected to leave</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">Monthly Breakdown</div>
                    <div class="detail-value" style="margin-top: 10px;">
                        ${monthlyBreakdownHTML}
                        ${sortedMonths.length > 0 ? `
                        <div style="display: flex; justify-content: space-between; padding: 12px 0; margin-top: 8px; border-top: 2px solid #e74c3c; font-weight: bold;">
                            <span>Total</span>
                            <span style="color: #e74c3c;">${totalAttritionCalc} people</span>
                        </div>
                        ` : ''}
                    </div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">Impact on Growth</div>
                    <div class="detail-value">These roles must be backfilled in addition to growth hires</div>
                </div>
            `;
            modalTitle.textContent = title;
            modal.style.display = 'block';
            return;
        case 'netGrowth':
            title = 'üìä Net Growth Projection';
            const netGrowthValue = document.getElementById('netGrowth').textContent;
            const netGrowthProjected = document.getElementById('projectedHires').textContent;
            const netGrowthAttrition = document.getElementById('expectedAttrition').textContent;
            const netGrowthTarget = document.getElementById('growthTarget').textContent;
            const netGap = parseInt(netGrowthTarget) - parseInt(netGrowthValue);
            const netGapStatus = netGap > 0 ? 'SHORT' : netGap < 0 ? 'AHEAD' : 'ON TARGET';
            const netGapColor = netGap > 0 ? '#ff6b6b' : netGap < 0 ? '#28a745' : '#ffc107';
            const netGapText = netGap > 0 ? `-${netGap}` : netGap < 0 ? `+${Math.abs(netGap)}` : '¬±0';

            modalBody.innerHTML = `
                <div class="detail-section" style="background: ${netGapColor}15; border-left: 4px solid ${netGapColor}; padding: 15px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div class="detail-label" style="font-size: 0.9em; color: #666; margin-bottom: 5px;">Current Status</div>
                            <div style="font-size: 1.8em; font-weight: 700; color: ${netGapColor};">${netGapStatus}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 2.5em; font-weight: 700; color: ${netGapColor};">${netGapText}</div>
                            <div style="font-size: 0.9em; color: #666;">hires ${netGap > 0 ? 'short' : netGap < 0 ? 'ahead' : 'exact'}</div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <div class="detail-label">üìê The Calculation</div>
                    <div class="detail-value" style="font-family: monospace; font-size: 1.1em; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <div style="margin-bottom: 10px;"><strong>Projected Hires:</strong> ${netGrowthProjected}</div>
                        <div style="margin-bottom: 10px;"><strong>‚àí Expected Attrition:</strong> ${netGrowthAttrition}</div>
                        <div style="border-top: 2px solid #dee2e6; padding-top: 10px; margin-top: 10px;">
                            <strong>= Net Growth:</strong> <span style="color: ${netGapColor}; font-size: 1.2em;">${netGrowthValue}</span>
                        </div>
                        <div style="margin-top: 15px; padding-top: 10px; border-top: 1px dashed #dee2e6;">
                            <strong>Growth Target:</strong> ${netGrowthTarget}
                        </div>
                        <div style="margin-top: 5px;">
                            <strong>Gap:</strong> <span style="color: ${netGapColor};">${netGapText}</span>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <div class="detail-label">üéØ Why This Matters</div>
                    <div class="detail-value">
                        <p><strong>Net Growth</strong> is the real number that determines if you hit your 30% growth target.</p>
                        <p style="margin-top: 10px;"><strong>Many dashboards only show gross hires</strong> (${netGrowthProjected} in this case), making it seem like you're well ahead of the ${netGrowthTarget} target.</p>
                        <p style="margin-top: 10px; background: #fff3cd; padding: 12px; border-radius: 6px; border-left: 4px solid #ffc107;">
                            ‚ö†Ô∏è <strong>Critical mistake:</strong> Comparing ${netGrowthProjected} projected vs ${netGrowthTarget} target looks like you're +${parseInt(netGrowthProjected) - parseInt(netGrowthTarget)} ahead. But after accounting for ${netGrowthAttrition} attrition, you're actually ${netGap > 0 ? netGap + ' short' : netGap < 0 ? Math.abs(netGap) + ' ahead' : 'exactly on target'}.
                        </p>
                    </div>
                </div>

                <div class="detail-section">
                    <div class="detail-label">üí° Recommended Actions</div>
                    <div class="detail-value">
                        ${netGap > 0 ? `
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li style="margin-bottom: 8px;"><strong>Accelerate hiring:</strong> Need ${netGap} more accepted offers to hit target</li>
                                <li style="margin-bottom: 8px;"><strong>Increase pipeline:</strong> Assuming 80% offer acceptance, need ~${Math.ceil(netGap / 0.8)} more offers</li>
                                <li style="margin-bottom: 8px;"><strong>Reduce attrition:</strong> Every person retained = one less hire needed</li>
                                <li style="margin-bottom: 8px;"><strong>Review timeline:</strong> Can future pipeline roles be accelerated?</li>
                            </ul>
                        ` : netGap < 0 ? `
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li style="margin-bottom: 8px;"><strong>Maintain velocity:</strong> Current pace is sufficient to exceed target</li>
                                <li style="margin-bottom: 8px;"><strong>Buffer for risk:</strong> ${Math.abs(netGap)}-person buffer protects against lower acceptance rates or higher attrition</li>
                                <li style="margin-bottom: 8px;"><strong>Consider strategic hires:</strong> Extra capacity could enable stretch goals</li>
                            </ul>
                        ` : `
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li style="margin-bottom: 8px;"><strong>Maintain course:</strong> Currently on track to hit target exactly</li>
                                <li style="margin-bottom: 8px;"><strong>Build buffer:</strong> No margin for error - consider accelerating 5-10 more roles</li>
                                <li style="margin-bottom: 8px;"><strong>Monitor closely:</strong> Any pipeline slippage will put target at risk</li>
                            </ul>
                        `}
                    </div>
                </div>

                <div class="detail-section" style="background: #e7f3ff; padding: 15px; border-radius: 8px;">
                    <div class="detail-label">üó£Ô∏è Board Presentation</div>
                    <div class="detail-value">
                        <p style="font-style: italic; color: #495057;">
                            "While our gross hiring projection is ${netGrowthProjected}, our <strong>net growth after attrition</strong> is ${netGrowthValue}.
                            ${netGap > 0 ? `This puts us ${netGap} hires short of our ${netGrowthTarget} growth target.` : netGap < 0 ? `This exceeds our ${netGrowthTarget} target by ${Math.abs(netGap)}, providing a healthy buffer.` : `This hits our ${netGrowthTarget} target exactly, though with no margin for error.`}
                            ${netGap > 0 ? `To close this gap, we need approximately ${Math.ceil(netGap / 0.8)} additional offers at our 80% acceptance rate.` : ''}"
                        </p>
                    </div>
                </div>
            `;
            modalTitle.textContent = title;
            modal.style.display = 'block';
            return;
        case 'totalNeed':
            title = 'üéØ Total Hiring Need';
            const totalNeedValue = document.getElementById('totalNeed').textContent;
            const totalNeedProjected = document.getElementById('projectedHires').textContent;
            const totalNeedAttrition = document.getElementById('expectedAttrition').textContent;
            const totalNeedGrowthTarget = document.getElementById('growthTarget').textContent;
            const totalNeedGap = parseInt(totalNeedValue) - parseInt(totalNeedProjected);
            const totalNeedStatus = totalNeedGap > 0 ? 'SHORT' : totalNeedGap < 0 ? 'SURPLUS' : 'ON TARGET';
            const totalNeedColor = totalNeedGap > 0 ? '#ffa500' : totalNeedGap < 0 ? '#28a745' : '#ffc107';
            const totalNeedGapText = totalNeedGap > 0 ? `-${totalNeedGap}` : totalNeedGap < 0 ? `+${Math.abs(totalNeedGap)}` : '¬±0';

            modalBody.innerHTML = `
                <div class="detail-section" style="background: ${totalNeedColor}15; border-left: 4px solid ${totalNeedColor}; padding: 15px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div class="detail-label" style="font-size: 0.9em; color: #666; margin-bottom: 5px;">Total Hiring Status</div>
                            <div style="font-size: 1.8em; font-weight: 700; color: ${totalNeedColor};">${totalNeedStatus}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 2.5em; font-weight: 700; color: ${totalNeedColor};">${totalNeedGapText}</div>
                            <div style="font-size: 0.9em; color: #666;">hires ${totalNeedGap > 0 ? 'short' : totalNeedGap < 0 ? 'surplus' : 'exact'}</div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <div class="detail-label">üìä Total Hiring Requirement</div>
                    <div class="detail-value" style="font-family: monospace; font-size: 1.1em; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <div style="margin-bottom: 10px;"><strong>Growth Target:</strong> ${totalNeedGrowthTarget} new roles</div>
                        <div style="margin-bottom: 10px;"><strong>+ Attrition Backfill:</strong> ${totalNeedAttrition} replacements</div>
                        <div style="border-top: 2px solid #dee2e6; padding-top: 10px; margin-top: 10px;">
                            <strong>= Total Need:</strong> <span style="color: ${totalNeedColor}; font-size: 1.2em;">${totalNeedValue}</span> hires
                        </div>
                        <div style="margin-top: 15px; padding-top: 10px; border-top: 1px dashed #dee2e6;">
                            <strong>Currently Projected:</strong> ${totalNeedProjected}
                        </div>
                        <div style="margin-top: 5px;">
                            <strong>Gap:</strong> <span style="color: ${totalNeedColor};">${totalNeedGapText}</span>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <div class="detail-label">üîç The Hidden Math</div>
                    <div class="detail-value">
                        <p><strong>Most people miss this:</strong> To achieve ${totalNeedGrowthTarget} <em>net growth</em>, you don't need ${totalNeedGrowthTarget} hires ‚Äî you need <strong>${totalNeedValue} hires</strong>.</p>

                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #ffc107;">
                            <div style="font-weight: 700; margin-bottom: 10px;">‚ö†Ô∏è Critical Mistake to Avoid</div>
                            <div style="margin-bottom: 8px;">‚ùå <strong>Wrong thinking:</strong> "We're projecting ${totalNeedProjected} hires vs ${totalNeedGrowthTarget} target = we're ${parseInt(totalNeedProjected) - parseInt(totalNeedGrowthTarget)} ahead!"</div>
                            <div>‚úÖ <strong>Right thinking:</strong> "We're projecting ${totalNeedProjected} hires vs ${totalNeedValue} total need = we're ${totalNeedGap > 0 ? totalNeedGap + ' short' : totalNeedGap < 0 ? Math.abs(totalNeedGap) + ' ahead' : 'exactly on target'}!"</div>
                        </div>

                        <p style="margin-top: 15px;"><strong>Why the difference?</strong></p>
                        <p style="margin-top: 8px;">Every person who leaves must be replaced BEFORE you can grow. Think of it like filling a leaking bucket:</p>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li style="margin-bottom: 8px;">First ${totalNeedAttrition} hires = plug the leaks (backfill attrition)</li>
                            <li style="margin-bottom: 8px;">Next ${totalNeedGrowthTarget} hires = actual growth</li>
                            <li style="margin-bottom: 8px;">Total needed = ${totalNeedValue} hires</li>
                        </ul>
                    </div>
                </div>

                <div class="detail-section">
                    <div class="detail-label">üìà Reality Check</div>
                    <div class="detail-value" style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr style="border-bottom: 2px solid #dee2e6;">
                                <th style="text-align: left; padding: 8px; font-weight: 700;">Metric</th>
                                <th style="text-align: right; padding: 8px; font-weight: 700;">Value</th>
                            </tr>
                            <tr style="border-bottom: 1px solid #dee2e6;">
                                <td style="padding: 8px;">Starting headcount</td>
                                <td style="text-align: right; padding: 8px;">177</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #dee2e6;">
                                <td style="padding: 8px;">‚àí Expected exits</td>
                                <td style="text-align: right; padding: 8px; color: #dc3545;">‚àí${totalNeedAttrition}</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #dee2e6;">
                                <td style="padding: 8px;">+ Projected hires</td>
                                <td style="text-align: right; padding: 8px; color: #28a745;">+${totalNeedProjected}</td>
                            </tr>
                            <tr style="border-top: 2px solid #495057; background: #e9ecef;">
                                <td style="padding: 8px; font-weight: 700;">= Ending headcount</td>
                                <td style="text-align: right; padding: 8px; font-weight: 700;">${177 - parseInt(totalNeedAttrition) + parseInt(totalNeedProjected)}</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #dee2e6;">
                                <td style="padding: 8px; font-weight: 700;">Target headcount</td>
                                <td style="text-align: right; padding: 8px; font-weight: 700;">${177 + parseInt(totalNeedGrowthTarget)}</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; font-weight: 700; color: ${totalNeedColor};">Gap</td>
                                <td style="text-align: right; padding: 8px; font-weight: 700; color: ${totalNeedColor};">${totalNeedGapText}</td>
                            </tr>
                        </table>
                    </div>
                </div>

                <div class="detail-section">
                    <div class="detail-label">üíº Action Items</div>
                    <div class="detail-value">
                        ${totalNeedGap > 0 ? `
                            <p style="font-weight: 600; margin-bottom: 10px;">To close the ${totalNeedGap}-person gap:</p>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li style="margin-bottom: 8px;"><strong>Approve ${Math.ceil(totalNeedGap / 0.8)} additional job openings</strong> (assuming 80% offer acceptance rate)</li>
                                <li style="margin-bottom: 8px;"><strong>Accelerate pipeline roles:</strong> Can any "Future Pipeline" roles move to "Active Pipeline"?</li>
                                <li style="margin-bottom: 8px;"><strong>Retention focus:</strong> Every 1% reduction in attrition saves ~2 hires</li>
                                <li style="margin-bottom: 8px;"><strong>Increase offer acceptance:</strong> Every 5% improvement in acceptance = 4-5 fewer offers needed</li>
                            </ul>
                        ` : totalNeedGap < 0 ? `
                            <p style="font-weight: 600; margin-bottom: 10px;">Current hiring plan provides a ${Math.abs(totalNeedGap)}-person buffer:</p>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li style="margin-bottom: 8px;"><strong>Risk protection:</strong> Buffer guards against higher attrition or lower acceptance</li>
                                <li style="margin-bottom: 8px;"><strong>Maintain momentum:</strong> Don't slow hiring pace</li>
                                <li style="margin-bottom: 8px;"><strong>Strategic opportunities:</strong> Extra capacity enables stretch goals</li>
                            </ul>
                        ` : `
                            <p style="font-weight: 600; margin-bottom: 10px;">Currently on track, but with zero margin for error:</p>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li style="margin-bottom: 8px;"><strong>Build buffer:</strong> Recommend approving 5-10 additional roles</li>
                                <li style="margin-bottom: 8px;"><strong>Monitor acceptance rates:</strong> Any drop will miss target</li>
                                <li style="margin-bottom: 8px;"><strong>Track attrition:</strong> Any increase requires more backfill</li>
                            </ul>
                        `}
                    </div>
                </div>

                <div class="detail-section" style="background: #e7f3ff; padding: 15px; border-radius: 8px;">
                    <div class="detail-label">üó£Ô∏è Board Presentation</div>
                    <div class="detail-value">
                        <p style="font-style: italic; color: #495057;">
                            "To achieve our ${totalNeedGrowthTarget} net growth target while backfilling ${totalNeedAttrition} expected exits, we need <strong>${totalNeedValue} total hires</strong> in 2026.
                            ${totalNeedGap > 0 ? `We're currently projecting ${totalNeedProjected} hires, leaving us ${totalNeedGap} short. To close this gap, we're requesting approval for ${Math.ceil(totalNeedGap / 0.8)} additional roles at our current 80% offer acceptance rate.` : totalNeedGap < 0 ? `We're currently projecting ${totalNeedProjected} hires, which provides a ${Math.abs(totalNeedGap)}-person buffer for risk mitigation.` : `We're currently projecting ${totalNeedProjected} hires, which exactly meets this requirement, though with no margin for error.`}"
                        </p>
                    </div>
                </div>
            `;
            modalTitle.textContent = title;
            modal.style.display = 'block';
            return;
    }

    // For cases that show role lists
    modalTitle.textContent = title;
    modalBody.innerHTML = `
        <div class="detail-section">
            <div class="detail-label">Total: ${filteredData.length} roles</div>
            ${generateRolesList(filteredData)}
        </div>
    `;
    modal.style.display = 'block';
}

// Show status banner info modal
function showStatusBannerInfo(event) {
    if (event) {
        event.stopPropagation();
        event.preventDefault();
    }

    const modal = document.getElementById('detailModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');

    // Get current values
    const projectedHires = document.getElementById('projectedHires')?.textContent || '83';
    const attrition = document.getElementById('expectedAttrition')?.textContent || '44';
    const growthTarget = document.getElementById('growthTarget')?.textContent || '53';
    const netGrowth = parseInt(projectedHires) - parseInt(attrition);
    const gap = parseInt(growthTarget) - netGrowth;

    modalTitle.textContent = '‚ö†Ô∏è Status Banner Explained';

    modalBody.innerHTML = `
        <div class="detail-section">
            <div class="detail-label">üéØ How the Status Banner Works</div>
            <div class="detail-value">
                <p>The banner color and message change based on your <strong>Net Growth Gap</strong> - the difference between your target net growth and your actual projected net growth.</p>
            </div>
        </div>

        <div class="detail-section">
            <div class="detail-label">üßÆ Current Calculation</div>
            <div class="detail-value" style="font-family: monospace; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                <div style="margin-bottom: 10px;"><strong>Step 1:</strong> Calculate Net Growth</div>
                <div style="margin-left: 20px; margin-bottom: 15px;">
                    Projected Hires (${projectedHires}) ‚àí Attrition (${attrition}) = <strong>${netGrowth} net growth</strong>
                </div>

                <div style="margin-bottom: 10px;"><strong>Step 2:</strong> Calculate Gap</div>
                <div style="margin-left: 20px; margin-bottom: 15px;">
                    Growth Target (${growthTarget}) ‚àí Net Growth (${netGrowth}) = <strong>${gap > 0 ? '+' : ''}${gap} gap</strong>
                </div>

                <div style="border-top: 2px solid #dee2e6; padding-top: 10px; margin-top: 10px;">
                    <strong>Your Status:</strong> ${gap > 0 ? gap + ' short' : gap < 0 ? Math.abs(gap) + ' ahead' : 'Exactly on target'}
                </div>
            </div>
        </div>

        <div class="detail-section">
            <div class="detail-label">üîÆ How "Projected Hires" is Calculated</div>
            <div class="detail-value">
                <p style="margin-bottom: 12px;">The <strong>Projected ${projectedHires}</strong> number comes from a sophisticated prediction algorithm that accounts for multiple factors:</p>

                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.9em; margin-bottom: 15px;">
                    <div style="font-weight: 700; margin-bottom: 10px; font-family: inherit;">Formula:</div>
                    <div style="color: #495057;">
                        <strong>Projected Total</strong> =
                        <span style="color: #ff6b35; font-weight: 700;">Accepted</span> +
                        <span style="color: #3498db; font-weight: 700;">(Velocity √ó Days Remaining)</span> +
                        <span style="color: #f39c12; font-weight: 700;">(Pipeline √ó 0.8)</span> +
                        <span style="color: #9b59b6; font-weight: 700;">(Future √ó 0.6)</span>
                    </div>
                </div>

                <div style="margin-bottom: 12px;">
                    <div style="font-weight: 700; color: #ff6b35; margin-bottom: 5px;">1Ô∏è‚É£ Accepted Offers (Confirmed)</div>
                    <div style="margin-left: 20px; color: #666; font-size: 0.95em;">
                        ‚Ä¢ Roles with status "Offer Accepted" or "Started" for 2026<br>
                        ‚Ä¢ <strong>100% certainty</strong> - these are locked in<br>
                        ‚Ä¢ Check your "Accepted + Hired" card for current count
                    </div>
                </div>

                <div style="margin-bottom: 12px;">
                    <div style="font-weight: 700; color: #3498db; margin-bottom: 5px;">2Ô∏è‚É£ Velocity-Based Projection</div>
                    <div style="margin-left: 20px; color: #666; font-size: 0.95em;">
                        ‚Ä¢ Formula: <code style="background: #fff; padding: 2px 6px; border-radius: 3px;">Accepted √∑ Days Elapsed = Hires/Day</code><br>
                        ‚Ä¢ Then: <code style="background: #fff; padding: 2px 6px; border-radius: 3px;">Hires/Day √ó Days Remaining = Additional Projected</code><br>
                        ‚Ä¢ Assumes <strong>current hiring pace continues</strong><br>
                        ‚Ä¢ Conservative estimate based on actual performance
                    </div>
                </div>

                <div style="margin-bottom: 12px;">
                    <div style="font-weight: 700; color: #f39c12; margin-bottom: 5px;">3Ô∏è‚É£ Pipeline Conversion (80%)</div>
                    <div style="margin-left: 20px; color: #666; font-size: 0.95em;">
                        ‚Ä¢ Roles actively being recruited ("Pipeline Open" status)<br>
                        ‚Ä¢ Estimated rate: <strong>~80% convert to offers</strong><br>
                        ‚Ä¢ Accounts for: candidates declining, falling out of process<br>
                        ‚Ä¢ Check your "Pipeline Open" card for current count
                    </div>
                </div>

                <div style="margin-bottom: 12px;">
                    <div style="font-weight: 700; color: #9b59b6; margin-bottom: 5px;">4Ô∏è‚É£ Future Roles Conversion (60%)</div>
                    <div style="margin-left: 20px; color: #666; font-size: 0.95em;">
                        ‚Ä¢ Approved roles not yet opened for recruitment ("Future" status)<br>
                        ‚Ä¢ Estimated rate: <strong>~60% convert</strong> (more uncertainty)<br>
                        ‚Ä¢ Factors in: delays in opening, priority changes, budget freezes<br>
                        ‚Ä¢ Check your "Future Roles" card for current count
                    </div>
                </div>

                <div style="background: #fff3cd; padding: 12px; border-radius: 8px; border-left: 4px solid #ffc107; margin-top: 15px;">
                    <div style="font-weight: 700; margin-bottom: 5px;">üí° Example Calculation:</div>
                    <div style="font-size: 0.9em; font-family: monospace; color: #666;">
                        ‚Ä¢ 15 accepted<br>
                        ‚Ä¢ + 5 from velocity (0.05/day √ó 100 days left)<br>
                        ‚Ä¢ + 12 from pipeline (15 roles √ó 0.8)<br>
                        ‚Ä¢ + 27 from future (45 roles √ó 0.6)<br>
                        <div style="border-top: 1px solid #ddd; margin-top: 8px; padding-top: 8px;">
                        <strong>= 59 projected hires</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="detail-section">
            <div class="detail-label">üö¶ Banner Color Logic</div>
            <div class="detail-value">
                <div style="margin-bottom: 15px; padding: 12px; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); border-radius: 8px; color: white;">
                    <div style="font-weight: 700; margin-bottom: 5px;">üî¥ RED (Warning) - Short of Target</div>
                    <div style="font-size: 0.9em; opacity: 0.95;">
                        <strong>Condition:</strong> Gap > 0 (net growth below target)<br>
                        <strong>Example:</strong> 39 net growth vs 53 target = 14 short ‚Üí RED<br>
                        <strong>Message:</strong> "[X] HIRES SHORT OF NET GROWTH TARGET"
                    </div>
                </div>

                <div style="margin-bottom: 15px; padding: 12px; background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%); border-radius: 8px; color: white;">
                    <div style="font-weight: 700; margin-bottom: 5px;">üü° YELLOW (Neutral) - Exactly On Target</div>
                    <div style="font-size: 0.9em; opacity: 0.95;">
                        <strong>Condition:</strong> Gap = 0 (net growth equals target)<br>
                        <strong>Example:</strong> 53 net growth vs 53 target = 0 gap ‚Üí YELLOW<br>
                        <strong>Message:</strong> "ON TARGET FOR NET GROWTH"
                    </div>
                </div>

                <div style="margin-bottom: 0; padding: 12px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); border-radius: 8px; color: white;">
                    <div style="font-weight: 700; margin-bottom: 5px;">üü¢ GREEN (Success) - Ahead of Target</div>
                    <div style="font-size: 0.9em; opacity: 0.95;">
                        <strong>Condition:</strong> Gap < 0 (net growth above target)<br>
                        <strong>Example:</strong> 56 net growth vs 53 target = 3 ahead ‚Üí GREEN<br>
                        <strong>Message:</strong> "[X] HIRES AHEAD OF TARGET"
                    </div>
                </div>
            </div>
        </div>

        <div class="detail-section">
            <div class="detail-label">üìä Status Scenarios Table</div>
            <div class="detail-value">
                <table style="width: 100%; border-collapse: collapse; font-size: 0.95em;">
                    <thead>
                        <tr style="border-bottom: 2px solid #495057; background: #f8f9fa;">
                            <th style="text-align: left; padding: 10px;">Net Growth</th>
                            <th style="text-align: center; padding: 10px;">Gap Calculation</th>
                            <th style="text-align: center; padding: 10px;">Color</th>
                            <th style="text-align: left; padding: 10px;">Banner Shows</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid #dee2e6; background: ${netGrowth === 39 ? '#fff3cd' : 'white'};">
                            <td style="padding: 10px;"><strong>39</strong> (current)</td>
                            <td style="text-align: center; padding: 10px;">53 ‚àí 39 = +14</td>
                            <td style="text-align: center; padding: 10px;">üî¥ RED</td>
                            <td style="padding: 10px;">"14 HIRES SHORT"</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #dee2e6;">
                            <td style="padding: 10px;">50</td>
                            <td style="text-align: center; padding: 10px;">53 ‚àí 50 = +3</td>
                            <td style="text-align: center; padding: 10px;">üî¥ RED</td>
                            <td style="padding: 10px;">"3 HIRES SHORT"</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #dee2e6;">
                            <td style="padding: 10px;"><strong>53</strong></td>
                            <td style="text-align: center; padding: 10px;">53 ‚àí 53 = 0</td>
                            <td style="text-align: center; padding: 10px;">üü° YELLOW</td>
                            <td style="padding: 10px;">"ON TARGET"</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #dee2e6;">
                            <td style="padding: 10px;">56</td>
                            <td style="text-align: center; padding: 10px;">53 ‚àí 56 = ‚àí3</td>
                            <td style="text-align: center; padding: 10px;">üü¢ GREEN</td>
                            <td style="padding: 10px;">"3 HIRES AHEAD"</td>
                        </tr>
                        <tr>
                            <td style="padding: 10px;">60</td>
                            <td style="text-align: center; padding: 10px;">53 ‚àí 60 = ‚àí7</td>
                            <td style="text-align: center; padding: 10px;">üü¢ GREEN</td>
                            <td style="padding: 10px;">"7 HIRES AHEAD"</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="detail-section" style="background: #e7f3ff; padding: 15px; border-radius: 8px;">
            <div class="detail-label">üéØ Key Insight</div>
            <div class="detail-value">
                <p style="margin-bottom: 10px;">The banner is based on <strong>NET GROWTH</strong> (after attrition), not gross projected hires.</p>
                <p style="margin-bottom: 10px;"><strong>To reach different statuses:</strong></p>
                <ul style="margin: 0; padding-left: 20px;">
                    <li style="margin-bottom: 8px;"><strong>Yellow (On Target):</strong> Need ${parseInt(growthTarget) + parseInt(attrition)} total projected hires (${growthTarget} + ${attrition})</li>
                    <li style="margin-bottom: 8px;"><strong>Green (Ahead):</strong> Need ${parseInt(growthTarget) + parseInt(attrition) + 1}+ total projected hires</li>
                    <li><strong>Currently:</strong> ${projectedHires} projected = ${netGrowth} net growth = ${gap > 0 ? 'RED (' + gap + ' short)' : gap < 0 ? 'GREEN (' + Math.abs(gap) + ' ahead)' : 'YELLOW (on target)'}</li>
                </ul>
            </div>
        </div>
    `;

    modal.style.display = 'block';
}

// Show Hiring Timeline info modal
function showHiringTimelineInfo(event) {
    if (event) {
        event.stopPropagation();
        event.preventDefault();
    }

    const modal = document.getElementById('detailModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');

    modalTitle.textContent = 'üìä Hiring Timeline Chart Guide';

    modalBody.innerHTML = `
        <div class="detail-section" style="background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); border-left: 4px solid #667eea; padding: 20px; margin-bottom: 20px; border-radius: 8px;">
            <h3 style="color: #667eea; margin-top: 0; font-size: 1.3em;">üéØ What This Chart Shows</h3>
            <p style="margin: 0; line-height: 1.8; font-size: 1.05em;">
                The <strong>Hiring Timeline</strong> displays when each role in your pipeline is expected to result in a hire,
                spanning from 2025 through 2026. Each bar represents one month, and the color indicates the role's current status:
            </p>
            <div style="margin-top: 15px; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 12px;">
                <div style="padding: 10px; background: white; border-radius: 6px; border-left: 4px solid #ff6b35;">
                    <strong style="color: #ff6b35;">üü† Accepted + Started</strong><br>
                    <span style="font-size: 0.9em; color: #666;">Offers accepted, hires confirmed</span>
                </div>
                <div style="padding: 10px; background: white; border-radius: 6px; border-left: 4px solid #f39c12;">
                    <strong style="color: #f39c12;">üü° Pipeline Open</strong><br>
                    <span style="font-size: 0.9em; color: #666;">Active recruitment underway</span>
                </div>
                <div style="padding: 10px; background: white; border-radius: 6px; border-left: 4px solid #9b59b6;">
                    <strong style="color: #9b59b6;">üü£ Future Roles</strong><br>
                    <span style="font-size: 0.9em; color: #666;">Approved but not yet opened</span>
                </div>
            </div>
        </div>

        <div class="detail-section">
            <h3 style="color: #ff6b35; font-size: 1.3em; border-bottom: 2px solid #ff6b35; padding-bottom: 10px;">üí° Why This Chart is Valuable</h3>

            <div style="margin-top: 20px;">
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <h4 style="color: #667eea; margin-top: 0; font-size: 1.15em;">1Ô∏è‚É£ Identifies Hiring Gaps & Surges</h4>
                    <p style="margin: 8px 0 0 0; line-height: 1.7;">
                        <strong>The Problem:</strong> Without visibility into <em>when</em> hires are expected, you might discover too late that:
                        <ul style="margin-top: 8px;">
                            <li>You have zero hires planned for Q2 but 30 in Q4 (capacity crunch)</li>
                            <li>Critical team expansions are delayed until late in the year (business risk)</li>
                            <li>Onboarding will be overwhelmed in certain months (poor experience)</li>
                        </ul>
                        <strong style="color: #28a745;">The Solution:</strong> This timeline shows your hiring distribution month-by-month,
                        allowing you to identify gaps early and rebalance start dates or accelerate recruiting for understaffed periods.
                    </p>
                </div>

                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <h4 style="color: #667eea; margin-top: 0; font-size: 1.15em;">2Ô∏è‚É£ Tracks Progress vs. Time-Bound Goals</h4>
                    <p style="margin: 8px 0 0 0; line-height: 1.7;">
                        <strong>The Problem:</strong> If your board expects "20 hires by Q1" or "30% growth by year-end,"
                        you need to know if you're on pace. Aggregate numbers don't reveal timing risks.
                        <br><br>
                        <strong style="color: #28a745;">The Solution:</strong> The timeline chart lets you see exactly how many hires
                        land in each quarter. Hover over any month to see the count. You can quickly answer: "Will we hit our Q2 target?"
                        or "Are we backloaded into Q4?" This is essential for board reporting and course correction.
                    </p>
                </div>

                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <h4 style="color: #667eea; margin-top: 0; font-size: 1.15em;">3Ô∏è‚É£ Reveals Pipeline Conversion Velocity</h4>
                    <p style="margin: 8px 0 0 0; line-height: 1.7;">
                        <strong>The Problem:</strong> You might have 50 roles "in pipeline," but when will they actually convert to hires?
                        Are they all landing in 2027? Are they stuck in limbo?
                        <br><br>
                        <strong style="color: #28a745;">The Solution:</strong> By displaying expected start dates (based on each role's
                        expected time-to-hire), this chart reveals conversion velocity. If all your "Pipeline Open" roles show start dates
                        8+ months out, you know your recruitment cycle is too slow. If "Future Roles" aren't appearing until late 2026,
                        you need to accelerate opening those requisitions.
                    </p>
                </div>

                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <h4 style="color: #667eea; margin-top: 0; font-size: 1.15em;">4Ô∏è‚É£ Enables Capacity & Budget Planning</h4>
                    <p style="margin: 8px 0 0 0; line-height: 1.7;">
                        <strong>The Problem:</strong> Finance needs to know when headcount costs hit the P&L. HR needs to know when
                        onboarding capacity is required. Facilities needs to know when desks/equipment are needed. None of this is possible
                        with just "we're hiring 83 people this year."
                        <br><br>
                        <strong style="color: #28a745;">The Solution:</strong> This timeline provides the monthly breakdown needed for:
                        <ul style="margin-top: 8px;">
                            <li><strong>Budget Planning:</strong> Show CFO when salary costs ramp up</li>
                            <li><strong>Onboarding Planning:</strong> Ensure HR has capacity for high-volume months</li>
                            <li><strong>Space Planning:</strong> Know when office expansion is needed</li>
                            <li><strong>Manager Readiness:</strong> Alert hiring managers well in advance of new team members joining</li>
                        </ul>
                    </p>
                </div>

                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                    <h4 style="color: #667eea; margin-top: 0; font-size: 1.15em;">5Ô∏è‚É£ Provides Executive Context for Board Presentations</h4>
                    <p style="margin: 8px 0 0 0; line-height: 1.7;">
                        <strong>The Problem:</strong> The board asks: "When will we see the impact of this hiring?"
                        Saying "83 hires this year" doesn't answer the question. They need to know: Q1? Q4? Evenly distributed?
                        <br><br>
                        <strong style="color: #28a745;">The Solution:</strong> This visual tells the story clearly:
                        <ul style="margin-top: 8px;">
                            <li><strong>"We're front-loaded"</strong> ‚Üí 40 hires in H1, 43 in H2 (early impact)</li>
                            <li><strong>"We're back-loaded"</strong> ‚Üí 20 hires in H1, 63 in H2 (delayed impact, higher risk)</li>
                            <li><strong>"We're balanced"</strong> ‚Üí Steady 6-7 hires per month (sustainable pace)</li>
                        </ul>
                        The board can instantly see the hiring cadence and understand business impact timing.
                    </p>
                </div>
            </div>
        </div>

        <div class="detail-section" style="background: linear-gradient(135deg, #43e97b15 0%, #38f9d715 100%); border-left: 4px solid #43e97b; padding: 20px; border-radius: 8px;">
            <h3 style="color: #43e97b; margin-top: 0; font-size: 1.3em;">üé¨ How to Use This Chart</h3>

            <div style="margin-top: 15px;">
                <div style="margin-bottom: 15px;">
                    <strong style="color: #667eea; font-size: 1.05em;">üìä Reading the Chart:</strong>
                    <ul style="margin-top: 8px; line-height: 1.7;">
                        <li><strong>Hover over any bar</strong> to see the exact count of hires expected that month</li>
                        <li><strong>Look for gaps</strong> (months with zero or very low bars) - these are risk periods</li>
                        <li><strong>Look for spikes</strong> (months with unusually high bars) - these may overwhelm onboarding capacity</li>
                        <li><strong>Compare colors</strong> - More orange (Accepted) = higher certainty, more purple (Future) = needs attention</li>
                    </ul>
                </div>

                <div style="margin-bottom: 15px;">
                    <strong style="color: #667eea; font-size: 1.05em;">‚ö†Ô∏è Red Flags to Watch For:</strong>
                    <ul style="margin-top: 8px; line-height: 1.7;">
                        <li><strong>Empty Q1-Q2:</strong> If most hires are in H2, you're at risk of missing year-end targets</li>
                        <li><strong>Too much purple:</strong> If most bars are purple (Future Roles), these roles need to open ASAP</li>
                        <li><strong>Lumpy distribution:</strong> Big gaps between hiring months suggest poor pipeline flow</li>
                        <li><strong>Late 2026 concentration:</strong> If everything clusters in Q4 2026, delays will cascade into 2027</li>
                    </ul>
                </div>

                <div>
                    <strong style="color: #667eea; font-size: 1.05em;">‚úÖ Actions to Take:</strong>
                    <ul style="margin-top: 8px; line-height: 1.7;">
                        <li><strong>Rebalance start dates</strong> if you see capacity surges or gaps</li>
                        <li><strong>Accelerate pipeline roles</strong> showing late start dates to pull them forward</li>
                        <li><strong>Open future roles earlier</strong> if they're not appearing until late in the year</li>
                        <li><strong>Alert stakeholders</strong> (Finance, HR, Facilities) about high-volume months in advance</li>
                        <li><strong>Track monthly</strong> - the timeline will shift as roles progress, so review regularly</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="detail-section" style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 20px; border-radius: 8px;">
            <h3 style="color: #f39c12; margin-top: 0; font-size: 1.3em;">üíº Board Presentation Example</h3>
            <p style="margin: 0 0 15px 0; line-height: 1.7; font-style: italic; color: #666;">
                "Here's our hiring timeline through 2026. As you can see, we have 23 confirmed hires (orange) with start dates
                already secured, mostly concentrated in Q1 and Q2. However, you'll notice our pipeline (yellow) and future roles (purple)
                show expected start dates heavily weighted toward Q4. This tells us we need to accelerate recruitment velocity
                to avoid a risky back-loaded year. Specifically, we need to move 15 of these Q4 roles forward into Q2-Q3 to smooth
                our hiring cadence and reduce year-end delivery risk."
            </p>
            <p style="margin: 0; line-height: 1.7;">
                <strong style="color: #f39c12;">Result:</strong> The board immediately understands the timing risk and approves
                your request to accelerate recruiting resources in Q1 to rebalance the timeline.
            </p>
        </div>

        <div class="detail-section" style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px;">
            <p style="margin: 0; font-size: 1.1em; color: #495057; line-height: 1.7;">
                <strong>Bottom Line:</strong> The Hiring Timeline turns abstract hiring targets into concrete, actionable dates.
                It reveals <em>when</em> your team will grow, not just <em>by how much</em> - and that's the insight that drives
                better decisions, better planning, and better business outcomes.
            </p>
        </div>
    `;

    modal.style.display = 'block';
}

// Helper function to generate roles list HTML
function generateRolesList(roles) {
    if (roles.length === 0) {
        return '<div class="detail-value">No roles found</div>';
    }

    return `<ul class="detail-list">
        ${roles.map(role => `
            <li onclick="showRoleDetailById('${role.id}')" style="cursor: pointer; padding: 10px; margin: 5px 0; border-radius: 5px; transition: background 0.2s;" onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='transparent'">
                <strong>${role.roleTitle || 'Untitled Role'}</strong>
                <span style="float: right; color: #ff6b35; font-size: 0.9em;">‚Üí Click for details</span>
                <br>
                <small>
                    ${role.function || 'N/A'} ‚Ä¢ ${role.team || 'N/A'} ‚Ä¢
                    TC: ${role.leadTC || 'N/A'} ‚Ä¢
                    Status: ${role.roleStatus || 'N/A'}
                    ${role.dateStart ? `<br>Start: ${formatDate(role.dateStart)}` : ''}
                </small>
            </li>
        `).join('')}
    </ul>`;
}

// Helper function to format dates
function formatDate(date) {
    if (!date) return 'N/A';
    if (date instanceof Date) {
        return date.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
    }
    return new Date(date).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('detailModal');
    if (event.target === modal) {
        closeModal();
    }
}

// Show role detail by ID (helper function for onclick handlers)
function showRoleDetailById(roleId) {
    const role = hiringData.find(r => r.id === roleId);
    if (role) {
        handleRowClick(role);
    } else {
        console.error('Role not found:', roleId);
    }
}

// Handle table row clicks
function handleRowClick(rowData) {
    const modal = document.getElementById('detailModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');

    modalTitle.textContent = `üìã ${rowData.roleTitle}`;
    modalBody.innerHTML = `
        <div class="detail-section">
            <div class="detail-label">Role ID</div>
            <div class="detail-value">${rowData.id || 'N/A'}</div>
        </div>

        <div class="detail-section">
            <div class="detail-label">Status</div>
            <div class="detail-value">
                <span class="status-badge ${getStatusClass(rowData.roleStatus)}">
                    ${rowData.roleStatus || 'Unknown'}
                </span>
            </div>
        </div>

        <div class="detail-section">
            <div class="detail-label">Talent Champion</div>
            <div class="detail-value">${rowData.leadTC || 'N/A'}</div>
        </div>

        <div class="detail-section">
            <div class="detail-label">Team & Function</div>
            <div class="detail-value">${rowData.team || 'N/A'} (${rowData.function || 'N/A'})</div>
        </div>

        <div class="detail-section">
            <div class="detail-label">Tribe</div>
            <div class="detail-value">${rowData.tribe || 'N/A'}</div>
        </div>

        <div class="detail-section">
            <div class="detail-label">Location</div>
            <div class="detail-value">${rowData.geo || 'N/A'}</div>
        </div>

        <div class="detail-section">
            <div class="detail-label">Dates</div>
            <div class="detail-value">
                <strong>Opened:</strong> ${rowData.dateOpen ? new Date(rowData.dateOpen).toLocaleDateString() : 'N/A'}<br>
                <strong>Accepted:</strong> ${rowData.dateAccept ? new Date(rowData.dateAccept).toLocaleDateString() : 'N/A'}<br>
                <strong>Start:</strong> ${rowData.dateStart ? new Date(rowData.dateStart).toLocaleDateString() : 'N/A'}
            </div>
        </div>

        <div class="detail-section">
            <div class="detail-label">Role Type</div>
            <div class="detail-value">${rowData.roleType || 'N/A'} | ${rowData.swiggerType || 'N/A'}</div>
        </div>

        ${rowData.workableLink ? `
            <div class="detail-section">
                <div class="detail-label">Workable Link</div>
                <div class="detail-value">
                    <a href="${rowData.workableLink}" target="_blank" style="color: #ff6b35;">View in Workable ‚Üí</a>
                </div>
            </div>
        ` : ''}

        ${rowData.notes ? `
            <div class="detail-section">
                <div class="detail-label">Notes</div>
                <div class="detail-value">${rowData.notes}</div>
            </div>
        ` : ''}
    `;

    modal.style.display = 'block';
}

// Save changes to backend server
async function saveChangesToServer() {
    try {
        // Collect all changed roles
        const changes = [];

        changedRoles.forEach(roleId => {
            const role = hiringData.find(r => r.id === roleId);
            if (role) {
                changes.push(role);
            }
        });

        if (changes.length === 0) {
            alert('No changes to save');
            return;
        }

        // Send to server
        const response = await fetch('http://localhost:5000/api/save', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ changes })
        });

        const result = await response.json();

        if (result.success) {
            alert(`‚úÖ Successfully saved ${result.updated} changes to Excel file!\nBackup created: ${result.backup}`);

            // Clear changed roles tracking
            changedRoles.clear();

            // Reload data to reflect changes
            await loadData();
        } else {
            alert(`‚ùå Error saving changes: ${result.error}`);
        }
    } catch (error) {
        console.error('Error saving to server:', error);
        alert(`‚ùå Error connecting to server: ${error.message}\n\nMake sure the server is running:\npython3 server.py`);
    }
}

// Toggle edit mode
function toggleEditMode() {
    editMode = !editMode;

    const editBtn = document.getElementById('editModeBtn');
    const editModeActions = document.getElementById('editModeActions');

    if (editMode) {
        editBtn.textContent = '‚ùå Exit Edit';
        editBtn.style.background = 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)';
        editBtn.style.minWidth = '120px';

        // Show edit mode actions group
        if (editModeActions) {
            editModeActions.style.display = 'flex';
        }

        // Make table cells editable
        updateTable();
    } else {
        editBtn.textContent = '‚úèÔ∏è Edit';
        editBtn.style.background = 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)';
        editBtn.style.minWidth = '120px';

        // Hide edit mode actions group
        if (editModeActions) {
            editModeActions.style.display = 'none';
        }

        // Revert to read-only
        updateTable();
    }
}

// Export to Excel (download modified file)
function exportToExcel() {
    try {
        // Create workbook
        const wb = XLSX.utils.book_new();

        // Prepare data for export
        const exportData = hiringData.map(role => ({
            'ID': role.id,
            'Role Title': role.roleTitle,
            'Notes': role.notes || '',
            'Workable Link': role.workableLink || '',
            'Role Status': role.roleStatus,
            'Date Open': role.dateOpen ? new Date(role.dateOpen).toLocaleDateString() : '',
            'Date Accept': role.dateAccept ? new Date(role.dateAccept).toLocaleDateString() : '',
            'Date Start': role.dateStart ? new Date(role.dateStart).toLocaleDateString() : '',
            'Role Type': role.roleType || '',
            'Team': role.team || '',
            'Tribe': role.tribe || '',
            'Function': role.function || '',
            'Leader?': role.isLeader || '',
            'Grad?': role.isGrad || '',
            'Geo': role.geo || '',
            'Geo Fixed': role.geoFixed || '',
            'Swigger Type': role.swiggerType || '',
            'Lead TC': role.leadTC || '',
            'Sourcing Notes': role.sourcingNotes || '',
            'Strategic Initiative': role.strategicInitiative || ''
        }));

        // Create worksheet
        const ws = XLSX.utils.json_to_sheet(exportData);

        // Add worksheet to workbook
        XLSX.utils.book_append_sheet(wb, ws, 'Hiring');

        // Generate filename with timestamp
        const timestamp = new Date().toISOString().split('T')[0];
        const filename = `hiring-master-export-${timestamp}.xlsx`;

        // Download
        XLSX.writeFile(wb, filename);

        alert(`‚úÖ Exported to ${filename}\n\nTo update the original file:\n1. Close Excel if it's open\n2. Replace the original file with this export\n3. Refresh the dashboard`);
    } catch (error) {
        console.error('Export error:', error);
        alert(`‚ùå Export failed: ${error.message}`);
    }
}

// Add new role
function addNewRole() {
    const roleTitle = prompt('Enter role title:');
    if (!roleTitle) return;

    const leadTC = prompt('Enter Talent Champion:');
    const team = prompt('Enter team:');
    const func = prompt('Enter function (P&E, GTM, Support, Gr&C):');

    // Generate new ID
    const maxId = Math.max(...hiringData.map(r => parseInt(r.id) || 0));
    const newId = maxId + 1;

    const newRole = {
        id: newId,
        roleTitle: roleTitle,
        leadTC: leadTC,
        team: team,
        function: func,
        roleStatus: 'Future',
        dateOpen: null,
        dateAccept: null,
        dateStart: null
    };

    // Add to hiringData
    hiringData.push(newRole);
    newRoles.add(newId);
    changedRoles.add(newId);

    // Update display
    updateDashboard();

    alert(`‚úÖ New role added with ID ${newId}\n\nRemember to save changes to update the Excel file!`);
}

// Open timeline visualization in new window/tab
function openTimelineView() {
    window.open("timeline_visualization.html", "_blank");
}

// Toggle fullscreen for growth chart
function toggleGrowthChartFullscreen(event) {
    event.stopPropagation(); // Prevent card click event
    const chartCard = document.getElementById('growthChartCard');
    const btn = event.target;

    if (chartCard.classList.contains('chart-fullscreen')) {
        // Exit fullscreen
        chartCard.classList.remove('chart-fullscreen');
        btn.innerHTML = '‚õ∂ Fullscreen';

        // Resize chart after exiting fullscreen
        setTimeout(() => {
            if (charts.growth) {
                charts.growth.resize();
                charts.growth.update();
            }
        }, 100);
    } else {
        // Enter fullscreen
        chartCard.classList.add('chart-fullscreen');
        btn.innerHTML = '‚úï Exit Fullscreen';

        // Resize chart to fit fullscreen
        setTimeout(() => {
            if (charts.growth) {
                charts.growth.resize();
                charts.growth.update();
            }
        }, 100);
    }
}

// Add escape key listener to exit fullscreen
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        const chartCard = document.getElementById('growthChartCard');
        if (chartCard && chartCard.classList.contains('chart-fullscreen')) {
            const btn = chartCard.querySelector('button');
            if (btn) {
                btn.click();
            }
        }
    }
});


    // ============================================
    // EDIT MODE FUNCTIONALITY
    // ============================================
    // ============================================
// DATA MANAGEMENT & EDIT MODE FUNCTIONALITY
// ============================================

// Toggle edit mode
function toggleEditMode() {
    editMode = !editMode;
    const btn = document.getElementById('editModeBtn');
    const addBtn = document.getElementById('addRoleBtn');
    const exportBtn = document.getElementById('exportBtn');

    if (editMode) {
        btn.textContent = 'üëÅ View Mode';
        btn.style.background = 'linear-gradient(135deg, #f5576c 0%, #f093fb 100%)';
        addBtn.style.display = 'inline-block';
        exportBtn.style.display = 'inline-block';

        // Show edit mode indicator
        const indicator = document.createElement('div');
        indicator.id = 'editModeIndicator';
        indicator.className = 'edit-mode-indicator';
        indicator.textContent = '‚úèÔ∏è EDIT MODE - Click cells to edit';
        document.body.appendChild(indicator);

        // Update table header to include Actions column
        updateTableHeader(true);
    } else {
        btn.textContent = '‚úèÔ∏è Edit Mode';
        btn.style.background = 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)';
        addBtn.style.display = 'none';
        exportBtn.style.display = 'none';

        // Remove edit mode indicator
        const indicator = document.getElementById('editModeIndicator');
        if (indicator) indicator.remove();

        // Restore table header
        updateTableHeader(false);
    }

    // Refresh table to show/hide edit controls
    updateDashboard();
}

// Update table header based on edit mode
function updateTableHeader(isEditMode) {
    const headerRow = document.querySelector('.pipeline-table thead tr');
    if (!headerRow) return;

    if (isEditMode) {
        // Add Actions column if not present
        if (!document.getElementById('actionsHeader')) {
            const actionsHeader = document.createElement('th');
            actionsHeader.id = 'actionsHeader';
            actionsHeader.textContent = 'Actions';
            headerRow.appendChild(actionsHeader);
        }
    } else {
        // Remove Actions column
        const actionsHeader = document.getElementById('actionsHeader');
        if (actionsHeader) actionsHeader.remove();
    }
}

// Add new role
function addNewRole() {
    const newId = `J26-${String(hiringData.length + 1).padStart(3, '0')}`;
    const newRole = {
        id: newId,
        roleTitle: 'New Role',
        roleStatus: 'Future',
        leadTC: 'Anthony',
        function: 'P&E',
        team: 'TBD',
        tribe: 'TBD',
        dateOpen: null,
        dateAccept: null,
        dateStart: new Date(),
        geo: 'KNU',
        notes: '',
        workableLink: '',
        roleType: 'New',
        isLeader: false,
        isGrad: false,
        geoFixed: false,
        swiggerType: 'Permanent',
        sourcingNotes: '',
        __isNew: true
    };

    hiringData.unshift(newRole); // Add to beginning
    newRoles.add(newId);
    saveToLocalStorage();
    updateDashboard();

    // Scroll to top of table
    document.querySelector('.pipeline-table').scrollIntoView({ behavior: 'smooth' });
}

// Delete role
function deleteRole(roleId) {
    if (!confirm('Are you sure you want to delete this role?')) return;

    deletedRoles.add(roleId);
    changedRoles.delete(roleId);
    newRoles.delete(roleId);

    saveToLocalStorage();
    updateDashboard();
}

// Make cell editable
function makeEditable(cell, roleId, field, currentValue) {
    if (cell.classList.contains('editing')) return;

    cell.classList.add('editing');
    const originalContent = cell.innerHTML;

    // Create input based on field type
    let input;
    if (field === 'roleStatus') {
        input = document.createElement('select');
        ['Offer Accepted', 'Pipeline Open', 'Future', 'On Hold', 'Cancelled'].forEach(status => {
            const option = document.createElement('option');
            option.value = status;
            option.textContent = status;
            if (status === currentValue) option.selected = true;
            input.appendChild(option);
        });
    } else if (field === 'leadTC') {
        input = document.createElement('select');
        ['Anthony', 'Simon', 'Mia', 'Adam', 'Tom'].forEach(champ => {
            const option = document.createElement('option');
            option.value = champ;
            option.textContent = champ;
            if (champ === currentValue) option.selected = true;
            input.appendChild(option);
        });
    } else if (field === 'function') {
        input = document.createElement('select');
        ['P&E', 'GTM', 'Support'].forEach(func => {
            const option = document.createElement('option');
            option.value = func;
            option.textContent = func;
            if (func === currentValue) option.selected = true;
            input.appendChild(option);
        });
    } else if (field === 'dateStart' || field === 'dateOpen' || field === 'dateAccept') {
        input = document.createElement('input');
        input.type = 'date';
        if (currentValue) {
            const date = new Date(currentValue);
            input.value = date.toISOString().split('T')[0];
        }
    } else {
        input = document.createElement('input');
        input.type = 'text';
        input.value = currentValue || '';
    }

    cell.innerHTML = '';
    cell.appendChild(input);
    input.focus();

    // Save on blur or enter
    const save = () => {
        const newValue = input.value;
        if (newValue !== currentValue) {
            updateRoleField(roleId, field, newValue);
        }
        cell.classList.remove('editing');
        cell.innerHTML = originalContent;
    };

    input.addEventListener('blur', save);
    input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') save();
        if (e.key === 'Escape') {
            cell.classList.remove('editing');
            cell.innerHTML = originalContent;
        }
    });
}

// Update role field
function updateRoleField(roleId, field, newValue) {
    const role = hiringData.find(r => r.id === roleId);
    if (!role) return;

    // Convert date strings to Date objects
    if (field === 'dateStart' || field === 'dateOpen' || field === 'dateAccept') {
        role[field] = newValue ? new Date(newValue) : null;
    } else {
        role[field] = newValue;
    }

    changedRoles.add(roleId);
    saveToLocalStorage();
    updateDashboard();
}

// Save to LocalStorage
function saveToLocalStorage() {
    try {
        localStorage.setItem('hiringData', JSON.stringify(hiringData));
        localStorage.setItem('changedRoles', JSON.stringify([...changedRoles]));
        localStorage.setItem('deletedRoles', JSON.stringify([...deletedRoles]));
        localStorage.setItem('newRoles', JSON.stringify([...newRoles]));
        console.log('Data saved to localStorage');
    } catch (e) {
        console.error('Error saving to localStorage:', e);
        alert('Error saving changes. Storage may be full.');
    }
}

// Load from LocalStorage
function loadFromLocalStorage() {
    try {
        const savedData = localStorage.getItem('hiringData');
        const savedChanged = localStorage.getItem('changedRoles');
        const savedDeleted = localStorage.getItem('deletedRoles');
        const savedNew = localStorage.getItem('newRoles');

        if (savedData) {
            hiringData = JSON.parse(savedData).map(role => ({
                ...role,
                dateOpen: role.dateOpen ? new Date(role.dateOpen) : null,
                dateAccept: role.dateAccept ? new Date(role.dateAccept) : null,
                dateStart: role.dateStart ? new Date(role.dateStart) : null
            }));
        }
        if (savedChanged) changedRoles = new Set(JSON.parse(savedChanged));
        if (savedDeleted) deletedRoles = new Set(JSON.parse(savedDeleted));
        if (savedNew) newRoles = new Set(JSON.parse(savedNew));

        if (savedData) {
            console.log('Loaded saved changes from localStorage');
            updateDashboard();
        }
    } catch (e) {
        console.error('Error loading from localStorage:', e);
    }
}

// Export to Excel
function exportToExcel() {
    // Filter out deleted roles
    const exportData = hiringData.filter(role => !deletedRoles.has(role.id));

    // Convert to format suitable for Excel
    const excelData = exportData.map(role => ({
        'ID': role.id,
        'Role Title': role.roleTitle,
        'Notes': role.notes || '',
        'Workable Link': role.workableLink || '',
        'Role Status': role.roleStatus,
        'Date Open': role.dateOpen ? formatDateForExcel(role.dateOpen) : '',
        'Date Accept': role.dateAccept ? formatDateForExcel(role.dateAccept) : '',
        'Date Start': role.dateStart ? formatDateForExcel(role.dateStart) : '',
        'Role Type': role.roleType || '',
        'Team': role.team || '',
        'Tribe': role.tribe || '',
        'Function': role.function || '',
        'Is Leader': role.isLeader ? 'Yes' : 'No',
        'Is Grad': role.isGrad ? 'Yes' : 'No',
        'Geo': role.geo || '',
        'Geo Fixed': role.geoFixed ? 'Yes' : 'No',
        'Swigger Type': role.swiggerType || '',
        'Lead TC': role.leadTC || '',
        'Sourcing Notes': role.sourcingNotes || ''
    }));

    // Create worksheet for growth roles
    const ws = XLSX.utils.json_to_sheet(excelData);

    // Create workbook
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'Hiring');

    // Add backfills as separate sheet
    if (window.backfillRoles && window.backfillRoles.length > 0) {
        const backfillData = window.backfillRoles.map(backfill => ({
            'Type': 'Backfill',
            'Departure Month': backfill.departureMonth,
            'Backfill Open Month': backfill.backfillOpenMonth,
            'Backfill Open Date': formatDateForExcel(backfill.backfillOpenDate),
            'Role Title': backfill.roleTitle,
            'Function': backfill.function || 'TBD',
            'Champion': backfill.champion,
            'Status': backfill.status,
            'Notes': `Backfill for departure in ${backfill.departureMonth}`
        }));
        const wsBackfills = XLSX.utils.json_to_sheet(backfillData);
        XLSX.utils.book_append_sheet(wb, wsBackfills, 'Backfills');
    }

    // Generate filename with timestamp
    const timestamp = new Date().toISOString().slice(0, 10);
    const filename = `PortSwigger_Hiring_Modified_${timestamp}.xlsx`;

    // Download
    XLSX.writeFile(wb, filename);

    const backfillCount = window.backfillRoles ? window.backfillRoles.length : 0;
    alert(`‚úÖ Data exported to ${filename}\n\nGrowth Roles:\n  Modified: ${changedRoles.size}\n  New: ${newRoles.size}\n  Deleted: ${deletedRoles.size}\n\nBackfill Roles: ${backfillCount}`);
}

// Format date for Excel
function formatDateForExcel(date) {
    if (!date) return '';
    const d = new Date(date);
    return `${d.getMonth() + 1}/${d.getDate()}/${d.getFullYear()}`;
}

// Clear all local changes
function clearLocalChanges() {
    if (!confirm('Clear all local changes and reload from Excel files? This cannot be undone.')) return;

    localStorage.removeItem('hiringData');
    localStorage.removeItem('changedRoles');
    localStorage.removeItem('deletedRoles');
    localStorage.removeItem('newRoles');

    changedRoles.clear();
    deletedRoles.clear();
    newRoles.clear();

    location.reload();
}


    // ============================================
    // AI ASSISTANT
    // ============================================
    // AI Assistant for Dashboard - Powered by Claude API
// Provides intelligent answers about hiring data, metrics, and calculations

class DashboardAIAssistant {
    constructor() {
        this.conversationHistory = [];
        this.apiKey = null; // User will need to provide their Anthropic API key
        this.isInitialized = false;
    }

    // Initialize the assistant with API key from user
    initialize(apiKey) {
        this.apiKey = apiKey;
        this.isInitialized = true;
        console.log('AI Assistant initialized');
    }

    // Get comprehensive dashboard context for the AI
    getDashboardContext() {
        const context = {
            timestamp: new Date().toISOString(),

            // Current metrics from dashboard
            metrics: {
                totalPlan2026: document.getElementById('totalPlan2026')?.textContent || 'N/A',
                offersAccepted: document.getElementById('offersAccepted')?.textContent || 'N/A',
                accepted2026Only: document.getElementById('accepted2026Only')?.textContent || 'N/A',
                pipelineOpen: document.getElementById('pipelineOpen')?.textContent || 'N/A',
                futureRoles: document.getElementById('futureRoles')?.textContent || 'N/A',
                growthTarget: document.getElementById('growthTarget')?.textContent || 'N/A',
                expectedAttrition: document.getElementById('expectedAttrition')?.textContent || 'N/A',
                targetProbability: document.getElementById('targetProbability')?.textContent || 'N/A'
            },

            // Raw hiring data
            hiringData: window.hiringData ? {
                totalRecords: window.hiringData.length,
                statuses: this.getStatusBreakdown(window.hiringData),
                functions: this.getFunctionBreakdown(window.hiringData),
                champions: this.getChampionBreakdown(window.hiringData),
                monthlyDistribution: this.getMonthlyDistribution(window.hiringData),
                sample: window.hiringData.slice(0, 5) // First 5 records as sample
            } : null,

            // Attrition data
            attritionData: window.attritionData ? {
                totalAttrition: window.attritionData.reduce((sum, item) => sum + Math.abs(item.count || 0), 0),
                byMonth: window.attritionData.map(item => ({
                    date: item.date,
                    count: item.count,
                    name: item.name
                }))
            } : null,

            // Visualization data (Future roles timeline)
            visualizationData: window.visualizationData ? {
                monthlyFuture: window.visualizationData.monthlyFuture || [],
                totalFutureRoles: window.visualizationData.monthlyFuture
                    ? window.visualizationData.monthlyFuture.reduce((sum, count) => sum + count, 0)
                    : 0,
                note: "Future roles tracked in visualization sheet with multiplier notation (e.g., 'Role x12' = 12 roles)"
            } : null,

            // Backfill roles (generated from attrition)
            backfillRoles: window.backfillRoles ? {
                totalBackfills: window.backfillRoles.length,
                notOpened: window.backfillRoles.filter(b => b.status === 'Backfill - Not Opened').length,
                byMonth: window.backfillRoles.reduce((acc, b) => {
                    const month = b.backfillOpenMonth;
                    acc[month] = (acc[month] || 0) + 1;
                    return acc;
                }, {}),
                explanation: "Each attrition departure generates 1 backfill role opening the month AFTER departure. All assigned to 'Misc Talent Champion'.",
                impact: "44 attrition departures = 44 backfill roles needed to maintain headcount"
            } : null,

            // Configuration and constants
            config: window.CONFIG || {},

            // Calculation explanations
            calculations: {
                growthTarget: {
                    description: "30% growth target = 53 NET new headcount (177 starting employees * 0.30)",
                    baselineHeadcount: 177,
                    targetHires: 53,
                    isNetGrowth: true
                },
                targetProbability: {
                    description: "Probability is based on NET growth (projected hires minus expected attrition) divided by target",
                    formula: "(Projected Total Hires - Expected Attrition) / Growth Target",
                    factors: ["Pipeline conversion rate", "Future role conversion rate", "Expected attrition", "Current accepted offers"]
                },
                accepted2026Only: {
                    description: "Counts roles with status 'Offer Accepted' OR 'Started' AND Date_Start year = 2026",
                    excludes: "2025 historical hires, roles without start dates"
                },
                pipelineOpen: {
                    description: "Count of UNIQUE role titles with status 'Pipeline Open'",
                    note: "Uses Set() to avoid counting duplicate postings of same role"
                },
                futureRoles: {
                    description: "Future roles include BOTH growth roles (NEW positions) AND backfill roles (REPLACEMENT positions)",
                    growthFuture: "From visualization timeline sheet with multiplier notation (e.g., 'Product Engineer x12' = 12 roles)",
                    backfillFuture: "Generated from attrition data - each departure creates 1 backfill opening month-after",
                    calculation: "Total Future = Growth Future (46) + Backfill (44) = 90 total future roles",
                    source: "Hiring Resources - Central Document (2).xlsx, sheet 'Hiring Plan 2026 visualisation' + attrition expected.xlsx"
                },
                totalHiringDemand: {
                    description: "GROSS hiring demand = Growth roles (53) + Backfill roles (44) = 97 total",
                    breakdown: "Growth roles increase headcount from 177 to 230. Backfills maintain existing headcount against attrition.",
                    netGrowth: "NET growth = 53 (after accounting for 44 attrition via backfills)"
                }
            },

            // Strategic bets information
            strategicBets: window.strategicBetsData || null,

            // Current filters applied
            currentFilters: window.currentFilters || {},

            // Dashboard state
            dashboardState: {
                editMode: window.editMode || false,
                autoRefreshEnabled: window.autoRefreshEnabled || false
            }
        };

        return context;
    }

    // Helper: Get status breakdown
    getStatusBreakdown(data) {
        const breakdown = {};
        data.forEach(role => {
            const status = role.roleStatus || 'Unknown';
            breakdown[status] = (breakdown[status] || 0) + 1;
        });
        return breakdown;
    }

    // Helper: Get function breakdown
    getFunctionBreakdown(data) {
        const breakdown = {};
        data.forEach(role => {
            const func = role.function || 'Unassigned';
            breakdown[func] = (breakdown[func] || 0) + 1;
        });
        return breakdown;
    }

    // Helper: Get champion breakdown
    getChampionBreakdown(data) {
        const breakdown = {};
        data.forEach(role => {
            const champion = role.leadTC || 'Unassigned';
            breakdown[champion] = (breakdown[champion] || 0) + 1;
        });
        return breakdown;
    }

    // Helper: Get monthly distribution
    getMonthlyDistribution(data) {
        const distribution = {};
        data.forEach(role => {
            if (role.dateStart) {
                const date = new Date(role.dateStart);
                const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                distribution[monthKey] = (distribution[monthKey] || 0) + 1;
            }
        });
        return distribution;
    }

    // Send message to Claude API
    async sendMessage(userMessage) {
        if (!this.isInitialized || !this.apiKey) {
            return {
                error: true,
                message: "AI Assistant not initialized. Please provide your Anthropic API key in the settings."
            };
        }

        try {
            // Get current dashboard context
            const context = this.getDashboardContext();

            // Build system prompt with all context
            const systemPrompt = `You are an AI assistant for the PortSwigger Talent Acquisition Dashboard. You have access to all hiring data, metrics, and calculations.

Current Dashboard Data:
${JSON.stringify(context, null, 2)}

Your role:
- Answer questions about the dashboard data, metrics, and calculations
- Explain why certain numbers are what they are
- Help users understand NET vs GROSS growth and the backfill system
- Explain the distinction between growth roles (NEW positions) and backfill roles (REPLACEMENT positions)
- Explain the impact of attrition on growth targets
- Provide insights from the data
- Reference specific numbers and calculations from the context above

When answering:
- Be specific and cite actual numbers from the data
- Explain calculations step-by-step when relevant
- If asked about probability or projections, explain the NET growth concept (hires minus attrition)
- Always be accurate and transparent about what you can and cannot determine from the data

Key Concepts to Explain:
- BACKFILL SYSTEM: Each attrition departure generates 1 backfill role opening the month AFTER departure
- 44 attrition departures in 2026 = 44 backfill roles needed to maintain headcount
- Backfills are assigned to "Misc Talent Champion" with status "Backfill - Not Opened"
- GROSS hiring demand = 97 (53 growth + 44 backfills)
- NET growth target = 53 (excludes backfills, which only maintain headcount)
- Growth roles INCREASE headcount (177 ‚Üí 230), backfills MAINTAIN it
- Future Roles (90) = Growth Future (46) + Backfill (44)

User's timezone: ${Intl.DateTimeFormat().resolvedOptions().timeZone}
Current date: ${new Date().toLocaleDateString()}`;

            // Add user message to history
            this.conversationHistory.push({
                role: 'user',
                content: userMessage
            });

            // Call Claude API
            const response = await fetch('https://api.anthropic.com/v1/messages', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': this.apiKey,
                    'anthropic-version': '2023-06-01'
                },
                body: JSON.stringify({
                    model: 'claude-3-5-sonnet-20241022',
                    max_tokens: 2048,
                    system: systemPrompt,
                    messages: this.conversationHistory.slice(-10) // Keep last 10 messages for context
                })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`API Error: ${errorData.error?.message || response.statusText}`);
            }

            const data = await response.json();
            const assistantMessage = data.content[0].text;

            // Add assistant response to history
            this.conversationHistory.push({
                role: 'assistant',
                content: assistantMessage
            });

            return {
                error: false,
                message: assistantMessage,
                usage: data.usage
            };

        } catch (error) {
            console.error('AI Assistant Error:', error);
            return {
                error: true,
                message: `Error: ${error.message}`
            };
        }
    }

    // Clear conversation history
    clearHistory() {
        this.conversationHistory = [];
    }

    // Export conversation
    exportConversation() {
        return {
            timestamp: new Date().toISOString(),
            messages: this.conversationHistory
        };
    }
}

// Initialize global assistant instance
window.dashboardAI = new DashboardAIAssistant();


    // ============================================
    // BOARD PACK GENERATION
    // ============================================
    // Board Pack Generation - Executive-Level Reporting
// Generates comprehensive hiring metrics report for board members

function generateBoardPack() {
    console.log('Generating Board Pack...');

    // Get current date for report
    const reportDate = new Date();
    const reportMonth = reportDate.toLocaleString('en-US', { month: 'long', year: 'numeric' });

    // Calculate all metrics
    const metrics = calculateBoardMetrics();

    // Generate HTML report
    const reportHTML = generateBoardPackHTML(metrics, reportMonth);

    // Open in new window for printing/PDF export
    const printWindow = window.open('', '_blank');
    printWindow.document.write(reportHTML);
    printWindow.document.close();

    // Automatically trigger print dialog
    printWindow.onload = function() {
        printWindow.print();
    };
}

function calculateBoardMetrics() {
    const currentYear = 2026;
    const currentMonth = new Date().getMonth(); // 0-11

    // Helper function to check if role is grad
    const isGradRole = (role) => {
        if (!role.isGrad) return false;
        const gradValue = String(role.isGrad).toLowerCase().trim();
        return gradValue === 'yes' || gradValue === 'y' || gradValue === 'true' || gradValue === '1' || gradValue.includes('grad');
    };

    // Filter for 2026-relevant data only: active roles + 2026 starters (exclude 2025 starters)
    const is2026Relevant = (role) => {
        // Exclude cancelled roles
        if (role.roleStatus === 'Cancelled') return false;

        // If role is accepted/started, must have 2026 start date (not 2025)
        if (role.roleStatus === 'Offer Accepted' || role.roleStatus === 'Started') {
            if (role.dateStart) {
                const startYear = new Date(role.dateStart).getFullYear();
                return startYear === 2026; // Only 2026 starts, exclude 2025
            }
            // If no start date, assume it's still being planned for 2026
            return true;
        }

        // Include all other active roles (Pipeline, Future, On Hold)
        return true;
    };

    // 1. HEADLINE METRICS - Filter for 2026-relevant roles only
    // Use getAllRoles() to include both growth roles and backfills
    const allRoles = typeof getAllRoles === 'function' ? getAllRoles() : hiringData;
    const totalPlan2026 = allRoles.filter(is2026Relevant).length;

    const acceptedRoles2026 = allRoles.filter(r => {
        if (r.roleStatus !== 'Offer Accepted' && r.roleStatus !== 'Started') return false;
        // Only include 2026 starters
        if (r.dateStart) {
            const startYear = new Date(r.dateStart).getFullYear();
            return startYear === 2026;
        }
        // If no start date, assume 2026
        return true;
    });

    const offersAccepted2026 = acceptedRoles2026.length;

    // Count unique role titles for Pipeline Open (consistent with dashboard)
    const pipelineOpenRoles = allRoles.filter(r => is2026Relevant(r) && r.roleStatus === 'Pipeline Open');
    const pipelineOpen = new Set(pipelineOpenRoles.map(r => r.roleTitle || 'Untitled Role')).size;
    const pipelineOpenTotal = pipelineOpenRoles.length; // Total live roles across all pipelines

    // Count Future roles - includes BOTH visualization data AND backfills
    // Growth future roles from visualization timeline
    const futureGrowthRoles = window.visualizationData && window.visualizationData.monthlyFuture
        ? window.visualizationData.monthlyFuture.reduce((sum, count) => sum + count, 0)
        : 0;
    // Backfill roles not yet opened
    const futureBackfillRoles = (window.backfillRoles || [])
        .filter(b => b.status === 'Backfill - Not Opened').length;
    const futureRoles = futureGrowthRoles + futureBackfillRoles;
    const futureRolesTotal = futureRoles;

    const onHold = allRoles.filter(r => is2026Relevant(r) && r.roleStatus === 'On Hold').length;

    // Progress percentage
    const progressPct = ((offersAccepted2026 / totalPlan2026) * 100).toFixed(1);

    // 2. FUNCTION BREAKDOWN - Only 2026-relevant roles (includes backfills)
    const functionBreakdown = {};
    allRoles.forEach(role => {
        if (!is2026Relevant(role)) return; // Exclude 2025 starters and cancelled roles

        const func = role.function || 'Unassigned';
        if (!functionBreakdown[func]) {
            functionBreakdown[func] = { plan: 0, hired: 0, pipeline: 0 };
        }
        functionBreakdown[func].plan++;

        if (role.roleStatus === 'Offer Accepted' || role.roleStatus === 'Started') {
            // Only count if it's a 2026 starter
            if (role.dateStart) {
                if (new Date(role.dateStart).getFullYear() === 2026) {
                    functionBreakdown[func].hired++;
                }
            } else {
                // No start date means still being planned for 2026
                functionBreakdown[func].hired++;
            }
        }
        if (role.roleStatus === 'Pipeline Open') {
            functionBreakdown[func].pipeline++;
        }
    });

    // Add backfills to TBD function category
    if (window.backfillRoles && window.backfillRoles.length > 0) {
        if (!functionBreakdown['TBD']) {
            functionBreakdown['TBD'] = { plan: 0, hired: 0, pipeline: 0 };
        }
        functionBreakdown['TBD'].plan += window.backfillRoles.length;
    }

    // 3. MONTHLY HIRING TRAJECTORY - Dual-layer: Actual hires + Future pipeline
    const monthlyHires = Array(12).fill(0);
    const monthlyFuture = Array(12).fill(0);

    // Track actual accepted offers by accept date
    allRoles.forEach(role => {
        if ((role.roleStatus === 'Offer Accepted' || role.roleStatus === 'Started') && role.dateAccept) {
            // Only include 2026 starters
            if (role.dateStart && new Date(role.dateStart).getFullYear() !== 2026) return;

            const acceptDate = new Date(role.dateAccept);
            if (acceptDate.getFullYear() === 2026) {
                const month = acceptDate.getMonth();
                monthlyHires[month]++;
            }
        }
    });

    // Track Future roles from "Hiring Resources - Central Document" visualization sheet
    // This sheet contains planned hiring timeline that hasn't been added to Hiring Master yet
    if (window.visualizationData && window.visualizationData.monthlyFuture) {
        // Use pre-loaded visualization data if available
        for (let month = 0; month < 12; month++) {
            monthlyFuture[month] = window.visualizationData.monthlyFuture[month] || 0;
        }
    } else {
        // Fallback: Track Future roles from Hiring Master by their planned start date
        allRoles.forEach(role => {
            if (role.roleStatus === 'Future' && is2026Relevant(role) && role.dateStart) {
                const startDate = new Date(role.dateStart);
                if (startDate.getFullYear() === 2026) {
                    const month = startDate.getMonth();
                    monthlyFuture[month]++;
                }
            }
        });
    }

    // Add backfill openings to monthly future
    if (window.backfillRoles) {
        window.backfillRoles.forEach(backfill => {
            const openDate = new Date(backfill.backfillOpenDate);
            if (openDate.getFullYear() === 2026) {
                const month = openDate.getMonth();
                if (month >= 0 && month < 12) {
                    monthlyFuture[month]++;
                }
            }
        });
    }

    // 4. CHAMPION WORKLOAD - Only 2026-relevant roles (includes backfills)
    const championWorkload = {};
    allRoles.forEach(role => {
        if (!is2026Relevant(role)) return; // Exclude 2025 starters and cancelled roles

        const champion = role.leadTC || 'Unassigned';
        if (!championWorkload[champion]) {
            championWorkload[champion] = { total: 0, active: 0, completed: 0 };
        }
        championWorkload[champion].total++;

        if (role.roleStatus === 'Pipeline Open') {
            championWorkload[champion].active++;
        }
        if (role.roleStatus === 'Offer Accepted' || role.roleStatus === 'Started') {
            // Only count 2026 starters as completed
            if (!role.dateStart || new Date(role.dateStart).getFullYear() === 2026) {
                championWorkload[champion].completed++;
            }
        }
    });

    // Add Misc Talent Champion with all backfills
    if (window.backfillRoles && window.backfillRoles.length > 0) {
        if (!championWorkload['Misc Talent Champion']) {
            championWorkload['Misc Talent Champion'] = { total: 0, active: 0, completed: 0 };
        }
        championWorkload['Misc Talent Champion'].total += window.backfillRoles.length;
    }

    // 5. TIME-TO-HIRE METRICS - Only 2026 starters
    const timeToHireData = [];
    allRoles.forEach(role => {
        // Only include 2026 starters
        if (role.dateStart && new Date(role.dateStart).getFullYear() !== 2026) return;

        if (role.dateOpen && role.dateAccept) {
            const openDate = new Date(role.dateOpen);
            const acceptDate = new Date(role.dateAccept);
            const days = Math.round((acceptDate - openDate) / (1000 * 60 * 60 * 24));
            if (days > 0 && days < 365) {
                timeToHireData.push(days);
            }
        }
    });

    const avgTimeToHire = timeToHireData.length > 0
        ? Math.round(timeToHireData.reduce((a, b) => a + b, 0) / timeToHireData.length)
        : 0;

    const medianTimeToHire = timeToHireData.length > 0
        ? timeToHireData.sort((a, b) => a - b)[Math.floor(timeToHireData.length / 2)]
        : 0;

    // 6. GRAD VS NON-GRAD - Only 2026 starters
    const gradHires = hiringData.filter(r => {
        if (r.roleStatus !== 'Offer Accepted' && r.roleStatus !== 'Started') return false;
        if (!isGradRole(r)) return false;
        // Only count 2026 starters
        if (r.dateStart) {
            return new Date(r.dateStart).getFullYear() === 2026;
        }
        // If no start date, assume 2026
        return true;
    }).length;

    const nonGradHires = offersAccepted2026 - gradHires;

    // 7. AT RISK ROLES - Only 2026-relevant active roles
    const atRiskRoles = hiringData.filter(role => {
        if (!is2026Relevant(role)) return false; // Exclude 2025 roles
        if (role.roleStatus !== 'Pipeline Open') return false;
        if (!role.dateOpen) return false;

        const openDate = new Date(role.dateOpen);
        const daysSinceOpen = Math.round((new Date() - openDate) / (1000 * 60 * 60 * 24));

        return daysSinceOpen > 90; // Over 90 days
    });

    // 8. QUARTERLY BREAKDOWN - Only 2026 starters
    const quarterlyData = {
        Q1: { hired: 0, pipeline: 0 },
        Q2: { hired: 0, pipeline: 0 },
        Q3: { hired: 0, pipeline: 0 },
        Q4: { hired: 0, pipeline: 0 }
    };

    hiringData.forEach(role => {
        if (!is2026Relevant(role)) return; // Exclude 2025 starters

        if (role.dateStart) {
            const startDate = new Date(role.dateStart);
            if (startDate.getFullYear() === 2026) {
                const month = startDate.getMonth();
                const quarter = month < 3 ? 'Q1' : month < 6 ? 'Q2' : month < 9 ? 'Q3' : 'Q4';

                if (role.roleStatus === 'Offer Accepted' || role.roleStatus === 'Started') {
                    quarterlyData[quarter].hired++;
                } else if (role.roleStatus === 'Pipeline Open') {
                    quarterlyData[quarter].pipeline++;
                }
            }
        }
    });

    // 9. STRATEGIC BETS ALIGNMENT - Load bet mapping and calculate metrics
    let strategicBets = {};
    try {
        // Load bet mapping from file
        const fs = require('fs');
        const mappingPath = 'bet_alignment_mapping.json';

        if (fs.existsSync(mappingPath)) {
            const mapping = JSON.parse(fs.readFileSync(mappingPath, 'utf8'));

            // Define bet info
            const betNames = ['Scale Execution', 'Launch the Invasion', 'Defend our Ground', 'Build the Bridge'];

            betNames.forEach(betName => {
                // Find roles aligned to this bet
                const rolesInBet = hiringData.filter(role => {
                    const roleKey = `${(role.roleTitle || '').toLowerCase()}|${(role.function || '').toLowerCase()}`;
                    const betData = mapping[roleKey];
                    return betData && betData.bet === betName;
                }).filter(is2026Relevant);

                const accepted = rolesInBet.filter(r => {
                    if (r.roleStatus !== 'Offer Accepted' && r.roleStatus !== 'Started') return false;
                    if (!r.dateStart) return false;
                    return new Date(r.dateStart).getFullYear() === 2026;
                }).length;

                // Count unique role titles (consistent with dashboard approach)
                const pipelineRoles = rolesInBet.filter(r => r.roleStatus === 'Pipeline Open');
                const pipeline = new Set(pipelineRoles.map(r => r.roleTitle || 'Untitled Role')).size;

                // FIX: Include BOTH visualization future roles AND backfills
                const futureRoles = rolesInBet.filter(r =>
                    r.roleStatus === 'Future' || // Visualization roles
                    r.roleStatus === 'Backfill - Not Opened' || // Backfills
                    r.__type === 'visualization' || // Explicitly marked
                    r.__isBackfill // Explicitly marked backfills
                );
                const future = new Set(futureRoles.map(r => r.roleTitle || 'Untitled Role')).size;
                const total = rolesInBet.length;
                const progressPct = total > 0 ? ((accepted / total) * 100).toFixed(1) : '0.0';

                strategicBets[betName] = {
                    total,
                    accepted,
                    pipeline,
                    future,
                    progressPct,
                    roles: rolesInBet
                };
            });
        }
    } catch (error) {
        console.warn('Could not load strategic bets data:', error.message);
    }

    return {
        reportDate: new Date(),
        headline: {
            totalPlan2026,
            offersAccepted2026,
            pipelineOpen,
            pipelineOpenTotal,
            futureRoles,
            futureRolesTotal,
            onHold,
            progressPct
        },
        acceptedRoles: acceptedRoles2026.map(r => ({
            id: r.id,
            title: r.roleTitle,
            function: r.function || 'Unassigned',
            team: r.team || 'Unassigned',
            champion: r.leadTC || 'Unassigned',
            dateAccept: r.dateAccept,
            dateStart: r.dateStart,
            status: r.roleStatus,
            isGrad: isGradRole(r)
        })).sort((a, b) => {
            // Sort by start date, then accept date
            const aDate = a.dateStart || a.dateAccept || new Date(0);
            const bDate = b.dateStart || b.dateAccept || new Date(0);
            return new Date(aDate) - new Date(bDate);
        }),
        functionBreakdown,
        monthlyHires,
        monthlyFuture,
        championWorkload,
        timeToHire: {
            average: avgTimeToHire,
            median: medianTimeToHire,
            count: timeToHireData.length
        },
        demographics: {
            gradHires,
            nonGradHires
        },
        atRiskRoles: {
            count: atRiskRoles.length,
            roles: atRiskRoles.map(r => ({ id: r.id, title: r.roleTitle, daysOpen: Math.round((new Date() - new Date(r.dateOpen)) / (1000 * 60 * 60 * 24)) }))
        },
        quarterlyData,
        strategicBets
    };
}

function generateBoardPackHTML(metrics, reportMonth) {
    const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

    return `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PortSwigger Board Pack - ${reportMonth}</title>
    <style>
        @media print {
            @page {
                size: A4;
                margin: 20mm;
            }
            body {
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }
            .page-break {
                page-break-before: always;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: white;
            padding: 40px;
        }

        .header {
            border-bottom: 4px solid #ff6b35;
            padding-bottom: 20px;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #ff6b35;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: #666;
            font-size: 18px;
        }

        .header .date {
            color: #999;
            font-size: 14px;
            margin-top: 10px;
        }

        .section {
            margin-bottom: 40px;
        }

        .section-title {
            color: #ff6b35;
            font-size: 24px;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .metric-card.highlight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .metric-card.success {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
        }

        .metric-card.warning {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        .metric-label {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .metric-value {
            font-size: 36px;
            font-weight: bold;
        }

        .metric-subtext {
            font-size: 12px;
            margin-top: 5px;
            opacity: 0.8;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        thead {
            background: #f8f9fa;
        }

        th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #ff6b35;
            border-bottom: 2px solid #dee2e6;
        }

        td {
            padding: 10px 12px;
            border-bottom: 1px solid #eee;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .progress-bar {
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: width 0.3s ease;
        }

        .chart-container {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .bar-chart {
            display: flex;
            align-items: flex-end;
            height: 200px;
            gap: 10px;
            padding: 20px 0;
        }

        .bar {
            flex: 1;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            border-radius: 5px 5px 0 0;
            position: relative;
            min-height: 5px;
        }

        .bar-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            white-space: nowrap;
        }

        .bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 14px;
            font-weight: bold;
            color: #333;
        }

        .executive-summary {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 40px;
        }

        .executive-summary h2 {
            color: #d35400;
            margin-bottom: 15px;
        }

        .executive-summary p {
            margin-bottom: 10px;
            line-height: 1.8;
        }

        .risk-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
            background: #fee140;
            color: #d35400;
        }

        .footer {
            margin-top: 60px;
            padding-top: 20px;
            border-top: 2px solid #eee;
            text-align: center;
            color: #999;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìä Talent Acquisition Board Pack - 2026</h1>
        <div class="subtitle">PortSwigger - 2026 Strategy & Planning Report</div>
        <div class="date">Report Date: ${metrics.reportDate.toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' })}</div>
        <div style="background: #667eea; color: white; padding: 10px; border-radius: 5px; margin-top: 10px; font-size: 14px;">
            <strong>Note:</strong> This report focuses exclusively on 2026 hires (active roles + 2026 starters). 2025 historical hires are excluded for strategic 2026 planning.
        </div>
    </div>

    <!-- EXECUTIVE SUMMARY -->
    <div class="executive-summary">
        <h2>Executive Summary - 2026 Strategy</h2>
        <p><strong>2026 Hiring Progress:</strong> ${metrics.headline.offersAccepted2026} offers accepted out of ${metrics.headline.totalPlan2026} planned roles (${metrics.headline.progressPct}% completion). ${metrics.headline.pipelineOpen} roles currently in active recruitment.</p>

        ${Object.keys(metrics.strategicBets || {}).length > 0 ? `
        <p><strong>üéØ Strategic Bets Overview:</strong> ${(() => {
            const totalRoles = Object.values(metrics.strategicBets).reduce((sum, bet) => sum + bet.total, 0);
            const totalAccepted = Object.values(metrics.strategicBets).reduce((sum, bet) => sum + bet.accepted, 0);
            const overallProgress = totalRoles > 0 ? ((totalAccepted / totalAccepted) * 100).toFixed(1) : 0;
            const critical = Object.entries(metrics.strategicBets).filter(([_, d]) => parseFloat(d.progressPct) < 50);
            const onTrack = Object.entries(metrics.strategicBets).filter(([_, d]) => parseFloat(d.progressPct) >= 75);

            return `${totalAccepted} of ${totalRoles} strategic roles filled (${overallProgress}% progress). ${onTrack.length} bet(s) on track, ${critical.length > 0 ? `<span style="color: #ff6b6b; font-weight: 700;">${critical.length} bet(s) require urgent attention</span>` : 'all bets showing activity'}.`;
        })()}</p>
        ` : ''}

        <p><strong>Pipeline Health:</strong> ${metrics.headline.pipelineOpen} unique roles in active recruitment (${metrics.headline.pipelineOpenTotal} total live openings), ${metrics.headline.futureRoles} future roles planned (${metrics.headline.futureRolesTotal} total postings), ${metrics.headline.onHold} roles on hold.</p>

        <p><strong>Time to Hire (2026 Hires):</strong> Average of ${metrics.timeToHire.average} days (median: ${metrics.timeToHire.median} days) based on ${metrics.timeToHire.count} completed hires with 2026 start dates.</p>

        ${metrics.atRiskRoles.count > 0 ? `<p><strong>‚ö†Ô∏è Risk Alert:</strong> ${metrics.atRiskRoles.count} roles have been open for more than 90 days and require attention.</p>` : ''}

        <p><strong>2026 Workforce Mix:</strong> ${metrics.demographics.nonGradHires} experienced hires and ${metrics.demographics.gradHires} graduate hires starting in 2026.</p>
    </div>

    <!-- HEADLINE METRICS -->
    <div class="section">
        <h2 class="section-title">1. Key Performance Indicators (2026 Only)</h2>

        <div class="metrics-grid">
            <div class="metric-card highlight">
                <div class="metric-label">2026 Hiring Plan</div>
                <div class="metric-value">${metrics.headline.totalPlan2026}</div>
                <div class="metric-subtext">Active + 2026 starters</div>
            </div>

            <div class="metric-card success">
                <div class="metric-label">2026 Offers Accepted</div>
                <div class="metric-value">${metrics.headline.offersAccepted2026}</div>
                <div class="metric-subtext">${metrics.headline.progressPct}% of plan</div>
            </div>

            <div class="metric-card">
                <div class="metric-label">Active Pipelines</div>
                <div class="metric-value">${metrics.headline.pipelineOpen}</div>
                <div class="metric-subtext">Unique roles (${metrics.headline.pipelineOpenTotal} live openings)</div>
            </div>

            <div class="metric-card">
                <div class="metric-label">Avg Time-to-Hire</div>
                <div class="metric-value">${metrics.timeToHire.average}</div>
                <div class="metric-subtext">days (2026 hires)</div>
            </div>
        </div>

        <div style="margin-top: 30px;">
            <h3 style="margin-bottom: 15px; color: #666;">2026 Hiring Progress vs Plan</h3>
            <div class="progress-bar">
                <div class="progress-fill" style="width: ${metrics.headline.progressPct}%;">
                    ${metrics.headline.progressPct}%
                </div>
            </div>
        </div>
    </div>

    <!-- STRATEGIC BETS ALIGNMENT - MOVED TO SECTION 2 FOR PROMINENCE -->
    ${Object.keys(metrics.strategicBets || {}).length > 0 ? `
    <div class="section page-break">
        <h2 class="section-title">2. üéØ Strategic Bets - 2026 Talent Alignment & Execution Risk</h2>

        <!-- Executive Context -->
        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 12px; margin-bottom: 35px; color: white; box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);">
            <h3 style="margin: 0 0 18px 0; color: white; font-size: 20px; font-weight: 700;">Strategic Context: Where We're Betting Our Talent Investment</h3>
            <p style="margin: 0 0 15px 0; font-size: 15px; line-height: 1.8; opacity: 0.95;">
                These four strategic bets represent PortSwigger's core focus areas for 2026 growth. <strong>Talent alignment to these bets is the #1 leading indicator of our ability to execute on strategic priorities.</strong> This analysis shows recruitment progress, identifies critical risks, and recommends immediate interventions.
            </p>
            <div style="background: rgba(255,255,255,0.18); padding: 15px; border-radius: 8px; font-size: 14px; line-height: 1.7; border-left: 4px solid #ffd700;">
                <strong>üìä Key Insight:</strong> ${(() => {
                    const totalRoles = Object.values(metrics.strategicBets).reduce((sum, bet) => sum + bet.total, 0);
                    const totalAccepted = Object.values(metrics.strategicBets).reduce((sum, bet) => sum + bet.accepted, 0);
                    const overallProgress = totalRoles > 0 ? ((totalAccepted / totalRoles) * 100).toFixed(1) : 0;
                    const atRisk = Object.entries(metrics.strategicBets).filter(([_, data]) => parseFloat(data.progressPct) < 50);
                    const critical = Object.entries(metrics.strategicBets).filter(([_, data]) => data.accepted === 0);

                    return `${totalAccepted} of ${totalRoles} strategic roles filled (${overallProgress}% overall progress). ${atRisk.length > 0 ? `<strong style="color: #ffd700; font-size: 15px;">${atRisk.length} bet(s) require urgent attention.</strong>` : '<strong style="color: #90EE90;">All bets showing recruitment activity.</strong>'} ${critical.length > 0 ? `<strong style="color: #ffcccc;">${critical.length} bet(s) have zero hires - critical intervention needed.</strong>` : ''}`;
                })()}
            </div>
        </div>

        <!-- Performance Overview Matrix -->
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 25px; margin-bottom: 35px;">
            ${Object.entries(metrics.strategicBets)
                .sort((a, b) => parseFloat(b[1].progressPct) - parseFloat(a[1].progressPct))
                .map(([betName, data]) => {
                const iconMap = {
                    'Scale Execution': 'üìä',
                    'Launch the Invasion': 'üöÄ',
                    'Defend our Ground': 'üõ°Ô∏è',
                    'Build the Bridge': 'üåâ'
                };
                const colorMap = {
                    'Scale Execution': '#667eea',
                    'Launch the Invasion': '#ff6b35',
                    'Defend our Ground': '#28a745',
                    'Build the Bridge': '#ffa500'
                };
                const icon = iconMap[betName] || 'üéØ';
                const color = colorMap[betName] || '#667eea';
                const progressNum = parseFloat(data.progressPct);
                const statusColor = progressNum >= 75 ? '#28a745' : progressNum >= 50 ? '#ffa500' : progressNum >= 25 ? '#ff8c42' : '#ff6b6b';
                const statusLabel = progressNum >= 75 ? 'On Track ‚úì' : progressNum >= 50 ? 'At Risk ‚ö†' : progressNum >= 25 ? 'Critical ‚ö†‚ö†' : 'URGENT ‚ö†‚ö†‚ö†';
                const remaining = data.total - data.accepted;

                return `
                <div style="background: white; border: 2px solid ${color}; border-radius: 12px; padding: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); position: relative;">
                    ${progressNum < 25 ? '<div style="position: absolute; top: 15px; right: 15px; background: #ff6b6b; color: white; padding: 5px 12px; border-radius: 6px; font-size: 11px; font-weight: 700; box-shadow: 0 2px 8px rgba(255,107,107,0.4);">‚ö† CRITICAL</div>' : ''}

                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 18px; padding-bottom: 18px; border-bottom: 2px solid ${color};">
                        <span style="font-size: 2.5em;">${icon}</span>
                        <div style="flex: 1;">
                            <div style="font-size: 18px; font-weight: 700; color: ${color}; margin-bottom: 5px;">${betName}</div>
                            <div style="font-size: 13px; color: ${statusColor}; font-weight: 700;">‚óè ${statusLabel}</div>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                        <div style="text-align: center; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <div style="font-size: 28px; font-weight: 700; color: ${color};">${data.total}</div>
                            <div style="font-size: 11px; color: #666; text-transform: uppercase; font-weight: 600;">Total Roles</div>
                        </div>
                        <div style="text-align: center; background: ${data.accepted > 0 ? '#d4edda' : '#f8d7da'}; padding: 15px; border-radius: 8px;">
                            <div style="font-size: 28px; font-weight: 700; color: ${data.accepted > 0 ? '#28a745' : '#dc3545'};">${data.accepted}</div>
                            <div style="font-size: 11px; color: #666; text-transform: uppercase; font-weight: 600;">Hired</div>
                        </div>
                        <div style="text-align: center; background: ${remaining === 0 ? '#d4edda' : '#fff3cd'}; padding: 15px; border-radius: 8px;">
                            <div style="font-size: 28px; font-weight: 700; color: ${remaining === 0 ? '#28a745' : '#ff6b35'};">${remaining}</div>
                            <div style="font-size: 11px; color: #666; text-transform: uppercase; font-weight: 600;">Remaining</div>
                        </div>
                    </div>

                    <div style="padding: 18px; background: #f8f9fa; border-radius: 10px; margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-around; margin-bottom: 15px;">
                            <div style="text-align: center;">
                                <div style="font-size: 22px; font-weight: 700; color: #2196f3;">${data.pipeline}</div>
                                <div style="font-size: 11px; color: #666; text-transform: uppercase;">Pipeline</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 22px; font-weight: 700; color: #ff9800;">${data.future}</div>
                                <div style="font-size: 11px; color: #666; text-transform: uppercase;">Future</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 22px; font-weight: 700; color: ${(data.pipeline + data.future) >= remaining ? '#28a745' : '#ff6b6b'};">${data.pipeline + data.future}</div>
                                <div style="font-size: 11px; color: #666; text-transform: uppercase;">Coverage</div>
                            </div>
                        </div>

                        ${(data.pipeline + data.future) < remaining ? `
                        <div style="background: #fff3cd; padding: 10px; border-radius: 6px; border-left: 3px solid #ffc107; font-size: 12px; color: #856404;">
                            <strong>‚ö† Gap Alert:</strong> Pipeline coverage insufficient to meet remaining ${remaining} role(s). Immediate sourcing required.
                        </div>
                        ` : ''}
                    </div>

                    <div>
                        <div style="display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 6px; font-weight: 600;">
                            <span style="color: #666;">Completion Progress</span>
                            <span style="color: ${statusColor}; font-size: 14px;">${data.progressPct}%</span>
                        </div>
                        <div style="background: #e9ecef; border-radius: 12px; height: 12px; overflow: hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);">
                            <div style="background: ${statusColor}; width: ${data.progressPct}%; height: 100%; transition: width 0.3s ease; border-radius: 12px;"></div>
                        </div>
                    </div>
                </div>
                `;
            }).join('')}
        </div>

        <!-- Strategic Analysis Dashboard -->
        <div style="background: #ffffff; border: 2px solid #667eea; border-radius: 12px; padding: 30px; margin-bottom: 35px; box-shadow: 0 4px 15px rgba(0,0,0,0.08);">
            <h3 style="color: #667eea; margin: 0 0 25px 0; font-size: 18px; display: flex; align-items: center; gap: 12px; font-weight: 700;">
                <span style="background: #667eea; color: white; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px;">üìà</span>
                Strategic Risk Assessment & Insights
            </h3>

            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;">
                <!-- Performance Distribution -->
                <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 20px; border-radius: 10px; border-left: 4px solid #667eea;">
                    <h4 style="margin: 0 0 15px 0; font-size: 14px; color: #667eea; font-weight: 700;">Performance Distribution</h4>
                    ${(() => {
                        const onTrack = Object.entries(metrics.strategicBets).filter(([_, d]) => parseFloat(d.progressPct) >= 75).length;
                        const atRisk = Object.entries(metrics.strategicBets).filter(([_, d]) => parseFloat(d.progressPct) >= 50 && parseFloat(d.progressPct) < 75).length;
                        const critical = Object.entries(metrics.strategicBets).filter(([_, d]) => parseFloat(d.progressPct) < 50).length;

                        return `
                        <div style="font-size: 13px; line-height: 2.2;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span><span style="color: #28a745; font-size: 16px;">‚óè</span> On Track (‚â•75%):</span>
                                <strong style="font-size: 18px; color: #28a745;">${onTrack}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span><span style="color: #ffa500; font-size: 16px;">‚óè</span> At Risk (50-74%):</span>
                                <strong style="font-size: 18px; color: #ffa500;">${atRisk}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span><span style="color: #ff6b6b; font-size: 16px;">‚óè</span> Critical (<50%):</span>
                                <strong style="font-size: 18px; color: ${critical > 0 ? '#ff6b6b' : '#28a745'};">${critical}</strong>
                            </div>
                        </div>
                        `;
                    })()}
                </div>

                <!-- Pipeline Coverage -->
                <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 20px; border-radius: 10px; border-left: 4px solid #2196f3;">
                    <h4 style="margin: 0 0 15px 0; font-size: 14px; color: #2196f3; font-weight: 700;">Pipeline Coverage Health</h4>
                    ${(() => {
                        const betsWithNoPipeline = Object.entries(metrics.strategicBets).filter(([_, d]) => d.pipeline === 0 && d.future === 0 && d.accepted < d.total);
                        const betsWithGap = Object.entries(metrics.strategicBets).filter(([_, d]) => (d.pipeline + d.future) < (d.total - d.accepted));
                        const betsWithStrongPipeline = Object.entries(metrics.strategicBets).filter(([_, d]) => (d.pipeline + d.future) >= (d.total - d.accepted));

                        return `
                        <div style="font-size: 13px; line-height: 2.2;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Strong Coverage:</span>
                                <strong style="font-size: 18px; color: #28a745;">${betsWithStrongPipeline.length}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Coverage Gap:</span>
                                <strong style="font-size: 18px; color: ${betsWithGap.length > 0 ? '#ffa500' : '#28a745'};">${betsWithGap.length}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>No Pipeline:</span>
                                <strong style="font-size: 18px; color: ${betsWithNoPipeline.length > 0 ? '#ff6b6b' : '#28a745'};">${betsWithNoPipeline.length}</strong>
                            </div>
                        </div>
                        ${betsWithNoPipeline.length > 0 ? `
                        <div style="margin-top: 12px; padding: 10px; background: #fff3cd; border-radius: 6px; font-size: 11px; color: #856404; font-weight: 600;">
                            ‚ö† ${betsWithNoPipeline.map(([name]) => name).join(', ')}
                        </div>
                        ` : ''}
                        `;
                    })()}
                </div>

                <!-- Overall Status -->
                <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 20px; border-radius: 10px; border-left: 4px solid #ff6b35;">
                    <h4 style="margin: 0 0 15px 0; font-size: 14px; color: #ff6b35; font-weight: 700;">Overall Strategic Status</h4>
                    ${(() => {
                        const totalRoles = Object.values(metrics.strategicBets).reduce((sum, bet) => sum + bet.total, 0);
                        const totalAccepted = Object.values(metrics.strategicBets).reduce((sum, bet) => sum + bet.accepted, 0);
                        const totalPipeline = Object.values(metrics.strategicBets).reduce((sum, bet) => sum + bet.pipeline, 0);
                        const remaining = totalRoles - totalAccepted;
                        const overallProgress = totalRoles > 0 ? ((totalAccepted / totalRoles) * 100).toFixed(1) : 0;

                        return `
                        <div style="font-size: 13px; line-height: 2.2;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Total Strategic Roles:</span>
                                <strong style="font-size: 18px; color: #667eea;">${totalRoles}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Roles Filled:</span>
                                <strong style="font-size: 18px; color: #28a745;">${totalAccepted}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Remaining to Fill:</span>
                                <strong style="font-size: 18px; color: ${remaining > 0 ? '#ff6b35' : '#28a745'};">${remaining}</strong>
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid #dee2e6;">
                            <div style="font-size: 12px; color: #666; margin-bottom: 6px; font-weight: 600;">Overall Progress</div>
                            <div style="background: #e9ecef; border-radius: 10px; height: 10px; overflow: hidden;">
                                <div style="background: ${parseFloat(overallProgress) >= 75 ? '#28a745' : parseFloat(overallProgress) >= 50 ? '#ffa500' : '#ff6b6b'}; width: ${overallProgress}%; height: 100%;"></div>
                            </div>
                            <div style="text-align: right; font-size: 16px; font-weight: 700; color: ${parseFloat(overallProgress) >= 75 ? '#28a745' : parseFloat(overallProgress) >= 50 ? '#ffa500' : '#ff6b6b'}; margin-top: 6px;">${overallProgress}%</div>
                        </div>
                        `;
                    })()}
                </div>
            </div>

            <!-- Executive Recommendations -->
            <div style="background: linear-gradient(135deg, #fff5f0 0%, #ffe6e0 100%); padding: 25px; border-radius: 10px; border-left: 5px solid #ff6b35; box-shadow: 0 2px 10px rgba(255,107,53,0.1);">
                <h4 style="margin: 0 0 20px 0; font-size: 16px; color: #ff6b35; display: flex; align-items: center; gap: 10px; font-weight: 700;">
                    <span style="font-size: 20px;">üí°</span> Executive Actions & Recommendations
                </h4>
                <ul style="margin: 0; padding-left: 25px; line-height: 2.2; font-size: 14px; color: #333;">
                    ${(() => {
                        const recommendations = [];
                        const critical = Object.entries(metrics.strategicBets).filter(([_, d]) => parseFloat(d.progressPct) < 50);
                        const zerohires = Object.entries(metrics.strategicBets).filter(([_, d]) => d.accepted === 0);
                        const noPipeline = Object.entries(metrics.strategicBets).filter(([_, d]) => d.pipeline === 0 && d.future === 0 && d.accepted < d.total);
                        const pipelineGap = Object.entries(metrics.strategicBets).filter(([_, d]) => (d.pipeline + d.future) < (d.total - d.accepted) && d.accepted < d.total);
                        const onTrack = Object.entries(metrics.strategicBets).filter(([_, d]) => parseFloat(d.progressPct) >= 75);

                        if (zerohires.length > 0) {
                            recommendations.push(`<li style="color: #dc3545; font-weight: 600;"><strong style="color: #dc3545;">üö® ZERO HIRES - IMMEDIATE ESCALATION:</strong> ${zerohires.map(([name]) => name).join(', ')} ${zerohires.length === 1 ? 'has' : 'have'} no accepted offers. Requires board-level intervention and potential strategic reassessment.</li>`);
                        }

                        if (critical.length > 0 && !zerohires.some(([name]) => critical.map(([n]) => n).includes(name))) {
                            recommendations.push(`<li style="color: #ff6b6b; font-weight: 600;"><strong style="color: #ff6b6b;">‚ö† URGENT ACTION REQUIRED:</strong> ${critical.map(([name]) => name).join(', ')} ${critical.length === 1 ? 'is' : 'are'} critically behind schedule (<50% progress). Fast-track recruitment, consider temporary contractors, or adjust strategic scope.</li>`);
                        }

                        if (noPipeline.length > 0) {
                            recommendations.push(`<li style="font-weight: 600;"><strong style="color: #dc3545;">Pipeline Emergency:</strong> ${noPipeline.map(([name]) => name).join(', ')} ${noPipeline.length === 1 ? 'has' : 'have'} zero pipeline coverage. Initiate emergency sourcing campaigns and executive search engagement immediately.</li>`);
                        }

                        if (pipelineGap.length > 0) {
                            recommendations.push(`<li><strong>Pipeline Gap Mitigation:</strong> ${pipelineGap.map(([name]) => name).join(', ')} ${pipelineGap.length === 1 ? 'lacks' : 'lack'} sufficient pipeline coverage. Accelerate sourcing velocity to avoid Q2/Q3 delivery delays.</li>`);
                        }

                        if (onTrack.length > 0) {
                            recommendations.push(`<li style="color: #28a745;"><strong style="color: #28a745;">‚úì Maintaining Momentum:</strong> ${onTrack.map(([name]) => name).join(', ')} ${onTrack.length === 1 ? 'is' : 'are'} tracking well (‚â•75% progress). Continue current velocity and talent champion allocation model.</li>`);
                        }

                        recommendations.push(`<li><strong>Resource Optimization:</strong> Consider reallocating Talent Champion capacity from completed/on-track bets to those with critical pipeline gaps for maximum strategic impact.</li>`);

                        const totalRoles = Object.values(metrics.strategicBets).reduce((sum, bet) => sum + bet.total, 0);
                        const totalAccepted = Object.values(metrics.strategicBets).reduce((sum, bet) => sum + bet.accepted, 0);
                        const remaining = totalRoles - totalAccepted;

                        recommendations.push(`<li><strong>Strategic Alignment Summary:</strong> ${totalAccepted} of ${totalRoles} strategic roles filled. ${remaining} roles remain critical to 2026 strategic execution success.</li>`);

                        return recommendations.join('');
                    })()}
                </ul>
            </div>
        </div>

        <!-- Bet Definitions & Objectives -->
        <div style="background: #f8f9fa; padding: 30px; border-radius: 12px; border: 2px solid #e0e0e0; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
            <h3 style="color: #667eea; margin: 0 0 25px 0; font-size: 18px; font-weight: 700;">Strategic Bet Definitions & 2026 Objectives</h3>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; font-size: 14px;">
                <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #667eea; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <div style="margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center;">
                        <strong style="color: #667eea; font-size: 16px;">üìä Scale Execution</strong>
                        ${(() => {
                            const bet = metrics.strategicBets['Scale Execution'];
                            return bet ? `<span style="background: ${parseFloat(bet.progressPct) >= 75 ? '#28a745' : parseFloat(bet.progressPct) >= 50 ? '#ffa500' : '#ff6b6b'}; color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 700;">${bet.progressPct}% Complete</span>` : '';
                        })()}
                    </div>
                    <p style="margin: 0 0 10px 0; color: #666; line-height: 1.7; font-size: 13px;">Build operational excellence and scalable infrastructure to support rapid growth and market expansion.</p>
                    ${(() => {
                        const bet = metrics.strategicBets['Scale Execution'];
                        return bet ? `<div style="font-size: 12px; color: #667eea; font-weight: 600;">Roles: ${bet.accepted} hired, ${bet.pipeline} in pipeline, ${bet.future} planned</div>` : '';
                    })()}
                </div>
                <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #ff6b35; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <div style="margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center;">
                        <strong style="color: #ff6b35; font-size: 16px;">üöÄ Launch the Invasion</strong>
                        ${(() => {
                            const bet = metrics.strategicBets['Launch the Invasion'];
                            return bet ? `<span style="background: ${parseFloat(bet.progressPct) >= 75 ? '#28a745' : parseFloat(bet.progressPct) >= 50 ? '#ffa500' : '#ff6b6b'}; color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 700;">${bet.progressPct}% Complete</span>` : '';
                        })()}
                    </div>
                    <p style="margin: 0 0 10px 0; color: #666; line-height: 1.7; font-size: 13px;">Aggressive market expansion, customer acquisition, and competitive positioning initiatives.</p>
                    ${(() => {
                        const bet = metrics.strategicBets['Launch the Invasion'];
                        return bet ? `<div style="font-size: 12px; color: #ff6b35; font-weight: 600;">Roles: ${bet.accepted} hired, ${bet.pipeline} in pipeline, ${bet.future} planned</div>` : '';
                    })()}
                </div>
                <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #28a745; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <div style="margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center;">
                        <strong style="color: #28a745; font-size: 16px;">üõ°Ô∏è Defend our Ground</strong>
                        ${(() => {
                            const bet = metrics.strategicBets['Defend our Ground'];
                            return bet ? `<span style="background: ${parseFloat(bet.progressPct) >= 75 ? '#28a745' : parseFloat(bet.progressPct) >= 50 ? '#ffa500' : '#ff6b6b'}; color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 700;">${bet.progressPct}% Complete</span>` : '';
                        })()}
                    </div>
                    <p style="margin: 0 0 10px 0; color: #666; line-height: 1.7; font-size: 13px;">Retain and deepen existing customer relationships, protect market position, and maximize customer lifetime value.</p>
                    ${(() => {
                        const bet = metrics.strategicBets['Defend our Ground'];
                        return bet ? `<div style="font-size: 12px; color: #28a745; font-weight: 600;">Roles: ${bet.accepted} hired, ${bet.pipeline} in pipeline, ${bet.future} planned</div>` : '';
                    })()}
                </div>
                <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #ffa500; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <div style="margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center;">
                        <strong style="color: #ffa500; font-size: 16px;">üåâ Build the Bridge</strong>
                        ${(() => {
                            const bet = metrics.strategicBets['Build the Bridge'];
                            return bet ? `<span style="background: ${parseFloat(bet.progressPct) >= 75 ? '#28a745' : parseFloat(bet.progressPct) >= 50 ? '#ffa500' : '#ff6b6b'}; color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 700;">${bet.progressPct}% Complete</span>` : '';
                        })()}
                    </div>
                    <p style="margin: 0 0 10px 0; color: #666; line-height: 1.7; font-size: 13px;">Connect products, teams, and capabilities to deliver integrated solutions and seamless customer experiences.</p>
                    ${(() => {
                        const bet = metrics.strategicBets['Build the Bridge'];
                        return bet ? `<div style="font-size: 12px; color: #ffa500; font-weight: 600;">Roles: ${bet.accepted} hired, ${bet.pipeline} in pipeline, ${bet.future} planned</div>` : '';
                    })()}
                </div>
            </div>
        </div>
    </div>
    ` : ''}

    <!-- FUNCTION BREAKDOWN -->
    <div class="section page-break">
        <h2 class="section-title">${Object.keys(metrics.strategicBets || {}).length > 0 ? '3' : '2'}. Function Breakdown (2026 Roles)</h2>

        <table>
            <thead>
                <tr>
                    <th>Function</th>
                    <th style="text-align: center;">Plan</th>
                    <th style="text-align: center;">Hired</th>
                    <th style="text-align: center;">Pipeline</th>
                    <th style="text-align: center;">Remaining</th>
                    <th>Progress</th>
                </tr>
            </thead>
            <tbody>
                ${Object.entries(metrics.functionBreakdown)
                    .sort((a, b) => b[1].plan - a[1].plan)
                    .map(([func, data]) => {
                        const remaining = data.plan - data.hired;
                        const progressPct = ((data.hired / data.plan) * 100).toFixed(0);
                        return `
                        <tr>
                            <td><strong>${func}</strong></td>
                            <td style="text-align: center;">${data.plan}</td>
                            <td style="text-align: center;">${data.hired}</td>
                            <td style="text-align: center;">${data.pipeline}</td>
                            <td style="text-align: center;">${remaining}</td>
                            <td>
                                <div class="progress-bar" style="height: 20px;">
                                    <div class="progress-fill" style="width: ${progressPct}%; font-size: 12px;">
                                        ${progressPct}%
                                    </div>
                                </div>
                            </td>
                        </tr>
                        `;
                    }).join('')}
            </tbody>
        </table>
    </div>

    <!-- MONTHLY TRAJECTORY -->
    <div class="section">
        <h2 class="section-title">3. Monthly Recruitment Timeline (2026)</h2>

        <!-- Legend -->
        <div style="display: flex; justify-content: center; gap: 30px; margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <div style="display: flex; align-items: center; gap: 10px;">
                <div style="width: 30px; height: 30px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); border-radius: 6px; box-shadow: 0 2px 4px rgba(40,167,69,0.3);"></div>
                <span style="font-size: 14px; font-weight: 600; color: #333;">Offers Accepted</span>
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
                <div style="width: 30px; height: 30px; background: transparent; border: 3px solid #ff9800; border-radius: 6px;"></div>
                <span style="font-size: 14px; font-weight: 600; color: #333;">Future Roles (Planned)</span>
            </div>
        </div>

        <div class="chart-container">
            <div class="bar-chart">
                ${metrics.monthlyHires.map((hiredCount, index) => {
                    const futureCount = metrics.monthlyFuture[index];
                    const maxCount = Math.max(...metrics.monthlyHires, ...metrics.monthlyFuture, 1);
                    const hiredHeight = (hiredCount / maxCount) * 100;
                    const futureHeight = (futureCount / maxCount) * 100;

                    return `
                        <div class="bar" style="height: auto; position: relative;">
                            <div style="display: flex; flex-direction: column; align-items: center; min-height: 200px; justify-content: flex-end;">
                                <!-- Hired bar (solid green) -->
                                ${hiredCount > 0 ? `
                                    <div style="width: 50px; height: ${hiredHeight * 2}px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); border-radius: 6px 6px 0 0; box-shadow: 0 2px 8px rgba(40,167,69,0.3); position: relative; margin-bottom: 5px;">
                                        <div style="position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 13px; font-weight: 700; color: #28a745;">${hiredCount}</div>
                                    </div>
                                ` : ''}

                                <!-- Future bar (outlined orange) -->
                                ${futureCount > 0 ? `
                                    <div style="width: 50px; height: ${futureHeight * 2}px; background: rgba(255,152,0,0.1); border: 3px solid #ff9800; border-radius: 6px 6px 0 0; position: relative; ${hiredCount > 0 ? 'margin-top: 10px;' : ''}">
                                        <div style="position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 13px; font-weight: 700; color: #ff9800;">${futureCount}</div>
                                    </div>
                                ` : ''}
                            </div>
                            <div class="bar-label" style="margin-top: 10px;">${monthNames[index]}</div>
                        </div>
                    `;
                }).join('')}
            </div>
        </div>

        <div style="margin-top: 25px; padding: 15px; background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); border-radius: 8px; border-left: 4px solid #667eea;">
            <p style="margin: 0 0 10px 0; font-size: 14px; color: #333; line-height: 1.7;">
                <strong style="color: #667eea;">üìä Reading This Chart:</strong>
            </p>
            <ul style="margin: 0; padding-left: 20px; font-size: 13px; color: #555; line-height: 1.9;">
                <li><strong style="color: #28a745;">Solid green bars:</strong> Actual offers accepted by month (historical progress)</li>
                <li><strong style="color: #ff9800;">Outlined orange bars:</strong> Future roles expected to start recruitment this month (forward pipeline)</li>
                <li><strong>Combined view:</strong> Shows both hiring velocity achieved and recruitment capacity planned</li>
            </ul>
        </div>
    </div>

    <!-- QUARTERLY BREAKDOWN -->
    <div class="section page-break">
        <h2 class="section-title">4. Quarterly Overview</h2>

        <div class="metrics-grid">
            ${Object.entries(metrics.quarterlyData).map(([quarter, data]) => `
                <div class="metric-card">
                    <div class="metric-label">${quarter} 2026</div>
                    <div class="metric-value">${data.hired}</div>
                    <div class="metric-subtext">Hired | ${data.pipeline} in pipeline</div>
                </div>
            `).join('')}
        </div>
    </div>

    <!-- STRATEGIC BETS ALIGNMENT -->
    ${Object.keys(metrics.strategicBets || {}).length > 0 ? `
    <div class="section page-break">
        <h2 class="section-title">5. üéØ Strategic Bets - 2026 Talent Alignment & Risk Assessment</h2>

        <!-- Executive Context -->
        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 25px; border-radius: 10px; margin-bottom: 30px; color: white; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);">
            <h3 style="margin: 0 0 15px 0; color: white; font-size: 18px;">Strategic Context: Where We're Betting Our Talent Investment</h3>
            <p style="margin: 0 0 12px 0; font-size: 14px; line-height: 1.7; opacity: 0.95;">
                These four strategic bets represent PortSwigger's core focus areas for 2026 growth. Talent alignment to these bets is a leading indicator of our ability to execute on strategic priorities. This analysis shows recruitment progress, identifies risks, and recommends interventions.
            </p>
            <div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 6px; font-size: 13px; line-height: 1.6;">
                <strong>Key Insight:</strong> ${(() => {
                    const totalRoles = Object.values(metrics.strategicBets).reduce((sum, bet) => sum + bet.total, 0);
                    const totalAccepted = Object.values(metrics.strategicBets).reduce((sum, bet) => sum + bet.accepted, 0);
                    const overallProgress = totalRoles > 0 ? ((totalAccepted / totalRoles) * 100).toFixed(1) : 0;
                    const atRisk = Object.entries(metrics.strategicBets).filter(([_, data]) => data.accepted === 0 || parseFloat(data.progressPct) < 25);

                    return `${totalAccepted} of ${totalRoles} strategic roles filled (${overallProgress}% progress). ${atRisk.length > 0 ? `<strong style="color: #ffd700;">${atRisk.length} bet(s) require urgent attention.</strong>` : 'All bets show recruitment activity.'}`;
                })()}
            </div>
        </div>

        <!-- Performance Overview Matrix -->
        <div class="metrics-grid" style="margin-bottom: 30px;">
            ${Object.entries(metrics.strategicBets)
                .sort((a, b) => parseFloat(b[1].progressPct) - parseFloat(a[1].progressPct))
                .map(([betName, data]) => {
                const iconMap = {
                    'Scale Execution': 'üìä',
                    'Launch the Invasion': 'üöÄ',
                    'Defend our Ground': 'üõ°Ô∏è',
                    'Build the Bridge': 'üåâ'
                };
                const colorMap = {
                    'Scale Execution': '#667eea',
                    'Launch the Invasion': '#ff6b35',
                    'Defend our Ground': '#28a745',
                    'Build the Bridge': '#ffa500'
                };
                const icon = iconMap[betName] || 'üéØ';
                const color = colorMap[betName] || '#667eea';
                const progressNum = parseFloat(data.progressPct);
                const statusColor = progressNum >= 75 ? '#28a745' : progressNum >= 50 ? '#ffa500' : '#ff6b6b';
                const statusLabel = progressNum >= 75 ? 'On Track' : progressNum >= 50 ? 'At Risk' : 'Critical';
                const remaining = data.total - data.accepted;

                return `
                <div class="metric-card" style="border-left: 5px solid ${color}; position: relative;">
                    ${progressNum < 25 ? '<div style="position: absolute; top: 10px; right: 10px; background: #ff6b6b; color: white; padding: 3px 8px; border-radius: 4px; font-size: 10px; font-weight: 700;">CRITICAL</div>' : ''}
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                        <span style="font-size: 1.8em;">${icon}</span>
                        <div>
                            <div class="metric-label" style="font-size: 14px; font-weight: 700; color: ${color}; margin-bottom: 2px;">${betName}</div>
                            <div style="font-size: 11px; color: ${statusColor}; font-weight: 600;">‚óè ${statusLabel}</div>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                        <div>
                            <div style="font-size: 24px; font-weight: 700; color: ${color};">${data.total}</div>
                            <div style="font-size: 11px; color: #999;">Total Roles</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; font-weight: 700; color: ${remaining === 0 ? '#28a745' : '#ff6b6b'};">${remaining}</div>
                            <div style="font-size: 11px; color: #999;">Remaining</div>
                        </div>
                    </div>
                    <div style="padding-top: 12px; border-top: 1px solid #eee;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <div style="text-align: center; flex: 1;">
                                <div style="font-size: 18px; font-weight: 700; color: #28a745;">${data.accepted}</div>
                                <div style="font-size: 10px; color: #666; text-transform: uppercase;">Hired</div>
                            </div>
                            <div style="text-align: center; flex: 1;">
                                <div style="font-size: 18px; font-weight: 700; color: #2196f3;">${data.pipeline}</div>
                                <div style="font-size: 10px; color: #666; text-transform: uppercase;">Pipeline</div>
                            </div>
                            <div style="text-align: center; flex: 1;">
                                <div style="font-size: 18px; font-weight: 700; color: #ff9800;">${data.future}</div>
                                <div style="font-size: 10px; color: #666; text-transform: uppercase;">Future</div>
                            </div>
                        </div>
                        <div style="margin-top: 12px;">
                            <div style="display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 4px;">
                                <span style="color: #666; font-weight: 600;">Progress</span>
                                <span style="font-weight: 700; color: ${statusColor};">${data.progressPct}% Complete</span>
                            </div>
                            <div style="background: #e9ecef; border-radius: 10px; height: 8px; overflow: hidden; box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);">
                                <div style="background: ${statusColor}; width: ${data.progressPct}%; height: 100%; transition: width 0.3s ease;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                `;
            }).join('')}
        </div>

        <!-- Strategic Analysis -->
        <div style="background: #ffffff; border: 1px solid #e0e0e0; border-radius: 10px; padding: 25px; margin-bottom: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
            <h3 style="color: #333; margin: 0 0 20px 0; font-size: 16px; display: flex; align-items: center; gap: 10px;">
                <span style="background: #667eea; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px;">üìà</span>
                Strategic Insights & Risk Assessment
            </h3>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                <!-- Performance Distribution -->
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                    <h4 style="margin: 0 0 12px 0; font-size: 14px; color: #667eea;">Performance Distribution</h4>
                    ${(() => {
                        const onTrack = Object.entries(metrics.strategicBets).filter(([_, d]) => parseFloat(d.progressPct) >= 75).length;
                        const atRisk = Object.entries(metrics.strategicBets).filter(([_, d]) => parseFloat(d.progressPct) >= 50 && parseFloat(d.progressPct) < 75).length;
                        const critical = Object.entries(metrics.strategicBets).filter(([_, d]) => parseFloat(d.progressPct) < 50).length;

                        return `
                        <div style="font-size: 13px; line-height: 2;">
                            <div style="display: flex; justify-content: space-between;">
                                <span><span style="color: #28a745; font-weight: 700;">‚óè</span> On Track (‚â•75%):</span>
                                <strong>${onTrack} bet(s)</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span><span style="color: #ffa500; font-weight: 700;">‚óè</span> At Risk (50-74%):</span>
                                <strong>${atRisk} bet(s)</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span><span style="color: #ff6b6b; font-weight: 700;">‚óè</span> Critical (<50%):</span>
                                <strong style="color: ${critical > 0 ? '#ff6b6b' : 'inherit'};">${critical} bet(s)</strong>
                            </div>
                        </div>
                        `;
                    })()}
                </div>

                <!-- Talent Pipeline Health -->
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                    <h4 style="margin: 0 0 12px 0; font-size: 14px; color: #667eea;">Pipeline Coverage</h4>
                    ${(() => {
                        const betsWithNoPipeline = Object.entries(metrics.strategicBets).filter(([_, d]) => d.pipeline === 0 && d.future === 0 && d.accepted < d.total);
                        const betsWithStrongPipeline = Object.entries(metrics.strategicBets).filter(([_, d]) => (d.pipeline + d.future) >= (d.total - d.accepted));

                        return `
                        <div style="font-size: 13px; line-height: 2;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>Strong Coverage:</span>
                                <strong style="color: #28a745;">${betsWithStrongPipeline.length} bet(s)</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>No Active Pipeline:</span>
                                <strong style="color: ${betsWithNoPipeline.length > 0 ? '#ff6b6b' : '#28a745'};">${betsWithNoPipeline.length} bet(s)</strong>
                            </div>
                            ${betsWithNoPipeline.length > 0 ? `
                            <div style="margin-top: 8px; padding: 8px; background: #fff3cd; border-radius: 4px; font-size: 12px; color: #856404;">
                                ‚ö†Ô∏è ${betsWithNoPipeline.map(([name]) => name).join(', ')}
                            </div>
                            ` : ''}
                        </div>
                        `;
                    })()}
                </div>
            </div>

            <!-- Executive Recommendations -->
            <div style="background: linear-gradient(135deg, #fff5f0 0%, #ffe6e0 100%); padding: 18px; border-radius: 8px; border-left: 4px solid #ff6b35;">
                <h4 style="margin: 0 0 15px 0; font-size: 14px; color: #ff6b35; display: flex; align-items: center; gap: 8px;">
                    <span>üí°</span> Executive Recommendations
                </h4>
                <ul style="margin: 0; padding-left: 20px; line-height: 1.9; font-size: 13px; color: #333;">
                    ${(() => {
                        const recommendations = [];
                        const critical = Object.entries(metrics.strategicBets).filter(([_, d]) => parseFloat(d.progressPct) < 50);
                        const noPipeline = Object.entries(metrics.strategicBets).filter(([_, d]) => d.pipeline === 0 && d.future === 0 && d.accepted < d.total);
                        const onTrack = Object.entries(metrics.strategicBets).filter(([_, d]) => parseFloat(d.progressPct) >= 75);

                        if (critical.length > 0) {
                            recommendations.push(`<li><strong style="color: #ff6b6b;">Urgent Action Required:</strong> ${critical.map(([name]) => name).join(', ')} ${critical.length === 1 ? 'requires' : 'require'} immediate executive intervention. Consider fast-tracking recruitment or adjusting strategic scope.</li>`);
                        }

                        if (noPipeline.length > 0) {
                            recommendations.push(`<li><strong>Pipeline Gap:</strong> Accelerate talent sourcing for ${noPipeline.map(([name]) => name).join(', ')} to avoid Q2/Q3 delivery delays.</li>`);
                        }

                        if (onTrack.length > 0) {
                            recommendations.push(`<li><strong style="color: #28a745;">Maintaining Momentum:</strong> ${onTrack.map(([name]) => name).join(', ')} ${onTrack.length === 1 ? 'is' : 'are'} tracking well. Continue current velocity and champion allocation.</li>`);
                        }

                        recommendations.push(`<li><strong>Resource Allocation:</strong> Consider reallocating Talent Champion capacity from completed bets to those with critical pipeline gaps.</li>`);

                        const totalRoles = Object.values(metrics.strategicBets).reduce((sum, bet) => sum + bet.total, 0);
                        const totalAccepted = Object.values(metrics.strategicBets).reduce((sum, bet) => sum + bet.accepted, 0);
                        const remaining = totalRoles - totalAccepted;

                        recommendations.push(`<li><strong>Strategic Alignment:</strong> ${totalAccepted} of ${totalRoles} strategic roles filled. ${remaining} roles remain critical to 2026 strategic execution.</li>`);

                        return recommendations.join('');
                    })()}
                </ul>
            </div>
        </div>

        <!-- Bet Definitions -->
        <div style="background: #f8f9fa; padding: 25px; border-radius: 10px; border: 1px solid #e0e0e0;">
            <h3 style="color: #667eea; margin: 0 0 20px 0; font-size: 16px;">Strategic Bet Definitions</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; font-size: 13px;">
                <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #667eea;">
                    <div style="margin-bottom: 8px;">
                        <strong style="color: #667eea; font-size: 14px;">üìä Scale Execution</strong>
                        ${(() => {
                            const bet = metrics.strategicBets['Scale Execution'];
                            return bet ? `<span style="float: right; background: ${parseFloat(bet.progressPct) >= 75 ? '#28a745' : parseFloat(bet.progressPct) >= 50 ? '#ffa500' : '#ff6b6b'}; color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px;">${bet.progressPct}%</span>` : '';
                        })()}
                    </div>
                    <p style="margin: 0; color: #666; line-height: 1.6;">Build operational excellence and scalable infrastructure to support growth</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #ff6b35;">
                    <div style="margin-bottom: 8px;">
                        <strong style="color: #ff6b35; font-size: 14px;">üöÄ Launch the Invasion</strong>
                        ${(() => {
                            const bet = metrics.strategicBets['Launch the Invasion'];
                            return bet ? `<span style="float: right; background: ${parseFloat(bet.progressPct) >= 75 ? '#28a745' : parseFloat(bet.progressPct) >= 50 ? '#ffa500' : '#ff6b6b'}; color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px;">${bet.progressPct}%</span>` : '';
                        })()}
                    </div>
                    <p style="margin: 0; color: #666; line-height: 1.6;">Aggressive market expansion and customer acquisition initiatives</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #28a745;">
                    <div style="margin-bottom: 8px;">
                        <strong style="color: #28a745; font-size: 14px;">üõ°Ô∏è Defend our Ground</strong>
                        ${(() => {
                            const bet = metrics.strategicBets['Defend our Ground'];
                            return bet ? `<span style="float: right; background: ${parseFloat(bet.progressPct) >= 75 ? '#28a745' : parseFloat(bet.progressPct) >= 50 ? '#ffa500' : '#ff6b6b'}; color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px;">${bet.progressPct}%</span>` : '';
                        })()}
                    </div>
                    <p style="margin: 0; color: #666; line-height: 1.6;">Retain and deepen existing customer relationships and market position</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #ffa500;">
                    <div style="margin-bottom: 8px;">
                        <strong style="color: #ffa500; font-size: 14px;">üåâ Build the Bridge</strong>
                        ${(() => {
                            const bet = metrics.strategicBets['Build the Bridge'];
                            return bet ? `<span style="float: right; background: ${parseFloat(bet.progressPct) >= 75 ? '#28a745' : parseFloat(bet.progressPct) >= 50 ? '#ffa500' : '#ff6b6b'}; color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px;">${bet.progressPct}%</span>` : '';
                        })()}
                    </div>
                    <p style="margin: 0; color: #666; line-height: 1.6;">Connect products, teams, and capabilities for integrated solutions</p>
                </div>
            </div>
        </div>
    </div>
    ` : ''}

    <!-- ACCEPTED ROLES DETAIL -->
    <div class="section page-break">
        <h2 class="section-title">${Object.keys(metrics.strategicBets || {}).length > 0 ? '6' : '5'}. Accepted Roles - 2026 Starters Only (${metrics.acceptedRoles.length} Hires)</h2>

        <table>
            <thead>
                <tr>
                    <th>Role ID</th>
                    <th>Role Title</th>
                    <th>Function</th>
                    <th>Team</th>
                    <th>Champion</th>
                    <th style="text-align: center;">Offer Accepted</th>
                    <th style="text-align: center;">Start Date</th>
                    <th style="text-align: center;">Type</th>
                </tr>
            </thead>
            <tbody>
                ${metrics.acceptedRoles.map(role => `
                    <tr>
                        <td>${role.id}</td>
                        <td><strong>${role.title}</strong></td>
                        <td>${role.function}</td>
                        <td>${role.team}</td>
                        <td>${role.champion}</td>
                        <td style="text-align: center;">
                            ${role.dateAccept ? new Date(role.dateAccept).toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' }) : '-'}
                        </td>
                        <td style="text-align: center;">
                            ${role.dateStart ? new Date(role.dateStart).toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' }) : 'TBC'}
                        </td>
                        <td style="text-align: center;">
                            ${role.isGrad ? '<span style="background: #e3f2fd; color: #1976d2; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: bold;">GRAD</span>' : '<span style="background: #f5f5f5; color: #666; padding: 4px 8px; border-radius: 4px; font-size: 11px;">EXPERIENCED</span>'}
                        </td>
                    </tr>
                `).join('')}
            </tbody>
        </table>
    </div>

    <!-- CHAMPION WORKLOAD -->
    <div class="section page-break">
        <h2 class="section-title">${Object.keys(metrics.strategicBets || {}).length > 0 ? '7' : '6'}. Talent Champion Workload (2026 Roles)</h2>

        <table>
            <thead>
                <tr>
                    <th>Talent Champion</th>
                    <th style="text-align: center;">Total Roles</th>
                    <th style="text-align: center;">Active</th>
                    <th style="text-align: center;">Completed</th>
                    <th style="text-align: center;">Completion %</th>
                </tr>
            </thead>
            <tbody>
                ${Object.entries(metrics.championWorkload)
                    .sort((a, b) => b[1].total - a[1].total)
                    .map(([champion, data]) => {
                        const completionPct = data.total > 0 ? ((data.completed / data.total) * 100).toFixed(0) : 0;
                        return `
                        <tr>
                            <td><strong>${champion}</strong></td>
                            <td style="text-align: center;">${data.total}</td>
                            <td style="text-align: center;">${data.active}</td>
                            <td style="text-align: center;">${data.completed}</td>
                            <td style="text-align: center;">${completionPct}%</td>
                        </tr>
                        `;
                    }).join('')}
            </tbody>
        </table>
    </div>

    <!-- AT RISK ROLES -->
    ${metrics.atRiskRoles.count > 0 ? `
    <div class="section page-break">
        <h2 class="section-title">${Object.keys(metrics.strategicBets || {}).length > 0 ? '8' : '7'}. ‚ö†Ô∏è 2026 Roles Requiring Attention</h2>

        <p style="margin-bottom: 20px; color: #d35400;">
            The following ${metrics.atRiskRoles.count} 2026 role(s) have been open for more than 90 days and may require intervention:
        </p>

        <table>
            <thead>
                <tr>
                    <th>Role ID</th>
                    <th>Role Title</th>
                    <th style="text-align: center;">Days Open</th>
                    <th style="text-align: center;">Status</th>
                </tr>
            </thead>
            <tbody>
                ${metrics.atRiskRoles.roles.map(role => `
                    <tr>
                        <td>${role.id}</td>
                        <td>${role.title}</td>
                        <td style="text-align: center;"><span class="risk-badge">${role.daysOpen} days</span></td>
                        <td style="text-align: center;">At Risk</td>
                    </tr>
                `).join('')}
            </tbody>
        </table>
    </div>
    ` : ''}

    <!-- KEY INSIGHTS -->
    <div class="section page-break">
        <h2 class="section-title">${Object.keys(metrics.strategicBets || {}).length > 0 ? '9' : '8'}. Key Insights & Recommendations</h2>

        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid #667eea;">
            <h3 style="color: #667eea; margin-bottom: 15px;">2026 Progress Assessment</h3>
            <ul style="line-height: 2; padding-left: 20px;">
                <li>2026 hiring is at <strong>${metrics.headline.progressPct}%</strong> of the plan with ${metrics.headline.offersAccepted2026} offers accepted for 2026 start dates</li>
                <li>Average time-to-hire for 2026 starters: <strong>${metrics.timeToHire.average} days</strong> ${metrics.timeToHire.average < 60 ? '(performing well)' : metrics.timeToHire.average < 90 ? '(on target)' : '(needs improvement)'}</li>
                <li>${metrics.headline.pipelineOpen} active pipelines for 2026 roles represent strong ongoing momentum</li>
                ${metrics.atRiskRoles.count > 0 ? `<li style="color: #d35400;"><strong>Action Required:</strong> ${metrics.atRiskRoles.count} 2026 roles require immediate attention (90+ days open)</li>` : ''}
            </ul>
        </div>

        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 20px; border-left: 4px solid #ff6b35;">
            <h3 style="color: #ff6b35; margin-bottom: 15px;">Strategic Recommendations for 2026</h3>
            <ul style="line-height: 2; padding-left: 20px;">
                <li>Continue current recruitment velocity to meet 2026 year-end targets</li>
                ${metrics.atRiskRoles.count > 0 ? '<li>Review and refresh job specs for 2026 roles open >90 days</li>' : ''}
                <li>Monitor talent champion workload distribution for optimal efficiency</li>
                <li>Maintain focus on functions with lower 2026 completion rates</li>
                <li>Note: 2025 historical hires excluded from this report for strategic 2026 planning focus</li>
            </ul>
        </div>
    </div>

    <div class="footer">
        <p>PortSwigger Talent Dashboard | Confidential Board Pack - 2026 Strategy Report</p>
        <p>Generated: ${metrics.reportDate.toLocaleString('en-GB')}</p>
        <p style="margin-top: 5px; font-size: 11px; color: #aaa;">Excludes 2025 historical hires ‚Ä¢ Focuses on active roles + 2026 starters</p>
    </div>
</body>
</html>
    `;
}

    </script>
    </body>
</html>